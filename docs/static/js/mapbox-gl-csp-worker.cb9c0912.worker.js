/*! For license information please see mapbox-gl-csp-worker.cb9c0912.worker.js.LICENSE.txt */
!function(){var e={897:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports},372:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},405:function(e,t,r){var n=r(897);e.exports=function(e){if(Array.isArray(e))return n(e)},e.exports.__esModule=!0,e.exports.default=e.exports},115:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},690:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},515:function(e,t,r){var n=r(15),i=r(617);function a(t,r,o){return i()?(e.exports=a=Reflect.construct.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=a=function(e,t,r){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return r&&n(a,r.prototype),a},e.exports.__esModule=!0,e.exports.default=e.exports),a.apply(null,arguments)}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},728:function(e){function t(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.exports=function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},704:function(e,t,r){var n=r(116);e.exports=function(e,t){var r="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=n(e))||t&&e&&"number"===typeof e.length){r&&(e=r);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==r.return||r.return()}finally{if(u)throw o}}}},e.exports.__esModule=!0,e.exports.default=e.exports},389:function(e,t,r){var n=r(808),i=r(617),a=r(993);e.exports=function(e){var t=i();return function(){var r,i=n(e);if(t){var o=n(this).constructor;r=Reflect.construct(i,arguments,o)}else r=i.apply(this,arguments);return a(this,r)}},e.exports.__esModule=!0,e.exports.default=e.exports},588:function(e,t,r){var n=r(753);function i(){return"undefined"!==typeof Reflect&&Reflect.get?(e.exports=i=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=i=function(e,t,r){var i=n(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?e:r):a.value}},e.exports.__esModule=!0,e.exports.default=e.exports),i.apply(this,arguments)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},808:function(e){function t(r){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},655:function(e,t,r){var n=r(15);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&n(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},35:function(e){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")},e.exports.__esModule=!0,e.exports.default=e.exports},617:function(e){e.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},498:function(e){e.exports=function(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},872:function(e){e.exports=function(e,t){var r=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(u){s=!0,i=u}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}},e.exports.__esModule=!0,e.exports.default=e.exports},218:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},281:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},993:function(e,t,r){var n=r(698).default,i=r(115);e.exports=function(e,t){if(t&&("object"===n(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},15:function(e){function t(r,n){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},424:function(e,t,r){var n=r(372),i=r(872),a=r(116),o=r(218);e.exports=function(e,t){return n(e)||i(e,t)||a(e,t)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},753:function(e,t,r){var n=r(808);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=n(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},589:function(e,t,r){var n=r(372),i=r(498),a=r(116),o=r(218);e.exports=function(e){return n(e)||i(e)||a(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},861:function(e,t,r){var n=r(405),i=r(498),a=r(116),o=r(281);e.exports=function(e){return n(e)||i(e)||a(e)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},698:function(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},116:function(e,t,r){var n=r(897);e.exports=function(e,t){if(e){if("string"===typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},496:function(e,t,r){var n=r(808),i=r(15),a=r(35),o=r(515);function s(t){var r="function"===typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!a(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof r){if(r.has(e))return r.get(e);r.set(e,t)}function t(){return o(e,arguments,n(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,s(t)}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}!function(){var e=r(115).default,t=r(515).default,n=r(588).default,i=r(808).default,a=r(993).default,o=r(589).default,s=r(861).default,u=r(704).default,l=r(655).default,c=r(389).default,h=r(496).default,f=r(424).default,p=r(690).default,y=r(728).default;!function(){"use strict";var r=d;function d(e,t,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=n}d.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,n=0;n<8;n++){var i=this.sampleCurveX(r)-e;if(Math.abs(i)<t)return r;var a=this.sampleCurveDerivativeX(r);if(Math.abs(a)<1e-6)break;r-=i/a}var o=0,s=1;for(r=e,n=0;n<20&&(i=this.sampleCurveX(r),!(Math.abs(i-e)<t));n++)e>i?o=r:s=r,r=.5*(s-o)+o;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}};var v=m;function m(e,t){this.x=e,this.y=t}m.prototype={clone:function(){return new m(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),n=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=n,this},_rotateAround:function(e,t){var r=Math.cos(e),n=Math.sin(e),i=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-n*(this.y-t.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},m.convert=function(e){return e instanceof m?e:Array.isArray(e)?new m(e[0],e[1]):e};var g="undefined"!=typeof self?self:{},x=Math.PI/180,b=180/Math.PI;function k(e){return e*x}function w(e){return e*b}function _(e,t,r){return Math.min(r,Math.max(t,e))}function S(e,t,r){var n=r-t,i=((e-t)%n+n)%n+t;return i===t?r:i}function A(e){var t=[];for(var r in e)t.push(e[r]);return t}function I(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var i=0,a=r;i<a.length;i++){var o=a[i];for(var s in o)e[s]=o[s]}return e}new r(.25,.1,.25,1);var M=1;function T(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function z(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function B(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}function C(e,t){return-1!==e.indexOf(t,e.length-t.length)}function P(e,t,r){var n={};for(var i in e)n[i]=t.call(r||this,e[i],i,e);return n}function E(e){return Array.isArray(e)?e.map(E):"object"==typeof e&&e?P(e,E):e}var D={};function V(e){D[e]||("undefined"!=typeof console&&console.warn(e),D[e]=!0)}function L(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function F(e){for(var t,r,n=0,i=0,a=e.length,o=a-1;i<a;o=i++)t=e[i],n+=((r=e[o]).x-t.x)*(t.y+r.y);return n}function R(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function j(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(e,r,n,i){var a=n||i;return t[r]=!a||a.toLowerCase(),""})),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var O=null;function U(e){if(null==O){var t=e.navigator?e.navigator.userAgent:null;O=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return O}function q(e){try{var t=g[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}function N(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}var Z=X;function X(e,t,r){var n=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var i=new Int32Array(this.arrayBuffer);e=i[0],this.d=(t=i[1])+2*(r=i[2]);for(var a=0;a<this.d*this.d;a++){var o=i[3+a],s=i[3+a+1];n.push(o===s?null:i.subarray(o,s))}var u=i[3+n.length+1];this.keys=i.subarray(i[3+n.length],u),this.bboxes=i.subarray(u),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var l=0;l<this.d*this.d;l++)n.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var c=r/t*e;this.min=-c,this.max=e+c}X.prototype.insert=function(e,t,r,n,i){this._forEachCell(t,r,n,i,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},X.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},X.prototype._insertCell=function(e,t,r,n,i,a){this.cells[i].push(a)},X.prototype.query=function(e,t,r,n,i){var a=this.min,o=this.max;if(e<=a&&t<=a&&o<=r&&o<=n&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,r,n,this._queryCell,s,{},i),s},X.prototype._queryCell=function(e,t,r,n,i,a,o,s){var u=this.cells[i];if(null!==u)for(var l=this.keys,c=this.bboxes,h=0;h<u.length;h++){var f=u[h];if(void 0===o[f]){var p=4*f;(s?s(c[p+0],c[p+1],c[p+2],c[p+3]):e<=c[p+2]&&t<=c[p+3]&&r>=c[p+0]&&n>=c[p+1])?(o[f]=!0,a.push(l[f])):o[f]=!1}}},X.prototype._forEachCell=function(e,t,r,n,i,a,o,s){for(var u=this._convertToCellCoord(e),l=this._convertToCellCoord(t),c=this._convertToCellCoord(r),h=this._convertToCellCoord(n),f=u;f<=c;f++)for(var p=l;p<=h;p++){var y=this.d*p+f;if((!s||s(this._convertFromCellCoord(f),this._convertFromCellCoord(p),this._convertFromCellCoord(f+1),this._convertFromCellCoord(p+1)))&&i.call(this,e,t,r,n,y,a,o,s))return}},X.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},X.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},X.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,n=0;n<this.cells.length;n++)r+=this.cells[n].length;var i=new Int32Array(t+r+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var a=t,o=0;o<e.length;o++){var s=e[o];i[3+o]=a,i.set(s,a),a+=s.length}return i[3+e.length]=a,i.set(this.keys,a),i[3+e.length+1]=a+=this.keys.length,i.set(this.bboxes,a),a+=this.bboxes.length,i.buffer};var G,Y={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function K(e){return(e=Math.round(e))<0?0:e>255?255:e}function J(e){return K("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function W(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function H(e,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}try{G={}.parseCSSColor=function(e){var t,r=e.replace(/ /g,"").toLowerCase();if(r in Y)return Y[r].slice();if("#"===r[0])return 4===r.length?(t=parseInt(r.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===r.length&&(t=parseInt(r.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var n=r.indexOf("("),i=r.indexOf(")");if(-1!==n&&i+1===r.length){var a=r.substr(0,n),o=r.substr(n+1,i-(n+1)).split(","),s=1;switch(a){case"rgba":if(4!==o.length)return null;s=W(o.pop());case"rgb":return 3!==o.length?null:[J(o[0]),J(o[1]),J(o[2]),s];case"hsla":if(4!==o.length)return null;s=W(o.pop());case"hsl":if(3!==o.length)return null;var u=(parseFloat(o[0])%360+360)%360/360,l=W(o[1]),c=W(o[2]),h=c<=.5?c*(l+1):c+l-c*l,f=2*c-h;return[K(255*H(f,h,u+1/3)),K(255*H(f,h,u)),K(255*H(f,h,u-1/3)),s];default:return null}}return null}}catch(r){}var $=function(){function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;p(this,e),this.r=t,this.g=r,this.b=n,this.a=i}return y(e,[{key:"toString",value:function(){var e=this.toArray(),t=f(e,4),r=t[0],n=t[1],i=t[2],a=t[3];return"rgba(".concat(Math.round(r),",").concat(Math.round(n),",").concat(Math.round(i),",").concat(a,")")}},{key:"toArray",value:function(){var e=this.r,t=this.g,r=this.b,n=this.a;return 0===n?[0,0,0,0]:[255*e/n,255*t/n,255*r/n,n]}},{key:"toArray01",value:function(){var e=this.r,t=this.g,r=this.b,n=this.a;return 0===n?[0,0,0,0]:[e/n,t/n,r/n,n]}},{key:"toArray01PremultipliedAlpha",value:function(){return[this.r,this.g,this.b,this.a]}}],[{key:"parse",value:function(t){if(t){if(t instanceof e)return t;if("string"==typeof t){var r=G(t);return r?new e(r[0]/255*r[3],r[1]/255*r[3],r[2]/255*r[3],r[3]):void 0}}}}]),e}();$.black=new $(0,0,0,1),$.white=new $(1,1,1,1),$.transparent=new $(0,0,0,0),$.red=new $(1,0,0,1),$.blue=new $(0,0,1,1);var Q=$;function ee(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];for(var i=0,a=r;i<a.length;i++){var o=a[i];for(var s in o)e[s]=o[s]}return e}var te=function(e){l(r,e);var t=c(r);function r(e,n){var i;return p(this,r),(i=t.call(this,n)).message=n,i.key=e,i}return y(r)}(h(Error)),re=te,ne=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];p(this,e),this.parent=t,this.bindings={};var n,i=u(r);try{for(i.s();!(n=i.n()).done;){var a=f(n.value,2),o=a[0],s=a[1];this.bindings[o]=s}}catch(l){i.e(l)}finally{i.f()}}return y(e,[{key:"concat",value:function(t){return new e(this,t)}},{key:"get",value:function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error("".concat(e," not found in scope."))}},{key:"has",value:function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}]),e}(),ie=ne,ae={kind:"null"},oe={kind:"number"},se={kind:"string"},ue={kind:"boolean"},le={kind:"color"},ce={kind:"object"},he={kind:"value"},fe={kind:"collator"},pe={kind:"formatted"},ye={kind:"resolvedImage"};function de(e,t){return{kind:"array",itemType:e,N:t}}function ve(e){if("array"===e.kind){var t=ve(e.itemType);return"number"==typeof e.N?"array<".concat(t,", ").concat(e.N,">"):"value"===e.itemType.kind?"array":"array<".concat(t,">")}return e.kind}var me=[ae,oe,se,ue,le,pe,ce,de(he),ye];function ge(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!ge(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind){var r,n=u(me);try{for(n.s();!(r=n.n()).done;){if(!ge(r.value,t))return null}}catch(i){n.e(i)}finally{n.f()}}}return"Expected ".concat(ve(e)," but found ").concat(ve(t)," instead.")}function xe(e,t){return t.some((function(t){return t.kind===e.kind}))}function be(e,t){return t.some((function(t){return"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e}))}var ke=function(){function e(t,r,n){p(this,e),this.sensitivity=t?r?"variant":"case":r?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}return y(e,[{key:"compare",value:function(e,t){return this.collator.compare(e,t)}},{key:"resolvedLocale",value:function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}]),e}(),we=y((function e(t,r,n,i,a){p(this,e),this.text=t.normalize?t.normalize():t,this.image=r,this.scale=n,this.fontStack=i,this.textColor=a})),_e=function(){function e(t){p(this,e),this.sections=t}return y(e,[{key:"isEmpty",value:function(){return 0===this.sections.length||!this.sections.some((function(e){return 0!==e.text.length||e.image&&0!==e.image.name.length}))}},{key:"toString",value:function(){return 0===this.sections.length?"":this.sections.map((function(e){return e.text})).join("")}},{key:"serialize",value:function(){var e,t=["format"],r=u(this.sections);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.image)t.push(["image",n.image.name]);else{t.push(n.text);var i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(i)}}}catch(a){r.e(a)}finally{r.f()}return t}}],[{key:"fromString",value:function(t){return new e([new we(t,null,null,null,null)])}},{key:"factory",value:function(t){return t instanceof e?t:e.fromString(t)}}]),e}(),Se=function(){function e(t){p(this,e),this.name=t.name,this.available=t.available}return y(e,[{key:"toString",value:function(){return this.name}},{key:"serialize",value:function(){return["image",this.name]}}],[{key:"fromString",value:function(t){return t?new e({name:t,available:!1}):null}}]),e}();function Ae(e,t,r,n){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid rgba value [".concat([e,t,r,n].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function Ie(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof Q)return!0;if(e instanceof ke)return!0;if(e instanceof _e)return!0;if(e instanceof Se)return!0;if(Array.isArray(e)){var t,r=u(e);try{for(r.s();!(t=r.n()).done;){if(!Ie(t.value))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}if("object"==typeof e){for(var n in e)if(!Ie(e[n]))return!1;return!0}return!1}function Me(e){if(null===e)return ae;if("string"==typeof e)return se;if("boolean"==typeof e)return ue;if("number"==typeof e)return oe;if(e instanceof Q)return le;if(e instanceof ke)return fe;if(e instanceof _e)return pe;if(e instanceof Se)return ye;if(Array.isArray(e)){var t,r,n=e.length,i=u(e);try{for(i.s();!(r=i.n()).done;){var a=Me(r.value);if(t){if(t===a)continue;t=he;break}t=a}}catch(o){i.e(o)}finally{i.f()}return de(t||he,n)}return ce}function Te(e){var t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Q||e instanceof _e||e instanceof Se?e.toString():JSON.stringify(e)}var ze=function(){function e(t,r){p(this,e),this.type=t,this.value=r}return y(e,[{key:"evaluate",value:function(){return this.value}},{key:"eachChild",value:function(){}},{key:"outputDefined",value:function(){return!0}},{key:"serialize",value:function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Q?["rgba"].concat(this.value.toArray()):this.value instanceof _e?this.value.serialize():this.value}}],[{key:"parse",value:function(t,r){if(2!==t.length)return r.error("'literal' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(!Ie(t[1]))return r.error("invalid value");var n=t[1],i=Me(n),a=r.expectedType;return"array"!==i.kind||0!==i.N||!a||"array"!==a.kind||"number"==typeof a.N&&0!==a.N||(i=a),new e(i,n)}}]),e}(),Be=ze,Ce=function(){function e(t){p(this,e),this.name="ExpressionEvaluationError",this.message=t}return y(e,[{key:"toJSON",value:function(){return this.message}}]),e}(),Pe={string:se,number:oe,boolean:ue,object:ce},Ee=function(){function e(t,r){p(this,e),this.type=t,this.args=r}return y(e,[{key:"evaluate",value:function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!ge(this.type,Me(r)))return r;if(t===this.args.length-1)throw new Ce("Expected value to be of type ".concat(ve(this.type),", but found ").concat(ve(Me(r))," instead."))}return null}},{key:"eachChild",value:function(e){this.args.forEach(e)}},{key:"outputDefined",value:function(){return this.args.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){var e=this.type,t=[e.kind];if("array"===e.kind){var r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){t.push(r.kind);var n=e.N;("number"==typeof n||this.args.length>1)&&t.push(n)}}return t.concat(this.args.map((function(e){return e.serialize()})))}}],[{key:"parse",value:function(t,r){if(t.length<2)return r.error("Expected at least one argument.");var n,i=1,a=t[0];if("array"===a){var o,s;if(t.length>2){var u=t[1];if("string"!=typeof u||!(u in Pe)||"object"===u)return r.error('The item type argument of "array" must be one of string, number, boolean',1);o=Pe[u],i++}else o=he;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return r.error('The length argument to "array" must be a positive integer literal',2);s=t[2],i++}n=de(o,s)}else n=Pe[a];for(var l=[];i<t.length;i++){var c=r.parse(t[i],i,he);if(!c)return null;l.push(c)}return new e(n,l)}}]),e}(),De=Ee,Ve=function(){function e(t){p(this,e),this.type=pe,this.sections=t}return y(e,[{key:"evaluate",value:function(e){return new _e(this.sections.map((function(t){var r=t.content.evaluate(e);return Me(r)===ye?new we("",r,null,null,null):new we(Te(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}},{key:"eachChild",value:function(e){var t,r=u(this.sections);try{for(r.s();!(t=r.n()).done;){var n=t.value;e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}}catch(i){r.e(i)}finally{r.f()}}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){var e,t=["format"],r=u(this.sections);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push(n.content.serialize());var i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),t.push(i)}}catch(a){r.e(a)}finally{r.f()}return t}}],[{key:"parse",value:function(t,r){if(t.length<2)return r.error("Expected at least one argument.");var n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return r.error("First argument must be an image or text section.");for(var i=[],a=!1,o=1;o<=t.length-1;++o){var s=t[o];if(a&&"object"==typeof s&&!Array.isArray(s)){a=!1;var u=null;if(s["font-scale"]&&!(u=r.parse(s["font-scale"],1,oe)))return null;var l=null;if(s["text-font"]&&!(l=r.parse(s["text-font"],1,de(se))))return null;var c=null;if(s["text-color"]&&!(c=r.parse(s["text-color"],1,le)))return null;var h=i[i.length-1];h.scale=u,h.font=l,h.textColor=c}else{var f=r.parse(t[o],1,he);if(!f)return null;var p=f.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return r.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");a=!0,i.push({content:f,scale:null,font:null,textColor:null})}}return new e(i)}}]),e}(),Le=function(){function e(t){p(this,e),this.type=ye,this.input=t}return y(e,[{key:"evaluate",value:function(e){var t=this.input.evaluate(e),r=Se.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r}},{key:"eachChild",value:function(e){e(this.input)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return["image",this.input.serialize()]}}],[{key:"parse",value:function(t,r){if(2!==t.length)return r.error("Expected two arguments.");var n=r.parse(t[1],1,se);return n?new e(n):r.error("No image name provided.")}}]),e}(),Fe={"to-boolean":ue,"to-color":le,"to-number":oe,"to-string":se},Re=function(){function e(t,r){p(this,e),this.type=t,this.args=r}return y(e,[{key:"evaluate",value:function(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){var t,r,n,i=u(this.args);try{for(i.s();!(n=i.n()).done;){if(t=n.value.evaluate(e),r=null,t instanceof Q)return t;if("string"==typeof t){var a=e.parseColor(t);if(a)return a}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value ".concat(JSON.stringify(t),": expected an array containing either three or four numeric values."):Ae(t[0],t[1],t[2],t[3])))return new Q(t[0]/255,t[1]/255,t[2]/255,t[3])}}catch(h){i.e(h)}finally{i.f()}throw new Ce(r||"Could not parse color from value '".concat("string"==typeof t?t:String(JSON.stringify(t)),"'"))}if("number"===this.type.kind){var o,s=null,l=u(this.args);try{for(l.s();!(o=l.n()).done;){if(null===(s=o.value.evaluate(e)))return 0;var c=Number(s);if(!isNaN(c))return c}}catch(h){l.e(h)}finally{l.f()}throw new Ce("Could not convert ".concat(JSON.stringify(s)," to number."))}return"formatted"===this.type.kind?_e.fromString(Te(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Se.fromString(Te(this.args[0].evaluate(e))):Te(this.args[0].evaluate(e))}},{key:"eachChild",value:function(e){this.args.forEach(e)}},{key:"outputDefined",value:function(){return this.args.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){if("formatted"===this.type.kind)return new Ve([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Le(this.args[0]).serialize();var e=["to-".concat(this.type.kind)];return this.eachChild((function(t){e.push(t.serialize())})),e}}],[{key:"parse",value:function(t,r){if(t.length<2)return r.error("Expected at least one argument.");var n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return r.error("Expected one argument.");for(var i=Fe[n],a=[],o=1;o<t.length;o++){var s=r.parse(t[o],o,he);if(!s)return null;a.push(s)}return new e(i,a)}}]),e}(),je=Re,Oe=["Unknown","Point","LineString","Polygon"],Ue=function(){function e(){p(this,e),this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}return y(e,[{key:"id",value:function(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}},{key:"geometryType",value:function(){return this.feature?"number"==typeof this.feature.type?Oe[this.feature.type]:this.feature.type:null}},{key:"geometry",value:function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}},{key:"canonicalID",value:function(){return this.canonical}},{key:"properties",value:function(){return this.feature&&this.feature.properties||{}}},{key:"distanceFromCenter",value:function(){if(this.featureTileCoord&&this.featureDistanceData){var e=this.featureDistanceData.center,t=this.featureDistanceData.scale,r=this.featureTileCoord,n=r.x,i=r.y;return this.featureDistanceData.bearing[0]*(n*t-e[0])+this.featureDistanceData.bearing[1]*(i*t-e[1])}return 0}},{key:"parseColor",value:function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Q.parse(e)),t}}]),e}(),qe=function(){function e(t,r,n,i){p(this,e),this.name=t,this.type=r,this._evaluate=n,this.args=i}return y(e,[{key:"evaluate",value:function(e){return this._evaluate(e,this.args)}},{key:"eachChild",value:function(e){this.args.forEach(e)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return[this.name].concat(this.args.map((function(e){return e.serialize()})))}}],[{key:"parse",value:function(t,r){var n,i=t[0],a=e.definitions[i];if(!a)return r.error('Unknown expression "'.concat(i,'". If you wanted a literal array, use ["literal", [...]].'),0);var o,l=Array.isArray(a)?a[0]:a.type,c=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,h=c.filter((function(e){var r=f(e,1)[0];return!Array.isArray(r)||r.length===t.length-1})),p=null,y=u(h);try{for(y.s();!(o=y.n()).done;){var d=f(o.value,2),v=d[0],m=d[1];p=new dt(r.registry,r.path,null,r.scope);for(var g=[],x=!1,b=1;b<t.length;b++){var k=t[b],w=Array.isArray(v)?v[b-1]:v.type,_=p.parse(k,1+g.length,w);if(!_){x=!0;break}g.push(_)}if(!x)if(Array.isArray(v)&&v.length!==g.length)p.error("Expected ".concat(v.length," arguments, but found ").concat(g.length," instead."));else{for(var S=0;S<g.length;S++){var A=Array.isArray(v)?v[S]:v.type,I=g[S];p.concat(S+1).checkSubtype(A,I.type)}if(0===p.errors.length)return new e(i,l,m,g)}}}catch(C){y.e(C)}finally{y.f()}if(1===h.length)(n=r.errors).push.apply(n,s(p.errors));else{for(var M=(h.length?h:c).map((function(e){var t;return t=f(e,1)[0],Array.isArray(t)?"(".concat(t.map(ve).join(", "),")"):"(".concat(ve(t.type),"...)")})).join(" | "),T=[],z=1;z<t.length;z++){var B=r.parse(t[z],1+T.length);if(!B)return null;T.push(ve(B.type))}r.error("Expected arguments of type ".concat(M,", but found (").concat(T.join(", "),") instead."))}return null}},{key:"register",value:function(t,r){for(var n in e.definitions=r,r)t[n]=e}}]),e}(),Ne=qe,Ze=function(){function e(t,r,n){p(this,e),this.type=fe,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=r}return y(e,[{key:"evaluate",value:function(e){return new ke(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}},{key:"eachChild",value:function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}],[{key:"parse",value:function(t,r){if(2!==t.length)return r.error("Expected one argument.");var n=t[1];if("object"!=typeof n||Array.isArray(n))return r.error("Collator options argument must be an object.");var i=r.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,ue);if(!i)return null;var a=r.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,ue);if(!a)return null;var o=null;return n.locale&&!(o=r.parse(n.locale,1,se))?null:new e(i,a,o)}}]),e}(),Xe=8192;function Ge(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Ye(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Ke(e,t){var r=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=Math.pow(2,t.z);return[Math.round(r*i*Xe),Math.round(n*i*Xe)]}function Je(e,t,r){var n=e[0]-t[0],i=e[1]-t[1],a=e[0]-r[0],o=e[1]-r[1];return n*o-a*i==0&&n*a<=0&&i*o<=0}function We(e,t){for(var r,n,i,a=!1,o=0,s=t.length;o<s;o++)for(var u=t[o],l=0,c=u.length;l<c-1;l++){if(Je(e,u[l],u[l+1]))return!1;(n=u[l])[1]>(r=e)[1]!=(i=u[l+1])[1]>r[1]&&r[0]<(i[0]-n[0])*(r[1]-n[1])/(i[1]-n[1])+n[0]&&(a=!a)}return a}function He(e,t){for(var r=0;r<t.length;r++)if(We(e,t[r]))return!0;return!1}function $e(e,t,r,n){var i=n[0]-r[0],a=n[1]-r[1],o=(e[0]-r[0])*a-i*(e[1]-r[1]),s=(t[0]-r[0])*a-i*(t[1]-r[1]);return o>0&&s<0||o<0&&s>0}function Qe(e,t,r){var n,i,a,o,s,l,c,h=u(r);try{for(h.s();!(n=h.n()).done;)for(var f=n.value,p=0;p<f.length-1;++p)if(0!=(l=[(s=f[p+1])[0]-(o=f[p])[0],s[1]-o[1]])[0]*(c=[(a=t)[0]-(i=e)[0],a[1]-i[1]])[1]-l[1]*c[0]&&$e(i,a,o,s)&&$e(o,s,i,a))return!0}catch(y){h.e(y)}finally{h.f()}return!1}function et(e,t){for(var r=0;r<e.length;++r)if(!We(e[r],t))return!1;for(var n=0;n<e.length-1;++n)if(Qe(e[n],e[n+1],t))return!1;return!0}function tt(e,t){for(var r=0;r<t.length;r++)if(et(e,t[r]))return!0;return!1}function rt(e,t,r){for(var n=[],i=0;i<e.length;i++){for(var a=[],o=0;o<e[i].length;o++){var s=Ke(e[i][o],r);Ge(t,s),a.push(s)}n.push(a)}return n}function nt(e,t,r){for(var n=[],i=0;i<e.length;i++){var a=rt(e[i],t,r);n.push(a)}return n}function it(e,t,r,n){if(e[0]<r[0]||e[0]>r[2]){var i=.5*n,a=e[0]-r[0]>i?-n:r[0]-e[0]>i?n:0;0===a&&(a=e[0]-r[2]>i?-n:r[2]-e[0]>i?n:0),e[0]+=a}Ge(t,e)}function at(e,t,r,n){var i=Math.pow(2,n.z)*Xe,a=[n.x*Xe,n.y*Xe],o=[];if(!e)return o;var s,l=u(e);try{for(l.s();!(s=l.n()).done;){var c,h=s.value,f=u(h);try{for(f.s();!(c=f.n()).done;){var p=c.value,y=[p.x+a[0],p.y+a[1]];it(y,t,r,i),o.push(y)}}catch(d){f.e(d)}finally{f.f()}}}catch(d){l.e(d)}finally{l.f()}return o}function ot(e,t,r,n){var i=Math.pow(2,n.z)*Xe,a=[n.x*Xe,n.y*Xe],o=[];if(!e)return o;var s,l,c=u(e);try{for(c.s();!(s=c.n()).done;){var h,f=s.value,p=[],y=u(f);try{for(y.s();!(h=y.n()).done;){var d=h.value,v=[d.x+a[0],d.y+a[1]];Ge(t,v),p.push(v)}}catch(w){y.e(w)}finally{y.f()}o.push(p)}}catch(w){c.e(w)}finally{c.f()}if(t[2]-t[0]<=i/2){(l=t)[0]=l[1]=1/0,l[2]=l[3]=-1/0;var m,g=u(o);try{for(g.s();!(m=g.n()).done;){var x,b=m.value,k=u(b);try{for(k.s();!(x=k.n()).done;){it(x.value,t,r,i)}}catch(w){k.e(w)}finally{k.f()}}}catch(w){g.e(w)}finally{g.f()}}return o}var st=function(){function e(t,r){p(this,e),this.type=ue,this.geojson=t,this.geometries=r}return y(e,[{key:"evaluate",value:function(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){var a=rt(t.coordinates,n,i),o=at(e.geometry(),r,n,i);if(!Ye(r,n))return!1;var s,l=u(o);try{for(l.s();!(s=l.n()).done;){if(!We(s.value,a))return!1}}catch(y){l.e(y)}finally{l.f()}}if("MultiPolygon"===t.type){var c=nt(t.coordinates,n,i),h=at(e.geometry(),r,n,i);if(!Ye(r,n))return!1;var f,p=u(h);try{for(p.s();!(f=p.n()).done;){if(!He(f.value,c))return!1}}catch(y){p.e(y)}finally{p.f()}}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){var a=rt(t.coordinates,n,i),o=ot(e.geometry(),r,n,i);if(!Ye(r,n))return!1;var s,l=u(o);try{for(l.s();!(s=l.n()).done;){if(!et(s.value,a))return!1}}catch(y){l.e(y)}finally{l.f()}}if("MultiPolygon"===t.type){var c=nt(t.coordinates,n,i),h=ot(e.geometry(),r,n,i);if(!Ye(r,n))return!1;var f,p=u(h);try{for(p.s();!(f=p.n()).done;){if(!tt(f.value,c))return!1}}catch(y){p.e(y)}finally{p.f()}}return!0}(e,this.geometries)}return!1}},{key:"eachChild",value:function(){}},{key:"outputDefined",value:function(){return!0}},{key:"serialize",value:function(){return["within",this.geojson]}}],[{key:"parse",value:function(t,r){if(2!==t.length)return r.error("'within' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(Ie(t[1])){var n=t[1];if("FeatureCollection"===n.type)for(var i=0;i<n.features.length;++i){var a=n.features[i].geometry.type;if("Polygon"===a||"MultiPolygon"===a)return new e(n,n.features[i].geometry)}else if("Feature"===n.type){var o=n.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new e(n,n.geometry)}else if("Polygon"===n.type||"MultiPolygon"===n.type)return new e(n,n)}return r.error("'within' expression requires valid geojson object that contains polygon geometry type.")}}]),e}(),ut=st;function lt(e){if(e instanceof Ne){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof ut)return!1;var t=!0;return e.eachChild((function(e){t&&!lt(e)&&(t=!1)})),t}function ct(e){if(e instanceof Ne&&"feature-state"===e.name)return!1;var t=!0;return e.eachChild((function(e){t&&!ct(e)&&(t=!1)})),t}function ht(e,t){if(e instanceof Ne&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild((function(e){r&&!ht(e,t)&&(r=!1)})),r}var ft=function(){function e(t,r){p(this,e),this.type=r.type,this.name=t,this.boundExpression=r}return y(e,[{key:"evaluate",value:function(e){return this.boundExpression.evaluate(e)}},{key:"eachChild",value:function(){}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return["var",this.name]}}],[{key:"parse",value:function(t,r){if(2!==t.length||"string"!=typeof t[1])return r.error("'var' expression requires exactly one string literal argument.");var n=t[1];return r.scope.has(n)?new e(n,r.scope.get(n)):r.error('Unknown variable "'.concat(n,'". Make sure "').concat(n,'" has been bound in an enclosing "let" expression before using it.'),1)}}]),e}(),pt=ft,yt=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ie,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];p(this,e),this.registry=t,this.path=r,this.key=r.map((function(e){return"[".concat(e,"]")})).join(""),this.scope=i,this.errors=a,this.expectedType=n}return y(e,[{key:"parse",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t?this.concat(t,r,n)._parse(e,i):this._parse(e,i)}},{key:"_parse",value:function(e,t){function r(e,t,r){return"assert"===r?new De(t,[e]):"coerce"===r?new je(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var n=e[0];if("string"!=typeof n)return this.error("Expression name must be a string, but found ".concat(typeof n,' instead. If you wanted a literal array, use ["literal", [...]].'),0),null;var i=this.registry[n];if(i){var a=i.parse(e,this);if(!a)return null;if(this.expectedType){var o=this.expectedType,s=a.type;if("string"!==o.kind&&"number"!==o.kind&&"boolean"!==o.kind&&"object"!==o.kind&&"array"!==o.kind||"value"!==s.kind)if("color"!==o.kind&&"formatted"!==o.kind&&"resolvedImage"!==o.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(o,s))return null}else a=r(a,o,t.typeAnnotation||"coerce");else a=r(a,o,t.typeAnnotation||"assert")}if(!(a instanceof Be)&&"resolvedImage"!==a.type.kind&&vt(a)){var u=new Ue;try{a=new Be(a.type,a.evaluate(u))}catch(e){return this.error(e.message),null}}return a}return this.error('Unknown expression "'.concat(n,'". If you wanted a literal array, use ["literal", [...]].'),0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof e," instead."))}},{key:"concat",value:function(t,r,n){var i="number"==typeof t?this.path.concat(t):this.path,a=n?this.scope.concat(n):this.scope;return new e(this.registry,i,r||null,a,this.errors)}},{key:"error",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];var i="".concat(this.key).concat(r.map((function(e){return"[".concat(e,"]")})).join(""));this.errors.push(new re(i,e))}},{key:"checkSubtype",value:function(e,t){var r=ge(e,t);return r&&this.error(r),r}}]),e}(),dt=yt;function vt(e){if(e instanceof pt)return vt(e.boundExpression);if(e instanceof Ne&&"error"===e.name)return!1;if(e instanceof Ze)return!1;if(e instanceof ut)return!1;var t=e instanceof je||e instanceof De,r=!0;return e.eachChild((function(e){r=t?r&&vt(e):r&&e instanceof Be})),!!r&&lt(e)&&ht(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function mt(e,t){for(var r,n,i=e.length-1,a=0,o=i,s=0;a<=o;)if(r=e[s=Math.floor((a+o)/2)],n=e[s+1],r<=t){if(s===i||t<n)return s;a=s+1}else{if(!(r>t))throw new Ce("Input is not a number.");o=s-1}return 0}var gt=function(){function e(t,r,n){p(this,e),this.type=t,this.input=r,this.labels=[],this.outputs=[];var i,a=u(n);try{for(a.s();!(i=a.n()).done;){var o=f(i.value,2),s=o[0],l=o[1];this.labels.push(s),this.outputs.push(l)}}catch(c){a.e(c)}finally{a.f()}}return y(e,[{key:"evaluate",value:function(e){var t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);var n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);var i=t.length;return n>=t[i-1]?r[i-1].evaluate(e):r[mt(t,n)].evaluate(e)}},{key:"eachChild",value:function(e){e(this.input);var t,r=u(this.outputs);try{for(r.s();!(t=r.n()).done;){e(t.value)}}catch(n){r.e(n)}finally{r.f()}}},{key:"outputDefined",value:function(){return this.outputs.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}],[{key:"parse",value:function(t,r){if(t.length-1<4)return r.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");var n=r.parse(t[1],1,oe);if(!n)return null;var i=[],a=null;r.expectedType&&"value"!==r.expectedType.kind&&(a=r.expectedType);for(var o=1;o<t.length;o+=2){var s=1===o?-1/0:t[o],u=t[o+1],l=o,c=o+1;if("number"!=typeof s)return r.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',l);if(i.length&&i[i.length-1][0]>=s)return r.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',l);var h=r.parse(u,c,a);if(!h)return null;a=a||h.type,i.push([s,h])}return new e(a,n,i)}}]),e}(),xt=gt;function bt(e,t,r){return e*(1-r)+t*r}var kt=Object.freeze({__proto__:null,number:bt,color:function(e,t,r){return new Q(bt(e.r,t.r,r),bt(e.g,t.g,r),bt(e.b,t.b,r),bt(e.a,t.a,r))},array:function(e,t,r){return e.map((function(e,n){return bt(e,t[n],r)}))}}),wt=.95047,_t=1.08883,St=4/29,At=6/29,It=3*At*At,Mt=Math.PI/180,Tt=180/Math.PI;function zt(e){return e>.008856451679035631?Math.pow(e,1/3):e/It+St}function Bt(e){return e>At?e*e*e:It*(e-St)}function Ct(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Pt(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Et(e){var t=Pt(e.r),r=Pt(e.g),n=Pt(e.b),i=zt((.4124564*t+.3575761*r+.1804375*n)/wt),a=zt((.2126729*t+.7151522*r+.072175*n)/1);return{l:116*a-16,a:500*(i-a),b:200*(a-zt((.0193339*t+.119192*r+.9503041*n)/_t)),alpha:e.a}}function Dt(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*Bt(t),r=wt*Bt(r),n=_t*Bt(n),new Q(Ct(3.2404542*r-1.5371385*t-.4985314*n),Ct(-.969266*r+1.8760108*t+.041556*n),Ct(.0556434*r-.2040259*t+1.0572252*n),e.alpha)}function Vt(e,t,r){var n=t-e;return e+r*(n>180||n<-180?n-360*Math.round(n/360):n)}var Lt={forward:Et,reverse:Dt,interpolate:function(e,t,r){return{l:bt(e.l,t.l,r),a:bt(e.a,t.a,r),b:bt(e.b,t.b,r),alpha:bt(e.alpha,t.alpha,r)}}},Ft={forward:function(e){var t=Et(e),r=t.l,n=t.a,i=t.b,a=Math.atan2(i,n)*Tt;return{h:a<0?a+360:a,c:Math.sqrt(n*n+i*i),l:r,alpha:e.a}},reverse:function(e){var t=e.h*Mt,r=e.c;return Dt({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:Vt(e.h,t.h,r),c:bt(e.c,t.c,r),l:bt(e.l,t.l,r),alpha:bt(e.alpha,t.alpha,r)}}},Rt=Object.freeze({__proto__:null,lab:Lt,hcl:Ft}),jt=function(){function e(t,r,n,i,a){p(this,e),this.type=t,this.operator=r,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];var o,s=u(a);try{for(s.s();!(o=s.n()).done;){var l=f(o.value,2),c=l[0],h=l[1];this.labels.push(c),this.outputs.push(h)}}catch(y){s.e(y)}finally{s.f()}}return y(e,[{key:"evaluate",value:function(t){var r=this.labels,n=this.outputs;if(1===r.length)return n[0].evaluate(t);var i=this.input.evaluate(t);if(i<=r[0])return n[0].evaluate(t);var a=r.length;if(i>=r[a-1])return n[a-1].evaluate(t);var o=mt(r,i),s=e.interpolationFactor(this.interpolation,i,r[o],r[o+1]),u=n[o].evaluate(t),l=n[o+1].evaluate(t);return"interpolate"===this.operator?kt[this.type.kind.toLowerCase()](u,l,s):"interpolate-hcl"===this.operator?Ft.reverse(Ft.interpolate(Ft.forward(u),Ft.forward(l),s)):Lt.reverse(Lt.interpolate(Lt.forward(u),Lt.forward(l),s))}},{key:"eachChild",value:function(e){e(this.input);var t,r=u(this.outputs);try{for(r.s();!(t=r.n()).done;){e(t.value)}}catch(n){r.e(n)}finally{r.f()}}},{key:"outputDefined",value:function(){return this.outputs.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){var e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t}}],[{key:"interpolationFactor",value:function(e,t,n,i){var a=0;if("exponential"===e.name)a=Ot(t,e.base,n,i);else if("linear"===e.name)a=Ot(t,1,n,i);else if("cubic-bezier"===e.name){var o=e.controlPoints;a=new r(o[0],o[1],o[2],o[3]).solve(Ot(t,1,n,i))}return a}},{key:"parse",value:function(t,r){var n=o(t),i=n[0],a=n[1],s=n[2],u=n.slice(3);if(!Array.isArray(a)||0===a.length)return r.error("Expected an interpolation type expression.",1);if("linear"===a[0])a={name:"linear"};else if("exponential"===a[0]){var l=a[1];if("number"!=typeof l)return r.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:l}}else{if("cubic-bezier"!==a[0])return r.error("Unknown interpolation type ".concat(String(a[0])),1,0);var c=a.slice(1);if(4!==c.length||c.some((function(e){return"number"!=typeof e||e<0||e>1})))return r.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:c}}if(t.length-1<4)return r.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!=0)return r.error("Expected an even number of arguments.");if(!(s=r.parse(s,2,oe)))return null;var h=[],f=null;"interpolate-hcl"===i||"interpolate-lab"===i?f=le:r.expectedType&&"value"!==r.expectedType.kind&&(f=r.expectedType);for(var p=0;p<u.length;p+=2){var y=u[p],d=u[p+1],v=p+3,m=p+4;if("number"!=typeof y)return r.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(h.length&&h[h.length-1][0]>=y)return r.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',v);var g=r.parse(d,m,f);if(!g)return null;f=f||g.type,h.push([y,g])}return"number"===f.kind||"color"===f.kind||"array"===f.kind&&"number"===f.itemType.kind&&"number"==typeof f.N?new e(f,i,a,s,h):r.error("Type ".concat(ve(f)," is not interpolatable."))}}]),e}();function Ot(e,t,r,n){var i=n-r,a=e-r;return 0===i?0:1===t?a/i:(Math.pow(t,a)-1)/(Math.pow(t,i)-1)}var Ut=jt,qt=function(){function e(t,r){p(this,e),this.type=t,this.args=r}return y(e,[{key:"evaluate",value:function(e){var t,r,n=null,i=0,a=u(this.args);try{for(a.s();!(r=a.n()).done;){var o=r.value;if(i++,(n=o.evaluate(e))&&n instanceof Se&&!n.available&&(t||(t=n),n=null,i===this.args.length))return t;if(null!==n)break}}catch(s){a.e(s)}finally{a.f()}return n}},{key:"eachChild",value:function(e){this.args.forEach(e)}},{key:"outputDefined",value:function(){return this.args.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){var e=["coalesce"];return this.eachChild((function(t){e.push(t.serialize())})),e}}],[{key:"parse",value:function(t,r){if(t.length<2)return r.error("Expectected at least one argument.");var n=null,i=r.expectedType;i&&"value"!==i.kind&&(n=i);var a,o=[],s=u(t.slice(1));try{for(s.s();!(a=s.n()).done;){var l=a.value,c=r.parse(l,1+o.length,n,void 0,{typeAnnotation:"omit"});if(!c)return null;n=n||c.type,o.push(c)}}catch(f){s.e(f)}finally{s.f()}var h=i&&o.some((function(e){return ge(i,e.type)}));return new e(h?he:n,o)}}]),e}(),Nt=qt,Zt=function(){function e(t,r){p(this,e),this.type=r.type,this.bindings=[].concat(t),this.result=r}return y(e,[{key:"evaluate",value:function(e){return this.result.evaluate(e)}},{key:"eachChild",value:function(e){var t,r=u(this.bindings);try{for(r.s();!(t=r.n()).done;){e(t.value[1])}}catch(n){r.e(n)}finally{r.f()}e(this.result)}},{key:"outputDefined",value:function(){return this.result.outputDefined()}},{key:"serialize",value:function(){var e,t=["let"],r=u(this.bindings);try{for(r.s();!(e=r.n()).done;){var n=f(e.value,2),i=n[0],a=n[1];t.push(i,a.serialize())}}catch(o){r.e(o)}finally{r.f()}return t.push(this.result.serialize()),t}}],[{key:"parse",value:function(t,r){if(t.length<4)return r.error("Expected at least 3 arguments, but found ".concat(t.length-1," instead."));for(var n=[],i=1;i<t.length-1;i+=2){var a=t[i];if("string"!=typeof a)return r.error("Expected string, but found ".concat(typeof a," instead."),i);if(/[^a-zA-Z0-9_]/.test(a))return r.error("Variable names must contain only alphanumeric characters or '_'.",i);var o=r.parse(t[i+1],i+1);if(!o)return null;n.push([a,o])}var s=r.parse(t[t.length-1],t.length-1,r.expectedType,n);return s?new e(n,s):null}}]),e}(),Xt=Zt,Gt=function(){function e(t,r,n){p(this,e),this.type=t,this.index=r,this.input=n}return y(e,[{key:"evaluate",value:function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Ce("Array index out of bounds: ".concat(t," < 0."));if(t>=r.length)throw new Ce("Array index out of bounds: ".concat(t," > ").concat(r.length-1,"."));if(t!==Math.floor(t))throw new Ce("Array index must be an integer, but found ".concat(t," instead."));return r[t]}},{key:"eachChild",value:function(e){e(this.index),e(this.input)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return["at",this.index.serialize(),this.input.serialize()]}}],[{key:"parse",value:function(t,r){if(3!==t.length)return r.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));var n=r.parse(t[1],1,oe),i=r.parse(t[2],2,de(r.expectedType||he));return n&&i?new e(i.type.itemType,n,i):null}}]),e}(),Yt=Gt,Kt=function(){function e(t,r){p(this,e),this.type=ue,this.needle=t,this.haystack=r}return y(e,[{key:"evaluate",value:function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!be(t,["boolean","string","number","null"]))throw new Ce("Expected first argument to be of type boolean, string, number or null, but found ".concat(ve(Me(t))," instead."));if(!be(r,["string","array"]))throw new Ce("Expected second argument to be of type array or string, but found ".concat(ve(Me(r))," instead."));return r.indexOf(t)>=0}},{key:"eachChild",value:function(e){e(this.needle),e(this.haystack)}},{key:"outputDefined",value:function(){return!0}},{key:"serialize",value:function(){return["in",this.needle.serialize(),this.haystack.serialize()]}}],[{key:"parse",value:function(t,r){if(3!==t.length)return r.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));var n=r.parse(t[1],1,he),i=r.parse(t[2],2,he);return n&&i?xe(n.type,[ue,se,oe,ae,he])?new e(n,i):r.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(ve(n.type)," instead")):null}}]),e}(),Jt=Kt,Wt=function(){function e(t,r,n){p(this,e),this.type=oe,this.needle=t,this.haystack=r,this.fromIndex=n}return y(e,[{key:"evaluate",value:function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!be(t,["boolean","string","number","null"]))throw new Ce("Expected first argument to be of type boolean, string, number or null, but found ".concat(ve(Me(t))," instead."));if(!be(r,["string","array"]))throw new Ce("Expected second argument to be of type array or string, but found ".concat(ve(Me(r))," instead."));if(this.fromIndex){var n=this.fromIndex.evaluate(e);return r.indexOf(t,n)}return r.indexOf(t)}},{key:"eachChild",value:function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}],[{key:"parse",value:function(t,r){if(t.length<=2||t.length>=5)return r.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));var n=r.parse(t[1],1,he),i=r.parse(t[2],2,he);if(!n||!i)return null;if(!xe(n.type,[ue,se,oe,ae,he]))return r.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(ve(n.type)," instead"));if(4===t.length){var a=r.parse(t[3],3,oe);return a?new e(n,i,a):null}return new e(n,i)}}]),e}(),Ht=Wt,$t=function(){function e(t,r,n,i,a,o){p(this,e),this.inputType=t,this.type=r,this.input=n,this.cases=i,this.outputs=a,this.otherwise=o}return y(e,[{key:"evaluate",value:function(e){var t=this.input.evaluate(e);return(Me(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}},{key:"eachChild",value:function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}},{key:"outputDefined",value:function(){return this.outputs.every((function(e){return e.outputDefined()}))&&this.otherwise.outputDefined()}},{key:"serialize",value:function(){var e,t=this,r=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),i=[],a={},o=u(n);try{for(o.s();!(e=o.n()).done;){var s=e.value,l=a[this.cases[s]];void 0===l?(a[this.cases[s]]=i.length,i.push([this.cases[s],[s]])):i[l][1].push(s)}}catch(m){o.e(m)}finally{o.f()}for(var c=function(e){return"number"===t.inputType.kind?Number(e):e},h=0,p=i;h<p.length;h++){var y=f(p[h],2),d=y[0],v=y[1];r.push(1===v.length?c(v[0]):v.map(c)),r.push(this.outputs[d].serialize())}return r.push(this.otherwise.serialize()),r}}],[{key:"parse",value:function(t,r){if(t.length<5)return r.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!=1)return r.error("Expected an even number of arguments.");var n,i;r.expectedType&&"value"!==r.expectedType.kind&&(i=r.expectedType);for(var a={},o=[],s=2;s<t.length-1;s+=2){var l=t[s],c=t[s+1];Array.isArray(l)||(l=[l]);var h=r.concat(s);if(0===l.length)return h.error("Expected at least one branch label.");var f,p=u(l);try{for(p.s();!(f=p.n()).done;){var y=f.value;if("number"!=typeof y&&"string"!=typeof y)return h.error("Branch labels must be numbers or strings.");if("number"==typeof y&&Math.abs(y)>Number.MAX_SAFE_INTEGER)return h.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof y&&Math.floor(y)!==y)return h.error("Numeric branch labels must be integer values.");if(n){if(h.checkSubtype(n,Me(y)))return null}else n=Me(y);if(void 0!==a[String(y)])return h.error("Branch labels must be unique.");a[String(y)]=o.length}}catch(g){p.e(g)}finally{p.f()}var d=r.parse(c,s,i);if(!d)return null;i=i||d.type,o.push(d)}var v=r.parse(t[1],1,he);if(!v)return null;var m=r.parse(t[t.length-1],t.length-1,i);return m?"value"!==v.type.kind&&r.concat(1).checkSubtype(n,v.type)?null:new e(n,i,v,a,o,m):null}}]),e}(),Qt=$t,er=function(){function e(t,r,n){p(this,e),this.type=t,this.branches=r,this.otherwise=n}return y(e,[{key:"evaluate",value:function(e){var t,r=u(this.branches);try{for(r.s();!(t=r.n()).done;){var n=f(t.value,2),i=n[0],a=n[1];if(i.evaluate(e))return a.evaluate(e)}}catch(o){r.e(o)}finally{r.f()}return this.otherwise.evaluate(e)}},{key:"eachChild",value:function(e){var t,r=u(this.branches);try{for(r.s();!(t=r.n()).done;){var n=f(t.value,2),i=n[0],a=n[1];e(i),e(a)}}catch(o){r.e(o)}finally{r.f()}e(this.otherwise)}},{key:"outputDefined",value:function(){return this.branches.every((function(e){var t=f(e,2);t[0];return t[1].outputDefined()}))&&this.otherwise.outputDefined()}},{key:"serialize",value:function(){var e=["case"];return this.eachChild((function(t){e.push(t.serialize())})),e}}],[{key:"parse",value:function(t,r){if(t.length<4)return r.error("Expected at least 3 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!=0)return r.error("Expected an odd number of arguments.");var n;r.expectedType&&"value"!==r.expectedType.kind&&(n=r.expectedType);for(var i=[],a=1;a<t.length-1;a+=2){var o=r.parse(t[a],a,ue);if(!o)return null;var s=r.parse(t[a+1],a+1,n);if(!s)return null;i.push([o,s]),n=n||s.type}var u=r.parse(t[t.length-1],t.length-1,n);return u?new e(n,i,u):null}}]),e}(),tr=er,rr=function(){function e(t,r,n,i){p(this,e),this.type=t,this.input=r,this.beginIndex=n,this.endIndex=i}return y(e,[{key:"evaluate",value:function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!be(t,["string","array"]))throw new Ce("Expected first argument to be of type array or string, but found ".concat(ve(Me(t))," instead."));if(this.endIndex){var n=this.endIndex.evaluate(e);return t.slice(r,n)}return t.slice(r)}},{key:"eachChild",value:function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){if(null!=this.endIndex&&void 0!==this.endIndex){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}],[{key:"parse",value:function(t,r){if(t.length<=2||t.length>=5)return r.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));var n=r.parse(t[1],1,he),i=r.parse(t[2],2,oe);if(!n||!i)return null;if(!xe(n.type,[de(he),se,he]))return r.error("Expected first argument to be of type array or string, but found ".concat(ve(n.type)," instead"));if(4===t.length){var a=r.parse(t[3],3,oe);return a?new e(n.type,n,i,a):null}return new e(n.type,n,i)}}]),e}(),nr=rr;function ir(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function ar(e,t,r,n){return 0===n.compare(t,r)}function or(e,t,r){var n="=="!==e&&"!="!==e;return function(){function i(e,t,r){p(this,i),this.type=ue,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}return y(i,[{key:"evaluate",value:function(i){var a=this.lhs.evaluate(i),o=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){var s=Me(a),u=Me(o);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new Ce('Expected arguments for "'.concat(e,'" to be (string, string) or (number, number), but found (').concat(s.kind,", ").concat(u.kind,") instead."))}if(this.collator&&!n&&this.hasUntypedArgument){var l=Me(a),c=Me(o);if("string"!==l.kind||"string"!==c.kind)return t(i,a,o)}return this.collator?r(i,a,o,this.collator.evaluate(i)):t(i,a,o)}},{key:"eachChild",value:function(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}},{key:"outputDefined",value:function(){return!0}},{key:"serialize",value:function(){var t=[e];return this.eachChild((function(e){t.push(e.serialize())})),t}}],[{key:"parse",value:function(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");var r=e[0],a=t.parse(e[1],1,he);if(!a)return null;if(!ir(r,a.type))return t.concat(1).error('"'.concat(r,"\" comparisons are not supported for type '").concat(ve(a.type),"'."));var o=t.parse(e[2],2,he);if(!o)return null;if(!ir(r,o.type))return t.concat(2).error('"'.concat(r,"\" comparisons are not supported for type '").concat(ve(o.type),"'."));if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error("Cannot compare types '".concat(ve(a.type),"' and '").concat(ve(o.type),"'."));n&&("value"===a.type.kind&&"value"!==o.type.kind?a=new De(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new De(a.type,[o])));var s=null;if(4===e.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error("Cannot use collator to compare non-string types.");if(!(s=t.parse(e[3],3,fe)))return null}return new i(a,o,s)}}]),i}()}var sr=or("==",(function(e,t,r){return t===r}),ar),ur=or("!=",(function(e,t,r){return t!==r}),(function(e,t,r,n){return!ar(0,t,r,n)})),lr=or("<",(function(e,t,r){return t<r}),(function(e,t,r,n){return n.compare(t,r)<0})),cr=or(">",(function(e,t,r){return t>r}),(function(e,t,r,n){return n.compare(t,r)>0})),hr=or("<=",(function(e,t,r){return t<=r}),(function(e,t,r,n){return n.compare(t,r)<=0})),fr=or(">=",(function(e,t,r){return t>=r}),(function(e,t,r,n){return n.compare(t,r)>=0})),pr=function(){function e(t,r,n,i,a,o){p(this,e),this.type=se,this.number=t,this.locale=r,this.currency=n,this.unit=i,this.minFractionDigits=a,this.maxFractionDigits=o}return y(e,[{key:"evaluate",value:function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}},{key:"eachChild",value:function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}],[{key:"parse",value:function(t,r){if(3!==t.length)return r.error("Expected two arguments.");var n=r.parse(t[1],1,oe);if(!n)return null;var i=t[2];if("object"!=typeof i||Array.isArray(i))return r.error("NumberFormat options argument must be an object.");var a=null;if(i.locale&&!(a=r.parse(i.locale,1,se)))return null;var o=null;if(i.currency&&!(o=r.parse(i.currency,1,se)))return null;var s=null;if(i.unit&&!(s=r.parse(i.unit,1,se)))return null;var u=null;if(i["min-fraction-digits"]&&!(u=r.parse(i["min-fraction-digits"],1,oe)))return null;var l=null;return i["max-fraction-digits"]&&!(l=r.parse(i["max-fraction-digits"],1,oe))?null:new e(n,a,o,s,u,l)}}]),e}(),yr=function(){function e(t){p(this,e),this.type=oe,this.input=t}return y(e,[{key:"evaluate",value:function(e){var t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Ce("Expected value to be of type string or array, but found ".concat(ve(Me(t))," instead."))}},{key:"eachChild",value:function(e){e(this.input)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){var e=["length"];return this.eachChild((function(t){e.push(t.serialize())})),e}}],[{key:"parse",value:function(t,r){if(2!==t.length)return r.error("Expected 1 argument, but found ".concat(t.length-1," instead."));var n=r.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?r.error("Expected argument of type string or array, but found ".concat(ve(n.type)," instead.")):new e(n):null}}]),e}(),dr={"==":sr,"!=":ur,">":cr,"<":lr,">=":fr,"<=":hr,array:De,at:Yt,boolean:De,case:tr,coalesce:Nt,collator:Ze,format:Ve,image:Le,in:Jt,"index-of":Ht,interpolate:Ut,"interpolate-hcl":Ut,"interpolate-lab":Ut,length:yr,let:Xt,literal:Be,match:Qt,number:De,"number-format":pr,object:De,slice:nr,step:xt,string:De,"to-boolean":je,"to-color":je,"to-number":je,"to-string":je,var:pt,within:ut};function vr(e,t){var r=f(t,4),n=r[0],i=r[1],a=r[2],o=r[3];n=n.evaluate(e),i=i.evaluate(e),a=a.evaluate(e);var s=o?o.evaluate(e):1,u=Ae(n,i,a,s);if(u)throw new Ce(u);return new Q(n/255*s,i/255*s,a/255*s,s)}function mr(e,t){return e in t}function gr(e,t){var r=t[e];return void 0===r?null:r}function xr(e){return{type:e}}Ne.register(dr,{error:[{kind:"error"},[se],function(e,t){var r=f(t,1)[0];throw new Ce(r.evaluate(e))}],typeof:[se,[he],function(e,t){return ve(Me(f(t,1)[0].evaluate(e)))}],"to-rgba":[de(oe,4),[le],function(e,t){return f(t,1)[0].evaluate(e).toArray()}],rgb:[le,[oe,oe,oe],vr],rgba:[le,[oe,oe,oe,oe],vr],has:{type:ue,overloads:[[[se],function(e,t){return mr(f(t,1)[0].evaluate(e),e.properties())}],[[se,ce],function(e,t){var r=f(t,2),n=r[0],i=r[1];return mr(n.evaluate(e),i.evaluate(e))}]]},get:{type:he,overloads:[[[se],function(e,t){return gr(f(t,1)[0].evaluate(e),e.properties())}],[[se,ce],function(e,t){var r=f(t,2),n=r[0],i=r[1];return gr(n.evaluate(e),i.evaluate(e))}]]},"feature-state":[he,[se],function(e,t){return gr(f(t,1)[0].evaluate(e),e.featureState||{})}],properties:[ce,[],function(e){return e.properties()}],"geometry-type":[se,[],function(e){return e.geometryType()}],id:[he,[],function(e){return e.id()}],zoom:[oe,[],function(e){return e.globals.zoom}],pitch:[oe,[],function(e){return e.globals.pitch||0}],"distance-from-center":[oe,[],function(e){return e.distanceFromCenter()}],"heatmap-density":[oe,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[oe,[],function(e){return e.globals.lineProgress||0}],"sky-radial-progress":[oe,[],function(e){return e.globals.skyRadialProgress||0}],accumulated:[he,[],function(e){return void 0===e.globals.accumulated?null:e.globals.accumulated}],"+":[oe,xr(oe),function(e,t){var r,n=0,i=u(t);try{for(i.s();!(r=i.n()).done;){n+=r.value.evaluate(e)}}catch(a){i.e(a)}finally{i.f()}return n}],"*":[oe,xr(oe),function(e,t){var r,n=1,i=u(t);try{for(i.s();!(r=i.n()).done;){n*=r.value.evaluate(e)}}catch(a){i.e(a)}finally{i.f()}return n}],"-":{type:oe,overloads:[[[oe,oe],function(e,t){var r=f(t,2),n=r[0],i=r[1];return n.evaluate(e)-i.evaluate(e)}],[[oe],function(e,t){return-f(t,1)[0].evaluate(e)}]]},"/":[oe,[oe,oe],function(e,t){var r=f(t,2),n=r[0],i=r[1];return n.evaluate(e)/i.evaluate(e)}],"%":[oe,[oe,oe],function(e,t){var r=f(t,2),n=r[0],i=r[1];return n.evaluate(e)%i.evaluate(e)}],ln2:[oe,[],function(){return Math.LN2}],pi:[oe,[],function(){return Math.PI}],e:[oe,[],function(){return Math.E}],"^":[oe,[oe,oe],function(e,t){var r=f(t,2),n=r[0],i=r[1];return Math.pow(n.evaluate(e),i.evaluate(e))}],sqrt:[oe,[oe],function(e,t){var r=f(t,1)[0];return Math.sqrt(r.evaluate(e))}],log10:[oe,[oe],function(e,t){var r=f(t,1)[0];return Math.log(r.evaluate(e))/Math.LN10}],ln:[oe,[oe],function(e,t){var r=f(t,1)[0];return Math.log(r.evaluate(e))}],log2:[oe,[oe],function(e,t){var r=f(t,1)[0];return Math.log(r.evaluate(e))/Math.LN2}],sin:[oe,[oe],function(e,t){var r=f(t,1)[0];return Math.sin(r.evaluate(e))}],cos:[oe,[oe],function(e,t){var r=f(t,1)[0];return Math.cos(r.evaluate(e))}],tan:[oe,[oe],function(e,t){var r=f(t,1)[0];return Math.tan(r.evaluate(e))}],asin:[oe,[oe],function(e,t){var r=f(t,1)[0];return Math.asin(r.evaluate(e))}],acos:[oe,[oe],function(e,t){var r=f(t,1)[0];return Math.acos(r.evaluate(e))}],atan:[oe,[oe],function(e,t){var r=f(t,1)[0];return Math.atan(r.evaluate(e))}],min:[oe,xr(oe),function(e,t){return Math.min.apply(Math,s(t.map((function(t){return t.evaluate(e)}))))}],max:[oe,xr(oe),function(e,t){return Math.max.apply(Math,s(t.map((function(t){return t.evaluate(e)}))))}],abs:[oe,[oe],function(e,t){var r=f(t,1)[0];return Math.abs(r.evaluate(e))}],round:[oe,[oe],function(e,t){var r=f(t,1)[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[oe,[oe],function(e,t){var r=f(t,1)[0];return Math.floor(r.evaluate(e))}],ceil:[oe,[oe],function(e,t){var r=f(t,1)[0];return Math.ceil(r.evaluate(e))}],"filter-==":[ue,[se,he],function(e,t){var r=f(t,2),n=r[0],i=r[1];return e.properties()[n.value]===i.value}],"filter-id-==":[ue,[he],function(e,t){var r=f(t,1)[0];return e.id()===r.value}],"filter-type-==":[ue,[se],function(e,t){var r=f(t,1)[0];return e.geometryType()===r.value}],"filter-<":[ue,[se,he],function(e,t){var r=f(t,2),n=r[0],i=r[1],a=e.properties()[n.value],o=i.value;return typeof a==typeof o&&a<o}],"filter-id-<":[ue,[he],function(e,t){var r=f(t,1)[0],n=e.id(),i=r.value;return typeof n==typeof i&&n<i}],"filter->":[ue,[se,he],function(e,t){var r=f(t,2),n=r[0],i=r[1],a=e.properties()[n.value],o=i.value;return typeof a==typeof o&&a>o}],"filter-id->":[ue,[he],function(e,t){var r=f(t,1)[0],n=e.id(),i=r.value;return typeof n==typeof i&&n>i}],"filter-<=":[ue,[se,he],function(e,t){var r=f(t,2),n=r[0],i=r[1],a=e.properties()[n.value],o=i.value;return typeof a==typeof o&&a<=o}],"filter-id-<=":[ue,[he],function(e,t){var r=f(t,1)[0],n=e.id(),i=r.value;return typeof n==typeof i&&n<=i}],"filter->=":[ue,[se,he],function(e,t){var r=f(t,2),n=r[0],i=r[1],a=e.properties()[n.value],o=i.value;return typeof a==typeof o&&a>=o}],"filter-id->=":[ue,[he],function(e,t){var r=f(t,1)[0],n=e.id(),i=r.value;return typeof n==typeof i&&n>=i}],"filter-has":[ue,[he],function(e,t){return f(t,1)[0].value in e.properties()}],"filter-has-id":[ue,[],function(e){return null!==e.id()&&void 0!==e.id()}],"filter-type-in":[ue,[de(se)],function(e,t){return f(t,1)[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[ue,[de(he)],function(e,t){return f(t,1)[0].value.indexOf(e.id())>=0}],"filter-in-small":[ue,[se,de(he)],function(e,t){var r=f(t,2),n=r[0];return r[1].value.indexOf(e.properties()[n.value])>=0}],"filter-in-large":[ue,[se,de(he)],function(e,t){var r=f(t,2),n=r[0],i=r[1];return function(e,t,r,n){for(;r<=n;){var i=r+n>>1;if(t[i]===e)return!0;t[i]>e?n=i-1:r=i+1}return!1}(e.properties()[n.value],i.value,0,i.value.length-1)}],all:{type:ue,overloads:[[[ue,ue],function(e,t){var r=f(t,2),n=r[0],i=r[1];return n.evaluate(e)&&i.evaluate(e)}],[xr(ue),function(e,t){var r,n=u(t);try{for(n.s();!(r=n.n()).done;){if(!r.value.evaluate(e))return!1}}catch(i){n.e(i)}finally{n.f()}return!0}]]},any:{type:ue,overloads:[[[ue,ue],function(e,t){var r=f(t,2),n=r[0],i=r[1];return n.evaluate(e)||i.evaluate(e)}],[xr(ue),function(e,t){var r,n=u(t);try{for(n.s();!(r=n.n()).done;){if(r.value.evaluate(e))return!0}}catch(i){n.e(i)}finally{n.f()}return!1}]]},"!":[ue,[ue],function(e,t){return!f(t,1)[0].evaluate(e)}],"is-supported-script":[ue,[se],function(e,t){var r=f(t,1)[0],n=e.globals&&e.globals.isSupportedScript;return!n||n(r.evaluate(e))}],upcase:[se,[se],function(e,t){return f(t,1)[0].evaluate(e).toUpperCase()}],downcase:[se,[se],function(e,t){return f(t,1)[0].evaluate(e).toLowerCase()}],concat:[se,xr(he),function(e,t){return t.map((function(t){return Te(t.evaluate(e))})).join("")}],"resolved-locale":[se,[fe],function(e,t){return f(t,1)[0].evaluate(e).resolvedLocale()}]});var br=dr;function kr(e){return{result:"success",value:e}}function wr(e){return{result:"error",value:e}}function _r(e){return"data-driven"===e["property-type"]}function Sr(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function Ar(e){return!!e.expression&&e.expression.interpolated}function Ir(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function Mr(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Tr(e){return e}function zr(e,t){var r,n,i,a="color"===t.type,o=e.stops&&"object"==typeof e.stops[0][0],s=o||!(o||void 0!==e.property),l=e.type||(Ar(t)?"exponential":"interval");if(a&&((e=ee({},e)).stops&&(e.stops=e.stops.map((function(e){return[e[0],Q.parse(e[1])]}))),e.default=Q.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Rt[e.colorSpace])throw new Error("Unknown color space: ".concat(e.colorSpace));if("exponential"===l)r=Er;else if("interval"===l)r=Pr;else if("categorical"===l){r=Cr,n=Object.create(null);var c,h=u(e.stops);try{for(h.s();!(c=h.n()).done;){var f=c.value;n[f[0]]=f[1]}}catch(S){h.e(S)}finally{h.f()}i=typeof e.stops[0][0]}else{if("identity"!==l)throw new Error('Unknown function type "'.concat(l,'"'));r=Dr}if(o){for(var p={},y=[],d=0;d<e.stops.length;d++){var v=e.stops[d],m=v[0].zoom;void 0===p[m]&&(p[m]={zoom:m,type:e.type,property:e.property,default:e.default,stops:[]},y.push(m)),p[m].stops.push([v[0].value,v[1]])}for(var g=[],x=0,b=y;x<b.length;x++){var k=b[x];g.push([p[k].zoom,zr(p[k],t)])}var w={name:"linear"};return{kind:"composite",interpolationType:w,interpolationFactor:Ut.interpolationFactor.bind(void 0,w),zoomStops:g.map((function(e){return e[0]})),evaluate:function(r,n){var i=r.zoom;return Er({stops:g,base:e.base},t,i).evaluate(i,n)}}}if(s){var _="exponential"===l?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:_,interpolationFactor:Ut.interpolationFactor.bind(void 0,_),zoomStops:e.stops.map((function(e){return e[0]})),evaluate:function(a){var o=a.zoom;return r(e,t,o,n,i)}}}return{kind:"source",evaluate:function(a,o){var s=o&&o.properties?o.properties[e.property]:void 0;return void 0===s?Br(e.default,t.default):r(e,t,s,n,i)}}}function Br(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function Cr(e,t,r,n,i){return Br(typeof r===i?n[r]:void 0,e.default,t.default)}function Pr(e,t,r){if("number"!==Ir(r))return Br(e.default,t.default);var n=e.stops.length;if(1===n)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[n-1][0])return e.stops[n-1][1];var i=mt(e.stops.map((function(e){return e[0]})),r);return e.stops[i][1]}function Er(e,t,r){var n=void 0!==e.base?e.base:1;if("number"!==Ir(r))return Br(e.default,t.default);var i=e.stops.length;if(1===i)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[i-1][0])return e.stops[i-1][1];var a=mt(e.stops.map((function(e){return e[0]})),r),o=function(e,t,r,n){var i=n-r,a=e-r;return 0===i?0:1===t?a/i:(Math.pow(t,a)-1)/(Math.pow(t,i)-1)}(r,n,e.stops[a][0],e.stops[a+1][0]),s=e.stops[a][1],u=e.stops[a+1][1],l=kt[t.type]||Tr;if(e.colorSpace&&"rgb"!==e.colorSpace){var c=Rt[e.colorSpace];l=function(e,t){return c.reverse(c.interpolate(c.forward(e),c.forward(t),o))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=s.evaluate.apply(void 0,t),i=u.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==i)return l(n,i,o)}}:l(s,u,o)}function Dr(e,t,r){return"color"===t.type?r=Q.parse(r):"formatted"===t.type?r=_e.fromString(r.toString()):"resolvedImage"===t.type?r=Se.fromString(r.toString()):Ir(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0),Br(r,e.default,t.default)}var Vr=function(){function e(t,r){p(this,e),this.expression=t,this._warningHistory={},this._evaluator=new Ue,this._defaultValue=r?function(e){return"color"===e.type&&(Mr(e.default)||Array.isArray(e.default))?new Q(0,0,0,0):"color"===e.type?Q.parse(e.default)||null:void 0===e.default?null:e.default}(r):null,this._enumValues=r&&"enum"===r.type?r.values:null}return y(e,[{key:"evaluateWithoutErrorHandling",value:function(e,t,r,n,i,a,o,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}},{key:"evaluate",value:function(e,t,r,n,i,a,o,s){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a||null,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=s||null;try{var u=this.expression.evaluate(this._evaluator);if(null==u||"number"==typeof u&&u!=u)return this._defaultValue;if(this._enumValues&&!(u in this._enumValues))throw new Ce("Expected value to be one of ".concat(Object.keys(this._enumValues).map((function(e){return JSON.stringify(e)})).join(", "),", but found ").concat(JSON.stringify(u)," instead."));return u}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}]),e}();function Lr(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in br}function Fr(e,t){var r=new dt(br,[],t?function(e){var t={color:le,string:se,number:oe,enum:se,boolean:ue,formatted:pe,resolvedImage:ye};return"array"===e.type?de(t[e.value]||he,e.length):t[e.type]}(t):void 0),n=r.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return n?kr(new Vr(n,t)):wr(r.errors)}var Rr=function(){function e(t,r){p(this,e),this.kind=t,this._styleExpression=r,this.isStateDependent="constant"!==t&&!ct(r.expression)}return y(e,[{key:"evaluateWithoutErrorHandling",value:function(e,t,r,n,i,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,a)}},{key:"evaluate",value:function(e,t,r,n,i,a){return this._styleExpression.evaluate(e,t,r,n,i,a)}}]),e}(),jr=function(){function e(t,r,n,i){p(this,e),this.kind=t,this.zoomStops=n,this._styleExpression=r,this.isStateDependent="camera"!==t&&!ct(r.expression),this.interpolationType=i}return y(e,[{key:"evaluateWithoutErrorHandling",value:function(e,t,r,n,i,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,a)}},{key:"evaluate",value:function(e,t,r,n,i,a){return this._styleExpression.evaluate(e,t,r,n,i,a)}},{key:"interpolationFactor",value:function(e,t,r){return this.interpolationType?Ut.interpolationFactor(this.interpolationType,e,t,r):0}}]),e}();function Or(e,t){if("error"===(e=Fr(e,t)).result)return e;var r=e.value.expression,n=lt(r);if(!n&&!_r(t))return wr([new re("","data expressions not supported")]);var i=ht(r,["zoom","pitch","distance-from-center"]);if(!i&&!Sr(t))return wr([new re("","zoom expressions not supported")]);var a=Nr(r);return a||i?a instanceof re?wr([a]):a instanceof Ut&&!Ar(t)?wr([new re("",'"interpolate" expressions cannot be used with this property')]):kr(a?new jr(n?"camera":"composite",e.value,a.labels,a instanceof Ut?a.interpolation:void 0):new Rr(n?"constant":"source",e.value)):wr([new re("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}var Ur,qr=function(){function e(t,r){p(this,e),this._parameters=t,this._specification=r,ee(this,zr(this._parameters,this._specification))}return y(e,null,[{key:"deserialize",value:function(t){return new e(t._parameters,t._specification)}},{key:"serialize",value:function(e){return{_parameters:e._parameters,_specification:e._specification}}}]),e}();function Nr(e){var t=null;if(e instanceof Xt)t=Nr(e.result);else if(e instanceof Nt){var r,n=u(e.args);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(t=Nr(i))break}}catch(a){n.e(a)}finally{n.f()}}else(e instanceof xt||e instanceof Ut)&&e.input instanceof Ne&&"zoom"===e.input.name&&(t=e);return t instanceof re||e.eachChild((function(e){var r=Nr(e);r instanceof re?t=r:!t&&r?t=new re("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&r&&t!==r&&(t=new re("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}var Zr,Xr,Gr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Ur){var e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ur=null!={NODE_ENV:"production",PUBLIC_URL:"/our-forests-tomorrow",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_MAPBOX_TOKEN:"pk.eyJ1IjoiZmF1c3RvLXBlcmV6IiwiYSI6ImNsZzUzbDB6ZTAydDIzc254aGhqYmVjajUifQ.OWcCD7jA8JsFcwnhU7Yvlg",REACT_APP_TILES_URL:""}.API_URL_REGEX?new RegExp({NODE_ENV:"production",PUBLIC_URL:"/our-forests-tomorrow",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_MAPBOX_TOKEN:"pk.eyJ1IjoiZmF1c3RvLXBlcmV6IiwiYSI6ImNsZzUzbDB6ZTAydDIzc254aGhqYmVjajUifQ.OWcCD7jA8JsFcwnhU7Yvlg",REACT_APP_TILES_URL:""}.API_URL_REGEX):e}catch(d){Ur=e}}return Ur},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Yr={supported:!1,testSupport:function(e){!Kr&&Xr&&(Jr?Wr(e):Zr=e)}},Kr=!1,Jr=!1;function Wr(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Xr),e.isContextLost())return;Yr.supported=!0}catch(e){}e.deleteTexture(t),Kr=!0}g.document&&((Xr=g.document.createElement("img")).onload=function(){Zr&&Wr(Zr),Zr=null,Jr=!0},Xr.onerror=function(){Kr=!0,Zr=null},Xr.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Hr="2.13.0",$r={create:"create",load:"load",fullLoad:"fullLoad"};function Qr(e){var t=e.name.split("?")[0];return rn(t)&&t.includes("mapbox-gl.js")?"javascript":rn(t)&&t.includes("mapbox-gl.css")?"css":function(e){return Gr.API_FONTS_REGEX.test(e)}(t)?"fontRange":an(t)?"sprite":nn(t)?"style":function(e){return Gr.API_TILEJSON_REGEX.test(e)}(t)?"tilejson":"other"}var en="NO_ACCESS_TOKEN";function tn(e){return Gr.API_URL_REGEX.test(e)}function rn(e){return Gr.API_CDN_URL_REGEX.test(e)}function nn(e){return Gr.API_STYLE_REGEX.test(e)&&!an(e)}function an(e){return Gr.API_SPRITE_REGEX.test(e)}var on=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function sn(e){var t=e.match(on);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function un(e){var t=e.params.length?"?".concat(e.params.join("&")):"";return"".concat(e.protocol,"://").concat(e.authority).concat(e.path).concat(t)}function ln(e){if(!e)return null;var t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(g.atob(t[1]).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(e){return null}}var cn=function(){function e(t){p(this,e),this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}return y(e,[{key:"getStorageKey",value:function(e){var t,r=ln(Gr.ACCESS_TOKEN);return t=r&&r.u?g.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))}))):"",e?"mapbox.eventData.".concat(e,":").concat(t):"mapbox.eventData:".concat(t)}},{key:"fetchEventData",value:function(){var e=q("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var n=g.localStorage.getItem(t);n&&(this.eventData=JSON.parse(n));var i=g.localStorage.getItem(r);i&&(this.anonId=i)}catch(e){V("Unable to read from LocalStorage")}}},{key:"saveEventData",value:function(){var e=q("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{g.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&g.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){V("Unable to write to LocalStorage")}}},{key:"processRequests",value:function(e){}},{key:"postEvent",value:function(e,t,r,n){var i=this;if(Gr.EVENTS_URL){var a=sn(Gr.EVENTS_URL);a.params.push("access_token=".concat(n||Gr.ACCESS_TOKEN||""));var o={event:this.type,created:new Date(e).toISOString()},s=t?I(o,t):o,u={url:un(a),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=_n(u,(function(e){i.pendingRequest=null,r(e),i.saveEventData(),i.processRequests(n)}))}}},{key:"queueRequest",value:function(e,t){this.queue.push(e),this.processRequests(t)}}]),e}(),hn=new(function(e){l(r,e);var t=c(r);function r(e){var n;return p(this,r),(n=t.call(this,"appUserTurnstile"))._customAccessToken=e,n}return y(r,[{key:"postTurnstileEvent",value:function(e,t){Gr.EVENTS_URL&&Gr.ACCESS_TOKEN&&Array.isArray(e)&&e.some((function(e){return function(e){return 0===e.indexOf("mapbox:")}(e)||tn(e)}))&&this.queueRequest(Date.now(),t)}},{key:"processRequests",value:function(e){var t=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var r=ln(Gr.ACCESS_TOKEN),n=r?r.u:Gr.ACCESS_TOKEN,i=n!==this.eventData.tokenU;z(this.anonId)||(this.anonId=T(),i=!0);var a=this.queue.shift();if(this.eventData.lastSuccess){var o=new Date(this.eventData.lastSuccess),s=new Date(a),u=(a-this.eventData.lastSuccess)/864e5;i=i||u>=1||u<-1||o.getDate()!==s.getDate()}else i=!0;i?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Hr,skuId:"01","enabled.telemetry":!1,userId:this.anonId},(function(e){e||(t.eventData.lastSuccess=a,t.eventData.tokenU=n)}),e):this.processRequests()}}}]),r}(cn));hn.postTurnstileEvent.bind(hn);var fn=new(function(e){l(r,e);var t=c(r);function r(){var e;return p(this,r),(e=t.call(this,"map.load")).success={},e.skuToken="",e}return y(r,[{key:"postMapLoadEvent",value:function(e,t,r,n){this.skuToken=t,this.errorCb=n,Gr.EVENTS_URL&&(r||Gr.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(en)))}},{key:"processRequests",value:function(e){var t=this;if(!this.pendingRequest&&0!==this.queue.length){var r=this.queue.shift(),n=r.id,i=r.timestamp;n&&this.success[n]||(this.anonId||this.fetchEventData(),z(this.anonId)||(this.anonId=T()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Hr,skuId:"01",skuToken:this.skuToken,userId:this.anonId},(function(e){e?t.errorCb(e):n&&(t.success[n]=!0)}),e))}}}]),r}(cn));fn.postMapLoadEvent.bind(fn);var pn=new(function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.call(this,"gljs.performance")}return y(r,[{key:"postPerformanceEvent",value:function(e,t){Gr.EVENTS_URL&&(e||Gr.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},e)}},{key:"processRequests",value:function(e){if(!this.pendingRequest&&0!==this.queue.length){var t,r=this.queue.shift(),n=r.timestamp,i=function(e){var t=g.performance.getEntriesByType("resource"),r=g.performance.getEntriesByType("mark"),n=function(e){var t={};if(e)for(var r in e)if("other"!==r){var n,i=u(e[r]);try{for(i.s();!(n=i.n()).done;){var a=n.value,o="".concat(r,"ResolveRangeMin"),s="".concat(r,"ResolveRangeMax"),l="".concat(r,"RequestCount"),c="".concat(r,"RequestCachedCount");t[o]=Math.min(t[o]||1/0,a.startTime),t[s]=Math.max(t[s]||-1/0,a.responseEnd);var h=function(e){void 0===t[e]&&(t[e]=0),++t[e]};void 0!==a.transferSize&&0===a.transferSize&&h(c),h(l)}}catch(f){i.e(f)}finally{i.f()}}return t}(function(e,t){var r={};if(e){var n,i=u(e);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=t(a);void 0===r[o]&&(r[o]=[]),r[o].push(a)}}catch(s){i.e(s)}finally{i.f()}}return r}(t,Qr)),i=g.devicePixelRatio,a=g.navigator.connection||g.navigator.mozConnection||g.navigator.webkitConnection,o={counters:[],metadata:[],attributes:[]},s=function(e,t,r){null!=r&&e.push({name:t,value:r.toString()})};for(var l in n)s(o.counters,l,n[l]);if(e.interactionRange[0]!==1/0&&e.interactionRange[1]!==-1/0&&(s(o.counters,"interactionRangeMin",e.interactionRange[0]),s(o.counters,"interactionRangeMax",e.interactionRange[1])),r)for(var c=function(){var e=f[h],t=$r[e],n=r.find((function(e){return e.name===t}));n&&s(o.counters,t,n.startTime)},h=0,f=Object.keys($r);h<f.length;h++)c();return s(o.counters,"visibilityHidden",e.visibilityHidden),s(o.attributes,"style",function(e){if(e){var t,r=u(e);try{for(r.s();!(t=r.n()).done;){var n=t.value.name.split("?")[0];if(nn(n)){var i=n.split("/").slice(-2);if(2===i.length)return"mapbox://styles/".concat(i[0],"/").concat(i[1])}}}catch(a){r.e(a)}finally{r.f()}}}(t)),s(o.attributes,"terrainEnabled",e.terrainEnabled?"true":"false"),s(o.attributes,"fogEnabled",e.fogEnabled?"true":"false"),s(o.attributes,"projection",e.projection),s(o.attributes,"zoom",e.zoom),s(o.metadata,"devicePixelRatio",i),s(o.metadata,"connectionEffectiveType",a?a.effectiveType:void 0),s(o.metadata,"navigatorUserAgent",g.navigator.userAgent),s(o.metadata,"screenWidth",g.screen.width),s(o.metadata,"screenHeight",g.screen.height),s(o.metadata,"windowWidth",g.innerWidth),s(o.metadata,"windowHeight",g.innerHeight),s(o.metadata,"mapWidth",e.width/i),s(o.metadata,"mapHeight",e.height/i),s(o.metadata,"webglRenderer",e.renderer),s(o.metadata,"webglVendor",e.vendor),s(o.metadata,"sdkVersion",Hr),s(o.metadata,"sdkIdentifier","mapbox-gl-js"),o}(r.performanceData),a=u(i.metadata);try{for(a.s();!(t=a.n()).done;)t.value}catch(h){a.e(h)}finally{a.f()}var o,s=u(i.counters);try{for(s.s();!(o=s.n()).done;)o.value}catch(h){s.e(h)}finally{s.f()}var l,c=u(i.attributes);try{for(c.s();!(l=c.n()).done;)l.value}catch(h){c.e(h)}finally{c.f()}this.postEvent(n,i,(function(){}),e)}}}]),r}(cn));pn.postPerformanceEvent.bind(pn);var yn,dn,vn=new(function(e){l(r,e);var t=c(r);function r(){var e;return p(this,r),(e=t.call(this,"map.auth")).success={},e.skuToken="",e}return y(r,[{key:"getSession",value:function(e,t,r,n){var i=this,a=sn(Gr.API_URL+Gr.SESSION_PATH);a.params.push("sku=".concat(t||"")),a.params.push("access_token=".concat(n||Gr.ACCESS_TOKEN||""));var o={url:un(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Sn(o,(function(e){i.pendingRequest=null,r(e),i.saveEventData(),i.processRequests(n)}))}},{key:"getSessionAPI",value:function(e,t,r,n){this.skuToken=t,this.errorCb=n,r||Gr.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},r):this.errorCb(new Error(en))}},{key:"processRequests",value:function(e){var t=this;if(!this.pendingRequest&&0!==this.queue.length){var r=this.queue.shift(),n=r.id,i=r.timestamp;n&&this.success[n]||this.getSession(i,this.skuToken,(function(e){e?t.errorCb(e):n&&(t.success[n]=!0)}),e)}}}]),r}(cn));function mn(){(function(){try{return g.caches}catch(r){}})()&&!yn&&(yn=g.caches.open("mapbox-tiles"))}function gn(e){var t=e.indexOf("?");if(t<0)return e;var r=function(e){var t=e.indexOf("?");return t>0?e.slice(t+1).split("&"):[]}(e),n=r.filter((function(e){var t=e.split("=");return"language"===t[0]||"worldview"===t[0]}));return n.length?"".concat(e.slice(0,t),"?").concat(n.join("&")):e.slice(0,t)}vn.getSessionAPI.bind(vn),"function"==typeof Object.freeze&&Object.freeze({Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"});var xn=function(e){l(r,e);var t=c(r);function r(e,n,i){var a;return p(this,r),401===n&&tn(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),(a=t.call(this,e)).status=n,a.url=i,a}return y(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(h(Error)),bn=R()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===g.location.protocol?g.parent:g).location.href},kn=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(bn())&&!/^\w+:/.test(r))){if(g.fetch&&g.Request&&g.AbortController&&g.Request.prototype.hasOwnProperty("signal"))return function(e,t){var r,n=new g.AbortController,i=new g.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:bn(),signal:n.signal}),a=!1,o=!1,s=(r=i.url).indexOf("sku=")>0&&tn(r);"json"===e.type&&i.headers.set("Accept","application/json");var u=function(r,n,a){if(!o){if(r&&"SecurityError"!==r.message&&V(r),n&&a)return l(n);var u=Date.now();g.fetch(i).then((function(r){if(r.ok){var n=s?r.clone():null;return l(r,n,u)}return t(new xn(r.statusText,r.status,e.url))})).catch((function(r){"AbortError"!==r.name&&t(new Error("".concat(r.message," ").concat(e.url)))}))}},l=function(r,n,s){("arrayBuffer"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text()).then((function(e){o||(n&&s&&function(e,t,r){if(mn(),yn){var n={status:t.status,statusText:t.statusText,headers:new g.Headers};t.headers.forEach((function(e,t){return n.headers.set(t,e)}));var i=j(t.headers.get("Cache-Control")||"");if(!i["no-store"]){i["max-age"]&&n.headers.set("Expires",new Date(r+1e3*i["max-age"]).toUTCString());var a=n.headers.get("Expires");a&&(new Date(a).getTime()-r<42e4||function(e,t){if(void 0===dn)try{new Response(new ReadableStream),dn=!0}catch(e){dn=!1}dn?t(e.body):e.blob().then(t)}(t,(function(t){var r=new g.Response(t,n);mn(),yn&&yn.then((function(t){return t.put(gn(e.url),r)})).catch((function(e){return V(e.message)}))})))}}}(i,n,s),a=!0,t(null,e,r.headers.get("Cache-Control"),r.headers.get("Expires")))})).catch((function(e){o||t(new Error(e.message))}))};return s?function(e,t){if(mn(),!yn)return t(null);var r=gn(e.url);yn.then((function(e){e.match(r).then((function(n){var i=function(e){if(!e)return!1;var t=new Date(e.headers.get("Expires")||0),r=j(e.headers.get("Cache-Control")||"");return t>Date.now()&&!r["no-cache"]}(n);e.delete(r),i&&e.put(r,n.clone()),t(null,n,i)})).catch(t)})).catch(t)}(i,u):u(null,null),{cancel:function(){o=!0,a||n.abort()}}}(e,t);if(R()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(e,t){var r=new g.XMLHttpRequest;for(var n in r.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(r.responseType="arraybuffer"),e.headers)r.setRequestHeader(n,e.headers[n]);return"json"===e.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===e.credentials,r.onerror=function(){t(new Error(r.statusText))},r.onload=function(){if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){var n=r.response;if("json"===e.type)try{n=JSON.parse(r.response)}catch(e){return t(e)}t(null,n,r.getResponseHeader("Cache-Control"),r.getResponseHeader("Expires"))}else t(new xn(r.statusText,r.status,e.url))},r.send(e.body),{cancel:function(){return r.abort()}}}(e,t)},wn=function(e,t){return kn(I(e,{type:"arrayBuffer"}),t)},_n=function(e,t){return kn(I(e,{method:"POST"}),t)},Sn=function(e,t){return kn(I(e,{method:"GET"}),t)},An={};function In(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),An[t]={klass:e,omit:r.omit||[]}}for(var Mn in In(Object,"Object"),Z.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Z.deserialize=function(e){return new Z(e.buffer)},Object.defineProperty(Z,"name",{value:"Grid"}),In(Z,"Grid"),In(Q,"Color"),In(Error,"Error"),In(xn,"AJAXError"),In(Se,"ResolvedImage"),In(qr,"StylePropertyFunction"),In(Vr,"StyleExpression",{omit:["_evaluator"]}),In(jr,"ZoomDependentExpression"),In(Rr,"ZoomConstantExpression"),In(Ne,"CompoundExpression",{omit:["_evaluate"]}),br)An[br[Mn]._classRegistryKey]||In(br[Mn],"Expression".concat(Mn));function Tn(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function zn(e){return g.ImageBitmap&&e instanceof g.ImageBitmap}function Bn(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Tn(e)||zn(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof g.ImageData)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){var n,i=[],a=u(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;i.push(Bn(o,t))}}catch(f){a.e(f)}finally{a.f()}return i}if("object"==typeof e){var s=e.constructor,l=s._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class ".concat(l));var c=s.serialize?s.serialize(e,t):{};if(!s.serialize){for(var h in e)e.hasOwnProperty(h)&&(An[l].omit.indexOf(h)>=0||(c[h]=Bn(e[h],t)));e instanceof Error&&(c.message=e.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(c.$name=l),c}throw new Error("can't serialize object of type "+typeof e)}function Cn(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Tn(e)||zn(e)||ArrayBuffer.isView(e)||e instanceof g.ImageData)return e;if(Array.isArray(e))return e.map(Cn);if("object"==typeof e){var t=e.$name||"Object",r=An[t].klass;if(!r)throw new Error("can't deserialize unregistered class ".concat(t));if(r.deserialize)return r.deserialize(e);for(var n=Object.create(r.prototype),i=0,a=Object.keys(e);i<a.length;i++){var o=a[i];"$name"!==o&&(n[o]=Cn(e[o]))}return n}throw new Error("can't deserialize object of type "+typeof e)}var Pn=function(){function e(t){var r=this;p(this,e),this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){r._triggered=!1,r._callback()})}return y(e,[{key:"trigger",value:function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){e._triggered=!1,e._callback()}),0))}},{key:"remove",value:function(){this._channel=void 0,this._callback=function(){}}}]),e}(),En=g.performance;function Dn(e){var t=e?e.url.toString():void 0;return En.getEntriesByName(t)}var Vn=function(){function e(){p(this,e),this.tasks={},this.taskQueue=[],B(["process"],this),this.invoker=new Pn(this.process),this.nextId=0}return y(e,[{key:"add",value:function(e,t){var r=this,n=this.nextId++,i=function(e){var t=e.type,r=e.isSymbolTile,n=e.zoom;return n=n||0,"message"===t?0:"maybePrepare"!==t||r?"parseTile"!==t||r?"parseTile"===t&&r?300-n:"maybePrepare"===t&&r?400-n:500:200-n:100-n}(t);if(0===i){R();try{e()}finally{}return{cancel:function(){}}}return this.tasks[n]={fn:e,metadata:t,priority:i,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:function(){delete r.tasks[n]}}}},{key:"process",value:function(){var e=this;R();try{if(this.taskQueue=this.taskQueue.filter((function(t){return!!e.tasks[t]})),!this.taskQueue.length)return;var t=this.pick();if(null===t)return;var r=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!r)return;r.fn()}finally{}}},{key:"pick",value:function(){for(var e=null,t=1/0,r=0;r<this.taskQueue.length;r++){var n=this.tasks[this.taskQueue[r]];n.priority<t&&(t=n.priority,e=r)}if(null===e)return null;var i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}},{key:"remove",value:function(){this.invoker.remove()}}]),e}(),Ln=function(){function e(t,r,n){p(this,e),this.target=t,this.parent=r,this.mapId=n,this.callbacks={},this.cancelCallbacks={},B(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=R()?t:g,this.scheduler=new Vn}return y(e,[{key:"send",value:function(e,t,r,n){var i=this,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=o,this.callbacks[s]=r);var u=U(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:e,hasCallback:!!r,targetMapId:n,mustQueue:a,sourceMapId:this.mapId,data:Bn(t,u)},u),{cancel:function(){r&&delete i.callbacks[s],i.target.postMessage({id:s,type:"<cancel>",targetMapId:n,sourceMapId:i.mapId})}}}},{key:"receive",value:function(e){var t=this,r=e.data,n=r.id;if(n&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){var i=this.cancelCallbacks[n];delete this.cancelCallbacks[n],i&&i.cancel()}else if(r.mustQueue||R()){var a=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add((function(){return t.processTask(n,r)}),a&&a.metadata||{type:"message"})}else this.processTask(n,r)}},{key:"processTask",value:function(e,t){var r=this;if("<response>"===t.type){var n=this.callbacks[e];delete this.callbacks[e],n&&(t.error?n(Cn(t.error)):n(null,Cn(t.data)))}else{var i=U(this.globalScope)?void 0:[],a=t.hasCallback?function(t,n){delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:t?Bn(t):null,data:Bn(n,i)},i)}:function(e){},o=Cn(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,o,a);else if(this.parent.getWorkerSource){var s=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,s[0],o.source)[s[1]](o,a)}else a(new Error("Could not find function ".concat(t.type)))}}},{key:"remove",value:function(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}]),e}(),Fn=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Rn(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function jn(e,t,r){if(r&&r[e]){var n=r[e].indexOf(t);-1!==n&&r[e].splice(n,1)}}var On=y((function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};p(this,e),I(this,r),this.type=t})),Un=function(e){l(r,e);var t=c(r);function r(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p(this,r),t.call(this,"error",I({error:e},n))}return y(r)}(On),qn=function(){function e(){p(this,e)}return y(e,[{key:"on",value:function(e,t){return this._listeners=this._listeners||{},Rn(e,t,this._listeners),this}},{key:"off",value:function(e,t){return jn(e,t,this._listeners),jn(e,t,this._oneTimeListeners),this}},{key:"once",value:function(e,t){var r=this;return t?(this._oneTimeListeners=this._oneTimeListeners||{},Rn(e,t,this._oneTimeListeners),this):new Promise((function(t){return r.once(e,t)}))}},{key:"fire",value:function(e,t){"string"==typeof e&&(e=new On(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;var n,i=this._listeners&&this._listeners[r]?this._listeners[r].slice():[],a=u(i);try{for(a.s();!(n=a.n()).done;){n.value.call(this,e)}}catch(f){a.e(f)}finally{a.f()}var o,s=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[],l=u(s);try{for(l.s();!(o=l.n()).done;){var c=o.value;jn(r,c,this._oneTimeListeners),c.call(this,e)}}catch(f){l.e(f)}finally{l.f()}var h=this._eventedParent;h&&(I(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),h.fire(e))}else e instanceof Un&&console.error(e.error);return this}},{key:"listens",value:function(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}},{key:"setEventedParent",value:function(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}]),e}();function Nn(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Zn(e){if(Array.isArray(e))return e.map(Zn);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=Zn(e[r]);return t}return Nn(e)}var Xn=y((function e(t,r,n,i){p(this,e),this.message=(t?"".concat(t,": "):"")+n,i&&(this.identifier=i),null!=r&&r.__line__&&(this.line=r.__line__)}));function Gn(e){var t=e.key,r=e.value,n=e.valueSpec||{},i=e.objectElementValidators||{},a=e.style,o=e.styleSpec,s=[],u=Ir(r);if("object"!==u)return[new Xn(t,r,"object expected, ".concat(u," found"))];for(var l in r){var c=l.split(".")[0],h=n[c]||n["*"],f=void 0;i[c]?f=i[c]:n[c]?f=ki:i["*"]?f=i["*"]:n["*"]&&(f=ki),f?s=s.concat(f({key:(t?"".concat(t,"."):t)+l,value:r[l],valueSpec:h,style:a,styleSpec:o,object:r,objectKey:l},r)):s.push(new Xn(t,r[l],'unknown property "'.concat(l,'"')))}for(var p in n)i[p]||n[p].required&&void 0===n[p].default&&void 0===r[p]&&s.push(new Xn(t,r,'missing required property "'.concat(p,'"')));return s}function Yn(e){var t=e.value,r=e.valueSpec,n=e.style,i=e.styleSpec,a=e.key,o=e.arrayElementValidator||ki;if("array"!==Ir(t))return[new Xn(a,t,"array expected, ".concat(Ir(t)," found"))];if(r.length&&t.length!==r.length)return[new Xn(a,t,"array length ".concat(r.length," expected, length ").concat(t.length," found"))];if(r["min-length"]&&t.length<r["min-length"])return[new Xn(a,t,"array length at least ".concat(r["min-length"]," expected, length ").concat(t.length," found"))];var s={type:r.value,values:r.values,minimum:r.minimum,maximum:r.maximum,function:void 0};i.$version<7&&(s.function=r.function),"object"===Ir(r.value)&&(s=r.value);for(var u=[],l=0;l<t.length;l++)u=u.concat(o({array:t,arrayIndex:l,value:t[l],valueSpec:s,style:n,styleSpec:i,key:"".concat(a,"[").concat(l,"]")}));return u}function Kn(e){var t=e.key,r=e.value,n=e.valueSpec,i=Ir(r);if("number"===i&&r!=r&&(i="NaN"),"number"!==i)return[new Xn(t,r,"number expected, ".concat(i," found"))];if("minimum"in n){var a=n.minimum;if("array"===Ir(n.minimum)&&(a=n.minimum[e.arrayIndex]),r<a)return[new Xn(t,r,"".concat(r," is less than the minimum value ").concat(a))]}if("maximum"in n){var o=n.maximum;if("array"===Ir(n.maximum)&&(o=n.maximum[e.arrayIndex]),r>o)return[new Xn(t,r,"".concat(r," is greater than the maximum value ").concat(o))]}return[]}function Jn(e){var t,r,n,i=e.valueSpec,a=Nn(e.value.type),o={},s="categorical"!==a&&void 0===e.value.property,u=!s,l="array"===Ir(e.value.stops)&&"array"===Ir(e.value.stops[0])&&"object"===Ir(e.value.stops[0][0]),c=Gn({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===a)return[new Xn(e.key,e.value,'identity function may not have a "stops" property')];var t=[],r=e.value;return t=t.concat(Yn({key:e.key,value:r,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===Ir(r)&&0===r.length&&t.push(new Xn(e.key,r,"array must have at least one stop")),t},default:function(e){return ki({key:e.key,value:e.value,valueSpec:i,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===a&&s&&c.push(new Xn(e.key,e.value,'missing required property "property"')),"identity"===a||e.value.stops||c.push(new Xn(e.key,e.value,'missing required property "stops"')),"exponential"===a&&e.valueSpec.expression&&!Ar(e.valueSpec)&&c.push(new Xn(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(u&&!_r(e.valueSpec)?c.push(new Xn(e.key,e.value,"property functions not supported")):s&&!Sr(e.valueSpec)&&c.push(new Xn(e.key,e.value,"zoom functions not supported"))),"categorical"!==a&&!l||void 0!==e.value.property||c.push(new Xn(e.key,e.value,'"property" property is required')),c;function h(e){var t=[],a=e.value,s=e.key;if("array"!==Ir(a))return[new Xn(s,a,"array expected, ".concat(Ir(a)," found"))];if(2!==a.length)return[new Xn(s,a,"array length 2 expected, length ".concat(a.length," found"))];if(l){if("object"!==Ir(a[0]))return[new Xn(s,a,"object expected, ".concat(Ir(a[0])," found"))];if(void 0===a[0].zoom)return[new Xn(s,a,"object stop key must have zoom")];if(void 0===a[0].value)return[new Xn(s,a,"object stop key must have value")];var u=Nn(a[0].zoom);if("number"!=typeof u)return[new Xn(s,a[0].zoom,"stop zoom values must be numbers")];if(n&&n>u)return[new Xn(s,a[0].zoom,"stop zoom values must appear in ascending order")];u!==n&&(n=u,r=void 0,o={}),t=t.concat(Gn({key:"".concat(s,"[0]"),value:a[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:Kn,value:f}}))}else t=t.concat(f({key:"".concat(s,"[0]"),value:a[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},a));return Lr(Zn(a[1]))?t.concat([new Xn("".concat(s,"[1]"),a[1],"expressions are not allowed in function stops.")]):t.concat(ki({key:"".concat(s,"[1]"),value:a[1],valueSpec:i,style:e.style,styleSpec:e.styleSpec}))}function f(e,n){var s=Ir(e.value),u=Nn(e.value),l=null!==e.value?e.value:n;if(t){if(s!==t)return[new Xn(e.key,l,"".concat(s," stop domain type must match previous stop domain type ").concat(t))]}else t=s;if("number"!==s&&"string"!==s&&"boolean"!==s&&"number"!=typeof u&&"string"!=typeof u&&"boolean"!=typeof u)return[new Xn(e.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==a){var c="number expected, ".concat(s," found");return _r(i)&&void 0===a&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Xn(e.key,l,c)]}return"categorical"!==a||"number"!==s||"number"==typeof u&&isFinite(u)&&Math.floor(u)===u?"categorical"!==a&&"number"===s&&"number"==typeof u&&"number"==typeof r&&void 0!==r&&u<r?[new Xn(e.key,l,"stop domain values must appear in ascending order")]:(r=u,"categorical"===a&&u in o?[new Xn(e.key,l,"stop domain values must be unique")]:(o[u]=!0,[])):[new Xn(e.key,l,"integer expected, found ".concat(String(u)))]}}function Wn(e){var t=("property"===e.expressionContext?Or:Fr)(Zn(e.value),e.valueSpec);if("error"===t.result)return t.value.map((function(t){return new Xn("".concat(e.key).concat(t.key),e.value,t.message)}));var r=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!r.outputDefined())return[new Xn(e.key,e.value,'Invalid data expression for "'.concat(e.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===e.expressionContext&&"layout"===e.propertyType&&!ct(r))return[new Xn(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext)return Hn(r,e);if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!ht(r,["zoom","feature-state"]))return[new Xn(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!lt(r))return[new Xn(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hn(e,t){var r=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression){var n,i=u(t.valueSpec.expression.parameters);try{for(i.s();!(n=i.n()).done;){var a=n.value;r.delete(a)}}catch(l){i.e(l)}finally{i.f()}}if(0===r.size)return[];var o=[];return e instanceof Ne&&r.has(e.name)?[new Xn(t.key,t.value,'["'.concat(e.name,'"] expression is not supported in a filter for a ').concat(t.object.type," layer with id: ").concat(t.object.id))]:(e.eachChild((function(e){o.push.apply(o,s(Hn(e,t)))})),o)}function $n(e){var t=e.key,r=e.value,n=e.valueSpec,i=[];return Array.isArray(n.values)?-1===n.values.indexOf(Nn(r))&&i.push(new Xn(t,r,"expected one of [".concat(n.values.join(", "),"], ").concat(JSON.stringify(r)," found"))):-1===Object.keys(n.values).indexOf(Nn(r))&&i.push(new Xn(t,r,"expected one of [".concat(Object.keys(n.values).join(", "),"], ").concat(JSON.stringify(r)," found"))),i}function Qn(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":var t,r=u(e.slice(1));try{for(r.s();!(t=r.n()).done;){var n=t.value;if(!Qn(n)&&"boolean"!=typeof n)return!1}}catch(i){r.e(i)}finally{r.f()}return!0;default:return!0}}function ei(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"fill";if(null==e)return{filter:function(){return!0},needGeometry:!1,needFeature:!1};Qn(e)||(e=si(e));var r=e,n=!0;try{n=function(e){if(!ni(e))return e;var t=Zn(e);return ri(t),t=ti(t)}(r)}catch(e){console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n".concat(JSON.stringify(r,null,2),"\n        "))}var i=Fn["filter_".concat(t)],a=Fr(n,i),o=null;if("error"===a.result)throw new Error(a.value.map((function(e){return"".concat(e.key,": ").concat(e.message)})).join(", "));o=function(e,t,r){return a.value.evaluate(e,t,{},r)};var s=null,u=null;if(n!==r){var l=Fr(r,i);if("error"===l.result)throw new Error(l.value.map((function(e){return"".concat(e.key,": ").concat(e.message)})).join(", "));s=function(e,t,r,n,i){return l.value.evaluate(e,t,{},r,void 0,void 0,n,i)},u=!lt(l.value.expression)}return{filter:o,dynamicFilter:s||void 0,needGeometry:oi(n),needFeature:!!u}}function ti(e){if(!Array.isArray(e))return e;var t=function(e){if(ii.has(e[0]))for(var t=1;t<e.length;t++)if(ni(e[t]))return!0;return e}(e);return!0===t?t:t.map((function(e){return ti(e)}))}function ri(e){var t=!1,r=[];if("case"===e[0]){for(var n=1;n<e.length-1;n+=2)t=t||ni(e[n]),r.push(e[n+1]);r.push(e[e.length-1])}else if("match"===e[0]){t=t||ni(e[1]);for(var i=2;i<e.length-1;i+=2)r.push(e[i+1]);r.push(e[e.length-1])}else if("step"===e[0]){t=t||ni(e[1]);for(var a=1;a<e.length-1;a+=2)r.push(e[a+1])}t&&(e.length=0,e.push.apply(e,["any"].concat(r)));for(var o=1;o<e.length;o++)ri(e[o])}function ni(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;for(var t,r=1;r<e.length;r++)if(ni(e[r]))return!0;return!1}var ii=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ai(e,t){return e<t?-1:e>t?1:0}function oi(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(var t=1;t<e.length;t++)if(oi(e[t]))return!0;return!1}function si(e){if(!e)return!0;var t,r=e[0];return e.length<=1?"any"!==r:"=="===r?ui(e[1],e[2],"=="):"!="===r?hi(ui(e[1],e[2],"==")):"<"===r||">"===r||"<="===r||">="===r?ui(e[1],e[2],r):"any"===r?(t=e.slice(1),["any"].concat(t.map(si))):"all"===r?["all"].concat(e.slice(1).map(si)):"none"===r?["all"].concat(e.slice(1).map(si).map(hi)):"in"===r?li(e[1],e.slice(2)):"!in"===r?hi(li(e[1],e.slice(2))):"has"===r?ci(e[1]):"!has"===r?hi(ci(e[1])):"within"!==r||e}function ui(e,t,r){switch(e){case"$type":return["filter-type-".concat(r),t];case"$id":return["filter-id-".concat(r),t];default:return["filter-".concat(r),e,t]}}function li(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((function(e){return typeof e!=typeof t[0]}))?["filter-in-large",e,["literal",t.sort(ai)]]:["filter-in-small",e,["literal",t]]}}function ci(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function hi(e){return["!",e]}function fi(e){return Qn(Zn(e.value))?Wn(ee({},e,{expressionContext:"filter",valueSpec:e.styleSpec["filter_".concat(e.layerType||"fill")]})):pi(e)}function pi(e){var t=e.value,r=e.key;if("array"!==Ir(t))return[new Xn(r,t,"array expected, ".concat(Ir(t)," found"))];var n,i=e.styleSpec,a=[];if(t.length<1)return[new Xn(r,t,"filter array must have at least 1 element")];switch(a=a.concat($n({key:"".concat(r,"[0]"),value:t[0],valueSpec:i.filter_operator,style:e.style,styleSpec:e.styleSpec})),Nn(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&"$type"===Nn(t[1])&&a.push(new Xn(r,t,'"$type" cannot be use with operator "'.concat(t[0],'"')));case"==":case"!=":3!==t.length&&a.push(new Xn(r,t,'filter array for operator "'.concat(t[0],'" must have 3 elements')));case"in":case"!in":t.length>=2&&("string"!==(n=Ir(t[1]))&&a.push(new Xn("".concat(r,"[1]"),t[1],"string expected, ".concat(n," found"))));for(var o=2;o<t.length;o++)n=Ir(t[o]),"$type"===Nn(t[1])?a=a.concat($n({key:"".concat(r,"[").concat(o,"]"),value:t[o],valueSpec:i.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==n&&"number"!==n&&"boolean"!==n&&a.push(new Xn("".concat(r,"[").concat(o,"]"),t[o],"string, number, or boolean expected, ".concat(n," found")));break;case"any":case"all":case"none":for(var s=1;s<t.length;s++)a=a.concat(pi({key:"".concat(r,"[").concat(s,"]"),value:t[s],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":n=Ir(t[1]),2!==t.length?a.push(new Xn(r,t,'filter array for "'.concat(t[0],'" operator must have 2 elements'))):"string"!==n&&a.push(new Xn("".concat(r,"[1]"),t[1],"string expected, ".concat(n," found")));break;case"within":n=Ir(t[1]),2!==t.length?a.push(new Xn(r,t,'filter array for "'.concat(t[0],'" operator must have 2 elements'))):"object"!==n&&a.push(new Xn("".concat(r,"[1]"),t[1],"object expected, ".concat(n," found")))}return a}function yi(e,t){var r=e.key,n=e.style,i=e.styleSpec,a=e.value,o=e.objectKey,s=i["".concat(t,"_").concat(e.layerType)];if(!s)return[];var u=o.match(/^(.*)-transition$/);if("paint"===t&&u&&s[u[1]]&&s[u[1]].transition)return ki({key:r,value:a,valueSpec:i.transition,style:n,styleSpec:i});var l,c=e.valueSpec||s[o];if(!c)return[new Xn(r,a,'unknown property "'.concat(o,'"'))];if("string"===Ir(a)&&_r(c)&&!c.tokens&&(l=/^{([^}]+)}$/.exec(a)))return[new Xn(r,a,'"'.concat(o,'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": ').concat(JSON.stringify(l[1])," }`."))];var h=[];return"symbol"===e.layerType&&("text-field"===o&&n&&!n.glyphs&&h.push(new Xn(r,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&Mr(Zn(a))&&"identity"===Nn(a.type)&&h.push(new Xn(r,a,'"text-font" does not support identity functions'))),h.concat(ki({key:e.key,value:a,valueSpec:c,style:n,styleSpec:i,expressionContext:"property",propertyType:t,propertyKey:o}))}function di(e){return yi(e,"paint")}function vi(e){return yi(e,"layout")}function mi(e){var t=e.value,r=e.key,n=Ir(t);return"string"!==n?[new Xn(r,t,"string expected, ".concat(n," found"))]:[]}var gi={promoteId:function(e){var t=e.key,r=e.value;if("string"===Ir(r))return mi({key:t,value:r});var n=[];for(var i in r)n.push.apply(n,s(mi({key:"".concat(t,".").concat(i),value:r[i]})));return n}};function xi(e){return e.source.reduce((function(t,r){var n=e[r];return"enum"===n.type.type&&(t=t.concat(Object.keys(n.type.values))),t}),[])}var bi={"*":function(){return[]},array:Yn,boolean:function(e){var t=e.value,r=e.key,n=Ir(t);return"boolean"!==n?[new Xn(r,t,"boolean expected, ".concat(n," found"))]:[]},number:Kn,color:function(e){var t=e.key,r=e.value,n=Ir(r);return"string"!==n?[new Xn(t,r,"color expected, ".concat(n," found"))]:null===G(r)?[new Xn(t,r,'color expected, "'.concat(r,'" found'))]:[]},enum:$n,filter:fi,function:Jn,layer:function(e){var t=[],r=e.value,n=e.key,i=e.style,a=e.styleSpec;r.type||r.ref||t.push(new Xn(n,r,'either "type" or "ref" is required'));var o,s=Nn(r.type),u=Nn(r.ref);if(r.id)for(var l=Nn(r.id),c=0;c<e.arrayIndex;c++){var h=i.layers[c];Nn(h.id)===l&&t.push(new Xn(n,r.id,'duplicate layer id "'.concat(r.id,'", previously used at line ').concat(h.id.__line__)))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach((function(e){e in r&&t.push(new Xn(n,r[e],'"'.concat(e,'" is prohibited for ref layers')))})),i.layers.forEach((function(e){Nn(e.id)===u&&(o=e)})),o?o.ref?t.push(new Xn(n,r.ref,"ref cannot reference another ref layer")):s=Nn(o.type):"string"==typeof u&&t.push(new Xn(n,r.ref,'ref layer "'.concat(u,'" not found')));else if("background"!==s&&"sky"!==s)if(r.source){var f=i.sources&&i.sources[r.source],p=f&&Nn(f.type);f?"vector"===p&&"raster"===s?t.push(new Xn(n,r.source,'layer "'.concat(r.id,'" requires a raster source'))):"raster"===p&&"raster"!==s?t.push(new Xn(n,r.source,'layer "'.concat(r.id,'" requires a vector source'))):"vector"!==p||r["source-layer"]?"raster-dem"===p&&"hillshade"!==s?t.push(new Xn(n,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!r.paint||!r.paint["line-gradient"]&&!r.paint["line-trim-offset"]||"geojson"===p&&f.lineMetrics||t.push(new Xn(n,r,'layer "'.concat(r.id,'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.'))):t.push(new Xn(n,r,'layer "'.concat(r.id,'" must specify a "source-layer"'))):t.push(new Xn(n,r.source,'source "'.concat(r.source,'" not found')))}else t.push(new Xn(n,r,'missing required property "source"'));return t=t.concat(Gn({key:n,value:r,valueSpec:a.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ki({key:"".concat(n,".type"),value:r.type,valueSpec:a.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:function(e){return fi(ee({layerType:s},e))},layout:function(e){return Gn({layer:r,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return vi(ee({layerType:s},e))}}})},paint:function(e){return Gn({layer:r,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return di(ee({layerType:s},e))}}})}}})),t},object:Gn,source:function(e){var t=e.value,r=e.key,n=e.styleSpec,i=e.style;if(!t.type)return[new Xn(r,t,'"type" is required')];var a,o=Nn(t.type);switch(o){case"vector":case"raster":case"raster-dem":return a=Gn({key:r,value:t,valueSpec:n["source_".concat(o.replace("-","_"))],style:e.style,styleSpec:n,objectElementValidators:gi});case"geojson":if(a=Gn({key:r,value:t,valueSpec:n.source_geojson,style:i,styleSpec:n,objectElementValidators:gi}),t.cluster)for(var u in t.clusterProperties){var l,c,h=f(t.clusterProperties[u],2),p=h[0],y=h[1],d="string"==typeof p?[p,["accumulated"],["get",u]]:p;(l=a).push.apply(l,s(Wn({key:"".concat(r,".").concat(u,".map"),value:y,expressionContext:"cluster-map"}))),(c=a).push.apply(c,s(Wn({key:"".concat(r,".").concat(u,".reduce"),value:d,expressionContext:"cluster-reduce"})))}return a;case"video":return Gn({key:r,value:t,valueSpec:n.source_video,style:i,styleSpec:n});case"image":return Gn({key:r,value:t,valueSpec:n.source_image,style:i,styleSpec:n});case"canvas":return[new Xn(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $n({key:"".concat(r,".type"),value:t.type,valueSpec:{values:xi(n)},style:i,styleSpec:n})}},light:function(e){var t=e.value,r=e.styleSpec,n=r.light,i=e.style,a=[],o=Ir(t);if(void 0===t)return a;if("object"!==o)return a=a.concat([new Xn("light",t,"object expected, ".concat(o," found"))]);for(var s in t){var u=s.match(/^(.*)-transition$/);a=a.concat(u&&n[u[1]]&&n[u[1]].transition?ki({key:s,value:t[s],valueSpec:r.transition,style:i,styleSpec:r}):n[s]?ki({key:s,value:t[s],valueSpec:n[s],style:i,styleSpec:r}):[new Xn(s,t[s],'unknown property "'.concat(s,'"'))])}return a},terrain:function(e){var t=e.value,r=e.key,n=e.style,i=e.styleSpec,a=i.terrain,o=[],s=Ir(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Xn("terrain",t,"object expected, ".concat(s," found"))]);for(var u in t){var l=u.match(/^(.*)-transition$/);o=o.concat(l&&a[l[1]]&&a[l[1]].transition?ki({key:u,value:t[u],valueSpec:i.transition,style:n,styleSpec:i}):a[u]?ki({key:u,value:t[u],valueSpec:a[u],style:n,styleSpec:i}):[new Xn(u,t[u],'unknown property "'.concat(u,'"'))])}if(t.source){var c=n.sources&&n.sources[t.source],h=c&&Nn(c.type);c?"raster-dem"!==h&&o.push(new Xn(r,t.source,"terrain cannot be used with a source of type ".concat(String(h),', it only be used with a "raster-dem" source type'))):o.push(new Xn(r,t.source,'source "'.concat(t.source,'" not found')))}else o.push(new Xn(r,t,'terrain is missing required property "source"'));return o},fog:function(e){var t=e.value,r=e.style,n=e.styleSpec,i=n.fog,a=[],o=Ir(t);if(void 0===t)return a;if("object"!==o)return a=a.concat([new Xn("fog",t,"object expected, ".concat(o," found"))]);for(var s in t){var u=s.match(/^(.*)-transition$/);a=a.concat(u&&i[u[1]]&&i[u[1]].transition?ki({key:s,value:t[s],valueSpec:n.transition,style:r,styleSpec:n}):i[s]?ki({key:s,value:t[s],valueSpec:i[s],style:r,styleSpec:n}):[new Xn(s,t[s],'unknown property "'.concat(s,'"'))])}return a},string:mi,formatted:function(e){return 0===mi(e).length?[]:Wn(e)},resolvedImage:function(e){return 0===mi(e).length?[]:Wn(e)},projection:function(e){var t=e.value,r=e.styleSpec,n=r.projection,i=e.style,a=[],o=Ir(t);if("object"===o)for(var s in t)a=a.concat(ki({key:s,value:t[s],valueSpec:n[s],style:i,styleSpec:r}));else"string"!==o&&(a=a.concat([new Xn("projection",t,"object or string expected, ".concat(o," found"))]));return a}};function ki(e){var t=e.value,r=e.valueSpec,n=e.styleSpec;return r.expression&&Mr(Nn(t))?Jn(e):r.expression&&Lr(Zn(t))?Wn(e):r.type&&bi[r.type]?bi[r.type](e):Gn(ee({},e,{valueSpec:r.type?n[r.type]:r}))}function wi(e){var t=e.value,r=e.key,n=mi(e);return n.length||(-1===t.indexOf("{fontstack}")&&n.push(new Xn(r,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&n.push(new Xn(r,t,'"glyphs" url must include a "{range}" token'))),n}function _i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Fn;return Ii(ki({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:wi,"*":function(){return[]}}}))}var Si=function(e){return Ii(di(e))},Ai=function(e){return Ii(vi(e))};function Ii(e){return e.slice().sort((function(e,t){return e.line&&t.line?e.line-t.line:0}))}var Mi,Ti,zi,Bi,Ci=function(e){return e>=1536&&e<=1791},Pi=function(e){return e>=1872&&e<=1919},Ei=function(e){return e>=2208&&e<=2303},Di=function(e){return e>=11904&&e<=12031},Vi=function(e){return e>=12032&&e<=12255},Li=function(e){return e>=12272&&e<=12287},Fi=function(e){return e>=12288&&e<=12351},Ri=function(e){return e>=12352&&e<=12447},ji=function(e){return e>=12448&&e<=12543},Oi=function(e){return e>=12544&&e<=12591},Ui=function(e){return e>=12704&&e<=12735},qi=function(e){return e>=12736&&e<=12783},Ni=function(e){return e>=12784&&e<=12799},Zi=function(e){return e>=12800&&e<=13055},Xi=function(e){return e>=13056&&e<=13311},Gi=function(e){return e>=13312&&e<=19903},Yi=function(e){return e>=19968&&e<=40959},Ki=function(e){return e>=40960&&e<=42127},Ji=function(e){return e>=42128&&e<=42191},Wi=function(e){return e>=63744&&e<=64255},Hi=function(e){return e>=64336&&e<=65023},$i=function(e){return e>=65040&&e<=65055},Qi=function(e){return e>=65072&&e<=65103},ea=function(e){return e>=65104&&e<=65135},ta=function(e){return e>=65136&&e<=65279},ra=function(e){return e>=65280&&e<=65519};function na(e){var t,r=u(e);try{for(r.s();!(t=r.n()).done;){if(aa(t.value.charCodeAt(0)))return!0}}catch(n){r.e(n)}finally{r.f()}return!1}function ia(e){return!(Ci(e)||Pi(e)||Ei(e)||Hi(e)||ta(e))}function aa(e){return!(746!==e&&747!==e&&(e<4352||!(Ui(e)||Oi(e)||Qi(e)&&!(e>=65097&&e<=65103)||Wi(e)||Xi(e)||Di(e)||qi(e)||!(!Fi(e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||Gi(e)||Yi(e)||Zi(e)||function(e){return e>=12592&&e<=12687}(e)||function(e){return e>=43360&&e<=43391}(e)||function(e){return e>=55216&&e<=55295}(e)||function(e){return e>=4352&&e<=4607}(e)||function(e){return e>=44032&&e<=55215}(e)||Ri(e)||Li(e)||function(e){return e>=12688&&e<=12703}(e)||Vi(e)||Ni(e)||ji(e)&&12540!==e||!(!ra(e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!ea(e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||function(e){return e>=5120&&e<=5759}(e)||function(e){return e>=6320&&e<=6399}(e)||$i(e)||function(e){return e>=19904&&e<=19967}(e)||Ki(e)||Ji(e))))}function oa(e){return!(aa(e)||function(e){return!!(function(e){return e>=128&&e<=255}(e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||function(e){return e>=8192&&e<=8303}(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||function(e){return e>=8448&&e<=8527}(e)||function(e){return e>=8528&&e<=8591}(e)||function(e){return e>=8960&&e<=9215}(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||function(e){return e>=9216&&e<=9279}(e)&&9251!==e||function(e){return e>=9280&&e<=9311}(e)||function(e){return e>=9312&&e<=9471}(e)||function(e){return e>=9632&&e<=9727}(e)||function(e){return e>=9728&&e<=9983}(e)&&!(e>=9754&&e<=9759)||function(e){return e>=11008&&e<=11263}(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Fi(e)||ji(e)||function(e){return e>=57344&&e<=63743}(e)||Qi(e)||ea(e)||ra(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function sa(e){return e>=1424&&e<=2303||Hi(e)||ta(e)}function ua(e,t){return!(!t&&sa(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||function(e){return e>=6016&&e<=6143}(e))}function la(e){var t,r=u(e);try{for(r.s();!(t=r.n()).done;){if(sa(t.value.charCodeAt(0)))return!0}}catch(n){r.e(n)}finally{r.f()}return!1}var ca={now:function(){return void 0!==zi?zi:g.performance.now()},setNow:function(e){zi=e},restoreNow:function(){zi=void 0},frame:function(e){var t=g.requestAnimationFrame(e);return{cancel:function(){return g.cancelAnimationFrame(t)}}},getImageData:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=e.width,n=e.height;Bi||(Bi=g.document.createElement("canvas"));var i=Bi.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return(r>Bi.width||n>Bi.height)&&(Bi.width=r,Bi.height=n),i.clearRect(-t,-t,r+2*t,n+2*t),i.drawImage(e,0,0,r,n),i.getImageData(-t,-t,r+2*t,n+2*t)},resolveURL:function(e){return Mi||(Mi=g.document.createElement("a")),Mi.href=e,Mi.href},get devicePixelRatio(){return g.devicePixelRatio},get prefersReducedMotion(){return!!g.matchMedia&&(null==Ti&&(Ti=g.matchMedia("(prefers-reduced-motion: reduce)")),Ti.matches)}},ha="loading",fa="loaded",pa="unavailable",ya=null;function da(){va.fire(new On("pluginStateChange",{pluginStatus:pa,pluginURL:ya}))}var va=new qn,ma=function(){return pa},ga=function(){if("deferred"!==pa||!ya)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");pa=ha,da(),ya&&wn({url:ya},(function(e){e?function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(pa="error")}(e):(pa=fa,da())}))},xa={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return pa===fa||null!=xa.applyArabicShaping},isLoading:function(){return pa===ha},setState:function(e){pa=e.pluginStatus,ya=e.pluginURL},isParsed:function(){return null!=xa.applyArabicShaping&&null!=xa.processBidirectionalText&&null!=xa.processStyledBidirectionalText},getPluginURL:function(){return ya}},ba=function(){function e(t,r){p(this,e),this.zoom=t,r?(this.now=r.now,this.fadeDuration=r.fadeDuration,this.transition=r.transition,this.pitch=r.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}return y(e,[{key:"isSupportedScript",value:function(e){return function(e,t){var r,n=u(e);try{for(n.s();!(r=n.n()).done;){if(!ua(r.value.charCodeAt(0),t))return!1}}catch(i){n.e(i)}finally{n.f()}return!0}(e,xa.isLoaded())}}]),e}(),ka=function(){function e(t,r){p(this,e),this.property=t,this.value=r,this.expression=function(e,t){if(Mr(e))return new qr(e,t);if(Lr(e)){var r=Or(e,t);if("error"===r.result)throw new Error(r.value.map((function(e){return"".concat(e.key,": ").concat(e.message)})).join(", "));return r.value}var n=e;return"string"==typeof e&&"color"===t.type&&(n=Q.parse(e)),{kind:"constant",evaluate:function(){return n}}}(void 0===r?t.specification.default:r,t.specification)}return y(e,[{key:"isDataDriven",value:function(){return"source"===this.expression.kind||"composite"===this.expression.kind}},{key:"possiblyEvaluate",value:function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)}}]),e}(),wa=function(){function e(t){p(this,e),this.property=t,this.value=new ka(t,void 0)}return y(e,[{key:"transitioned",value:function(e,t){return new Sa(this.property,this.value,t,I({},e.transition,this.transition),e.now)}},{key:"untransitioned",value:function(){return new Sa(this.property,this.value,null,{},0)}}]),e}(),_a=function(){function e(t){p(this,e),this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}return y(e,[{key:"getValue",value:function(e){return E(this._values[e].value.value)}},{key:"setValue",value:function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new wa(this._values[e].property)),this._values[e].value=new ka(this._values[e].property,null===t?void 0:E(t))}},{key:"getTransition",value:function(e){return E(this._values[e].transition)}},{key:"setTransition",value:function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new wa(this._values[e].property)),this._values[e].transition=E(t)||void 0}},{key:"serialize",value:function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t++){var n=r[t],i=this.getValue(n);void 0!==i&&(e[n]=i);var a=this.getTransition(n);void 0!==a&&(e["".concat(n,"-transition")]=a)}return e}},{key:"transitioned",value:function(e,t){for(var r=new Aa(this._properties),n=0,i=Object.keys(this._values);n<i.length;n++){var a=i[n];r._values[a]=this._values[a].transitioned(e,t._values[a])}return r}},{key:"untransitioned",value:function(){for(var e=new Aa(this._properties),t=0,r=Object.keys(this._values);t<r.length;t++){var n=r[t];e._values[n]=this._values[n].untransitioned()}return e}}]),e}(),Sa=function(){function e(t,r,n,i,a){p(this,e);var o=i.delay||0,s=i.duration||0;a=a||0,this.property=t,this.value=r,this.begin=a+o,this.end=this.begin+s,t.specification.transition&&(i.delay||i.duration)&&(this.prior=n)}return y(e,[{key:"possiblyEvaluate",value:function(e,t,r){var n=e.now||0,i=this.value.possiblyEvaluate(e,t,r),a=this.prior;if(a){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return a.possiblyEvaluate(e,t,r);var o=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,r),i,function(e){if(e<=0)return 0;if(e>=1)return 1;var t=e*e,r=t*e;return 4*(e<.5?r:3*(e-t)+r-.75)}(o))}return i}}]),e}(),Aa=function(){function e(t){p(this,e),this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}return y(e,[{key:"possiblyEvaluate",value:function(e,t,r){for(var n=new Ta(this._properties),i=0,a=Object.keys(this._values);i<a.length;i++){var o=a[i];n._values[o]=this._values[o].possiblyEvaluate(e,t,r)}return n}},{key:"hasTransition",value:function(){for(var e=0,t=Object.keys(this._values);e<t.length;e++){var r=t[e];if(this._values[r].prior)return!0}return!1}}]),e}(),Ia=function(){function e(t){p(this,e),this._properties=t,this._values=Object.create(t.defaultPropertyValues)}return y(e,[{key:"getValue",value:function(e){return E(this._values[e].value)}},{key:"setValue",value:function(e,t){this._values[e]=new ka(this._values[e].property,null===t?void 0:E(t))}},{key:"serialize",value:function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t++){var n=r[t],i=this.getValue(n);void 0!==i&&(e[n]=i)}return e}},{key:"possiblyEvaluate",value:function(e,t,r){for(var n=new Ta(this._properties),i=0,a=Object.keys(this._values);i<a.length;i++){var o=a[i];n._values[o]=this._values[o].possiblyEvaluate(e,t,r)}return n}}]),e}(),Ma=function(){function e(t,r,n){p(this,e),this.property=t,this.value=r,this.parameters=n}return y(e,[{key:"isConstant",value:function(){return"constant"===this.value.kind}},{key:"constantOr",value:function(e){return"constant"===this.value.kind?this.value.value:e}},{key:"evaluate",value:function(e,t,r,n){return this.property.evaluate(this.value,this.parameters,e,t,r,n)}}]),e}(),Ta=function(){function e(t){p(this,e),this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}return y(e,[{key:"get",value:function(e){return this._values[e]}}]),e}(),za=function(){function e(t){p(this,e),this.specification=t}return y(e,[{key:"possiblyEvaluate",value:function(e,t){return e.expression.evaluate(t)}},{key:"interpolate",value:function(e,t,r){var n=kt[this.specification.type];return n?n(e,t,r):e}}]),e}(),Ba=function(){function e(t,r){p(this,e),this.specification=t,this.overrides=r}return y(e,[{key:"possiblyEvaluate",value:function(e,t,r,n){return new Ma(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},r,n)}:e.expression,t)}},{key:"interpolate",value:function(e,t,r){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Ma(this,{kind:"constant",value:void 0},e.parameters);var n=kt[this.specification.type];return n?new Ma(this,{kind:"constant",value:n(e.value.value,t.value.value,r)},e.parameters):e}},{key:"evaluate",value:function(e,t,r,n,i,a){return"constant"===e.kind?e.value:e.evaluate(t,r,n,i,a)}}]),e}(),Ca=function(){function e(t){p(this,e),this.specification=t}return y(e,[{key:"possiblyEvaluate",value:function(e,t,r,n){return!!e.expression.evaluate(t,null,{},r,n)}},{key:"interpolate",value:function(){return!1}}]),e}(),Pa=y((function e(t){p(this,e),this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];var r=new ba(0,{});for(var n in t){var i=t[n];i.specification.overridable&&this.overridableProperties.push(n);var a=this.defaultPropertyValues[n]=new ka(i,void 0),o=this.defaultTransitionablePropertyValues[n]=new wa(i);this.defaultTransitioningPropertyValues[n]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=a.possiblyEvaluate(r)}}));function Ea(e,t){return 256*(e=_(Math.floor(e),0,255))+_(Math.floor(t),0,255)}In(Ba,"DataDrivenProperty"),In(za,"DataConstantProperty"),In(Ca,"ColorRampProperty");var Da={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Va=y((function e(t,r){p(this,e),this._structArray=t,this._pos1=r*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8})),La=function(){function e(){p(this,e),this.isTransferred=!1,this.capacity=-1,this.resize(0)}return y(e,[{key:"_trim",value:function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}},{key:"clear",value:function(){this.length=0}},{key:"resize",value:function(e){this.reserve(e),this.length=e}},{key:"reserve",value:function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}},{key:"_refreshViews",value:function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}},{key:"destroy",value:function(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}],[{key:"serialize",value:function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}},{key:"deserialize",value:function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}}]),e}();function Fa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=0,n=0;return{members:e.map((function(e){var i=Da[e.type].BYTES_PER_ELEMENT,a=r=Ra(r,Math.max(t,i)),o=e.components||1;return n=Math.max(n,i),r+=i*o,{name:e.name,type:e.type,components:o,offset:a}})),size:Ra(r,Math.max(n,t)),alignment:t}}function Ra(e,t){return Math.ceil(e/t)*t}var ja=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}},{key:"emplace",value:function(e,t,r){var n=2*e;return this.int16[n+0]=t,this.int16[n+1]=r,e}}]),r}(La);ja.prototype.bytesPerElement=4,In(ja,"StructArrayLayout2i4");var Oa=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}},{key:"emplace",value:function(e,t,r,n){var i=3*e;return this.int16[i+0]=t,this.int16[i+1]=r,this.int16[i+2]=n,e}}]),r}(La);Oa.prototype.bytesPerElement=6,In(Oa,"StructArrayLayout3i6");var Ua=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}},{key:"emplace",value:function(e,t,r,n,i){var a=4*e;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=n,this.int16[a+3]=i,e}}]),r}(La);Ua.prototype.bytesPerElement=8,In(Ua,"StructArrayLayout4i8");var qa=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n,i,a,o){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,a,o)}},{key:"emplace",value:function(e,t,r,n,i,a,o,s){var u=6*e,l=12*e,c=3*e;return this.int16[u+0]=t,this.int16[u+1]=r,this.uint8[l+4]=n,this.uint8[l+5]=i,this.uint8[l+6]=a,this.uint8[l+7]=o,this.float32[c+2]=s,e}}]),r}(La);qa.prototype.bytesPerElement=12,In(qa,"StructArrayLayout2i4ub1f12");var Na=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}},{key:"emplace",value:function(e,t,r,n,i){var a=4*e;return this.float32[a+0]=t,this.float32[a+1]=r,this.float32[a+2]=n,this.float32[a+3]=i,e}}]),r}(La);Na.prototype.bytesPerElement=16,In(Na,"StructArrayLayout4f16");var Za=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n,i){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i)}},{key:"emplace",value:function(e,t,r,n,i,a){var o=6*e,s=3*e;return this.uint16[o+0]=t,this.uint16[o+1]=r,this.uint16[o+2]=n,this.uint16[o+3]=i,this.float32[s+2]=a,e}}]),r}(La);Za.prototype.bytesPerElement=12,In(Za,"StructArrayLayout4ui1f12");var Xa=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}},{key:"emplace",value:function(e,t,r,n,i){var a=4*e;return this.uint16[a+0]=t,this.uint16[a+1]=r,this.uint16[a+2]=n,this.uint16[a+3]=i,e}}]),r}(La);Xa.prototype.bytesPerElement=8,In(Xa,"StructArrayLayout4ui8");var Ga=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n,i,a){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i,a)}},{key:"emplace",value:function(e,t,r,n,i,a,o){var s=6*e;return this.int16[s+0]=t,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,this.int16[s+4]=a,this.int16[s+5]=o,e}}]),r}(La);Ga.prototype.bytesPerElement=12,In(Ga,"StructArrayLayout6i12");var Ya=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n,i,a,o,s,u,l,c,h){var f=this.length;return this.resize(f+1),this.emplace(f,e,t,r,n,i,a,o,s,u,l,c,h)}},{key:"emplace",value:function(e,t,r,n,i,a,o,s,u,l,c,h,f){var p=12*e;return this.int16[p+0]=t,this.int16[p+1]=r,this.int16[p+2]=n,this.int16[p+3]=i,this.uint16[p+4]=a,this.uint16[p+5]=o,this.uint16[p+6]=s,this.uint16[p+7]=u,this.int16[p+8]=l,this.int16[p+9]=c,this.int16[p+10]=h,this.int16[p+11]=f,e}}]),r}(La);Ya.prototype.bytesPerElement=24,In(Ya,"StructArrayLayout4i4ui4i24");var Ka=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n,i,a){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i,a)}},{key:"emplace",value:function(e,t,r,n,i,a,o){var s=10*e,u=5*e;return this.int16[s+0]=t,this.int16[s+1]=r,this.int16[s+2]=n,this.float32[u+2]=i,this.float32[u+3]=a,this.float32[u+4]=o,e}}]),r}(La);Ka.prototype.bytesPerElement=20,In(Ka,"StructArrayLayout3i3f20");var Ja=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}},{key:"emplace",value:function(e,t){return this.uint32[1*e+0]=t,e}}]),r}(La);Ja.prototype.bytesPerElement=4,In(Ja,"StructArrayLayout1ul4");var Wa=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n,i,a,o,s,u,l,c,h,f){var p=this.length;return this.resize(p+1),this.emplace(p,e,t,r,n,i,a,o,s,u,l,c,h,f)}},{key:"emplace",value:function(e,t,r,n,i,a,o,s,u,l,c,h,f,p){var y=20*e,d=10*e;return this.int16[y+0]=t,this.int16[y+1]=r,this.int16[y+2]=n,this.int16[y+3]=i,this.int16[y+4]=a,this.float32[d+3]=o,this.float32[d+4]=s,this.float32[d+5]=u,this.float32[d+6]=l,this.int16[y+14]=c,this.uint32[d+8]=h,this.uint16[y+18]=f,this.uint16[y+19]=p,e}}]),r}(La);Wa.prototype.bytesPerElement=40,In(Wa,"StructArrayLayout5i4f1i1ul2ui40");var Ha=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n,i,a,o){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,a,o)}},{key:"emplace",value:function(e,t,r,n,i,a,o,s){var u=8*e;return this.int16[u+0]=t,this.int16[u+1]=r,this.int16[u+2]=n,this.int16[u+4]=i,this.int16[u+5]=a,this.int16[u+6]=o,this.int16[u+7]=s,e}}]),r}(La);Ha.prototype.bytesPerElement=16,In(Ha,"StructArrayLayout3i2i2i16");var $a=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n,i){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i)}},{key:"emplace",value:function(e,t,r,n,i,a){var o=4*e,s=8*e;return this.float32[o+0]=t,this.float32[o+1]=r,this.float32[o+2]=n,this.int16[s+6]=i,this.int16[s+7]=a,e}}]),r}(La);$a.prototype.bytesPerElement=16,In($a,"StructArrayLayout2f1f2i16");var Qa=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}},{key:"emplace",value:function(e,t,r,n,i){var a=12*e,o=3*e;return this.uint8[a+0]=t,this.uint8[a+1]=r,this.float32[o+1]=n,this.float32[o+2]=i,e}}]),r}(La);Qa.prototype.bytesPerElement=12,In(Qa,"StructArrayLayout2ub2f12");var eo=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}},{key:"emplace",value:function(e,t,r,n){var i=3*e;return this.float32[i+0]=t,this.float32[i+1]=r,this.float32[i+2]=n,e}}]),r}(La);eo.prototype.bytesPerElement=12,In(eo,"StructArrayLayout3f12");var to=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r){var n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}},{key:"emplace",value:function(e,t,r,n){var i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=r,this.uint16[i+2]=n,e}}]),r}(La);to.prototype.bytesPerElement=6,In(to,"StructArrayLayout3ui6");var ro=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n,i,a,o,s,u,l,c,h,f,p,y,d,v,m,g,x,b){var k=this.length;return this.resize(k+1),this.emplace(k,e,t,r,n,i,a,o,s,u,l,c,h,f,p,y,d,v,m,g,x,b)}},{key:"emplace",value:function(e,t,r,n,i,a,o,s,u,l,c,h,f,p,y,d,v,m,g,x,b,k){var w=30*e,_=15*e,S=60*e;return this.int16[w+0]=t,this.int16[w+1]=r,this.int16[w+2]=n,this.float32[_+2]=i,this.float32[_+3]=a,this.uint16[w+8]=o,this.uint16[w+9]=s,this.uint32[_+5]=u,this.uint32[_+6]=l,this.uint32[_+7]=c,this.uint16[w+16]=h,this.uint16[w+17]=f,this.uint16[w+18]=p,this.float32[_+10]=y,this.float32[_+11]=d,this.uint8[S+48]=v,this.uint8[S+49]=m,this.uint8[S+50]=g,this.uint32[_+13]=x,this.int16[w+28]=b,this.uint8[S+58]=k,e}}]),r}(La);ro.prototype.bytesPerElement=60,In(ro,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");var no=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n,i,a,o,s,u,l,c,h,f,p,y,d,v,m,g,x,b,k,w,_,S,A,I,M,T,z){var B=this.length;return this.resize(B+1),this.emplace(B,e,t,r,n,i,a,o,s,u,l,c,h,f,p,y,d,v,m,g,x,b,k,w,_,S,A,I,M,T,z)}},{key:"emplace",value:function(e,t,r,n,i,a,o,s,u,l,c,h,f,p,y,d,v,m,g,x,b,k,w,_,S,A,I,M,T,z,B){var C=38*e,P=19*e;return this.int16[C+0]=t,this.int16[C+1]=r,this.int16[C+2]=n,this.float32[P+2]=i,this.float32[P+3]=a,this.int16[C+8]=o,this.int16[C+9]=s,this.int16[C+10]=u,this.int16[C+11]=l,this.int16[C+12]=c,this.int16[C+13]=h,this.uint16[C+14]=f,this.uint16[C+15]=p,this.uint16[C+16]=y,this.uint16[C+17]=d,this.uint16[C+18]=v,this.uint16[C+19]=m,this.uint16[C+20]=g,this.uint16[C+21]=x,this.uint16[C+22]=b,this.uint16[C+23]=k,this.uint16[C+24]=w,this.uint16[C+25]=_,this.uint16[C+26]=S,this.uint16[C+27]=A,this.uint16[C+28]=I,this.uint32[P+15]=M,this.float32[P+16]=T,this.float32[P+17]=z,this.float32[P+18]=B,e}}]),r}(La);no.prototype.bytesPerElement=76,In(no,"StructArrayLayout3i2f6i15ui1ul3f76");var io=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}},{key:"emplace",value:function(e,t){return this.float32[1*e+0]=t,e}}]),r}(La);io.prototype.bytesPerElement=4,In(io,"StructArrayLayout1f4");var ao=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n,i){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i)}},{key:"emplace",value:function(e,t,r,n,i,a){var o=5*e;return this.float32[o+0]=t,this.float32[o+1]=r,this.float32[o+2]=n,this.float32[o+3]=i,this.float32[o+4]=a,e}}]),r}(La);ao.prototype.bytesPerElement=20,In(ao,"StructArrayLayout5f20");var oo=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,r,n){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}},{key:"emplace",value:function(e,t,r,n,i){var a=6*e;return this.uint32[3*e+0]=t,this.uint16[a+2]=r,this.uint16[a+3]=n,this.uint16[a+4]=i,e}}]),r}(La);oo.prototype.bytesPerElement=12,In(oo,"StructArrayLayout1ul3ui12");var so=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}},{key:"emplace",value:function(e,t,r){var n=2*e;return this.uint16[n+0]=t,this.uint16[n+1]=r,e}}]),r}(La);so.prototype.bytesPerElement=4,In(so,"StructArrayLayout2ui4");var uo=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}},{key:"emplace",value:function(e,t){return this.uint16[1*e+0]=t,e}}]),r}(La);uo.prototype.bytesPerElement=2,In(uo,"StructArrayLayout1ui2");var lo=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t){var r=this.length;return this.resize(r+1),this.emplace(r,e,t)}},{key:"emplace",value:function(e,t,r){var n=2*e;return this.float32[n+0]=t,this.float32[n+1]=r,e}}]),r}(La);lo.prototype.bytesPerElement=8,In(lo,"StructArrayLayout2f8");var co=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"projectedAnchorX",get:function(){return this._structArray.int16[this._pos2+0]}},{key:"projectedAnchorY",get:function(){return this._structArray.int16[this._pos2+1]}},{key:"projectedAnchorZ",get:function(){return this._structArray.int16[this._pos2+2]}},{key:"tileAnchorX",get:function(){return this._structArray.int16[this._pos2+3]}},{key:"tileAnchorY",get:function(){return this._structArray.int16[this._pos2+4]}},{key:"x1",get:function(){return this._structArray.float32[this._pos4+3]}},{key:"y1",get:function(){return this._structArray.float32[this._pos4+4]}},{key:"x2",get:function(){return this._structArray.float32[this._pos4+5]}},{key:"y2",get:function(){return this._structArray.float32[this._pos4+6]}},{key:"padding",get:function(){return this._structArray.int16[this._pos2+14]}},{key:"featureIndex",get:function(){return this._structArray.uint32[this._pos4+8]}},{key:"sourceLayerIndex",get:function(){return this._structArray.uint16[this._pos2+18]}},{key:"bucketIndex",get:function(){return this._structArray.uint16[this._pos2+19]}}]),r}(Va);co.prototype.size=40;var ho=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"get",value:function(e){return new co(this,e)}}]),r}(Wa);In(ho,"CollisionBoxArray");var fo=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"projectedAnchorX",get:function(){return this._structArray.int16[this._pos2+0]}},{key:"projectedAnchorY",get:function(){return this._structArray.int16[this._pos2+1]}},{key:"projectedAnchorZ",get:function(){return this._structArray.int16[this._pos2+2]}},{key:"tileAnchorX",get:function(){return this._structArray.float32[this._pos4+2]}},{key:"tileAnchorY",get:function(){return this._structArray.float32[this._pos4+3]}},{key:"glyphStartIndex",get:function(){return this._structArray.uint16[this._pos2+8]}},{key:"numGlyphs",get:function(){return this._structArray.uint16[this._pos2+9]}},{key:"vertexStartIndex",get:function(){return this._structArray.uint32[this._pos4+5]}},{key:"lineStartIndex",get:function(){return this._structArray.uint32[this._pos4+6]}},{key:"lineLength",get:function(){return this._structArray.uint32[this._pos4+7]}},{key:"segment",get:function(){return this._structArray.uint16[this._pos2+16]}},{key:"lowerSize",get:function(){return this._structArray.uint16[this._pos2+17]}},{key:"upperSize",get:function(){return this._structArray.uint16[this._pos2+18]}},{key:"lineOffsetX",get:function(){return this._structArray.float32[this._pos4+10]}},{key:"lineOffsetY",get:function(){return this._structArray.float32[this._pos4+11]}},{key:"writingMode",get:function(){return this._structArray.uint8[this._pos1+48]}},{key:"placedOrientation",get:function(){return this._structArray.uint8[this._pos1+49]},set:function(e){this._structArray.uint8[this._pos1+49]=e}},{key:"hidden",get:function(){return this._structArray.uint8[this._pos1+50]},set:function(e){this._structArray.uint8[this._pos1+50]=e}},{key:"crossTileID",get:function(){return this._structArray.uint32[this._pos4+13]},set:function(e){this._structArray.uint32[this._pos4+13]=e}},{key:"associatedIconIndex",get:function(){return this._structArray.int16[this._pos2+28]}},{key:"flipState",get:function(){return this._structArray.uint8[this._pos1+58]},set:function(e){this._structArray.uint8[this._pos1+58]=e}}]),r}(Va);fo.prototype.size=60;var po=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"get",value:function(e){return new fo(this,e)}}]),r}(ro);In(po,"PlacedSymbolArray");var yo=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"projectedAnchorX",get:function(){return this._structArray.int16[this._pos2+0]}},{key:"projectedAnchorY",get:function(){return this._structArray.int16[this._pos2+1]}},{key:"projectedAnchorZ",get:function(){return this._structArray.int16[this._pos2+2]}},{key:"tileAnchorX",get:function(){return this._structArray.float32[this._pos4+2]}},{key:"tileAnchorY",get:function(){return this._structArray.float32[this._pos4+3]}},{key:"rightJustifiedTextSymbolIndex",get:function(){return this._structArray.int16[this._pos2+8]}},{key:"centerJustifiedTextSymbolIndex",get:function(){return this._structArray.int16[this._pos2+9]}},{key:"leftJustifiedTextSymbolIndex",get:function(){return this._structArray.int16[this._pos2+10]}},{key:"verticalPlacedTextSymbolIndex",get:function(){return this._structArray.int16[this._pos2+11]}},{key:"placedIconSymbolIndex",get:function(){return this._structArray.int16[this._pos2+12]}},{key:"verticalPlacedIconSymbolIndex",get:function(){return this._structArray.int16[this._pos2+13]}},{key:"key",get:function(){return this._structArray.uint16[this._pos2+14]}},{key:"textBoxStartIndex",get:function(){return this._structArray.uint16[this._pos2+15]}},{key:"textBoxEndIndex",get:function(){return this._structArray.uint16[this._pos2+16]}},{key:"verticalTextBoxStartIndex",get:function(){return this._structArray.uint16[this._pos2+17]}},{key:"verticalTextBoxEndIndex",get:function(){return this._structArray.uint16[this._pos2+18]}},{key:"iconBoxStartIndex",get:function(){return this._structArray.uint16[this._pos2+19]}},{key:"iconBoxEndIndex",get:function(){return this._structArray.uint16[this._pos2+20]}},{key:"verticalIconBoxStartIndex",get:function(){return this._structArray.uint16[this._pos2+21]}},{key:"verticalIconBoxEndIndex",get:function(){return this._structArray.uint16[this._pos2+22]}},{key:"featureIndex",get:function(){return this._structArray.uint16[this._pos2+23]}},{key:"numHorizontalGlyphVertices",get:function(){return this._structArray.uint16[this._pos2+24]}},{key:"numVerticalGlyphVertices",get:function(){return this._structArray.uint16[this._pos2+25]}},{key:"numIconVertices",get:function(){return this._structArray.uint16[this._pos2+26]}},{key:"numVerticalIconVertices",get:function(){return this._structArray.uint16[this._pos2+27]}},{key:"useRuntimeCollisionCircles",get:function(){return this._structArray.uint16[this._pos2+28]}},{key:"crossTileID",get:function(){return this._structArray.uint32[this._pos4+15]},set:function(e){this._structArray.uint32[this._pos4+15]=e}},{key:"textOffset0",get:function(){return this._structArray.float32[this._pos4+16]}},{key:"textOffset1",get:function(){return this._structArray.float32[this._pos4+17]}},{key:"collisionCircleDiameter",get:function(){return this._structArray.float32[this._pos4+18]}}]),r}(Va);yo.prototype.size=76;var vo=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"get",value:function(e){return new yo(this,e)}}]),r}(no);In(vo,"SymbolInstanceArray");var mo=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"getoffsetX",value:function(e){return this.float32[1*e+0]}}]),r}(io);In(mo,"GlyphOffsetArray");var go=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"getx",value:function(e){return this.int16[2*e+0]}},{key:"gety",value:function(e){return this.int16[2*e+1]}}]),r}(ja);In(go,"SymbolLineVertexArray");var xo=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"featureIndex",get:function(){return this._structArray.uint32[this._pos4+0]}},{key:"sourceLayerIndex",get:function(){return this._structArray.uint16[this._pos2+2]}},{key:"bucketIndex",get:function(){return this._structArray.uint16[this._pos2+3]}},{key:"layoutVertexArrayOffset",get:function(){return this._structArray.uint16[this._pos2+4]}}]),r}(Va);xo.prototype.size=12;var bo=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"get",value:function(e){return new xo(this,e)}}]),r}(oo);In(bo,"FeatureIndexArray");var ko=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"geta_centroid_pos0",value:function(e){return this.uint16[2*e+0]}},{key:"geta_centroid_pos1",value:function(e){return this.uint16[2*e+1]}}]),r}(so);In(ko,"FillExtrusionCentroidArray");var wo=Fa([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),_o=Fa([{name:"a_dash",components:4,type:"Uint16"}]),So={},Ao={get exports(){return So},set exports(e){So=e}},Io={};({get exports(){return Io},set exports(e){Io=e}}).exports=function(e,t){var r,n,i,a,o,s,u,l;for(n=e.length-(r=3&e.length),i=t,o=3432918353,s=461845907,l=0;l<n;)u=255&e.charCodeAt(l)|(255&e.charCodeAt(++l))<<8|(255&e.charCodeAt(++l))<<16|(255&e.charCodeAt(++l))<<24,++l,i=27492+(65535&(a=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(u=0,r){case 3:u^=(255&e.charCodeAt(l+2))<<16;case 2:u^=(255&e.charCodeAt(l+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&e.charCodeAt(l)))*o+(((u>>>16)*o&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0};var Mo={};({get exports(){return Mo},set exports(e){Mo=e}}).exports=function(e,t){for(var r,n=e.length,i=t^n,a=0;n>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++a;switch(n){case 3:i^=(255&e.charCodeAt(a+2))<<16;case 2:i^=(255&e.charCodeAt(a+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(a)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0};var To=Io,zo=Mo;Ao.exports=To,So.murmur3=To,So.murmur2=zo;var Bo=function(){function e(){p(this,e),this.ids=[],this.positions=[],this.indexed=!1}return y(e,[{key:"add",value:function(e,t,r,n){this.ids.push(Co(e)),this.positions.push(t,r,n)}},{key:"getPositions",value:function(e){for(var t=Co(e),r=0,n=this.ids.length-1;r<n;){var i=r+n>>1;this.ids[i]>=t?n=i:r=i+1}for(var a=[];this.ids[r]===t;)a.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return a}}],[{key:"serialize",value:function(e,t){var r=new Float64Array(e.ids),n=new Uint32Array(e.positions);return Po(r,n,0,r.length-1),t&&t.push(r.buffer,n.buffer),{ids:r,positions:n}}},{key:"deserialize",value:function(t){var r=new e;return r.ids=t.ids,r.positions=t.positions,r.indexed=!0,r}}]),e}();function Co(e){var t=+e;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:So(String(e))}function Po(e,t,r,n){for(;r<n;){for(var i=e[r+n>>1],a=r-1,o=n+1;;){do{a++}while(e[a]<i);do{o--}while(e[o]>i);if(a>=o)break;Eo(e,a,o),Eo(t,3*a,3*o),Eo(t,3*a+1,3*o+1),Eo(t,3*a+2,3*o+2)}o-r<n-o?(Po(e,t,r,o),r=o+1):(Po(e,t,o+1,n),n=o)}}function Eo(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}In(Bo,"FeaturePositionMap");var Do=function(){function e(t){p(this,e),this.gl=t.gl,this.initialized=!1}return y(e,[{key:"fetchUniformLocation",value:function(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}}]),e}(),Vo=function(e){l(r,e);var t=c(r);function r(e){var n;return p(this,r),(n=t.call(this,e)).current=0,n}return y(r,[{key:"set",value:function(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}]),r}(Do),Lo=function(e){l(r,e);var t=c(r);function r(e){var n;return p(this,r),(n=t.call(this,e)).current=[0,0,0,0],n}return y(r,[{key:"set",value:function(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}]),r}(Do),Fo=function(e){l(r,e);var t=c(r);function r(e){var n;return p(this,r),(n=t.call(this,e)).current=Q.transparent,n}return y(r,[{key:"set",value:function(e,t,r){this.fetchUniformLocation(e,t)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}]),r}(Do);function Ro(e){return[Ea(255*e.r,255*e.g),Ea(255*e.b,255*e.a)]}var jo=function(){function e(t,r,n){p(this,e),this.value=t,this.uniformNames=r.map((function(e){return"u_".concat(e)})),this.type=n}return y(e,[{key:"setUniform",value:function(e,t,r,n,i){t.set(e,i,n.constantOr(this.value))}},{key:"getBinding",value:function(e,t){return"color"===this.type?new Fo(e):new Vo(e)}}]),e}(),Oo=function(){function e(t,r){p(this,e),this.uniformNames=r.map((function(e){return"u_".concat(e)})),this.pattern=null,this.pixelRatio=1}return y(e,[{key:"setConstantPatternPositions",value:function(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}},{key:"setUniform",value:function(e,t,r,n,i){var a="u_pattern"===i||"u_dash"===i?this.pattern:"u_pixel_ratio"===i?this.pixelRatio:null;a&&t.set(e,i,a)}},{key:"getBinding",value:function(e,t){return"u_pattern"===t||"u_dash"===t?new Lo(e):new Vo(e)}}]),e}(),Uo=function(){function e(t,r,n,i){p(this,e),this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=r.map((function(e){return{name:"a_".concat(e),type:"Float32",components:"color"===n?2:1,offset:0}})),this.paintVertexArray=new i}return y(e,[{key:"populatePaintArray",value:function(e,t,r,n,i,a){var o=this.paintVertexArray.length,s=this.expression.evaluate(new ba(0),t,{},i,n,a);this.paintVertexArray.resize(e),this._setPaintValue(o,e,s)}},{key:"updatePaintArray",value:function(e,t,r,n,i){var a=this.expression.evaluate({zoom:0},r,n,void 0,i);this._setPaintValue(e,t,a)}},{key:"_setPaintValue",value:function(e,t,r){if("color"===this.type)for(var n=Ro(r),i=e;i<t;i++)this.paintVertexArray.emplace(i,n[0],n[1]);else{for(var a=e;a<t;a++)this.paintVertexArray.emplace(a,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}},{key:"upload",value:function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}},{key:"destroy",value:function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}]),e}(),qo=function(){function e(t,r,n,i,a,o){p(this,e),this.expression=t,this.uniformNames=r.map((function(e){return"u_".concat(e,"_t")})),this.type=n,this.useIntegerZoom=i,this.zoom=a,this.maxValue=0,this.paintVertexAttributes=r.map((function(e){return{name:"a_".concat(e),type:"Float32",components:"color"===n?4:2,offset:0}})),this.paintVertexArray=new o}return y(e,[{key:"populatePaintArray",value:function(e,t,r,n,i,a){var o=this.expression.evaluate(new ba(this.zoom),t,{},i,n,a),s=this.expression.evaluate(new ba(this.zoom+1),t,{},i,n,a),u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(u,e,o,s)}},{key:"updatePaintArray",value:function(e,t,r,n,i){var a=this.expression.evaluate({zoom:this.zoom},r,n,void 0,i),o=this.expression.evaluate({zoom:this.zoom+1},r,n,void 0,i);this._setPaintValue(e,t,a,o)}},{key:"_setPaintValue",value:function(e,t,r,n){if("color"===this.type)for(var i=Ro(r),a=Ro(n),o=e;o<t;o++)this.paintVertexArray.emplace(o,i[0],i[1],a[0],a[1]);else{for(var s=e;s<t;s++)this.paintVertexArray.emplace(s,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}}},{key:"upload",value:function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}},{key:"destroy",value:function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}},{key:"setUniform",value:function(e,t,r,n,i){var a=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,o=_(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);t.set(e,i,o)}},{key:"getBinding",value:function(e,t){return new Vo(e)}}]),e}(),No=function(){function e(t,r,n,i,a){p(this,e),this.expression=t,this.layerId=a,this.paintVertexAttributes=("array"===n?_o:wo).members;for(var o=0;o<r.length;++o);this.paintVertexArray=new i}return y(e,[{key:"populatePaintArray",value:function(e,t,r){var n=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(n,e,t.patterns&&t.patterns[this.layerId],r)}},{key:"updatePaintArray",value:function(e,t,r,n,i,a){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],a)}},{key:"_setPaintValues",value:function(e,t,r,n){if(n&&r){var i=n[r];if(i)for(var a=i.tl,o=i.br,s=i.pixelRatio,u=e;u<t;u++)this.paintVertexArray.emplace(u,a[0],a[1],o[0],o[1],s)}}},{key:"upload",value:function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}},{key:"destroy",value:function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}]),e}(),Zo=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0};p(this,e),this.binders={},this._buffers=[];var i=[];for(var a in t.paint._values)if(n(a)){var o=t.paint.get(a);if(o instanceof Ma&&_r(o.property.specification)){var s=Yo(a,t.type),u=o.value,l=o.property.specification.type,c=o.property.useIntegerZoom,h="line-dasharray"===a||a.endsWith("pattern"),f="line-dasharray"===a&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==u.kind||f)if("source"===u.kind||f||h){var y=Wo(a,l,"source");this.binders[a]=h?new No(u,s,l,y,t.id):new Uo(u,s,l,y),i.push("/a_".concat(a))}else{var d=Wo(a,l,"composite");this.binders[a]=new qo(u,s,l,c,r,d),i.push("/z_".concat(a))}else this.binders[a]=h?new Oo(u.value,s):new jo(u.value,s,l),i.push("/u_".concat(a))}}this.cacheKey=i.sort().join("")}return y(e,[{key:"getMaxValue",value:function(e){var t=this.binders[e];return t instanceof Uo||t instanceof qo?t.maxValue:0}},{key:"populatePaintArrays",value:function(e,t,r,n,i,a){for(var o in this.binders){var s=this.binders[o];(s instanceof Uo||s instanceof qo||s instanceof No)&&s.populatePaintArray(e,t,r,n,i,a)}}},{key:"setConstantPatternPositions",value:function(e){for(var t in this.binders){var r=this.binders[t];r instanceof Oo&&r.setConstantPatternPositions(e)}}},{key:"updatePaintArrays",value:function(e,t,r,n,i,a){var o=!1;for(var s in e){var l,c=t.getPositions(s),h=u(c);try{for(h.s();!(l=h.n()).done;){var f=l.value,p=r.feature(f.index);for(var y in this.binders){var d=this.binders[y];if((d instanceof Uo||d instanceof qo||d instanceof No)&&!0===d.expression.isStateDependent){var v=n.paint.get(y);d.expression=v.value,d.updatePaintArray(f.start,f.end,p,e[s],i,a),o=!0}}}}catch(m){h.e(m)}finally{h.f()}}return o}},{key:"defines",value:function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof jo||r instanceof Oo)&&e.push.apply(e,s(r.uniformNames.map((function(e){return"#define HAS_UNIFORM_".concat(e)}))))}return e}},{key:"getBinderAttributes",value:function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof Uo||r instanceof qo||r instanceof No)for(var n=0;n<r.paintVertexAttributes.length;n++)e.push(r.paintVertexAttributes[n].name)}return e}},{key:"getBinderUniforms",value:function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof jo||r instanceof Oo||r instanceof qo){var n,i=u(r.uniformNames);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.push(a)}}catch(o){i.e(o)}finally{i.f()}}}return e}},{key:"getPaintVertexBuffers",value:function(){return this._buffers}},{key:"getUniforms",value:function(e){var t=[];for(var r in this.binders){var n=this.binders[r];if(n instanceof jo||n instanceof Oo||n instanceof qo){var i,a=u(n.uniformNames);try{for(a.s();!(i=a.n()).done;){var o=i.value;t.push({name:o,property:r,binding:n.getBinding(e,o)})}}catch(s){a.e(s)}finally{a.f()}}}return t}},{key:"setUniforms",value:function(e,t,r,n,i){var a,o=u(r);try{for(o.s();!(a=o.n()).done;){var s=a.value,l=s.name,c=s.property,h=s.binding;this.binders[c].setUniform(e,h,i,n.get(c),l)}}catch(f){o.e(f)}finally{o.f()}}},{key:"updatePaintBuffers",value:function(){for(var e in this._buffers=[],this.binders){var t=this.binders[e];(t instanceof Uo||t instanceof qo||t instanceof No)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer)}}},{key:"upload",value:function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof Uo||r instanceof qo||r instanceof No)&&r.upload(e)}this.updatePaintBuffers()}},{key:"destroy",value:function(){for(var e in this.binders){var t=this.binders[e];(t instanceof Uo||t instanceof qo||t instanceof No)&&t.destroy()}}}]),e}(),Xo=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0};p(this,e),this.programConfigurations={};var i,a=u(t);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.programConfigurations[o.id]=new Zo(o,r,n)}}catch(s){a.e(s)}finally{a.f()}this.needsUpload=!1,this._featureMap=new Bo,this._bufferOffset=0}return y(e,[{key:"populatePaintArrays",value:function(e,t,r,n,i,a,o){for(var s in this.programConfigurations)this.programConfigurations[s].populatePaintArrays(e,t,n,i,a,o);void 0!==t.id&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}},{key:"updatePaintArrays",value:function(e,t,r,n,i){var a,o=u(r);try{for(o.s();!(a=o.n()).done;){var s=a.value;this.needsUpload=this.programConfigurations[s.id].updatePaintArrays(e,this._featureMap,t,s,n,i)||this.needsUpload}}catch(l){o.e(l)}finally{o.f()}}},{key:"get",value:function(e){return this.programConfigurations[e]}},{key:"upload",value:function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}},{key:"destroy",value:function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()}}]),e}(),Go={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Yo(e,t){return Go[e]||[e.replace("".concat(t,"-"),"").replace(/-/g,"_")]}var Ko={"line-pattern":{source:Za,composite:Za},"fill-pattern":{source:Za,composite:Za},"fill-extrusion-pattern":{source:Za,composite:Za},"line-dasharray":{source:Xa,composite:Xa}},Jo={color:{source:lo,composite:Na},number:{source:io,composite:lo}};function Wo(e,t,r){var n=Ko[e];return n&&n[r]||Jo[t][r]}In(jo,"ConstantBinder"),In(Oo,"PatternConstantBinder"),In(Uo,"SourceExpressionBinder"),In(No,"PatternCompositeBinder"),In(qo,"CompositeExpressionBinder"),In(Zo,"ProgramConfiguration",{omit:["_buffers"]}),In(Xo,"ProgramConfigurationSet");var Ho="-transition",$o=function(e){l(r,e);var t=c(r);function r(e,n){var i;if(p(this,r),(i=t.call(this)).id=e.id,i.type=e.type,i._featureFilter={filter:function(){return!0},needGeometry:!1,needFeature:!1},i._filterCompiled=!1,"custom"!==e.type&&(i.metadata=e.metadata,i.minzoom=e.minzoom,i.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(i.source=e.source,i.sourceLayer=e["source-layer"],i.filter=e.filter),n.layout&&(i._unevaluatedLayout=new Ia(n.layout)),n.paint)){for(var o in i._transitionablePaint=new _a(n.paint),e.paint)i.setPaintProperty(o,e.paint[o],{validate:!1});for(var s in e.layout)i.setLayoutProperty(s,e.layout[s],{validate:!1});i._transitioningPaint=i._transitionablePaint.untransitioned(),i.paint=new Ta(n.paint)}return a(i)}return y(r,[{key:"getLayoutProperty",value:function(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}},{key:"setLayoutProperty",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null!=t&&this._validate(Ai,"layers.".concat(this.id,".layout.").concat(e),e,t,r)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}},{key:"getPaintProperty",value:function(e){return C(e,Ho)?this._transitionablePaint.getTransition(e.slice(0,-Ho.length)):this._transitionablePaint.getValue(e)}},{key:"setPaintProperty",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=t&&this._validate(Si,"layers.".concat(this.id,".paint.").concat(e),e,t,r))return!1;if(C(e,Ho))return this._transitionablePaint.setTransition(e.slice(0,-Ho.length),t||void 0),!1;var n=this._transitionablePaint._values[e],i=n.value.isDataDriven(),a=n.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);var o=this._transitionablePaint._values[e].value,s=o.isDataDriven(),u=C(e,"pattern")||"line-dasharray"===e;return s||i||u||this._handleOverridablePaintPropertyUpdate(e,a,o)}},{key:"_handleSpecialPaintPropertyUpdate",value:function(e){}},{key:"getProgramIds",value:function(){return null}},{key:"getProgramConfiguration",value:function(e){return null}},{key:"_handleOverridablePaintPropertyUpdate",value:function(e,t,r){return!1}},{key:"isHidden",value:function(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}},{key:"updateTransitions",value:function(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}},{key:"hasTransition",value:function(){return this._transitioningPaint.hasTransition()}},{key:"recalculate",value:function(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}},{key:"serialize",value:function(){var e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),function(e,t,r){var n={};for(var i in e)t.call(this,e[i],i,e)&&(n[i]=e[i]);return n}(e,(function(e,t){return!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)}))}},{key:"_validate",value:function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!i||!1!==i.validate)&&function(e,t){var r=!1;if(t&&t.length){var n,i=u(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;e.fire(new Un(new Error(a.message))),r=!0}}catch(o){i.e(o)}finally{i.f()}}return r}(this,e.call(_i,{key:t,layerType:this.type,objectKey:r,value:n,styleSpec:Fn,style:{glyphs:!0,sprite:!0}}))}},{key:"is3D",value:function(){return!1}},{key:"isSky",value:function(){return!1}},{key:"isTileClipped",value:function(){return!1}},{key:"hasOffscreenPass",value:function(){return!1}},{key:"resize",value:function(){}},{key:"isStateDependent",value:function(){for(var e in this.paint._values){var t=this.paint.get(e);if(t instanceof Ma&&_r(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}},{key:"compileFilter",value:function(){this._filterCompiled||(this._featureFilter=ei(this.filter),this._filterCompiled=!0)}},{key:"invalidateCompiledFilter",value:function(){this._filterCompiled=!1}},{key:"dynamicFilter",value:function(){return this._featureFilter.dynamicFilter}},{key:"dynamicFilterNeedsFeature",value:function(){return this._featureFilter.needFeature}}]),r}(qn),Qo=Fa([{name:"a_pos",components:2,type:"Int16"}],4),es=Fa([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),ts=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];p(this,e),this.segments=t}return y(e,[{key:"prepareSegment",value:function(t,r,n,i){var a=this.segments[this.segments.length-1];return t>e.MAX_VERTEX_ARRAY_LENGTH&&V("Max vertices per segment is ".concat(e.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(t)),(!a||a.vertexLength+t>e.MAX_VERTEX_ARRAY_LENGTH||a.sortKey!==i)&&(a={vertexOffset:r.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==i&&(a.sortKey=i),this.segments.push(a)),a}},{key:"get",value:function(){return this.segments}},{key:"destroy",value:function(){var e,t=u(this.segments);try{for(t.s();!(e=t.n()).done;){var r=e.value;for(var n in r.vaos)r.vaos[n].destroy()}}catch(i){t.e(i)}finally{t.f()}}}],[{key:"simpleSegment",value:function(t,r,n,i){return new e([{vertexOffset:t,primitiveOffset:r,vertexLength:n,primitiveLength:i,vaos:{},sortKey:0}])}}]),e}();ts.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,In(ts,"SegmentVector");var rs=8192,ns=function(){function e(t,r){p(this,e),t&&(r?this.setSouthWest(t).setNorthEast(r):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}return y(e,[{key:"setNorthEast",value:function(e){return this._ne=e instanceof Ws?new Ws(e.lng,e.lat):Ws.convert(e),this}},{key:"setSouthWest",value:function(e){return this._sw=e instanceof Ws?new Ws(e.lng,e.lat):Ws.convert(e),this}},{key:"extend",value:function(t){var r,n,i=this._sw,a=this._ne;if(t instanceof Ws)r=t,n=t;else{if(!(t instanceof e))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(e.convert(t)):this.extend(Ws.convert(t)):"object"==typeof t&&null!==t&&t.hasOwnProperty("lat")&&t.hasOwnProperty("lon")?this.extend(Ws.convert(t)):this;if(r=t._sw,n=t._ne,!r||!n)return this}return i||a?(i.lng=Math.min(r.lng,i.lng),i.lat=Math.min(r.lat,i.lat),a.lng=Math.max(n.lng,a.lng),a.lat=Math.max(n.lat,a.lat)):(this._sw=new Ws(r.lng,r.lat),this._ne=new Ws(n.lng,n.lat)),this}},{key:"getCenter",value:function(){return new Ws((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}},{key:"getSouthWest",value:function(){return this._sw}},{key:"getNorthEast",value:function(){return this._ne}},{key:"getNorthWest",value:function(){return new Ws(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new Ws(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this._sw.lng}},{key:"getSouth",value:function(){return this._sw.lat}},{key:"getEast",value:function(){return this._ne.lng}},{key:"getNorth",value:function(){return this._ne.lat}},{key:"toArray",value:function(){return[this._sw.toArray(),this._ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this._sw&&this._ne)}},{key:"contains",value:function(e){var t=Ws.convert(e),r=t.lng,n=t.lat,i=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&i}}],[{key:"convert",value:function(t){return!t||t instanceof e?t:new e(t)}}]),e}(),is=1e-6,as="undefined"!=typeof Float32Array?Float32Array:Array;function os(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ss(e,t){var r=t[0],n=t[1],i=t[2],a=t[3],o=t[4],s=t[5],u=t[6],l=t[7],c=t[8],h=t[9],f=t[10],p=t[11],y=t[12],d=t[13],v=t[14],m=t[15],g=r*s-n*o,x=r*u-i*o,b=r*l-a*o,k=n*u-i*s,w=n*l-a*s,_=i*l-a*u,S=c*d-h*y,A=c*v-f*y,I=c*m-p*y,M=h*v-f*d,T=h*m-p*d,z=f*m-p*v,B=g*z-x*T+b*M+k*I-w*A+_*S;return B?(e[0]=(s*z-u*T+l*M)*(B=1/B),e[1]=(i*T-n*z-a*M)*B,e[2]=(d*_-v*w+m*k)*B,e[3]=(f*w-h*_-p*k)*B,e[4]=(u*I-o*z-l*A)*B,e[5]=(r*z-i*I+a*A)*B,e[6]=(v*b-y*_-m*x)*B,e[7]=(c*_-f*b+p*x)*B,e[8]=(o*T-s*I+l*S)*B,e[9]=(n*I-r*T-a*S)*B,e[10]=(y*w-d*b+m*g)*B,e[11]=(h*b-c*w-p*g)*B,e[12]=(s*A-o*M-u*S)*B,e[13]=(r*M-n*A+i*S)*B,e[14]=(d*x-y*k-v*g)*B,e[15]=(c*k-h*x+f*g)*B,e):null}function us(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],p=t[10],y=t[11],d=t[12],v=t[13],m=t[14],g=t[15],x=r[0],b=r[1],k=r[2],w=r[3];return e[0]=x*n+b*s+k*h+w*d,e[1]=x*i+b*u+k*f+w*v,e[2]=x*a+b*l+k*p+w*m,e[3]=x*o+b*c+k*y+w*g,e[4]=(x=r[4])*n+(b=r[5])*s+(k=r[6])*h+(w=r[7])*d,e[5]=x*i+b*u+k*f+w*v,e[6]=x*a+b*l+k*p+w*m,e[7]=x*o+b*c+k*y+w*g,e[8]=(x=r[8])*n+(b=r[9])*s+(k=r[10])*h+(w=r[11])*d,e[9]=x*i+b*u+k*f+w*v,e[10]=x*a+b*l+k*p+w*m,e[11]=x*o+b*c+k*y+w*g,e[12]=(x=r[12])*n+(b=r[13])*s+(k=r[14])*h+(w=r[15])*d,e[13]=x*i+b*u+k*f+w*v,e[14]=x*a+b*l+k*p+w*m,e[15]=x*o+b*c+k*y+w*g,e}function ls(e,t,r){var n,i,a,o,s,u,l,c,h,f,p,y,d=r[0],v=r[1],m=r[2];return t===e?(e[12]=t[0]*d+t[4]*v+t[8]*m+t[12],e[13]=t[1]*d+t[5]*v+t[9]*m+t[13],e[14]=t[2]*d+t[6]*v+t[10]*m+t[14],e[15]=t[3]*d+t[7]*v+t[11]*m+t[15]):(i=t[1],a=t[2],o=t[3],s=t[4],u=t[5],l=t[6],c=t[7],h=t[8],f=t[9],p=t[10],y=t[11],e[0]=n=t[0],e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=u,e[6]=l,e[7]=c,e[8]=h,e[9]=f,e[10]=p,e[11]=y,e[12]=n*d+s*v+h*m+t[12],e[13]=i*d+u*v+f*m+t[13],e[14]=a*d+l*v+p*m+t[14],e[15]=o*d+c*v+y*m+t[15]),e}function cs(e,t,r){var n=r[0],i=r[1],a=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function hs(){var e=new as(3);return as!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function fs(e){var t=new as(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ps(e){return Math.hypot(e[0],e[1],e[2])}function ys(e,t,r){var n=new as(3);return n[0]=e,n[1]=t,n[2]=r,n}function ds(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function vs(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function ms(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function gs(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function xs(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function bs(e,t){var r=t[0],n=t[1],i=t[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function ks(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function ws(e,t,r){var n=t[0],i=t[1],a=t[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return e[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/(o=o||1),e[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var _s,Ss=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e};function As(e,t,r){var n=t[0],i=t[1],a=t[2],o=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,e[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,e[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,e[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,e}function Is(){var e=new as(4);return as!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}hs(),function(){var e;e=new as(4),as!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}(),hs(),ys(1,0,0),ys(0,1,0),Is(),Is(),_s=new as(9),as!=Float32Array&&(_s[1]=0,_s[2]=0,_s[3]=0,_s[5]=0,_s[6]=0,_s[7]=0),_s[0]=1,_s[4]=1,_s[8]=1,Fa([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);var Ms=Fa([{name:"a_pos_3",components:3,type:"Int16"}]),Ts=Fa([{name:"a_pos",type:"Int16",components:2}]),zs=function(){function e(t,r){p(this,e),this.pos=t,this.dir=r}return y(e,[{key:"intersectsPlane",value:function(e,t,r){var n=ks(t,this.dir);if(Math.abs(n)<1e-6)return!1;var i=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/n;return r[0]=this.pos[0]+this.dir[0]*i,r[1]=this.pos[1]+this.dir[1]*i,r[2]=this.pos[2]+this.dir[2]*i,!0}},{key:"closestPointOnSphere",value:function(e,t,r){if(function(e,t){var r=e[0],n=e[1],i=e[2],a=t[0],o=t[1],s=t[2];return Math.abs(r-a)<=is*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-o)<=is*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-s)<=is*Math.max(1,Math.abs(i),Math.abs(s))}(this.pos,e)||0===t)return r[0]=r[1]=r[2]=0,!1;var n=f(this.dir,3),i=n[0],a=n[1],o=n[2],s=this.pos[0]-e[0],u=this.pos[1]-e[1],l=this.pos[2]-e[2],c=i*i+a*a+o*o,h=2*(s*i+u*a+l*o),p=h*h-4*c*(s*s+u*u+l*l-t*t);if(p<0){var y=Math.max(-h/2,0),d=s+i*y,v=u+a*y,m=l+o*y,g=Math.hypot(d,v,m);return r[0]=d*t/g,r[1]=v*t/g,r[2]=m*t/g,!1}var x=(-h-Math.sqrt(p))/(2*c);if(x<0){var b=Math.hypot(s,u,l);return r[0]=s*t/b,r[1]=u*t/b,r[2]=l*t/b,!1}return r[0]=s+i*x,r[1]=u+a*x,r[2]=l+o*x,!0}}]),e}(),Bs=function(){function e(t,r){p(this,e),this.min=t,this.max=r,this.center=gs([],ds([],this.min,this.max),.5)}return y(e,[{key:"quadrant",value:function(t){for(var r=[t%2==0,t<2],n=fs(this.min),i=fs(this.max),a=0;a<r.length;a++)n[a]=r[a]?this.min[a]:this.center[a],i[a]=r[a]?this.center[a]:this.max[a];return i[2]=this.max[2],new e(n,i)}},{key:"distanceX",value:function(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}},{key:"distanceY",value:function(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}},{key:"distanceZ",value:function(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}},{key:"getCorners",value:function(){var e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}},{key:"intersects",value:function(e){for(var t=this.getCorners(),r=!0,n=0;n<e.planes.length;n++){for(var i=e.planes[n],a=0,o=0;o<t.length;o++)a+=ks(i,t[o])+i[3]>=0;if(0===a)return 0;a!==t.length&&(r=!1)}if(r)return 2;for(var s=0;s<3;s++){for(var u=Number.MAX_VALUE,l=-Number.MAX_VALUE,c=0;c<e.points.length;c++){var h=e.points[c][s]-this.min[s];u=Math.min(u,h),l=Math.max(l,h)}if(l<0||u>this.max[s]-this.min[s])return 0}return 1}}],[{key:"fromPoints",value:function(t){var r,n=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0],a=u(t);try{for(a.s();!(r=a.n()).done;){var o=r.value;vs(n,n,o),ms(i,i,o)}}catch(s){a.e(s)}finally{a.f()}return new e(n,i)}},{key:"applyTransform",value:function(t,r){for(var n=t.getCorners(),i=0;i<n.length;++i)ws(n[i],n[i],r);return e.fromPoints(n)}}]),e}(),Cs=rs/Math.PI/2,Ps=-Cs,Es=Cs,Ds=[new Bs([Ps,Ps,Ps],[Es,Es,Es]),new Bs([Ps,Ps,Ps],[0,0,Es]),new Bs([0,Ps,Ps],[Es,0,Es]),new Bs([Ps,0,Ps],[0,Es,Es]),new Bs([0,0,Ps],[Es,Es,Es])];function Vs(e){return e*Cs/Ks}function Ls(e,t,r){var n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=gs([],e._camera.position,e.worldSize),a=[t,r,1,1];As(a,a,e.pixelMatrixInverse),function(e,t,r){e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r}(a,a,1/a[3]);var o=bs([],Ss([],a,i)),s=e.globeMatrix,u=[s[12],s[13],s[14]],l=Ss([],u,i),c=ps(l),h=bs([],l),f=e.worldSize/(2*Math.PI),p=ks(h,o),y=Math.asin(f/c);if(y<Math.acos(p)){if(!n)return null;var d=[],v=[];gs(d,o,c/p),bs(v,Ss(v,d,l)),bs(o,ds(o,l,gs(o,v,Math.tan(y)*c)))}var m=[];new zs(i,o).closestPointOnSphere(u,f,m);var g=bs([],N(s,0)),x=bs([],N(s,1)),b=bs([],N(s,2)),k=ks(g,m),S=ks(x,m),A=ks(b,m),I=w(Math.asin(-S/f)),M=w(Math.atan2(k,A));M=e.center.lng+function(e,t){var r=(t-e+180)%360-180;return r<-180?r+360:r}(e.center.lng,M);var T=$s(M),z=_(Qs(I),0,1);return new iu(T,z)}function Fs(e){if(e.z<=1)return Ds[e.z+2*e.y+e.x];var t=Os(js(e));return Bs.fromPoints(t)}function Rs(e,t,r){return gs(e,e,1-r),xs(e,e,t,r)}function js(e){var t=e.x,r=e.y,n=1/(1<<e.z),i=new Ws(tu(t*n),ru((r+1)*n)),a=new Ws(tu((t+1)*n),ru(r*n));return new ns(i,a)}function Os(e){var t=k(e.getNorth()),r=k(e.getSouth()),n=Math.cos(t),i=Math.cos(r),a=Math.sin(t),o=Math.sin(r),s=e.getWest(),u=e.getEast();return[Us(i,o,s),Us(i,o,u),Us(n,a,u),Us(n,a,s)]}function Us(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Cs;return r=k(r),[e*Math.sin(r)*n,-t*n,e*Math.cos(r)*n]}function qs(e,t,r){return Us(Math.cos(k(e)),Math.sin(k(e)),t,r)}function Ns(e,t,r,n){var i=1<<r.z,a=(e/rs+r.x)/i;return qs(ru((t/rs+r.y)/i),tu(a),n)}function Zs(e){var t=e.min,r=e.max;return 16383/Math.max(r[0]-t[0],r[1]-t[1],r[2]-t[2])}var Xs=new Float64Array(16);function Gs(e){var t=Zs(e),r=function(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(Xs,[t,t,t]);return ls(r,r,function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}([],e.min))}function Ys(e){return(t=_(((t=e)-5)/1,0,1))*t*(3-2*t);var t}var Ks=6371008.8,Js=2*Math.PI*Ks,Ws=function(){function e(t,r){if(p(this,e),isNaN(t)||isNaN(r))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(r,")"));if(this.lng=+t,this.lat=+r,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return y(e,[{key:"wrap",value:function(){return new e(S(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(e){var t=Math.PI/180,r=this.lat*t,n=e.lat*t,i=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return Ks*Math.acos(Math.min(i,1))}},{key:"toBounds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=360*t/40075017,n=r/Math.cos(Math.PI/180*this.lat);return new ns(new e(this.lng-n,this.lat-r),new e(this.lng+n,this.lat+r))}},{key:"toEcef",value:function(e){var t=Vs(e);return qs(this.lat,this.lng,Cs+t)}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new e(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}();function Hs(e){return Js*Math.cos(e*Math.PI/180)}function $s(e){return(180+e)/360}function Qs(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function eu(e,t){return e/Hs(t)}function tu(e){return 360*e-180}function ru(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var nu=85.051129,iu=function(){function e(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;p(this,e),this.x=+t,this.y=+r,this.z=+n}return y(e,[{key:"toLngLat",value:function(){return new Ws(tu(this.x),ru(this.y))}},{key:"toAltitude",value:function(){return this.z*Hs(ru(this.y))}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/Js*(e=ru(this.y),1/Math.cos(e*Math.PI/180));var e}}],[{key:"fromLngLat",value:function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ws.convert(t);return new e($s(n.lng),Qs(n.lat),eu(r,n.lat))}}]),e}();function au(e,t,r,n,i,a,o,s,u){var l=(t+n)/2,c=(r+i)/2,h=new v(l,c);s(h),function(e,t,r,n,i,a){var o=r-i,s=n-a;return Math.abs((n-t)*o-(r-e)*s)/Math.hypot(o,s)}(h.x,h.y,a.x,a.y,o.x,o.y)>=u?(au(e,t,r,l,c,a,h,s,u),au(e,l,c,n,i,h,o,s,u)):e.push(o)}function ou(e,t,r){var n=e[0],i=n.x,a=n.y;t(n);for(var o=[n],s=1;s<e.length;s++){var u=e[s],l=u.x,c=u.y;t(u),au(o,i,a,l,c,n,u,t,r),i=l,a=c,n=u}return o}function su(e,t,r,n){if(n(t,r)){var i=t.add(r)._mult(.5);su(e,t,i,n),su(e,i,r,n)}else e.push(r)}function uu(e,t){for(var r=e[0],n=[r],i=1;i<e.length;i++){var a=e[i];su(n,r,a,t),r=a}return n}var lu=Math.pow(2,14)-1,cu=-lu-1;function hu(e,t){var r=Math.round(e.x*t),n=Math.round(e.y*t);return e.x=_(r,cu,lu),e.y=_(n,cu,lu),(r<e.x||r>e.x+1||n<e.y||n>e.y+1)&&V("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function fu(e,t,r){var n=e.loadGeometry(),i=e.extent,a=rs/i;if(t&&r&&r.projection.isReprojectedInTileSpace)for(var o=1<<t.z,s=r.scale,l=r.x,c=r.y,h=r.projection,f=function(e){var r=tu((t.x+e.x/i)/o),n=ru((t.y+e.y/i)/o),a=h.project(r,n);e.x=(a.x*s-l)*i,e.y=(a.y*s-c)*i},p=0;p<n.length;p++)if(1!==e.type)n[p]=ou(n[p],f,1);else{var y,d=[],v=u(n[p]);try{for(v.s();!(y=v.n()).done;){var m=y.value;m.x<0||m.x>=i||m.y<0||m.y>=i||(f(m),d.push(m))}}catch(_){v.e(_)}finally{v.f()}n[p]=d}var g,x=u(n);try{for(x.s();!(g=x.n()).done;){var b,k=g.value,w=u(k);try{for(w.s();!(b=w.n()).done;){hu(b.value,a)}}catch(_){w.e(_)}finally{w.f()}}}catch(_){x.e(_)}finally{x.f()}return n}function pu(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?fu(e):[]}}function yu(e,t,r,n,i){e.emplaceBack(2*t+(n+1)/2,2*r+(i+1)/2)}function du(e,t,r){var n=16384;e.emplaceBack(t.x,t.y,t.z,r[0]*n,r[1]*n,r[2]*n)}var vu=function(){function e(t){p(this,e),this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new ja,this.indexArray=new to,this.segments=new ts,this.programConfigurations=new Xo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))}return y(e,[{key:"populate",value:function(e,t,r,n){var i=this.layers[0],a=[],o=null;"circle"===i.type&&(o=i.layout.get("circle-sort-key"));var s,l=u(e);try{for(l.s();!(s=l.n()).done;){var c=s.value,h=c.feature,f=c.id,p=c.index,y=c.sourceLayerIndex,d=this.layers[0]._featureFilter.needGeometry,v=pu(h,d);if(this.layers[0]._featureFilter.filter(new ba(this.zoom),v,r)){var m=o?o.evaluate(v,{},r):void 0,g={id:f,properties:h.properties,type:h.type,sourceLayerIndex:y,index:p,geometry:d?v.geometry:fu(h,r,n),patterns:{},sortKey:m};a.push(g)}}}catch(M){l.e(M)}finally{l.f()}o&&a.sort((function(e,t){return e.sortKey-t.sortKey}));var x=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new Ga,x=n.projection);for(var b=0,k=a;b<k.length;b++){var w=k[b],_=w.geometry,S=w.index,A=w.sourceLayerIndex,I=e[S].feature;this.addFeature(w,_,S,t.availableImages,r,x),t.featureIndex.insert(I,_,S,A,this.index)}}},{key:"update",value:function(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}},{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length}},{key:"uploadPending",value:function(){return!this.uploaded||this.programConfigurations.needsUpload}},{key:"upload",value:function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qo.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,es.members))),this.programConfigurations.upload(e),this.uploaded=!0}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}},{key:"addFeature",value:function(e,t,r,n,i,a){var o,s=u(t);try{for(s.s();!(o=s.n()).done;){var l,c=o.value,h=u(c);try{for(h.s();!(l=h.n()).done;){var f=l.value,p=f.x,y=f.y;if(!(p<0||p>=rs||y<0||y>=rs)){if(a){var d=a.projectTilePoint(p,y,i),v=a.upVector(i,p,y),m=this.globeExtVertexArray;du(m,d,v),du(m,d,v),du(m,d,v),du(m,d,v)}var g=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),x=g.vertexLength;yu(this.layoutVertexArray,p,y,-1,-1),yu(this.layoutVertexArray,p,y,1,-1),yu(this.layoutVertexArray,p,y,1,1),yu(this.layoutVertexArray,p,y,-1,1),this.indexArray.emplaceBack(x,x+1,x+2),this.indexArray.emplaceBack(x,x+2,x+3),g.vertexLength+=4,g.primitiveLength+=2}}}catch(b){h.e(b)}finally{h.f()}}}catch(b){s.e(b)}finally{s.f()}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},n,i)}}]),e}();function mu(e,t){for(var r=0;r<e.length;r++)if(Iu(t,e[r]))return!0;for(var n=0;n<t.length;n++)if(Iu(e,t[n]))return!0;return!!ku(e,t)}function gu(e,t,r){return!!Iu(e,t)||!!_u(t,e,r)}function xu(e,t){if(1===e.length)return Au(t,e[0]);for(var r=0;r<t.length;r++)for(var n=t[r],i=0;i<n.length;i++)if(Iu(e,n[i]))return!0;for(var a=0;a<e.length;a++)if(Au(t,e[a]))return!0;for(var o=0;o<t.length;o++)if(ku(e,t[o]))return!0;return!1}function bu(e,t,r){if(e.length>1){if(ku(e,t))return!0;for(var n=0;n<t.length;n++)if(_u(t[n],e,r))return!0}for(var i=0;i<e.length;i++)if(_u(e[i],t,r))return!0;return!1}function ku(e,t){if(0===e.length||0===t.length)return!1;for(var r=0;r<e.length-1;r++)for(var n=e[r],i=e[r+1],a=0;a<t.length-1;a++)if(wu(n,i,t[a],t[a+1]))return!0;return!1}function wu(e,t,r,n){return L(e,r,n)!==L(t,r,n)&&L(e,t,r)!==L(e,t,n)}function _u(e,t,r){var n=r*r;if(1===t.length)return e.distSqr(t[0])<n;for(var i=1;i<t.length;i++)if(Su(e,t[i-1],t[i])<n)return!0;return!1}function Su(e,t,r){var n=t.distSqr(r);if(0===n)return e.distSqr(t);var i=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/n;return e.distSqr(i<0?t:i>1?r:r.sub(t)._mult(i)._add(t))}function Au(e,t){for(var r,n,i,a=!1,o=0;o<e.length;o++)for(var s=0,u=(r=e[o]).length-1;s<r.length;u=s++)n=r[s],i=r[u],n.y>t.y!=i.y>t.y&&t.x<(i.x-n.x)*(t.y-n.y)/(i.y-n.y)+n.x&&(a=!a);return a}function Iu(e,t){for(var r=!1,n=0,i=e.length-1;n<e.length;i=n++){var a=e[n],o=e[i];a.y>t.y!=o.y>t.y&&t.x<(o.x-a.x)*(t.y-a.y)/(o.y-a.y)+a.x&&(r=!r)}return r}function Mu(e,t,r){var n=r[0],i=r[2];if(e.x<n.x&&t.x<n.x||e.x>i.x&&t.x>i.x||e.y<n.y&&t.y<n.y||e.y>i.y&&t.y>i.y)return!1;var a=L(e,t,r[0]);return a!==L(e,t,r[1])||a!==L(e,t,r[2])||a!==L(e,t,r[3])}function Tu(e,t,r){var n=t.paint.get(e).value;return"constant"===n.kind?n.value:r.programConfigurations.get(t.id).getMaxValue(e)}function zu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function Bu(e,t,r,n,i){if(!t[0]&&!t[1])return e;var a=v.convert(t)._mult(i);"viewport"===r&&a._rotate(-n);for(var o=[],s=0;s<e.length;s++)o.push(e[s].sub(a));return o}function Cu(e,t,r,n){var i=v.convert(e)._mult(n);return"viewport"===t&&i._rotate(-r),i}In(vu,"CircleBucket",{omit:["layers"]});var Pu=new Pa({"circle-sort-key":new Ba(Fn.layout_circle["circle-sort-key"])}),Eu={paint:new Pa({"circle-radius":new Ba(Fn.paint_circle["circle-radius"]),"circle-color":new Ba(Fn.paint_circle["circle-color"]),"circle-blur":new Ba(Fn.paint_circle["circle-blur"]),"circle-opacity":new Ba(Fn.paint_circle["circle-opacity"]),"circle-translate":new za(Fn.paint_circle["circle-translate"]),"circle-translate-anchor":new za(Fn.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new za(Fn.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new za(Fn.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ba(Fn.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ba(Fn.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ba(Fn.paint_circle["circle-stroke-opacity"])}),layout:Pu};function Du(e,t,r,n,i,a,o,s,l){if(a&&e.queryGeometry.isAboveHorizon)return!1;a&&(l*=e.pixelToTileUnitsFactor);var c,h=e.tileID.canonical,f=r.projection.upVectorScale(h,r.center.lat,r.worldSize).metersToTile,p=u(t);try{for(p.s();!(c=p.n()).done;){var y,d=c.value,v=u(d);try{var m=function(){var t=y.value,u=t.add(s),c=i&&r.elevation?r.elevation.exaggeration()*i.getElevationAt(u.x,u.y,!0):0,p=r.projection.projectTilePoint(u.x,u.y,h);if(c>0){var d=r.projection.upVector(h,u.x,u.y);p.x+=d[0]*f*c,p.y+=d[1]*f*c,p.z+=d[2]*f*c}var v=a?u:Vu(p.x,p.y,p.z,n),m=a?e.tilespaceRays.map((function(e){return Ru(e,c)})):e.queryGeometry.screenGeometry,g=As([],[p.x,p.y,p.z,1],n);if(!o&&a?l*=g[3]/r.cameraToCenterDistance:o&&!a&&(l*=r.cameraToCenterDistance/g[3]),a){var x=ru((t.y/rs+h.y)/(1<<h.z));l/=r.projection.pixelsPerMeter(x,1)/eu(1,x)}if(gu(m,v,l))return{v:!0}};for(v.s();!(y=v.n()).done;){var g=m();if("object"===typeof g)return g.v}}catch(x){v.e(x)}finally{v.f()}}}catch(x){p.e(x)}finally{p.f()}return!1}function Vu(e,t,r,n){var i=As([],[e,t,r,1],n);return new v(i[0]/i[3],i[1]/i[3])}var Lu=ys(0,0,0),Fu=ys(0,0,1);function Ru(e,t){var r=hs();return Lu[2]=t,e.intersectsPlane(Lu,Fu,r),new v(r[0],r[1])}var ju=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r)}(vu);function Ou(e,t,r,n){var i=t.width,a=t.height;if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==i*a*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(i*a*r);return e.width=i,e.height=a,e.data=n,e}function Uu(e,t,r){var n=t.width,i=t.height;n===e.width&&i===e.height||(qu(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,i)},r),e.width=n,e.height=i,e.data=t.data)}function qu(e,t,r,n,i,a){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=e.data,s=t.data,u=0;u<i.height;u++)for(var l=((r.y+u)*e.width+r.x)*a,c=((n.y+u)*t.width+n.x)*a,h=0;h<i.width*a;h++)s[c+h]=o[l+h];return t}In(ju,"HeatmapBucket",{omit:["layers"]});var Nu=function(){function e(t,r){p(this,e),Ou(this,t,1,r)}return y(e,[{key:"resize",value:function(t){Uu(this,new e(t),1)}},{key:"clone",value:function(){return new e({width:this.width,height:this.height},new Uint8Array(this.data))}}],[{key:"copy",value:function(e,t,r,n,i){qu(e,t,r,n,i,1)}}]),e}(),Zu=function(){function e(t,r){p(this,e),Ou(this,t,4,r)}return y(e,[{key:"resize",value:function(t){Uu(this,new e(t),4)}},{key:"replace",value:function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}},{key:"clone",value:function(){return new e({width:this.width,height:this.height},new Uint8Array(this.data))}}],[{key:"copy",value:function(e,t,r,n,i){qu(e,t,r,n,i,4)}}]),e}();In(Nu,"AlphaImage"),In(Zu,"RGBAImage");var Xu={paint:new Pa({"heatmap-radius":new Ba(Fn.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ba(Fn.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new za(Fn.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ca(Fn.paint_heatmap["heatmap-color"]),"heatmap-opacity":new za(Fn.paint_heatmap["heatmap-opacity"])})};function Gu(e){var t={},r=e.resolution||256,n=e.clips?e.clips.length:1,i=e.image||new Zu({width:r,height:n}),a=function(r,n,a){t[e.evaluationKey]=a;var o=e.expression.evaluate(t);i.data[r+n+0]=Math.floor(255*o.r/o.a),i.data[r+n+1]=Math.floor(255*o.g/o.a),i.data[r+n+2]=Math.floor(255*o.b/o.a),i.data[r+n+3]=Math.floor(255*o.a)};if(e.clips)for(var o=0,s=0;o<n;++o,s+=4*r)for(var u=0,l=0;u<r;u++,l+=4){var c=u/(r-1),h=e.clips[o];a(s,l,h.start*(1-c)+h.end*c)}else for(var f=0,p=0;f<r;f++,p+=4)a(0,p,f/(r-1));return i}var Yu={paint:new Pa({"hillshade-illumination-direction":new za(Fn.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new za(Fn.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new za(Fn.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new za(Fn.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new za(Fn.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new za(Fn.paint_hillshade["hillshade-accent-color"])})},Ku=Fa([{name:"a_pos",components:2,type:"Int16"}],4).members,Ju={};function Wu(e,t,r){r=r||2;var n,i,a,o,s,u,l,c=t&&t.length,h=c?t[0]*r:e.length,f=Hu(e,0,h,r,!0),p=[];if(!f||f.next===f.prev)return p;if(c&&(f=function(e,t,r,n){var i,a,o,s=[];for(i=0,a=t.length;i<a;i++)(o=Hu(e,t[i]*n,i<a-1?t[i+1]*n:e.length,n,!1))===o.next&&(o.steiner=!0),s.push(ul(o));for(s.sort(il),i=0;i<s.length;i++)r=al(s[i],r);return r}(e,t,f,r)),e.length>80*r){n=a=e[0],i=o=e[1];for(var y=r;y<h;y+=r)(s=e[y])<n&&(n=s),(u=e[y+1])<i&&(i=u),s>a&&(a=s),u>o&&(o=u);l=0!==(l=Math.max(a-n,o-i))?32767/l:0}return Qu(f,p,r,n,i,l,0),p}function Hu(e,t,r,n,i){var a,o;if(i===kl(e,t,r,n)>0)for(a=t;a<r;a+=n)o=gl(a,e[a],e[a+1],o);else for(a=r-n;a>=t;a-=n)o=gl(a,e[a],e[a+1],o);return o&&fl(o,o.next)&&(xl(o),o=o.next),o}function $u(e,t){if(!e)return e;t||(t=e);var r,n=e;do{if(r=!1,n.steiner||!fl(n,n.next)&&0!==hl(n.prev,n,n.next))n=n.next;else{if(xl(n),(n=t=n.prev)===n.next)break;r=!0}}while(r||n!==t);return t}function Qu(e,t,r,n,i,a,o){if(e){!o&&a&&function(e,t,r,n){var i=e;do{0===i.z&&(i.z=sl(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,r,n,i,a,o,s,u,l=1;do{for(r=e,e=null,a=null,o=0;r;){for(o++,n=r,s=0,t=0;t<l&&(s++,n=n.nextZ);t++);for(u=l;s>0||u>0&&n;)0!==s&&(0===u||!n||r.z<=n.z)?(i=r,r=r.nextZ,s--):(i=n,n=n.nextZ,u--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;r=n}a.nextZ=null,l*=2}while(o>1)}(i)}(e,n,i,a);for(var s,u,l=e;e.prev!==e.next;)if(s=e.prev,u=e.next,a?tl(e,n,i,a):el(e))t.push(s.i/r|0),t.push(e.i/r|0),t.push(u.i/r|0),xl(e),e=u.next,l=u.next;else if((e=u)===l){o?1===o?Qu(e=rl($u(e),t,r),t,r,n,i,a,2):2===o&&nl(e,t,r,n,i,a):Qu($u(e),t,r,n,i,a,1);break}}}function el(e){var t=e.prev,r=e,n=e.next;if(hl(t,r,n)>=0)return!1;for(var i=t.x,a=r.x,o=n.x,s=t.y,u=r.y,l=n.y,c=i<a?i<o?i:o:a<o?a:o,h=s<u?s<l?s:l:u<l?u:l,f=i>a?i>o?i:o:a>o?a:o,p=s>u?s>l?s:l:u>l?u:l,y=n.next;y!==t;){if(y.x>=c&&y.x<=f&&y.y>=h&&y.y<=p&&ll(i,s,a,u,o,l,y.x,y.y)&&hl(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function tl(e,t,r,n){var i=e.prev,a=e,o=e.next;if(hl(i,a,o)>=0)return!1;for(var s=i.x,u=a.x,l=o.x,c=i.y,h=a.y,f=o.y,p=s<u?s<l?s:l:u<l?u:l,y=c<h?c<f?c:f:h<f?h:f,d=s>u?s>l?s:l:u>l?u:l,v=c>h?c>f?c:f:h>f?h:f,m=sl(p,y,t,r,n),g=sl(d,v,t,r,n),x=e.prevZ,b=e.nextZ;x&&x.z>=m&&b&&b.z<=g;){if(x.x>=p&&x.x<=d&&x.y>=y&&x.y<=v&&x!==i&&x!==o&&ll(s,c,u,h,l,f,x.x,x.y)&&hl(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,b.x>=p&&b.x<=d&&b.y>=y&&b.y<=v&&b!==i&&b!==o&&ll(s,c,u,h,l,f,b.x,b.y)&&hl(b.prev,b,b.next)>=0)return!1;b=b.nextZ}for(;x&&x.z>=m;){if(x.x>=p&&x.x<=d&&x.y>=y&&x.y<=v&&x!==i&&x!==o&&ll(s,c,u,h,l,f,x.x,x.y)&&hl(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;b&&b.z<=g;){if(b.x>=p&&b.x<=d&&b.y>=y&&b.y<=v&&b!==i&&b!==o&&ll(s,c,u,h,l,f,b.x,b.y)&&hl(b.prev,b,b.next)>=0)return!1;b=b.nextZ}return!0}function rl(e,t,r){var n=e;do{var i=n.prev,a=n.next.next;!fl(i,a)&&pl(i,n,n.next,a)&&vl(i,a)&&vl(a,i)&&(t.push(i.i/r|0),t.push(n.i/r|0),t.push(a.i/r|0),xl(n),xl(n.next),n=e=a),n=n.next}while(n!==e);return $u(n)}function nl(e,t,r,n,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&cl(o,s)){var u=ml(o,s);return o=$u(o,o.next),u=$u(u,u.next),Qu(o,t,r,n,i,a,0),void Qu(u,t,r,n,i,a,0)}s=s.next}o=o.next}while(o!==e)}function il(e,t){return e.x-t.x}function al(e,t){var r=function(e,t){var r,n=t,i=e.x,a=e.y,o=-1/0;do{if(a<=n.y&&a>=n.next.y&&n.next.y!==n.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>o&&(o=s,r=n.x<n.next.x?n:n.next,s===i))return r}n=n.next}while(n!==t);if(!r)return null;var u,l=r,c=r.x,h=r.y,f=1/0;n=r;do{i>=n.x&&n.x>=c&&i!==n.x&&ll(a<h?i:o,a,c,h,a<h?o:i,a,n.x,n.y)&&(u=Math.abs(a-n.y)/(i-n.x),vl(n,e)&&(u<f||u===f&&(n.x>r.x||n.x===r.x&&ol(r,n)))&&(r=n,f=u)),n=n.next}while(n!==l);return r}(e,t);if(!r)return t;var n=ml(r,e);return $u(n,n.next),$u(r,r.next)}function ol(e,t){return hl(e.prev,e,t.prev)<0&&hl(t.next,e,e.next)<0}function sl(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ul(e){var t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function ll(e,t,r,n,i,a,o,s){return(i-o)*(t-s)>=(e-o)*(a-s)&&(e-o)*(n-s)>=(r-o)*(t-s)&&(r-o)*(a-s)>=(i-o)*(n-s)}function cl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&pl(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(vl(e,t)&&vl(t,e)&&function(e,t){var r=e,n=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{r.y>a!=r.next.y>a&&r.next.y!==r.y&&i<(r.next.x-r.x)*(a-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(hl(e.prev,e,t.prev)||hl(e,t.prev,t))||fl(e,t)&&hl(e.prev,e,e.next)>0&&hl(t.prev,t,t.next)>0)}function hl(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function fl(e,t){return e.x===t.x&&e.y===t.y}function pl(e,t,r,n){var i=dl(hl(e,t,r)),a=dl(hl(e,t,n)),o=dl(hl(r,n,e)),s=dl(hl(r,n,t));return i!==a&&o!==s||!(0!==i||!yl(e,r,t))||!(0!==a||!yl(e,n,t))||!(0!==o||!yl(r,e,n))||!(0!==s||!yl(r,t,n))}function yl(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function dl(e){return e>0?1:e<0?-1:0}function vl(e,t){return hl(e.prev,e,e.next)<0?hl(e,t,e.next)>=0&&hl(e,e.prev,t)>=0:hl(e,t,e.prev)<0||hl(e,e.next,t)<0}function ml(e,t){var r=new bl(e.i,e.x,e.y),n=new bl(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,a.next=n,n.prev=a,n}function gl(e,t,r,n){var i=new bl(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function xl(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function bl(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function kl(e,t,r,n){for(var i=0,a=t,o=r-n;a<r;a+=n)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}function wl(e,t,r,n,i){_l(e,t,r||0,n||e.length-1,i||Al)}function _l(e,t,r,n,i){for(;n>r;){if(n-r>600){var a=n-r+1,o=t-r+1,s=Math.log(a),u=.5*Math.exp(2*s/3),l=.5*Math.sqrt(s*u*(a-u)/a)*(o-a/2<0?-1:1);_l(e,t,Math.max(r,Math.floor(t-o*u/a+l)),Math.min(n,Math.floor(t+(a-o)*u/a+l)),i)}var c=e[t],h=r,f=n;for(Sl(e,r,t),i(e[n],c)>0&&Sl(e,r,n);h<f;){for(Sl(e,h,f),h++,f--;i(e[h],c)<0;)h++;for(;i(e[f],c)>0;)f--}0===i(e[r],c)?Sl(e,r,f):Sl(e,++f,n),f<=t&&(r=f+1),t<=f&&(n=f-1)}}function Sl(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function Al(e,t){return e<t?-1:e>t?1:0}function Il(e,t){var r=e.length;if(r<=1)return[e];for(var n,i,a=[],o=0;o<r;o++){var s=F(e[o]);0!==s&&(e[o].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(n&&a.push(n),n=[e[o]]):n.push(e[o]))}if(n&&a.push(n),t>1)for(var u=0;u<a.length;u++)a[u].length<=t||(wl(a[u],t,1,a[u].length-1,Ml),a[u]=a[u].slice(0,t));return a}function Ml(e,t){return t.area-e.area}function Tl(e,t,r){var n,i=r.patternDependencies,a=!1,o=u(t);try{for(o.s();!(n=o.n()).done;){var s=n.value.paint.get("".concat(e,"-pattern"));s.isConstant()||(a=!0);var l=s.constantOr(null);l&&(a=!0,i[l]=!0)}}catch(c){o.e(c)}finally{o.f()}return a}function zl(e,t,r,n,i){var a,o=i.patternDependencies,s=u(t);try{for(s.s();!(a=s.n()).done;){var l=a.value,c=l.paint.get("".concat(e,"-pattern")).value;if("constant"!==c.kind){var h=c.evaluate({zoom:n},r,{},i.availableImages);o[h=h&&h.name?h.name:h]=!0,r.patterns[l.id]=h}}}catch(f){s.e(f)}finally{s.f()}return r}({get exports(){return Ju},set exports(e){Ju=e}}).exports=Wu,Ju.default=Wu,Wu.deviation=function(e,t,r,n){var i=t&&t.length,a=Math.abs(kl(e,0,i?t[0]*r:e.length,r));if(i)for(var o=0,s=t.length;o<s;o++)a-=Math.abs(kl(e,t[o]*r,o<s-1?t[o+1]*r:e.length,r));var u=0;for(o=0;o<n.length;o+=3){var l=n[o]*r,c=n[o+1]*r,h=n[o+2]*r;u+=Math.abs((e[l]-e[h])*(e[c+1]-e[l+1])-(e[l]-e[c])*(e[h+1]-e[l+1]))}return 0===a&&0===u?0:Math.abs((u-a)/a)},Wu.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},n=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)r.vertices.push(e[i][a][o]);i>0&&r.holes.push(n+=e[i-1].length)}return r};var Bl=function(){function e(t){p(this,e),this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ja,this.indexArray=new to,this.indexArray2=new so,this.programConfigurations=new Xo(t.layers,t.zoom),this.segments=new ts,this.segments2=new ts,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id})),this.projection=t.projection}return y(e,[{key:"populate",value:function(e,t,r,n){this.hasPattern=Tl("fill",this.layers,t);var i,a=this.layers[0].layout.get("fill-sort-key"),o=[],s=u(e);try{for(s.s();!(i=s.n()).done;){var l=i.value,c=l.feature,h=l.id,f=l.index,p=l.sourceLayerIndex,y=this.layers[0]._featureFilter.needGeometry,d=pu(c,y);if(this.layers[0]._featureFilter.filter(new ba(this.zoom),d,r)){var v=a?a.evaluate(d,{},r,t.availableImages):void 0,m={id:h,properties:c.properties,type:c.type,sourceLayerIndex:p,index:f,geometry:y?d.geometry:fu(c,r,n),patterns:{},sortKey:v};o.push(m)}}}catch(A){s.e(A)}finally{s.f()}a&&o.sort((function(e,t){return e.sortKey-t.sortKey}));for(var g=0,x=o;g<x.length;g++){var b=x[g],k=b.geometry,w=b.index,_=b.sourceLayerIndex;if(this.hasPattern){var S=zl("fill",this.layers,b,this.zoom,t);this.patternFeatures.push(S)}else this.addFeature(b,k,w,r,{},t.availableImages);t.featureIndex.insert(e[w].feature,k,w,_,this.index)}}},{key:"update",value:function(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}},{key:"addFeatures",value:function(e,t,r,n,i){var a,o=u(this.patternFeatures);try{for(o.s();!(a=o.n()).done;){var s=a.value;this.addFeature(s,s.geometry,s.index,t,r,n)}}catch(l){o.e(l)}finally{o.f()}}},{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length}},{key:"uploadPending",value:function(){return!this.uploaded||this.programConfigurations.needsUpload}},{key:"upload",value:function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ku),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}},{key:"addFeature",value:function(e,t,r,n,i){var a,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],s=u(Il(t,500));try{for(s.s();!(a=s.n()).done;){var l,c=a.value,h=0,f=u(c);try{for(f.s();!(l=f.n()).done;){var p=l.value;h+=p.length}}catch(I){f.e(I)}finally{f.f()}var y,d=this.segments.prepareSegment(h,this.layoutVertexArray,this.indexArray),v=d.vertexLength,m=[],g=[],x=u(c);try{for(x.s();!(y=x.n()).done;){var b=y.value;if(0!==b.length){b!==c[0]&&g.push(m.length/2);var k=this.segments2.prepareSegment(b.length,this.layoutVertexArray,this.indexArray2),w=k.vertexLength;this.layoutVertexArray.emplaceBack(b[0].x,b[0].y),this.indexArray2.emplaceBack(w+b.length-1,w),m.push(b[0].x),m.push(b[0].y);for(var _=1;_<b.length;_++)this.layoutVertexArray.emplaceBack(b[_].x,b[_].y),this.indexArray2.emplaceBack(w+_-1,w+_),m.push(b[_].x),m.push(b[_].y);k.vertexLength+=b.length,k.primitiveLength+=b.length}}}catch(I){x.e(I)}finally{x.f()}for(var S=Ju(m,g),A=0;A<S.length;A+=3)this.indexArray.emplaceBack(v+S[A],v+S[A+1],v+S[A+2]);d.vertexLength+=h,d.primitiveLength+=S.length/3}}catch(I){s.e(I)}finally{s.f()}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,o,n)}}]),e}();In(Bl,"FillBucket",{omit:["layers","patternFeatures"]});var Cl=new Pa({"fill-sort-key":new Ba(Fn.layout_fill["fill-sort-key"])}),Pl={paint:new Pa({"fill-antialias":new za(Fn.paint_fill["fill-antialias"]),"fill-opacity":new Ba(Fn.paint_fill["fill-opacity"]),"fill-color":new Ba(Fn.paint_fill["fill-color"]),"fill-outline-color":new Ba(Fn.paint_fill["fill-outline-color"]),"fill-translate":new za(Fn.paint_fill["fill-translate"]),"fill-translate-anchor":new za(Fn.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ba(Fn.paint_fill["fill-pattern"])}),layout:Cl},El=Fa([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Dl=Fa([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Vl=Fa([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),Ll=El.members,Fl={},Rl=v,jl=Ol;function Ol(e,t,r,n,i){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(Ul,this,t)}function Ul(e,t,r){1==e?t.id=r.readVarint():2==e?function(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var n=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[n]=i}}(r,t):3==e?t.type=r.readVarint():4==e&&(t._geometry=r.pos)}function ql(e){for(var t,r,n=0,i=0,a=e.length,o=a-1;i<a;o=i++)n+=((r=e[o]).x-(t=e[i]).x)*(t.y+r.y);return n}Ol.types=["Unknown","Point","LineString","Polygon"],Ol.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,n=1,i=0,a=0,o=0,s=[];e.pos<r;){if(i<=0){var u=e.readVarint();n=7&u,i=u>>3}if(i--,1===n||2===n)a+=e.readSVarint(),o+=e.readSVarint(),1===n&&(t&&s.push(t),t=[]),t.push(new Rl(a,o));else{if(7!==n)throw new Error("unknown command "+n);t&&t.push(t[0].clone())}}return t&&s.push(t),s},Ol.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,n=0,i=0,a=0,o=1/0,s=-1/0,u=1/0,l=-1/0;e.pos<t;){if(n<=0){var c=e.readVarint();r=7&c,n=c>>3}if(n--,1===r||2===r)(i+=e.readSVarint())<o&&(o=i),i>s&&(s=i),(a+=e.readSVarint())<u&&(u=a),a>l&&(l=a);else if(7!==r)throw new Error("unknown command "+r)}return[o,u,s,l]},Ol.prototype.toGeoJSON=function(e,t,r){var n,i,a=this.extent*Math.pow(2,r),o=this.extent*e,s=this.extent*t,u=this.loadGeometry(),l=Ol.types[this.type];function c(e){for(var t=0;t<e.length;t++){var r=e[t];e[t]=[360*(r.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(r.y+s)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(n=0;n<u.length;n++)h[n]=u[n][0];c(u=h);break;case 2:for(n=0;n<u.length;n++)c(u[n]);break;case 3:for(u=function(e){var t=e.length;if(t<=1)return[e];for(var r,n,i=[],a=0;a<t;a++){var o=ql(e[a]);0!==o&&(void 0===n&&(n=o<0),n===o<0?(r&&i.push(r),r=[e[a]]):r.push(e[a]))}return r&&i.push(r),i}(u),n=0;n<u.length;n++)for(i=0;i<u[n].length;i++)c(u[n][i])}1===u.length?u=u[0]:l="Multi"+l;var f={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f};var Nl=jl,Zl=Xl;function Xl(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Gl,this,t),this.length=this._features.length}function Gl(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var n=e.readVarint()>>3;t=1===n?e.readString():2===n?e.readFloat():3===n?e.readDouble():4===n?e.readVarint64():5===n?e.readVarint():6===n?e.readSVarint():7===n?e.readBoolean():null}return t}(r))}Xl.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Nl(this._pbf,t,this.extent,this._keys,this._values)};var Yl=Zl;function Kl(e,t,r){if(3===e){var n=new Yl(r,r.readVarint()+r.pos);n.length&&(t[n.name]=n)}}var Jl=Fl.VectorTile=function(e,t){this.layers=e.readFields(Kl,{},t)},Wl=Fl.VectorTileFeature=jl;function Hl(e,t,r,n){var i,a=[],o=0===n?function(e,t,r,n,i,a){e.push(new v(a,r+(a-t)/(n-t)*(i-r)))}:function(e,t,r,n,i,a){e.push(new v(t+(a-r)/(i-r)*(n-t),a))},s=u(e);try{for(s.s();!(i=s.n()).done;){var l,c=i.value,h=[],f=u(c);try{for(f.s();!(l=f.n()).done;){var p=l.value;if(!(p.length<=2)){for(var y=[],d=0;d<p.length-1;d++){var m=p[d].x,g=p[d].y,x=p[d+1].x,b=p[d+1].y,k=0===n?m:g,w=0===n?x:b;k<t?w>t&&o(y,m,g,x,b,t):k>r?w<r&&o(y,m,g,x,b,r):y.push(p[d]),w<t&&k>=t&&o(y,m,g,x,b,t),w>r&&k<=r&&o(y,m,g,x,b,r)}var _=p[p.length-1],S=0===n?_.x:_.y;S>=t&&S<=r&&y.push(_),y.length&&(_=y[y.length-1],y[0].x===_.x&&y[0].y===_.y||y.push(y[0]),h.push(y))}}}catch(A){f.e(A)}finally{f.f()}h.length&&a.push(h)}}catch(A){s.e(A)}finally{s.f()}return a}Fl.VectorTileLayer=Zl;var $l=Wl.types,Ql=Math.pow(2,13);function ec(e,t,r,n,i,a,o,s){e.emplaceBack((t<<1)+o,(r<<1)+a,(Math.floor(n*Ql)<<1)+i,Math.round(s))}function tc(e,t,r){var n=16384;e.emplaceBack(t.x,t.y,t.z,r[0]*n,r[1]*n,r[2]*n)}var rc=function(){function e(){p(this,e),this.acc=new v(0,0),this.polyCount=[]}return y(e,[{key:"startRing",value:function(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new v(e.x,e.y),this.max=new v(e.x,e.y))}},{key:"append",value:function(e,t){this.currentPolyCount.edges++,this.acc._add(e);var r=this.min,n=this.max;e.x<r.x?r.x=e.x:e.x>n.x&&(n.x=e.x),e.y<r.y?r.y=e.y:e.y>n.y&&(n.y=e.y),((0===e.x||e.x===rs)&&e.x===t.x)!=((0===e.y||e.y===rs)&&e.y===t.y)&&this.processBorderOverlap(e,t),t.x<0!=e.x<0&&this.addBorderIntersection(0,bt(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>rs!=e.x>rs&&this.addBorderIntersection(1,bt(t.y,e.y,(rs-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,bt(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>rs!=e.y>rs&&this.addBorderIntersection(3,bt(t.x,e.x,(rs-t.y)/(e.y-t.y)))}},{key:"addBorderIntersection",value:function(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);var r=this.borders[e];t<r[0]&&(r[0]=t),t>r[1]&&(r[1]=t)}},{key:"processBorderOverlap",value:function(e,t){if(e.x===t.x){if(e.y===t.y)return;var r=0===e.x?0:1;this.addBorderIntersection(r,t.y),this.addBorderIntersection(r,e.y)}else{var n=0===e.y?2:3;this.addBorderIntersection(n,t.x),this.addBorderIntersection(n,e.x)}}},{key:"centroid",value:function(){var e=this.polyCount.reduce((function(e,t){return e+t.edges}),0);return 0!==e?this.acc.div(e)._round():new v(0,0)}},{key:"span",value:function(){return new v(this.max.x-this.min.x,this.max.y-this.min.y)}},{key:"intersectsCount",value:function(){return this.borders.reduce((function(e,t){return e+ +(t[0]!==Number.MAX_VALUE)}),0)}}]),e}(),nc=function(){function e(t){p(this,e),this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.layoutVertexArray=new Ua,this.centroidVertexArray=new ko,this.indexArray=new to,this.programConfigurations=new Xo(t.layers,t.zoom),this.segments=new ts,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id})),this.enableTerrain=t.enableTerrain}return y(e,[{key:"populate",value:function(e,t,r,n){this.features=[],this.hasPattern=Tl("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(e){var t=Math.exp(Math.PI*(1-e.y/(1<<e.z)*2));return 80150034*t/(t*t+1)/rs/(1<<e.z)}(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;var i,a=u(e);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=o.feature,l=o.id,c=o.index,h=o.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,p=pu(s,f);if(this.layers[0]._featureFilter.filter(new ba(this.zoom),p,r)){var y={id:l,sourceLayerIndex:h,index:c,geometry:f?p.geometry:fu(s,r,n),properties:s.properties,type:s.type,patterns:{}},d=this.layoutVertexArray.length;this.hasPattern?this.features.push(zl("fill-extrusion",this.layers,y,this.zoom,t)):this.addFeature(y,y.geometry,c,r,{},t.availableImages,n),t.featureIndex.insert(s,y.geometry,c,h,this.index,d)}}}catch(v){a.e(v)}finally{a.f()}this.sortBorders()}},{key:"addFeatures",value:function(e,t,r,n,i){var a,o=u(this.features);try{for(o.s();!(a=o.n()).done;){var s=a.value,l=s.geometry;this.addFeature(s,l,s.index,t,r,n,i)}}catch(c){o.e(c)}finally{o.f()}this.sortBorders()}},{key:"update",value:function(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}},{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length}},{key:"uploadPending",value:function(){return!this.uploaded||this.programConfigurations.needsUpload}},{key:"upload",value:function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ll),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Vl.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}},{key:"uploadCentroid",value:function(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Dl.members,!0),this.needsCentroidUpdate=!1)}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}},{key:"addFeature",value:function(e,t,r,n,i,a,o){var s=[new v(0,0),new v(rs,rs)],l=o.projection,c="globe"===l.name,h=this.enableTerrain&&!c?new rc:null,f="Polygon"===$l[e.type];c&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ga);for(var p,y,d=Il(t,500),m=d.length-1;m>=0;m--){var g=d[m];(0===g.length||(p=g[0]).every((function(e){return e.x<=0}))||p.every((function(e){return e.x>=rs}))||p.every((function(e){return e.y<=0}))||p.every((function(e){return e.y>=rs})))&&d.splice(m,1)}if(c)y=cc(d,s,n);else{y=[];var x,b=u(d);try{for(b.s();!(x=b.n()).done;){var k=x.value;y.push({polygon:k,bounds:s})}}catch(Be){b.e(Be)}finally{b.f()}}var w,_=f?this.edgeRadius:0,S=u(y);try{for(S.s();!(w=S.n()).done;){var A,I=w.value,M=I.polygon,T=I.bounds,z=0,B=0,C=u(M);try{for(C.s();!(A=C.n()).done;){var P=A.value;f&&!P[0].equals(P[P.length-1])&&P.push(P[0]),B+=f?P.length-1:P.length}}catch(Be){C.e(Be)}finally{C.f()}var E=this.segments.prepareSegment((f?5:4)*B,this.layoutVertexArray,this.indexArray);if(f){var D=[],V=[];z=E.vertexLength;var L,F=u(M);try{for(F.s();!(L=F.n()).done;){var R=L.value,j=void 0,O=void 0;R.length&&R!==M[0]&&V.push(D.length/2),j=R[1].sub(R[0])._perp()._unit();for(var U=1;U<R.length;U++){var q=R[U],N=R[U===R.length-1?1:U+1],Z=q.x,X=q.y;if(_){O=N.sub(q)._perp()._unit();var G=j.add(O)._unit(),Y=_*Math.min(4,1/(j.x*G.x+j.y*G.y));Z+=Y*G.x,X+=Y*G.y,j=O}ec(this.layoutVertexArray,Z,X,0,0,1,1,0),E.vertexLength++,D.push(q.x,q.y),c&&tc(this.layoutVertexExtArray,l.projectTilePoint(Z,X,n),l.upVector(n,Z,X))}}}catch(Be){F.e(Be)}finally{F.f()}for(var K=Ju(D,V),J=0;J<K.length;J+=3)this.indexArray.emplaceBack(z+K[J],z+K[J+2],z+K[J+1]),E.primitiveLength++}var W,H=u(M);try{for(H.s();!(W=H.n()).done;){var $=W.value;h&&$.length&&h.startRing($[0]);var Q=void 0,ee=void 0,te=void 0,re=$.length>4&&uc($[$.length-2],$[0],$[1]),ne=_?ac($[$.length-2],$[0],$[1],_):0;ee=$[1].sub($[0])._perp()._unit();for(var ie=!0,ae=1,oe=0;ae<$.length;ae++){var se=$[ae-1],ue=$[ae],le=$[ae===$.length-1?1:ae+1];if(h&&f&&h.currentPolyCount.top++,sc(ue,se,T))_&&(ee=le.sub(ue)._perp()._unit(),ie=!ie);else{h&&h.append(ue,se);var ce=ue.sub(se)._perp(),he=ce.x/(Math.abs(ce.x)+Math.abs(ce.y)),fe=ce.y>0?1:0,pe=se.dist(ue);if(oe+pe>32768&&(oe=0),_){te=le.sub(ue)._perp()._unit();var ye=oc(se,ue,le,ic(ee,te),_);isNaN(ye)&&(ye=0);var de=ue.sub(se)._unit();se=se.add(de.mult(ne))._round(),ue=ue.add(de.mult(-ye))._round(),ne=ye,ee=te}var ve=E.vertexLength,me=$.length>4&&uc(se,ue,le),ge=lc(oe,re,ie);if(ec(this.layoutVertexArray,se.x,se.y,he,fe,0,0,ge),ec(this.layoutVertexArray,se.x,se.y,he,fe,0,1,ge),ge=lc(oe+=pe,me,!ie),re=me,ec(this.layoutVertexArray,ue.x,ue.y,he,fe,0,0,ge),ec(this.layoutVertexArray,ue.x,ue.y,he,fe,0,1,ge),E.vertexLength+=4,this.indexArray.emplaceBack(ve+0,ve+1,ve+2),this.indexArray.emplaceBack(ve+1,ve+3,ve+2),E.primitiveLength+=2,_){var xe=z+(1===ae?$.length-2:ae-2),be=1===ae?z:xe+1;if(this.indexArray.emplaceBack(ve+1,xe,ve+3),this.indexArray.emplaceBack(xe,be,ve+3),E.primitiveLength+=2,void 0===Q&&(Q=ve),!sc(le,$[ae],T)){var ke=ae===$.length-1?Q:E.vertexLength;this.indexArray.emplaceBack(ve+2,ve+3,ke),this.indexArray.emplaceBack(ve+3,ke+1,ke),this.indexArray.emplaceBack(ve+3,be,ke+1),E.primitiveLength+=3}ie=!ie}if(c){var we=this.layoutVertexExtArray,_e=l.projectTilePoint(se.x,se.y,n),Se=l.projectTilePoint(ue.x,ue.y,n),Ae=l.upVector(n,se.x,se.y),Ie=l.upVector(n,ue.x,ue.y);tc(we,_e,Ae),tc(we,_e,Ae),tc(we,Se,Ie),tc(we,Se,Ie)}}}f&&(z+=$.length-1)}}catch(Be){H.e(Be)}finally{H.f()}}}catch(Be){S.e(Be)}finally{S.f()}if(h&&h.polyCount.length>0){if(h.borders){h.vertexArrayOffset=this.centroidVertexArray.length;for(var Me=h.borders,Te=this.featuresOnBorder.push(h)-1,ze=0;ze<4;ze++)Me[ze][0]!==Number.MAX_VALUE&&this.borders[ze].push(Te)}this.encodeCentroid(h.borders?void 0:h.centroid(),h)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,a,n)}},{key:"sortBorders",value:function(){for(var e=this,t=function(t){e.borders[t].sort((function(r,n){return e.featuresOnBorder[r].borders[t][0]-e.featuresOnBorder[n].borders[t][0]}))},r=0;r<4;r++)t(r)}},{key:"encodeCentroid",value:function(e,t){var r,n,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e)if(0!==e.y){var a=t.span()._mult(this.tileToMeter);r=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(a.x/10)),n=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(a.y/10))}else r=Math.ceil(7*(e.x+450)),n=0;else r=0,n=+i;var o,s=i?this.centroidVertexArray.length:t.vertexArrayOffset,l=u(t.polyCount);try{for(l.s();!(o=l.n()).done;){var c=o.value;i&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*c.edges+c.top);for(var h=0;h<c.top;h++)this.centroidVertexArray.emplace(s++,r,n);for(var f=0;f<2*c.edges;f++)this.centroidVertexArray.emplace(s++,0,n),this.centroidVertexArray.emplace(s++,r,n)}}catch(p){l.e(p)}finally{l.f()}}}]),e}();function ic(e,t){var r=e.add(t)._unit();return e.x*r.x+e.y*r.y}function ac(e,t,r,n){var i=t.sub(e)._perp()._unit(),a=r.sub(t)._perp()._unit();return oc(e,t,r,ic(i,a),n)}function oc(e,t,r,n,i){var a=Math.sqrt(1-n*n);return Math.min(e.dist(t)/3,t.dist(r)/3,i*a/n)}function sc(e,t,r){return e.x<r[0].x&&t.x<r[0].x||e.x>r[1].x&&t.x>r[1].x||e.y<r[0].y&&t.y<r[0].y||e.y>r[1].y&&t.y>r[1].y}function uc(e,t,r){if(e.x<0||e.x>=rs||t.x<0||t.x>=rs||r.x<0||r.x>=rs)return!1;var n=r.sub(t),i=n.perp(),a=e.sub(t);return(n.x*a.x+n.y*a.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(a.x*a.x+a.y*a.y))>-.866&&i.x*a.x+i.y*a.y<0}function lc(e,t,r){var n=t?2|e:-3&e;return r?1|n:-2&n}function cc(e,t,r){var n=1<<r.z,i=tu(r.x/n),a=tu((r.x+1)/n),o=ru(r.y/n),s=ru((r.y+1)/n);return function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0,o=[];if(!e.length||!r||!n)return o;for(var s=function(e,t){var r,n=u(e);try{for(n.s();!(r=n.n()).done;){var i=r.value;o.push({polygon:i,bounds:t})}}catch(a){n.e(a)}finally{n.f()}},l=Math.ceil(Math.log2(r)),c=Math.ceil(Math.log2(n)),h=l-c,f=[],p=0;p<Math.abs(h);p++)f.push(h>0?0:1);for(var y=0;y<Math.min(l,c);y++)f.push(0),f.push(1);var d=e;if(d=Hl(d,t[0].y-i,t[1].y+i,1),!(d=Hl(d,t[0].x-i,t[1].x+i,0)).length)return o;var m=[];for(f.length?m.push({polygons:d,bounds:t,depth:0}):s(d,t);m.length;){var g=m.pop(),x=g.depth,b=f[x],k=g.bounds[0],w=g.bounds[1],_=0===b?k.x:k.y,S=0===b?w.x:w.y,A=a?a(b,_,S):.5*(_+S),I=Hl(g.polygons,_-i,A+i,b),M=Hl(g.polygons,A-i,S+i,b);if(I.length){var T=[k,new v(0===b?A:w.x,1===b?A:w.y)];f.length>x+1?m.push({polygons:I,bounds:T,depth:x+1}):s(I,T)}if(M.length){var z=[new v(0===b?A:k.x,1===b?A:k.y),w];f.length>x+1?m.push({polygons:M,bounds:z,depth:x+1}):s(M,z)}}return o}(e,t,Math.ceil((a-i)/11.25),Math.ceil((o-s)/11.25),1,(function(e,t,i){if(0===e)return.5*(t+i);var a=ru((r.y+t/rs)/n);return(Qs(.5*(ru((r.y+i/rs)/n)+a))*n-r.y)*rs}))}In(nc,"FillExtrusionBucket",{omit:["layers","features"]}),In(rc,"PartMetadata");var hc=new Pa({"fill-extrusion-edge-radius":new za(Fn["layout_fill-extrusion"]["fill-extrusion-edge-radius"])}),fc={paint:new Pa({"fill-extrusion-opacity":new za(Fn["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ba(Fn["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new za(Fn["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new za(Fn["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ba(Fn["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ba(Fn["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ba(Fn["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new za(Fn["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new za(Fn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new za(Fn["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:hc};function pc(e,t,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[e*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}var yc=function(){function e(t,r,n){p(this,e),this.z=t,this.x=r,this.y=n,this.key=mc(0,t,t,r,n)}return y(e,[{key:"equals",value:function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}},{key:"url",value:function(e,t){var r=function(e,t,r){var n=pc(256*e,256*(t=Math.pow(2,r)-t-1),r),i=pc(256*(e+1),256*(t+1),r);return n[0]+","+n[1]+","+i[0]+","+i[1]}(this.x,this.y,this.z),n=function(e,t,r){for(var n,i="",a=e;a>0;a--)i+=(t&(n=1<<a-1)?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",r)}},{key:"toString",value:function(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}]),e}(),dc=y((function e(t,r){p(this,e),this.wrap=t,this.canonical=r,this.key=mc(t,r.z,r.z,r.x,r.y)})),vc=function(){function e(t,r,n,i,a){p(this,e),this.overscaledZ=t,this.wrap=r,this.canonical=new yc(n,+i,+a),this.key=0===r&&t===n?this.canonical.key:mc(r,t,n,i,a)}return y(e,[{key:"equals",value:function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}},{key:"scaledTo",value:function(t){var r=this.canonical.z-t;return t>this.canonical.z?new e(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new e(t,this.wrap,t,this.canonical.x>>r,this.canonical.y>>r)}},{key:"calculateScaledKey",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return mc(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);var r=this.canonical.z-e;return mc(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)}},{key:"isChildOf",value:function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}},{key:"children",value:function(t){if(this.overscaledZ>=t)return[new e(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var r=this.canonical.z+1,n=2*this.canonical.x,i=2*this.canonical.y;return[new e(r,this.wrap,r,n,i),new e(r,this.wrap,r,n+1,i),new e(r,this.wrap,r,n,i+1),new e(r,this.wrap,r,n+1,i+1)]}},{key:"isLessThan",value:function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}},{key:"wrapped",value:function(){return new e(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}},{key:"unwrapTo",value:function(t){return new e(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}},{key:"overscaleFactor",value:function(){return Math.pow(2,this.overscaledZ-this.canonical.z)}},{key:"toUnwrapped",value:function(){return new dc(this.wrap,this.canonical)}},{key:"toString",value:function(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}}]),e}();function mc(e,t,r,n,i){var a=1<<Math.min(r,22),o=a*(i%a)+n%a;return e&&r<22&&(o+=a*a*((e<0?-2*e-1:2*e)%(1<<2*(22-r)))),16*(32*o+r)+(t-r)}In(yc,"CanonicalTileID"),In(vc,"OverscaledTileID",{omit:["projMatrix"]});var gc=function(e){l(r,e);var t=c(r);function r(e,n,i){var a;return p(this,r),(a=t.call(this,e,n)).z=i,a}return y(r)}(v);function xc(e,t){return e.x*t.x+e.y*t.y}function bc(e,t){if(1===e.length){for(var r,n=0,i=t[n++];!r||i.equals(r);)if(!(r=t[n++]))return 1/0;for(;n<t.length;n++){var a=t[n],o=e[0],s=r.sub(i),l=a.sub(i),c=o.sub(i),h=xc(s,s),f=xc(s,l),p=xc(l,l),y=xc(c,s),d=xc(c,l),v=h*p-f*f,m=(p*y-f*d)/v,g=(h*d-f*y)/v,x=i.z*(1-m-g)+r.z*m+a.z*g;if(isFinite(x))return x}return 1/0}var b,k=1/0,w=u(t);try{for(w.s();!(b=w.n()).done;){var _=b.value;k=Math.min(k,_.z)}}catch(S){w.e(S)}finally{w.f()}return k}function kc(e,t,r,n,i,a,o,s){var u=o*i.getElevationAt(e,t,!0,!0),l=0!==a[0],c=l?0===a[1]?o*(a[0]/7-450):o*function(e,t,r){var n=Math.floor(t[0]/8),i=Math.floor(t[1]/8),a=10*(t[0]-8*n),o=10*(t[1]-8*i),s=e.getElevationAt(n,i,!0,!0),u=e.getMeterToDEM(r),l=Math.floor(.5*(a*u-1)),c=Math.floor(.5*(o*u-1)),h=e.tileCoordToPixel(n,i),f=2*l+1,p=2*c+1,y=function(e,t,r,n,i){return[e.getElevationAtPixel(t,r,!0),e.getElevationAtPixel(t+i,r,!0),e.getElevationAtPixel(t,r+i,!0),e.getElevationAtPixel(t+n,r+i,!0)]}(e,h.x-l,h.y-c,f,p),d=Math.abs(y[0]-y[1]),v=Math.abs(y[2]-y[3]),m=Math.abs(y[0]-y[2])+Math.abs(y[1]-y[3]),g=Math.min(.25,.5*u*(d+v)/f),x=Math.min(.25,.5*u*m/p);return s+Math.max(g*a,x*o)}(i,a,s):u;return{base:u+(0===r)?-1:r,top:l?Math.max(c+n,u+r+2):u+n}}var wc=Fa([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4).members,_c=Fa([{name:"a_packed",components:4,type:"Float32"}]).members,Sc=Wl.types,Ac=Math.cos(Math.PI/180*37.5),Ic=function(){function e(t){var r=this;p(this,e),this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(e){r.gradients[e.id]={}})),this.layoutVertexArray=new qa,this.layoutVertexArray2=new Na,this.indexArray=new to,this.programConfigurations=new Xo(t.layers,t.zoom),this.segments=new ts,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))}return y(e,[{key:"populate",value:function(e,t,r,n){this.hasPattern=Tl("line",this.layers,t);var i,a=this.layers[0].layout.get("line-sort-key"),o=[],s=u(e);try{for(s.s();!(i=s.n()).done;){var l=i.value,c=l.feature,h=l.id,f=l.index,p=l.sourceLayerIndex,y=this.layers[0]._featureFilter.needGeometry,d=pu(c,y);if(this.layers[0]._featureFilter.filter(new ba(this.zoom),d,r)){var v=a?a.evaluate(d,{},r):void 0,m={id:h,properties:c.properties,type:c.type,sourceLayerIndex:p,index:f,geometry:y?d.geometry:fu(c,r,n),patterns:{},sortKey:v};o.push(m)}}}catch(T){s.e(T)}finally{s.f()}a&&o.sort((function(e,t){return e.sortKey-t.sortKey}));for(var g=t.lineAtlas,x=t.featureIndex,b=this.addConstantDashes(g),k=0,w=o;k<w.length;k++){var _=w[k],S=_.geometry,A=_.index,I=_.sourceLayerIndex;if(b&&this.addFeatureDashes(_,g),this.hasPattern){var M=zl("line",this.layers,_,this.zoom,t);this.patternFeatures.push(M)}else this.addFeature(_,S,A,r,g.positions,t.availableImages);x.insert(e[A].feature,S,A,I,this.index)}}},{key:"addConstantDashes",value:function(e){var t,r=!1,n=u(this.layers);try{for(n.s();!(t=n.n()).done;){var i=t.value,a=i.paint.get("line-dasharray").value,o=i.layout.get("line-cap").value;if("constant"!==a.kind||"constant"!==o.kind)r=!0;else{var s=o.value,l=a.value;if(!l)continue;e.addDash(l,s)}}}catch(c){n.e(c)}finally{n.f()}return r}},{key:"addFeatureDashes",value:function(e,t){var r,n=this.zoom,i=u(this.layers);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a.paint.get("line-dasharray").value,s=a.layout.get("line-cap").value;if("constant"!==o.kind||"constant"!==s.kind){var l,c=void 0;if("constant"===o.kind){if(!(c=o.value))continue}else c=o.evaluate({zoom:n},e);l="constant"===s.kind?s.value:s.evaluate({zoom:n},e),t.addDash(c,l),e.patterns[a.id]=t.getKey(c,l)}}}catch(h){i.e(h)}finally{i.f()}}},{key:"update",value:function(e,t,r,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r,n)}},{key:"addFeatures",value:function(e,t,r,n,i){var a,o=u(this.patternFeatures);try{for(o.s();!(a=o.n()).done;){var s=a.value;this.addFeature(s,s.geometry,s.index,t,r,n)}}catch(l){o.e(l)}finally{o.f()}}},{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length}},{key:"uploadPending",value:function(){return!this.uploaded||this.programConfigurations.needsUpload}},{key:"upload",value:function(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,_c)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wc),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}},{key:"lineFeatureClips",value:function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}},{key:"addFeature",value:function(e,t,r,n,i,a){var o=this.layers[0].layout,s=o.get("line-join").evaluate(e,{}),l=o.get("line-cap").evaluate(e,{}),c=o.get("line-miter-limit"),h=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);var f,p=u(t);try{for(p.s();!(f=p.n()).done;){var y=f.value;this.addLine(y,e,s,l,c,h)}}catch(d){p.e(d)}finally{p.f()}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,a,n)}},{key:"addLine",value:function(e,t,r,n,i,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var o=0;o<e.length-1;o++)this.totalDistance+=e[o].dist(e[o+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===Sc[t.type],u=e.length;u>=2&&e[u-1].equals(e[u-2]);)u--;for(var l=0;l<u-1&&e[l].equals(e[l+1]);)l++;if(!(u<(s?3:2))){"bevel"===r&&(i=1.05);var c,h,f,p,y,d=this.overscaling<=16?122880/(512*this.overscaling):0,v=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray);this.e1=this.e2=-1,s&&(c=e[u-2],y=e[l].sub(c)._unit()._perp());for(var m=l;m<u;m++)if(!(f=m===u-1?s?e[l+1]:void 0:e[m+1])||!e[m].equals(f)){y&&(p=y),c&&(h=c),c=e[m],y=f?f.sub(c)._unit()._perp():p;var g=(p=p||y).add(y);0===g.x&&0===g.y||g._unit();var x=p.x*y.x+p.y*y.y,b=g.x*y.x+g.y*y.y,k=0!==b?1/b:1/0,w=2*Math.sqrt(2-2*b),_=b<Ac&&h&&f,S=p.x*y.y-p.y*y.x>0;if(_&&m>l){var A=c.dist(h);if(A>2*d){var I=c.sub(c.sub(h)._mult(d/A)._round());this.updateDistance(h,I),this.addCurrentVertex(I,p,0,0,v),h=I}}var M=h&&f,T=M?r:s?"butt":n;if(M&&"round"===T&&(k<a?T="miter":k<=2&&(T="fakeround")),"miter"===T&&k>i&&(T="bevel"),"bevel"===T&&(k>2&&(T="flipbevel"),k<i&&(T="miter")),h&&this.updateDistance(h,c),"miter"===T)g._mult(k),this.addCurrentVertex(c,g,0,0,v);else if("flipbevel"===T){if(k>100)g=y.mult(-1);else{var z=k*p.add(y).mag()/p.sub(y).mag();g._perp()._mult(z*(S?-1:1))}this.addCurrentVertex(c,g,0,0,v),this.addCurrentVertex(c,g.mult(-1),0,0,v)}else if("bevel"===T||"fakeround"===T){var B=-Math.sqrt(k*k-1),C=S?B:0,P=S?0:B;if(h&&this.addCurrentVertex(c,p,C,P,v),"fakeround"===T)for(var E=Math.round(180*w/Math.PI/20),D=1;D<E;D++){var V=D/E;if(.5!==V){var L=V-.5;V+=V*L*(V-1)*((1.0904+x*(x*(3.55645-1.43519*x)-3.2452))*L*L+(.848013+x*(.215638*x-1.06021)))}var F=y.sub(p)._mult(V)._add(p)._unit()._mult(S?-1:1);this.addHalfVertex(c,F.x,F.y,!1,S,0,v)}f&&this.addCurrentVertex(c,y,-C,-P,v)}else if("butt"===T)this.addCurrentVertex(c,g,0,0,v);else if("square"===T){var R=h?1:-1;h||this.addCurrentVertex(c,g,R,R,v),this.addCurrentVertex(c,g,0,0,v),h&&this.addCurrentVertex(c,g,R,R,v)}else"round"===T&&(h&&(this.addCurrentVertex(c,p,0,0,v),this.addCurrentVertex(c,p,1,1,v,!0)),f&&(this.addCurrentVertex(c,y,-1,-1,v,!0),this.addCurrentVertex(c,y,0,0,v)));if(_&&m<u-1){var j=c.dist(f);if(j>2*d){var O=c.add(f.sub(c)._mult(d/j)._round());this.updateDistance(c,O),this.addCurrentVertex(O,y,0,0,v),c=O}}}}}},{key:"addCurrentVertex",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=t.y*n-t.x,s=-t.y-t.x*n;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,a,!1,r,i),this.addHalfVertex(e,o,s,a,!0,-n,i)}},{key:"addHalfVertex",value:function(e,t,r,n,i,a,o){var s=e.x,u=e.y;this.layoutVertexArray.emplaceBack((s<<1)+(n?1:0),(u<<1)+(i?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(0===a?0:a<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);var l=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,l),o.primitiveLength++),i?this.e2=l:this.e1=l}},{key:"updateScaledDistance",value:function(){if(this.lineClips){var e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}},{key:"updateDistance",value:function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}]),e}();In(Ic,"LineBucket",{omit:["layers","patternFeatures"]});var Mc=new Pa({"line-cap":new Ba(Fn.layout_line["line-cap"]),"line-join":new Ba(Fn.layout_line["line-join"]),"line-miter-limit":new za(Fn.layout_line["line-miter-limit"]),"line-round-limit":new za(Fn.layout_line["line-round-limit"]),"line-sort-key":new Ba(Fn.layout_line["line-sort-key"])}),Tc={paint:new Pa({"line-opacity":new Ba(Fn.paint_line["line-opacity"]),"line-color":new Ba(Fn.paint_line["line-color"]),"line-translate":new za(Fn.paint_line["line-translate"]),"line-translate-anchor":new za(Fn.paint_line["line-translate-anchor"]),"line-width":new Ba(Fn.paint_line["line-width"]),"line-gap-width":new Ba(Fn.paint_line["line-gap-width"]),"line-offset":new Ba(Fn.paint_line["line-offset"]),"line-blur":new Ba(Fn.paint_line["line-blur"]),"line-dasharray":new Ba(Fn.paint_line["line-dasharray"]),"line-pattern":new Ba(Fn.paint_line["line-pattern"]),"line-gradient":new Ca(Fn.paint_line["line-gradient"]),"line-trim-offset":new za(Fn.paint_line["line-trim-offset"])}),layout:Mc},zc=new(function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"possiblyEvaluate",value:function(e,t){return t=new ba(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition}),n(i(r.prototype),"possiblyEvaluate",this).call(this,e,t)}},{key:"evaluate",value:function(e,t,a,o){return t=I({},t,{zoom:Math.floor(t.zoom)}),n(i(r.prototype),"evaluate",this).call(this,e,t,a,o)}}]),r}(Ba))(Tc.paint.properties["line-width"].specification);function Bc(e,t){return t>0?t+2*e:e}zc.useIntegerZoom=!0;var Cc=Fa([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Pc=Fa([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Ec=Fa([{name:"a_projected_pos",components:4,type:"Float32"}],4);Fa([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);var Dc=Fa([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Vc=Fa([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Fa([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);var Lc=Fa([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4);Fa([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4),Fa([{name:"triangle",components:3,type:"Uint16"}]),Fa([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Fa([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Fa([{type:"Float32",name:"offsetX"}]),Fa([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Fc=24,Rc=128;function jc(e,t){var r=t.expression;if("constant"===r.kind)return{kind:"constant",layoutSize:r.evaluate(new ba(e+1))};if("source"===r.kind)return{kind:"source"};for(var n=r.zoomStops,i=r.interpolationType,a=0;a<n.length&&n[a]<=e;)a++;for(var o=a=Math.max(0,a-1);o<n.length&&n[o]<e+1;)o++;o=Math.min(n.length-1,o);var s=n[a],u=n[o];return"composite"===r.kind?{kind:"composite",minZoom:s,maxZoom:u,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:u,minSize:r.evaluate(new ba(s)),maxSize:r.evaluate(new ba(u)),interpolationType:i}}function Oc(e,t,r){var n=t.uSize,i=t.uSizeT,a=r.lowerSize,o=r.upperSize;return"source"===e.kind?a/Rc:"composite"===e.kind?bt(a/Rc,o/Rc,i):n}function Uc(e,t){var r=0,n=0;if("constant"===e.kind)n=e.layoutSize;else if("source"!==e.kind){var i=e.interpolationType,a=e.minZoom,o=e.maxZoom,s=i?_(Ut.interpolationFactor(i,t,a,o),0,1):0;"camera"===e.kind?n=bt(e.minSize,e.maxSize,s):r=s}return{uSizeT:r,uSize:n}}function qc(e,t,r){return e.sections.forEach((function(e){e.text=function(e,t,r){var n=t.layout.get("text-transform").evaluate(r,{});return"uppercase"===n?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),xa.applyArabicShaping&&(e=xa.applyArabicShaping(e)),e}(e.text,t,r)})),e}var Nc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Zc(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function Xc(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}var Gc=Jc,Yc=function(e,t,r,n,i){var a,o,s=8*i-n-1,u=(1<<s)-1,l=u>>1,c=-7,h=r?i-1:0,f=r?-1:1,p=e[t+h];for(h+=f,a=p&(1<<-c)-1,p>>=-c,c+=s;c>0;a=256*a+e[t+h],h+=f,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=n;c>0;o=256*o+e[t+h],h+=f,c-=8);if(0===a)a=1-l;else{if(a===u)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,n),a-=l}return(p?-1:1)*o*Math.pow(2,a-n)},Kc=function(e,t,r,n,i,a){var o,s,u,l=8*a-i-1,c=(1<<l)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:a-1,y=n?1:-1,d=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(t*u-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[r+p]=255&s,p+=y,s/=256,i-=8);for(o=o<<i|s,l+=i;l>0;e[r+p]=255&o,p+=y,o/=256,l-=8);e[r+p-y]|=128*d};function Jc(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}Jc.Varint=0,Jc.Fixed64=1,Jc.Bytes=2,Jc.Fixed32=5;var Wc=4294967296,Hc=1/Wc,$c="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Qc(e){return e.type===Jc.Bytes?e.readVarint()+e.pos:e.pos+1}function eh(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function th(e,t,r){var n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=e;i--)r.buf[i+n]=r.buf[i]}function rh(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function nh(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function ih(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function ah(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function oh(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function sh(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function uh(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function lh(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function ch(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function hh(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function fh(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function ph(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function yh(e){var t,r=0,n=0,i=u(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;r+=a.w*a.h,n=Math.max(n,a.w)}}catch(v){i.e(v)}finally{i.f()}e.sort((function(e,t){return t.h-e.h}));var o,s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),n),h:1/0}],l=0,c=0,h=u(e);try{for(h.s();!(o=h.n()).done;)for(var f=o.value,p=s.length-1;p>=0;p--){var y=s[p];if(!(f.w>y.w||f.h>y.h)){if(f.x=y.x,f.y=y.y,c=Math.max(c,f.y+f.h),l=Math.max(l,f.x+f.w),f.w===y.w&&f.h===y.h){var d=s.pop();p<s.length&&(s[p]=d)}else f.h===y.h?(y.x+=f.w,y.w-=f.w):f.w===y.w?(y.y+=f.h,y.h-=f.h):(s.push({x:y.x+f.w,y:y.y,w:y.w-f.w,h:f.h}),y.y+=f.h,y.h-=f.h);break}}}catch(v){h.e(v)}finally{h.f()}return{w:l,h:c,fill:r/(l*c)||0}}Jc.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,a=this.pos;this.type=7&n,e(i,t,this),this.pos===a&&this.skip(n)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=hh(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=ph(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=hh(this.buf,this.pos)+hh(this.buf,this.pos+4)*Wc;return this.pos+=8,e},readSFixed64:function(){var e=hh(this.buf,this.pos)+ph(this.buf,this.pos+4)*Wc;return this.pos+=8,e},readFloat:function(){var e=Yc(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Yc(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,n=this.buf;return t=127&(r=n[this.pos++]),r<128?t:(t|=(127&(r=n[this.pos++]))<<7,r<128?t:(t|=(127&(r=n[this.pos++]))<<14,r<128?t:(t|=(127&(r=n[this.pos++]))<<21,r<128?t:function(e,t,r){var n,i,a=r.buf;if(n=(112&(i=a[r.pos++]))>>4,i<128)return eh(e,n,t);if(n|=(127&(i=a[r.pos++]))<<3,i<128)return eh(e,n,t);if(n|=(127&(i=a[r.pos++]))<<10,i<128)return eh(e,n,t);if(n|=(127&(i=a[r.pos++]))<<17,i<128)return eh(e,n,t);if(n|=(127&(i=a[r.pos++]))<<24,i<128)return eh(e,n,t);if(n|=(1&(i=a[r.pos++]))<<31,i<128)return eh(e,n,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=n[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&$c?function(e,t,r){return $c.decode(e.subarray(t,r))}(this.buf,t,e):function(e,t,r){for(var n="",i=t;i<r;){var a,o,s,u=e[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>r)break;1===c?u<128&&(l=u):2===c?128==(192&(a=e[i+1]))&&(l=(31&u)<<6|63&a)<=127&&(l=null):3===c?(o=e[i+2],128==(192&(a=e[i+1]))&&128==(192&o)&&((l=(15&u)<<12|(63&a)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(o=e[i+2],s=e[i+3],128==(192&(a=e[i+1]))&&128==(192&o)&&128==(192&s)&&((l=(15&u)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,n+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),n+=String.fromCharCode(l),i+=c}return n}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==Jc.Bytes)return e.push(this.readVarint(t));var r=Qc(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==Jc.Bytes)return e.push(this.readSVarint());var t=Qc(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==Jc.Bytes)return e.push(this.readBoolean());var t=Qc(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==Jc.Bytes)return e.push(this.readFloat());var t=Qc(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==Jc.Bytes)return e.push(this.readDouble());var t=Qc(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==Jc.Bytes)return e.push(this.readFixed32());var t=Qc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==Jc.Bytes)return e.push(this.readSFixed32());var t=Qc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==Jc.Bytes)return e.push(this.readFixed64());var t=Qc(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==Jc.Bytes)return e.push(this.readSFixed64());var t=Qc(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===Jc.Varint)for(;this.buf[this.pos++]>127;);else if(t===Jc.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Jc.Fixed32)this.pos+=4;else{if(t!==Jc.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),fh(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),fh(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),fh(this.buf,-1&e,this.pos),fh(this.buf,Math.floor(e*Hc),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),fh(this.buf,-1&e,this.pos),fh(this.buf,Math.floor(e*Hc),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(n=~(-e/4294967296),4294967295^(r=~(-e%4294967296))?r=r+1|0:(r=0,n=n+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,r.buf[r.pos]=127&(e>>>=7)}(r,0,t),function(e,t){var r=(7&e)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,r){for(var n,i,a=0;a<t.length;a++){if((n=t.charCodeAt(a))>55295&&n<57344){if(!i){n>56319||a+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):i=n;continue}if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(e[r++]=239,e[r++]=191,e[r++]=189,i=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&th(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),Kc(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Kc(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var n=this.pos-r;n>=128&&th(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(e,t,r){this.writeTag(e,Jc.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,rh,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,nh,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,oh,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,ih,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,ah,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,sh,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,uh,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,lh,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,ch,t)},writeBytesField:function(e,t){this.writeTag(e,Jc.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,Jc.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,Jc.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,Jc.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,Jc.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,Jc.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,Jc.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,Jc.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,Jc.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,Jc.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var dh=function(){function e(t,r){var n=r.pixelRatio,i=r.version,a=r.stretchX,o=r.stretchY,s=r.content;p(this,e),this.paddedRect=t,this.pixelRatio=n,this.stretchX=a,this.stretchY=o,this.content=s,this.version=i}return y(e,[{key:"tl",get:function(){return[this.paddedRect.x+1,this.paddedRect.y+1]}},{key:"br",get:function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}},{key:"displaySize",get:function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}]),e}(),vh=function(){function e(t,r){p(this,e);var n={},i={};this.haveRenderCallbacks=[];var a=[];this.addImages(t,n,a),this.addImages(r,i,a);var o=yh(a),s=o.w,u=o.h,l=new Zu({width:s||1,height:u||1});for(var c in t){var h=t[c],f=n[c].paddedRect;Zu.copy(h.data,l,{x:0,y:0},{x:f.x+1,y:f.y+1},h.data)}for(var y in r){var d=r[y],v=i[y].paddedRect,m=v.x+1,g=v.y+1,x=d.data.width,b=d.data.height;Zu.copy(d.data,l,{x:0,y:0},{x:m,y:g},d.data),Zu.copy(d.data,l,{x:0,y:b-1},{x:m,y:g-1},{width:x,height:1}),Zu.copy(d.data,l,{x:0,y:0},{x:m,y:g+b},{width:x,height:1}),Zu.copy(d.data,l,{x:x-1,y:0},{x:m-1,y:g},{width:1,height:b}),Zu.copy(d.data,l,{x:0,y:0},{x:m+x,y:g},{width:1,height:b})}this.image=l,this.iconPositions=n,this.patternPositions=i}return y(e,[{key:"addImages",value:function(e,t,r){for(var n in e){var i=e[n],a={x:0,y:0,w:i.data.width+2,h:i.data.height+2};r.push(a),t[n]=new dh(a,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(n)}}},{key:"patchUpdatedImages",value:function(e,t){for(var r in this.haveRenderCallbacks=this.haveRenderCallbacks.filter((function(t){return e.hasImage(t)})),e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)}},{key:"patchUpdatedImage",value:function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var n=f(e.tl,2),i=n[0],a=n[1];r.update(t.data,void 0,{x:i,y:a})}}}]),e}();In(dh,"ImagePosition"),In(vh,"ImageAtlas");var mh={horizontal:1,vertical:2,horizontalOnly:3},gh=function(){function e(){p(this,e),this.scale=1,this.fontStack="",this.imageName=null}return y(e,null,[{key:"forText",value:function(t,r){var n=new e;return n.scale=t||1,n.fontStack=r,n}},{key:"forImage",value:function(t){var r=new e;return r.imageName=t,r}}]),e}(),xh=function(){function e(){p(this,e),this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}return y(e,[{key:"length",value:function(){return this.text.length}},{key:"getSection",value:function(e){return this.sections[this.sectionIndex[e]]}},{key:"getSections",value:function(){return this.sections}},{key:"getSectionIndex",value:function(e){return this.sectionIndex[e]}},{key:"getCharCode",value:function(e){return this.text.charCodeAt(e)}},{key:"verticalizePunctuation",value:function(e){this.text=function(e,t){for(var r="",n=0;n<e.length;n++){var i=e.charCodeAt(n+1)||null,a=e.charCodeAt(n-1)||null;r+=!t&&(i&&oa(i)&&!Nc[e[n+1]]||a&&oa(a)&&!Nc[e[n-1]])||!Nc[e[n]]?e[n]:Nc[e[n]]}return r}(this.text,e)}},{key:"trim",value:function(){for(var e=0,t=0;t<this.text.length&&kh[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,n=this.text.length-1;n>=0&&n>=e&&kh[this.text.charCodeAt(n)];n--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)}},{key:"substring",value:function(t,r){var n=new e;return n.text=this.text.substring(t,r),n.sectionIndex=this.sectionIndex.slice(t,r),n.sections=this.sections,n}},{key:"toString",value:function(){return this.text}},{key:"getMaxScale",value:function(){var e=this;return this.sectionIndex.reduce((function(t,r){return Math.max(t,e.sections[r].scale)}),0)}},{key:"addTextSection",value:function(e,t){this.text+=e.text,this.sections.push(gh.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,n=0;n<e.text.length;++n)this.sectionIndex.push(r)}},{key:"addImageSection",value:function(e){var t=e.image?e.image.name:"";if(0!==t.length){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(gh.forImage(t)),this.sectionIndex.push(this.sections.length-1)):V("Reached maximum number of images 6401")}else V("Can't add FormattedSection with an empty image.")}},{key:"getNextImageSectionCharCode",value:function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}],[{key:"fromFeature",value:function(t,r){for(var n=new e,i=0;i<t.sections.length;i++){var a=t.sections[i];a.image?n.addImageSection(a):n.addTextSection(a,r)}return n}}]),e}();function bh(e,t,r,n,i,a,o,s,l,c,h,f,p,y,d){var v=xh.fromFeature(e,i);f===mh.vertical&&v.verticalizePunctuation(p);var m=[],g=function(e,t,r,n,i,a){if(!e)return[];for(var o,s=[],u=function(e,t,r,n,i,a){for(var o=0,s=0;s<e.length();s++){var u=e.getSection(s);o+=_h(e.getCharCode(s),u,n,i,t,a)}return o/Math.max(1,Math.ceil(o/r))}(e,t,r,n,i,a),l=e.text.indexOf("\u200b")>=0,c=0,h=0;h<e.length();h++){var f=e.getSection(h),p=e.getCharCode(h);if(kh[p]||(c+=_h(p,f,n,i,t,a)),h<e.length()-1){var y=!((o=p)<11904||!(Ui(o)||Oi(o)||Qi(o)||Wi(o)||Xi(o)||Di(o)||qi(o)||Fi(o)||Gi(o)||Yi(o)||Zi(o)||ra(o)||Ri(o)||Li(o)||Vi(o)||Ni(o)||ji(o)||$i(o)||Ji(o)||Ki(o)));(wh[p]||y||f.imageName)&&s.push(Ih(h+1,c,u,s,Ah(p,e.getCharCode(h+1),y&&l),!1))}}return Mh(Ih(e.length(),c,u,s,0,!0))}(v,c,a,t,n,y),x=xa.processBidirectionalText,b=xa.processStyledBidirectionalText;if(x&&1===v.sections.length){var k,w=x(v.toString(),g),_=u(w);try{for(_.s();!(k=_.n()).done;){var S=k.value,A=new xh;A.text=S,A.sections=v.sections;for(var I=0;I<S.length;I++)A.sectionIndex.push(0);m.push(A)}}catch(D){_.e(D)}finally{_.f()}}else if(b){var M,T=b(v.text,v.sectionIndex,g),z=u(T);try{for(z.s();!(M=z.n()).done;){var B=M.value,C=new xh;C.text=B[0],C.sectionIndex=B[1],C.sections=v.sections,m.push(C)}}catch(D){z.e(D)}finally{z.f()}}else m=function(e,t){var r,n=[],i=e.text,a=0,o=u(t);try{for(o.s();!(r=o.n()).done;){var s=r.value;n.push(e.substring(a,s)),a=s}}catch(D){o.e(D)}finally{o.f()}return a<i.length&&n.push(e.substring(a,i.length)),n}(v,g);var P=[],E={positionedLines:P,text:v.toString(),top:h[1],bottom:h[1],left:h[0],right:h[0],writingMode:f,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(e,t,r,n,i,a,o,s,l,c,h,f){var p,y=0,d=0,v=0,m="right"===s?1:"left"===s?0:.5,g=!1,x=u(i);try{for(x.s();!(p=x.n()).done;){var b,k=p.value.getSections(),w=u(k);try{for(w.s();!(b=w.n()).done;){var _=b.value;if(!_.imageName){var S=t[_.fontStack];if(S&&!(g=void 0!==S.ascender&&void 0!==S.descender))break}}}catch(D){w.e(D)}finally{w.f()}if(!g)break}}catch(D){x.e(D)}finally{x.f()}var A,I,M=0,T=u(i);try{for(T.s();!(A=T.n()).done;){var z=A.value;z.trim();var B=z.getMaxScale(),C=(B-1)*Fc,P={positionedGlyphs:[],lineOffset:0};e.positionedLines[M]=P;var E=P.positionedGlyphs,V=0;if(z.length()){for(var L=0,F=0,R=0;R<z.length();R++){var j=z.getSection(R),O=z.getSectionIndex(R),U=z.getCharCode(R),q=j.scale,N=null,Z=null,X=null,G=Fc,Y=0,K=!(l===mh.horizontal||!h&&!aa(U)||h&&(kh[U]||(I=U,Ci(I)||Pi(I)||Ei(I)||Hi(I)||ta(I))));if(j.imageName){var J=n[j.imageName];if(!J)continue;X=j.imageName,e.iconsInText=e.iconsInText||!0,Z=J.paddedRect;var W=J.displaySize;q=q*Fc/f,N={width:W[0],height:W[1],left:1,top:-3,advance:K?W[1]:W[0],localGlyph:!1},Y=g?-N.height*q:B*Fc-17-W[1]*q,G=N.advance;var H=(K?W[0]:W[1])*q-Fc*B;H>0&&H>V&&(V=H)}else{var $=r[j.fontStack];if(!$)continue;$[U]&&(Z=$[U]);var Q=t[j.fontStack];if(!Q)continue;var ee=Q.glyphs[U];if(!ee)continue;if(N=ee.metrics,G=8203!==U?Fc:0,g){var te=void 0!==Q.ascender?Math.abs(Q.ascender):0,re=void 0!==Q.descender?Math.abs(Q.descender):0,ne=(te+re)*q;L<ne&&(L=ne,F=(te-re)/2*q),Y=-te*q}else Y=(B-q)*Fc-17}K?(e.verticalizable=!0,E.push({glyph:U,imageName:X,x:y,y:d+Y,vertical:K,scale:q,localGlyph:N.localGlyph,fontStack:j.fontStack,sectionIndex:O,metrics:N,rect:Z}),y+=G*q+c):(E.push({glyph:U,imageName:X,x:y,y:d+Y,vertical:K,scale:q,localGlyph:N.localGlyph,fontStack:j.fontStack,sectionIndex:O,metrics:N,rect:Z}),y+=N.advance*q+c)}0!==E.length&&(v=Math.max(y-c,v),g?zh(E,m,V,F,a*B/2):zh(E,m,V,0,a/2)),y=0;var ie=a*B+V;P.lineOffset=Math.max(V,C),d+=ie,++M}else d+=a,++M}}catch(D){T.e(D)}finally{T.f()}var ae=d,oe=Th(o),se=oe.horizontalAlign,ue=oe.verticalAlign;(function(e,t,r,n,i,a){var o,s=(t-r)*i,l=-a*n,c=u(e);try{for(c.s();!(o=c.n()).done;){var h,f=o.value,p=u(f.positionedGlyphs);try{for(p.s();!(h=p.n()).done;){var y=h.value;y.x+=s,y.y+=l}}catch(D){p.e(D)}finally{p.f()}}}catch(D){c.e(D)}finally{c.f()}})(e.positionedLines,m,se,ue,v,ae),e.top+=-ue*ae,e.bottom=e.top+ae,e.left+=-se*v,e.right=e.left+v,e.hasBaseline=g}(E,t,r,n,m,o,s,l,f,c,p,d),!function(e){var t,r=u(e);try{for(r.s();!(t=r.n()).done;){if(0!==t.value.positionedGlyphs.length)return!1}}catch(D){r.e(D)}finally{r.f()}return!0}(P)&&E}var kh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},wh={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function _h(e,t,r,n,i,a){if(t.imageName){var o=n[t.imageName];return o?o.displaySize[0]*t.scale*Fc/a+i:0}var s=r[t.fontStack],u=s&&s.glyphs[e];return u?u.metrics.advance*t.scale+i:0}function Sh(e,t,r,n){var i=Math.pow(e-t,2);return n?e<t?i/2:2*i:i+Math.abs(r)*r}function Ah(e,t,r){var n=0;return 10===e&&(n-=1e4),r&&(n+=150),40!==e&&65288!==e||(n+=50),41!==t&&65289!==t||(n+=50),n}function Ih(e,t,r,n,i,a){var o,s=null,l=Sh(t,r,i,a),c=u(n);try{for(c.s();!(o=c.n()).done;){var h=o.value,f=Sh(t-h.x,r,i,a)+h.badness;f<=l&&(s=h,l=f)}}catch(p){c.e(p)}finally{c.f()}return{index:e,x:t,priorBreak:s,badness:l}}function Mh(e){return e?Mh(e.priorBreak).concat(e.index):[]}function Th(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function zh(e,t,r,n,i){if(t||r||n||i)for(var a=e.length-1,o=e[a],s=(o.x+o.metrics.advance*o.scale)*t,u=0;u<=a;u++)e[u].x-=s,e[u].y+=r+n+i}function Bh(e,t,r,n,i,a){var o,s=e.image;if(s.content){var u=s.content,l=s.pixelRatio||1;o=[u[0]/l,u[1]/l,s.displaySize[0]-u[2]/l,s.displaySize[1]-u[3]/l]}var c,h,f,p,y=t.left*a,d=t.right*a;"width"===r||"both"===r?(p=i[0]+y-n[3],h=i[0]+d+n[1]):h=(p=i[0]+(y+d-s.displaySize[0])/2)+s.displaySize[0];var v=t.top*a,m=t.bottom*a;return"height"===r||"both"===r?(c=i[1]+v-n[0],f=i[1]+m+n[2]):f=(c=i[1]+(v+m-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:c,right:h,bottom:f,left:p,collisionPadding:o}}var Ch=function(e){l(r,e);var t=c(r);function r(e,n,i,a,o){var s;return p(this,r),(s=t.call(this,e,n)).angle=a,s.z=i,void 0!==o&&(s.segment=o),s}return y(r,[{key:"clone",value:function(){return new r(this.x,this.y,this.z,this.angle,this.segment)}}]),r}(v);function Ph(e,t,r,n,i){if(void 0===t.segment)return!0;for(var a=t,o=t.segment+1,s=0;s>-r/2;){if(--o<0)return!1;s-=e[o].dist(a),a=e[o]}s+=e[o].dist(e[o+1]),o++;for(var u=[],l=0;s<r/2;){var c=e[o],h=e[o+1];if(!h)return!1;var f=e[o-1].angleTo(c)-c.angleTo(h);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:f}),l+=f;s-u[0].distance>n;)l-=u.shift().angleDelta;if(l>i)return!1;o++,s+=c.dist(h)}return!0}function Eh(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Dh(e,t,r){return e?.6*t*r:0}function Vh(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Lh(e,t,r,n,i,a){for(var o=Dh(r,i,a),s=Vh(r,n)*a,u=0,l=Eh(e)/2,c=0;c<e.length-1;c++){var h=e[c],f=e[c+1],p=h.dist(f);if(u+p>l){var y=(l-u)/p,d=bt(h.x,f.x,y),v=bt(h.y,f.y,y),m=new Ch(d,v,0,f.angleTo(h),c);return!o||Ph(e,m,s,o,t)?m:void 0}u+=p}}function Fh(e,t,r,n,i,a,o,s,u){var l=Dh(n,a,o),c=Vh(n,i),h=c*o,f=0===e[0].x||e[0].x===u||0===e[0].y||e[0].y===u;return t-h<t/4&&(t=h+t/4),Rh(e,f?t/2*s%t:(c/2+2*a)*o*s%t,t,l,r,h,f,!1,u)}function Rh(e,t,r,n,i,a,o,s,u){for(var l=a/2,c=Eh(e),h=0,f=t-r,p=[],y=0;y<e.length-1;y++){for(var d=e[y],v=e[y+1],m=d.dist(v),g=v.angleTo(d);f+r<h+m;){var x=((f+=r)-h)/m,b=bt(d.x,v.x,x),k=bt(d.y,v.y,x);if(b>=0&&b<u&&k>=0&&k<u&&f-l>=0&&f+l<=c){var w=new Ch(b,k,0,g,y);w._round(),n&&!Ph(e,w,a,n,i)||p.push(w)}}h+=m}return s||p.length||o||(p=Rh(e,h/2,r,n,i,a,o,!0,u)),p}function jh(e,t,r,n){var i=[],a=e.image,o=a.pixelRatio,s=a.paddedRect.w-2,u=a.paddedRect.h-2,l=e.right-e.left,c=e.bottom-e.top,h=a.stretchX||[[0,s]],f=a.stretchY||[[0,u]],p=function(e,t){return e+t[1]-t[0]},y=h.reduce(p,0),d=f.reduce(p,0),m=s-y,g=u-d,x=0,b=y,k=0,w=d,_=0,S=m,A=0,I=g;if(a.content&&n){var M=a.content;x=Oh(h,0,M[0]),k=Oh(f,0,M[1]),b=Oh(h,M[0],M[2]),w=Oh(f,M[1],M[3]),_=M[0]-x,A=M[1]-k,S=M[2]-M[0]-b,I=M[3]-M[1]-w}var T=function(n,i,s,u){var h=qh(n.stretch-x,b,l,e.left),f=Nh(n.fixed-_,S,n.stretch,y),p=qh(i.stretch-k,w,c,e.top),m=Nh(i.fixed-A,I,i.stretch,d),g=qh(s.stretch-x,b,l,e.left),M=Nh(s.fixed-_,S,s.stretch,y),T=qh(u.stretch-k,w,c,e.top),z=Nh(u.fixed-A,I,u.stretch,d),B=new v(h,p),C=new v(g,p),P=new v(g,T),E=new v(h,T),D=new v(f/o,m/o),V=new v(M/o,z/o),L=t*Math.PI/180;if(L){var F=Math.sin(L),R=Math.cos(L),j=[R,-F,F,R];B._matMult(j),C._matMult(j),E._matMult(j),P._matMult(j)}var O=n.stretch+n.fixed,U=i.stretch+i.fixed;return{tl:B,tr:C,bl:E,br:P,tex:{x:a.paddedRect.x+1+O,y:a.paddedRect.y+1+U,w:s.stretch+s.fixed-O,h:u.stretch+u.fixed-U},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:D,pixelOffsetBR:V,minFontScaleX:S/o/l,minFontScaleY:I/o/c,isSDF:r}};if(n&&(a.stretchX||a.stretchY))for(var z=Uh(h,m,y),B=Uh(f,g,d),C=0;C<z.length-1;C++)for(var P=z[C],E=z[C+1],D=0;D<B.length-1;D++)i.push(T(P,B[D],E,B[D+1]));else i.push(T({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:s+1},{fixed:0,stretch:u+1}));return i}function Oh(e,t,r){var n,i=0,a=u(e);try{for(a.s();!(n=a.n()).done;){var o=n.value;i+=Math.max(t,Math.min(r,o[1]))-Math.max(t,Math.min(r,o[0]))}}catch(s){a.e(s)}finally{a.f()}return i}function Uh(e,t,r){var n,i=[{fixed:-1,stretch:0}],a=u(e);try{for(a.s();!(n=a.n()).done;){var o=f(n.value,2),s=o[0],l=o[1],c=i[i.length-1];i.push({fixed:s-c.stretch,stretch:c.stretch}),i.push({fixed:s-c.stretch,stretch:c.stretch+(l-s)})}}catch(h){a.e(h)}finally{a.f()}return i.push({fixed:t+1,stretch:r}),i}function qh(e,t,r,n){return e/t*r+n}function Nh(e,t,r,n){return e-t*r/n}function Zh(e,t,r,n){var i=t+e.positionedLines[n].lineOffset;return 0===n?r+i/2:r+(i+(t+e.positionedLines[n-1].lineOffset))/2}In(Ch,"Anchor");var Xh=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Gh;if(p(this,e),this.data=t,this.length=this.data.length,this.compare=r,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}return y(e,[{key:"push",value:function(e){this.data.push(e),this.length++,this._up(this.length-1)}},{key:"pop",value:function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}}},{key:"peek",value:function(){return this.data[0]}},{key:"_up",value:function(e){for(var t=this.data,r=this.compare,n=t[e];e>0;){var i=e-1>>1,a=t[i];if(r(n,a)>=0)break;t[e]=a,e=i}t[e]=n}},{key:"_down",value:function(e){for(var t=this.data,r=this.compare,n=this.length>>1,i=t[e];e<n;){var a=1+(e<<1),o=t[a],s=a+1;if(s<this.length&&r(t[s],o)<0&&(a=s,o=t[s]),r(o,i)>=0)break;t[e]=o,e=a}t[e]=i}}]),e}();function Gh(e,t){return e<t?-1:e>t?1:0}function Yh(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=1/0,i=1/0,a=-1/0,o=-1/0,s=e[0],u=0;u<s.length;u++){var l=s[u];(!u||l.x<n)&&(n=l.x),(!u||l.y<i)&&(i=l.y),(!u||l.x>a)&&(a=l.x),(!u||l.y>o)&&(o=l.y)}var c=Math.min(a-n,o-i),h=c/2,f=new Xh([],Kh);if(0===c)return new v(n,i);for(var p=n;p<a;p+=c)for(var y=i;y<o;y+=c)f.push(new Jh(p+h,y+h,h,e));for(var d=function(e){for(var t=0,r=0,n=0,i=e[0],a=0,o=i.length,s=o-1;a<o;s=a++){var u=i[a],l=i[s],c=u.x*l.y-l.x*u.y;r+=(u.x+l.x)*c,n+=(u.y+l.y)*c,t+=3*c}return new Jh(r/t,n/t,0,e)}(e),m=f.length;f.length;){var g=f.pop();(g.d>d.d||!d.d)&&(d=g,r&&console.log("found best %d after %d probes",Math.round(1e4*g.d)/1e4,m)),g.max-d.d<=t||(h=g.h/2,f.push(new Jh(g.p.x-h,g.p.y-h,h,e)),f.push(new Jh(g.p.x+h,g.p.y-h,h,e)),f.push(new Jh(g.p.x-h,g.p.y+h,h,e)),f.push(new Jh(g.p.x+h,g.p.y+h,h,e)),m+=4)}return r&&(console.log("num probes: ".concat(m)),console.log("best distance: ".concat(d.d))),d.p}function Kh(e,t){return t.max-e.max}function Jh(e,t,r,n){this.p=new v(e,t),this.h=r,this.d=function(e,t){for(var r=!1,n=1/0,i=0;i<t.length;i++)for(var a=t[i],o=0,s=a.length,u=s-1;o<s;u=o++){var l=a[o],c=a[u];l.y>e.y!=c.y>e.y&&e.x<(c.x-l.x)*(e.y-l.y)/(c.y-l.y)+l.x&&(r=!r),n=Math.min(n,Su(e,l,c))}return(r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}var Wh=Number.POSITIVE_INFINITY,Hh=Math.sqrt(2);function $h(e,t,r,n,i,a,o,s,l,c){e.createArrays(),e.tilePixelRatio=rs/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var h=e.layers[0].layout,p=e.layers[0]._unevaluatedLayout._values,y={};if("composite"===e.textSizeData.kind){var d=e.textSizeData,v=d.minZoom,m=d.maxZoom;y.compositeTextSizes=[p["text-size"].possiblyEvaluate(new ba(v),s),p["text-size"].possiblyEvaluate(new ba(m),s)]}if("composite"===e.iconSizeData.kind){var g=e.iconSizeData,x=g.minZoom,b=g.maxZoom;y.compositeIconSizes=[p["icon-size"].possiblyEvaluate(new ba(x),s),p["icon-size"].possiblyEvaluate(new ba(b),s)]}y.layoutTextSize=p["text-size"].possiblyEvaluate(new ba(l+1),s),y.layoutIconSize=p["icon-size"].possiblyEvaluate(new ba(l+1),s),y.textMaxSize=p["text-size"].possiblyEvaluate(new ba(18),s);var k,w="map"===h.get("text-rotation-alignment")&&"point"!==h.get("symbol-placement"),_=h.get("text-size"),S=u(e.features);try{var A=function(){var a=k.value,l=h.get("text-font").evaluate(a,{},s).join(","),p=_.evaluate(a,{},s),d=y.layoutTextSize.evaluate(a,{},s),v=(y.layoutIconSize.evaluate(a,{},s),{horizontal:{},vertical:void 0}),m=a.text,g=void 0,x=[0,0];if(m){var b=m.toString(),S=h.get("text-letter-spacing").evaluate(a,{},s)*Fc,A=h.get("text-line-height").evaluate(a,{},s)*Fc,I=function(e){var t,r=u(e);try{for(r.s();!(t=r.n()).done;)if(!ia(t.value.charCodeAt(0)))return!1}catch(n){r.e(n)}finally{r.f()}return!0}(b)?S:0,M=h.get("text-anchor").evaluate(a,{},s),T=h.get("text-variable-anchor");if(!T){var z=h.get("text-radial-offset").evaluate(a,{},s);x=z?function(e,t){var r=f(t,2),n=r[0],i=r[1],a=0,o=0;if(i===Wh){n<0&&(n=0);var s=n/Hh;switch(e){case"top-right":case"top-left":o=s-7;break;case"bottom-right":case"bottom-left":o=7-s;break;case"bottom":o=7-n;break;case"top":o=n-7}switch(e){case"top-right":case"bottom-right":a=-s;break;case"top-left":case"bottom-left":a=s;break;case"left":a=n;break;case"right":a=-n}}else{switch(n=Math.abs(n),i=Math.abs(i),e){case"top-right":case"top-left":case"top":o=i-7;break;case"bottom-right":case"bottom-left":case"bottom":o=7-i}switch(e){case"top-right":case"bottom-right":case"right":a=-n;break;case"top-left":case"bottom-left":case"left":a=n}}return[a,o]}(M,[z*Fc,Wh]):h.get("text-offset").evaluate(a,{},s).map((function(e){return e*Fc}))}var B=w?"center":h.get("text-justify").evaluate(a,{},s),C="point"===h.get("symbol-placement"),P=C?h.get("text-max-width").evaluate(a,{},s)*Fc:1/0,E=function(n){e.allowVerticalPlacement&&na(b)&&(v.vertical=bh(m,t,r,i,l,P,A,M,n,I,x,mh.vertical,!0,d,p))};if(!w&&T){for(var D="auto"===B?T.map((function(e){return Qh(e)})):[B],L=!1,F=0;F<D.length;F++){var R=D[F];if(!v.horizontal[R])if(L)v.horizontal[R]=v.horizontal[0];else{var j=bh(m,t,r,i,l,P,A,"center",R,I,x,mh.horizontal,!1,d,p);j&&(v.horizontal[R]=j,L=1===j.positionedLines.length)}}E("left")}else{if("auto"===B&&(B=Qh(M)),C||h.get("text-writing-mode").indexOf("horizontal")>=0||!na(b)){var O=bh(m,t,r,i,l,P,A,M,B,I,x,mh.horizontal,!1,d,p);O&&(v.horizontal[B]=O)}E(C?"left":B)}}var U=!1;if(a.icon&&a.icon.name){var q=n[a.icon.name];q&&(g=function(e,t,r){var n=Th(r),i=n.horizontalAlign,a=n.verticalAlign,o=t[0]-e.displaySize[0]*i,s=t[1]-e.displaySize[1]*a;return{image:e,top:s,bottom:s+e.displaySize[1],left:o,right:o+e.displaySize[0]}}(i[a.icon.name],h.get("icon-offset").evaluate(a,{},s),h.get("icon-anchor").evaluate(a,{},s)),U=q.sdf,void 0===e.sdfIcons?e.sdfIcons=q.sdf:e.sdfIcons!==q.sdf&&V("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(q.pixelRatio!==e.pixelRatio||0!==h.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}var N=nf(v.horizontal)||v.vertical;e.iconsInText||(e.iconsInText=!!N&&N.iconsInText),(N||g)&&ef(e,a,v,g,n,y,d,0,x,U,o,s,c)};for(S.s();!(k=S.n()).done;)A()}catch(I){S.e(I)}finally{S.f()}a&&e.generateCollisionDebugBuffers(l,e.collisionBoxArray)}function Qh(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ef(e,t,r,n,i,a,o,s,l,c,h,p,y){var d=a.textMaxSize.evaluate(t,{},p);void 0===d&&(d=o);var m,g,x=e.layers[0].layout,b=x.get("icon-offset").evaluate(t,{},p),w=nf(r.horizontal)||r.vertical,_="globe"===y.name,S=o/24,A=e.tilePixelRatio*d/24,I=(m=e.overscaling,e.zoom>18&&m>2&&(m>>=1),Math.max(rs/(512*m),1)*x.get("symbol-spacing")),M=x.get("text-padding")*e.tilePixelRatio,T=x.get("icon-padding")*e.tilePixelRatio,z=k(x.get("text-max-angle")),B="map"===x.get("text-rotation-alignment")&&"point"!==x.get("symbol-placement"),C="map"===x.get("icon-rotation-alignment")&&"point"!==x.get("symbol-placement"),P=x.get("symbol-placement"),E=I/2,D=x.get("icon-text-fit");n&&"none"!==D&&(e.allowVerticalPlacement&&r.vertical&&(g=Bh(n,r.vertical,D,x.get("icon-text-fit-padding"),b,S)),w&&(n=Bh(n,w,D,x.get("icon-text-fit-padding"),b,S)));var L=function(o,s,u){if(!(s.x<0||s.x>=rs||s.y<0||s.y>=rs)){var d=null;if(_){var v=y.projectTilePoint(s.x,s.y,u),m=v.x,x=v.y,k=v.z;d={anchor:new Ch(m,x,k,0,void 0),up:y.upVector(u,s.x,s.y)}}!function(e,t,r,n,i,a,o,s,u,l,c,h,p,y,d,v,m,g,x,b,k,w,_,S,A){var I,M,T,z,B,C,P,E,D,L=e.addToLineVertexArray(t,n),F=0,R=0,j=0,O=0,U=-1,q=-1,N={},Z=So(""),X=r?r.anchor:t,G=0,Y=0;if(void 0===u._unevaluatedLayout.getValue("text-radial-offset")?(I=u.layout.get("text-offset").evaluate(k,{},A).map((function(e){return e*Fc})),G=(M=f(I,2))[0],Y=M[1]):(G=u.layout.get("text-radial-offset").evaluate(k,{},A)*Fc,Y=Wh),e.allowVerticalPlacement&&i.vertical){var K=i.vertical;if(d)E=of(K),s&&(D=of(s));else{var J=u.layout.get("text-rotate").evaluate(k,{},A)+90;B=af(l,X,t,c,h,p,K,y,J,v),s&&(C=af(l,X,t,c,h,p,s,g,J))}}if(a){var W=u.layout.get("icon-rotate").evaluate(k,{},A),H="none"!==u.layout.get("icon-text-fit"),$=jh(a,W,_,H),Q=s?jh(s,W,_,H):void 0;z=af(l,X,t,c,h,p,a,g,W),F=4*$.length;var ee=e.iconSizeData,te=null;"source"===ee.kind?(te=[Rc*u.layout.get("icon-size").evaluate(k,{},A)])[0]>tf&&V("".concat(e.layerIds[0],': Value for "icon-size" is >= 255. Reduce your "icon-size".')):"composite"===ee.kind&&(((te=[Rc*w.compositeIconSizes[0].evaluate(k,{},A),Rc*w.compositeIconSizes[1].evaluate(k,{},A)])[0]>tf||te[1]>tf)&&V("".concat(e.layerIds[0],': Value for "icon-size" is >= 255. Reduce your "icon-size".'))),e.addSymbols(e.icon,$,te,b,x,k,!1,r,t,L.lineStartIndex,L.lineLength,-1,S,A),U=e.icon.placedSymbolArray.length-1,Q&&(R=4*Q.length,e.addSymbols(e.icon,Q,te,b,x,k,mh.vertical,r,t,L.lineStartIndex,L.lineLength,-1,S,A),q=e.icon.placedSymbolArray.length-1)}for(var re in i.horizontal){var ne=i.horizontal[re];T||(Z=So(ne.text),d?P=of(ne):T=af(l,X,t,c,h,p,ne,y,u.layout.get("text-rotate").evaluate(k,{},A),v));var ie=1===ne.positionedLines.length;if(j+=rf(e,r,t,ne,o,u,d,k,v,L,i.vertical?mh.horizontal:mh.horizontalOnly,ie?Object.keys(i.horizontal):[re],N,U,w,S,A),ie)break}i.vertical&&(O+=rf(e,r,t,i.vertical,o,u,d,k,v,L,mh.vertical,["vertical"],N,q,w,S,A));var ae=-1,oe=function(e,t){return e?Math.max(e,t):t};ae=oe(P,ae),ae=oe(E,ae);var se=(ae=oe(D,ae))>-1?1:0;e.glyphOffsetArray.length>=jf.MAX_GLYPHS&&V("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==k.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,k.sortKey),e.symbolInstances.emplaceBack(X.x,X.y,X.z,t.x,t.y,N.right>=0?N.right:-1,N.center>=0?N.center:-1,N.left>=0?N.left:-1,N.vertical>=0?N.vertical:-1,U,q,Z,void 0!==T?T:e.collisionBoxArray.length,void 0!==T?T+1:e.collisionBoxArray.length,void 0!==B?B:e.collisionBoxArray.length,void 0!==B?B+1:e.collisionBoxArray.length,void 0!==z?z:e.collisionBoxArray.length,void 0!==z?z+1:e.collisionBoxArray.length,C||e.collisionBoxArray.length,C?C+1:e.collisionBoxArray.length,c,j,O,F,R,se,0,G,Y,ae)}(e,s,d,o,r,n,i,g,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,M,B,l,0,T,C,b,t,a,c,h,p)}};if("line"===P){var F,R=u(function(e,t,r,n,i){for(var a=[],o=0;o<e.length;o++)for(var s=e[o],u=void 0,l=0;l<s.length-1;l++){var c=s[l],h=s[l+1];c.x<0&&h.x<0||(c.x<0?c=new v(0,c.y+(0-c.x)/(h.x-c.x)*(h.y-c.y))._round():h.x<0&&(h=new v(0,c.y+(0-c.x)/(h.x-c.x)*(h.y-c.y))._round()),c.y<0&&h.y<0||(c.y<0?c=new v(c.x+(0-c.y)/(h.y-c.y)*(h.x-c.x),0)._round():h.y<0&&(h=new v(c.x+(0-c.y)/(h.y-c.y)*(h.x-c.x),0)._round()),c.x>=n&&h.x>=n||(c.x>=n?c=new v(n,c.y+(n-c.x)/(h.x-c.x)*(h.y-c.y))._round():h.x>=n&&(h=new v(n,c.y+(n-c.x)/(h.x-c.x)*(h.y-c.y))._round()),c.y>=i&&h.y>=i||(c.y>=i?c=new v(c.x+(i-c.y)/(h.y-c.y)*(h.x-c.x),i)._round():h.y>=i&&(h=new v(c.x+(i-c.y)/(h.y-c.y)*(h.x-c.x),i)._round()),u&&c.equals(u[u.length-1])||(u=[c],a.push(u)),u.push(h)))))}return a}(t.geometry,0,0,rs,rs));try{for(R.s();!(F=R.n()).done;){var j,O=F.value,U=Fh(O,I,z,r.vertical||w,n,24,A,e.overscaling,rs),q=u(U);try{for(q.s();!(j=q.n()).done;){var N=j.value;w&&sf(e,w.text,E,N)||L(O,N,p)}}catch(se){q.e(se)}finally{q.f()}}}catch(se){R.e(se)}finally{R.f()}}else if("line-center"===P){var Z,X=u(t.geometry);try{for(X.s();!(Z=X.n()).done;){var G=Z.value;if(G.length>1){var Y=Lh(G,z,r.vertical||w,n,24,A);Y&&L(G,Y,p)}}}catch(se){X.e(se)}finally{X.f()}}else if("Polygon"===t.type){var K,J=u(Il(t.geometry,0));try{for(J.s();!(K=J.n()).done;){var W=K.value,H=Yh(W,16);L(W[0],new Ch(H.x,H.y,0,0,void 0),p)}}catch(se){J.e(se)}finally{J.f()}}else if("LineString"===t.type){var $,Q=u(t.geometry);try{for(Q.s();!($=Q.n()).done;){var ee=$.value;L(ee,new Ch(ee[0].x,ee[0].y,0,0,void 0),p)}}catch(se){Q.e(se)}finally{Q.f()}}else if("Point"===t.type){var te,re=u(t.geometry);try{for(re.s();!(te=re.n()).done;){var ne,ie=te.value,ae=u(ie);try{for(ae.s();!(ne=ae.n()).done;){var oe=ne.value;L([oe],new Ch(oe.x,oe.y,0,0,void 0),p)}}catch(se){ae.e(se)}finally{ae.f()}}}catch(se){re.e(se)}finally{re.f()}}}var tf=32640;function rf(e,r,n,i,a,o,l,c,h,f,p,y,d,m,g,x,b){var k=function(e,r,n,i,a,o,l,c){var h=[];if(0===r.positionedLines.length)return h;var f,p=i.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,y=function(e){var t=e[0],r=e[1],n=t*r;return n>0?[t,-r]:n<0?[-t,r]:0===t?[r,t]:[r,-t]}(n),d=Math.abs(r.top-r.bottom),m=u(r.positionedLines);try{for(m.s();!(f=m.n()).done;){d-=f.value.lineOffset}}catch(oe){m.e(oe)}finally{m.f()}for(var g=r.positionedLines.length,x=d/g,b=r.top-n[1],k=0;k<g;++k){var w=r.positionedLines[k];b=Zh(r,x,b,k);var _,S=u(w.positionedGlyphs);try{for(S.s();!(_=S.n()).done;){var A=_.value;if(A.rect){var I=A.rect||{},M=4,T=!0,z=1,B=0;if(A.imageName){var C=l[A.imageName];if(!C)continue;if(C.sdf){V("SDF images are not supported in formatted text and will be ignored.");continue}T=!1,M=1/(z=C.pixelRatio)}var P=(a||c)&&A.vertical,E=A.metrics.advance*A.scale/2,D=A.metrics,L=A.rect;if(null!==L){c&&r.verticalizable&&(B=A.imageName?E-A.metrics.width*A.scale/2:0);var F=a?[A.x+E,A.y]:[0,0],R=[0,0],j=[0,0],O=!1;a||(P?(j=[A.x+E+y[0],A.y+y[1]-B],O=!0):R=[A.x+E+n[0],A.y+n[1]-B]);var U=L.w*A.scale/(z*(A.localGlyph?2:1)),q=L.h*A.scale/(z*(A.localGlyph?2:1)),N=void 0,Z=void 0,X=void 0,G=void 0;if(P){var Y=A.y-b,K=new v(-E,E-Y),J=-Math.PI/2,W=t(v,s(j));(N=new v(-E+R[0],R[1]))._rotateAround(J,K)._add(W),N.x+=-Y+E,N.y-=(D.left-M)*A.scale;var H=A.imageName?D.advance*A.scale:Fc*A.scale,$=String.fromCharCode(A.glyph);Zc($)?N.x+=(1-M)*A.scale:Xc($)?N.x+=H-D.height*A.scale+(-M-1)*A.scale:N.x+=A.imageName||D.width+2*M===L.w&&D.height+2*M===L.h?(H-q)/2:(H-(D.height+2*M)*A.scale)/2,Z=new v(N.x,N.y-U),X=new v(N.x+q,N.y),G=new v(N.x+q,N.y-U)}else{var Q=(D.left-M)*A.scale-E+R[0],ee=(-D.top-M)*A.scale+R[1],te=Q+U,re=ee+q;N=new v(Q,ee),Z=new v(te,ee),X=new v(Q,re),G=new v(te,re)}if(p){var ne;ne=a?new v(0,0):O?new v(y[0],y[1]):new v(n[0],n[1]),N._rotateAround(p,ne),Z._rotateAround(p,ne),X._rotateAround(p,ne),G._rotateAround(p,ne)}var ie=new v(0,0),ae=new v(0,0);h.push({tl:N,tr:Z,bl:X,br:G,tex:I,writingMode:r.writingMode,glyphOffset:F,sectionIndex:A.sectionIndex,isSDF:T,pixelOffsetTL:ie,pixelOffsetBR:ae,minFontScaleX:0,minFontScaleY:0})}}}}catch(oe){S.e(oe)}finally{S.f()}}return h}(0,i,h,o,l,c,a,e.allowVerticalPlacement),w=e.textSizeData,_=null;"source"===w.kind?(_=[Rc*o.layout.get("text-size").evaluate(c,{},b)])[0]>tf&&V("".concat(e.layerIds[0],': Value for "text-size" is >= 255. Reduce your "text-size".')):"composite"===w.kind&&(((_=[Rc*g.compositeTextSizes[0].evaluate(c,{},b),Rc*g.compositeTextSizes[1].evaluate(c,{},b)])[0]>tf||_[1]>tf)&&V("".concat(e.layerIds[0],': Value for "text-size" is >= 255. Reduce your "text-size".'))),e.addSymbols(e.text,k,_,h,l,c,p,r,n,f.lineStartIndex,f.lineLength,m,x,b);var S,A=u(y);try{for(A.s();!(S=A.n()).done;){d[S.value]=e.text.placedSymbolArray.length-1}}catch(I){A.e(I)}finally{A.f()}return 4*k.length}function nf(e){for(var t in e)return e[t];return null}function af(e,t,r,n,i,a,o,s,u,l){var c=o.top,h=o.bottom,f=o.left,p=o.right,y=o.collisionPadding;if(y&&(f-=y[0],c-=y[1],p+=y[2],h+=y[3]),u){var d=new v(f,c),m=new v(p,c),g=new v(f,h),x=new v(p,h),b=k(u),w=new v(0,0);l&&(w=new v(l[0],l[1])),d._rotateAround(b,w),m._rotateAround(b,w),g._rotateAround(b,w),x._rotateAround(b,w),f=Math.min(d.x,m.x,g.x,x.x),p=Math.max(d.x,m.x,g.x,x.x),c=Math.min(d.y,m.y,g.y,x.y),h=Math.max(d.y,m.y,g.y,x.y)}return e.emplaceBack(t.x,t.y,t.z,r.x,r.y,f,c,p,h,s,n,i,a),e.length-1}function of(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);var t=e.bottom-e.top;return t>0?Math.max(10,t):null}function sf(e,t,r,n){var i=e.compareText;if(t in i){for(var a=i[t],o=a.length-1;o>=0;o--)if(n.dist(a[o])<r)return!0}else i[t]=[];return i[t].push(n),!1}function uf(e,t){var r=e.fovAboveCenter,n=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,i=(e._camera.position[2]*e.worldSize-n)/Math.cos(e._pitch),a=Math.sin(r)*i/Math.sin(Math.max(Math.PI/2-e._pitch-r,.01)),o=Math.sin(e._pitch)*a+i;return Math.min(1.01*o,i*(1/e._horizonShift))}function lf(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};var r=Math.pow(2,-e.z),n=e.x*r,i=(e.x+1)*r,a=e.y*r,o=(e.y+1)*r,s=tu(n),u=tu(i),l=ru(a),c=ru(o),h=t.project(s,l),f=t.project(u,l),p=t.project(u,c),y=t.project(s,c),d=Math.min(h.x,f.x,p.x,y.x),v=Math.min(h.y,f.y,p.y,y.y),m=Math.max(h.x,f.x,p.x,y.x),g=Math.max(h.y,f.y,p.y,y.y),x=r/16;function b(e,r,n,i,a,o){var s=(n+a)/2,u=(i+o)/2,l=t.project(tu(s),ru(u)),c=Math.max(0,d-l.x,v-l.y,l.x-m,l.y-g);d=Math.min(d,l.x),m=Math.max(m,l.x),v=Math.min(v,l.y),g=Math.max(g,l.y),c>x&&(b(e,l,n,i,s,u),b(l,r,s,u,a,o))}b(h,f,n,a,i,a),b(f,p,i,a,i,o),b(p,y,i,o,n,o),b(y,h,n,o,n,a),d-=x,v-=x,m+=x,g+=x;var k=1/Math.max(m-d,g-v);return{scale:k,x:d*k,y:v*k,x2:m*k,y2:g*k,projection:t}}var cf=os(new Float32Array(16)),hf=function(){function e(t){p(this,e),this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}return y(e,[{key:"project",value:function(e,t){return{x:0,y:0,z:0}}},{key:"unproject",value:function(e,t){return new Ws(0,0)}},{key:"projectTilePoint",value:function(e,t,r){return{x:e,y:t,z:0}}},{key:"locationPoint",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return e._coordinatePoint(e.locationCoordinate(t),r)}},{key:"pixelsPerMeter",value:function(e,t){return eu(1,e)*t}},{key:"pixelSpaceConversion",value:function(e,t,r){return 1}},{key:"farthestPixelDistance",value:function(e){return uf(e,e.pixelsPerMeter)}},{key:"pointCoordinate",value:function(e,t,r,n){var i=e.horizonLineFromTop(!1),a=new v(t,Math.max(i,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(a,n))}},{key:"pointCoordinate3D",value:function(e,t,r){var n=new v(t,r);if(e.elevation)return e.elevation.pointCoordinate(n);var i=this.pointCoordinate(e,n.x,n.y,0);return[i.x,i.y,i.z]}},{key:"isPointAboveHorizon",value:function(e,t){if(e.elevation)return!this.pointCoordinate3D(e,t.x,t.y);var r=e.horizonLineFromTop();return t.y<r}},{key:"createInversionMatrix",value:function(e,t){return cf}},{key:"createTileMatrix",value:function(e,t,r){var n,i,a,o=r.canonical,s=os(new Float64Array(16));if(this.isReprojectedInTileSpace){var u=lf(o,this);n=1,i=u.x+r.wrap*u.scale,a=u.y,cs(s,s,[n/u.scale,n/u.scale,e.pixelsPerMeter/t])}else n=t/e.zoomScale(o.z),i=(o.x+Math.pow(2,o.z)*r.wrap)*n,a=o.y*n;return ls(s,s,[i,a,0]),cs(s,s,[n/rs,n/rs,1]),s}},{key:"upVector",value:function(e,t,r){return[0,0,1]}},{key:"upVectorScale",value:function(e,t,r){return{metersToTile:1}}}]),e}(),ff=function(e){l(r,e);var t=c(r);function r(e){var n;p(this,r),(n=t.call(this,e)).range=[4,7],n.center=e.center||[-96,37.5];var i=n.parallels=e.parallels||[29.5,45.5],a=f(i,2),o=a[0],s=a[1],u=Math.sin(k(o));return n.n=(u+Math.sin(k(s)))/2,n.c=1+u*(2*n.n-u),n.r0=Math.sqrt(n.c)/n.n,n}return y(r,[{key:"project",value:function(e,t){var r=this.n,n=this.c,i=this.r0,a=k(e-this.center[0]),o=k(t),s=Math.sqrt(n-2*r*Math.sin(o))/r;return{x:s*Math.sin(a*r),y:s*Math.cos(a*r)-i,z:0}}},{key:"unproject",value:function(e,t){var r=this.n,n=this.c,i=this.r0+t,a=Math.atan2(e,Math.abs(i))*Math.sign(i);i*r<0&&(a-=Math.PI*Math.sign(e)*Math.sign(i));var o=k(this.center[0])*r,s=_(w((a=S(a,-Math.PI-o,Math.PI-o))/r)+this.center[0],-180,180),u=Math.asin(_((n-(e*e+i*i)*r*r)/(2*r),-1,1)),l=_(w(u),-85.051129,nu);return new Ws(s,l)}}]),r}(hf),pf=1.340264,yf=-.081106,df=893e-6,vf=.003796,mf=Math.sqrt(3)/2,gf=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"project",value:function(e,t){t=t/180*Math.PI,e=e/180*Math.PI;var r=Math.asin(mf*Math.sin(t)),n=r*r,i=n*n*n;return{x:.5*(e*Math.cos(r)/(mf*(pf+3*yf*n+i*(7*df+9*vf*n)))/Math.PI+.5),y:1-.5*(r*(pf+yf*n+i*(df+vf*n))/Math.PI+1),z:0}}},{key:"unproject",value:function(e,t){e=(2*e-.5)*Math.PI;for(var r,n=t=(2*(1-t)-1)*Math.PI,i=n*n,a=i*i*i,o=0;o<12&&(a=(i=(n=_(n-(r=(n*(pf+yf*i+a*(df+vf*i))-t)/(pf+3*yf*i+a*(7*df+9*vf*i))),-Math.PI/3,Math.PI/3))*n)*i*i,!(Math.abs(r)<1e-12));++o);var s=mf*e*(pf+3*yf*i+a*(7*df+9*vf*i))/Math.cos(n),u=Math.asin(Math.sin(n)/mf),l=_(180*s/Math.PI,-180,180),c=_(180*u/Math.PI,-85.051129,nu);return new Ws(l,c)}}]),r}(hf),xf=function(e){l(r,e);var t=c(r);function r(e){var n;return p(this,r),(n=t.call(this,e)).wrap=!0,n.supportsWorldCopies=!0,n}return y(r,[{key:"project",value:function(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}},{key:"unproject",value:function(e,t){var r=360*(e-.5),n=_(360*(.5-t),-85.051129,nu);return new Ws(r,n)}}]),r}(hf),bf=Math.PI/2;function kf(e){return Math.tan((bf+e)/2)}var wf=function(e){l(r,e);var t=c(r);function r(e){var n;p(this,r),(n=t.call(this,e)).center=e.center||[0,30];var i=n.parallels=e.parallels||[30,30],a=f(i,2),o=a[0],s=a[1],u=k(o),l=k(s);n.southernCenter=u+l<0,n.southernCenter&&(u=-u,l=-l);var c=Math.cos(u),h=kf(u);return n.n=u===l?Math.sin(u):Math.log(c/Math.cos(l))/Math.log(kf(l)/h),n.f=c*Math.pow(kf(u),n.n)/n.n,n}return y(r,[{key:"project",value:function(e,t){t=k(t),this.southernCenter&&(t=-t),e=k(e-this.center[0]);var r=1e-6,n=this.n,i=this.f;i>0?t<-bf+r&&(t=-bf+r):t>bf-r&&(t=bf-r);var a=i/Math.pow(kf(t),n),o=a*Math.sin(n*e),s=i-a*Math.cos(n*e);return o=.5*(o/Math.PI+.5),s=.5*(s/Math.PI+.5),{x:o,y:this.southernCenter?s:1-s,z:0}}},{key:"unproject",value:function(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;var r=this.n,n=this.f,i=n-t,a=Math.sign(i),o=Math.sign(r)*Math.sqrt(e*e+i*i),s=Math.atan2(e,Math.abs(i))*a;i*r<0&&(s-=Math.PI*Math.sign(e)*a);var u=_(w(s/r)+this.center[0],-180,180),l=_(w(2*Math.atan(Math.pow(n/o,1/r))-bf),-85.051129,nu);return new Ws(u,this.southernCenter?-l:l)}}]),r}(hf),_f=function(e){l(r,e);var t=c(r);function r(e){var n;return p(this,r),(n=t.call(this,e)).wrap=!0,n.supportsWorldCopies=!0,n.supportsTerrain=!0,n.supportsFog=!0,n.supportsFreeCamera=!0,n.isReprojectedInTileSpace=!1,n.unsupportedLayers=[],n.range=null,n}return y(r,[{key:"project",value:function(e,t){return{x:$s(e),y:Qs(t),z:0}}},{key:"unproject",value:function(e,t){var r=tu(e),n=ru(t);return new Ws(r,n)}}]),r}(hf),Sf=k(nu),Af=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"project",value:function(e,t){var r=(t=k(t))*t,n=r*r;return{x:.5*((e=k(e))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}}},{key:"unproject",value:function(e,t){e=(2*e-.5)*Math.PI;var r=t=(2*(1-t)-1)*Math.PI,n=25,i=0,a=r*r;do{var o=(a=r*r)*a;r=_(r-(i=(r*(1.007226+a*(.015085+o*(.028874*a-.044475-.005916*o)))-t)/(1.007226+a*(.045255+o*(.259866*a-.311325-.005916*11*o)))),-Sf,Sf)}while(Math.abs(i)>1e-6&&--n>0);var s=_(w(e/(.8707+(a=r*r)*(a*(a*a*a*(.003971-.001529*a)-.013791)-.131979))),-180,180),u=w(r);return new Ws(s,u)}}]),r}(hf),If=k(nu),Mf=function(e){l(r,e);var t=c(r);function r(){return p(this,r),t.apply(this,arguments)}return y(r,[{key:"project",value:function(e,t){t=k(t),e=k(e);var r=Math.cos(t),n=2/Math.PI,i=Math.acos(r*Math.cos(e/2)),a=Math.sin(i)/i,o=.5*(e*n+2*r*Math.sin(e/2)/a)||0,s=.5*(t+Math.sin(t)/a)||0;return{x:.5*(o/Math.PI+.5),y:1-.5*(s/Math.PI+1),z:0}}},{key:"unproject",value:function(e,t){var r=e=(2*e-.5)*Math.PI,n=t=(2*(1-t)-1)*Math.PI,i=25,a=1e-6,o=0,s=0;do{var u=Math.cos(n),l=Math.sin(n),c=2*l*u,h=l*l,f=u*u,p=Math.cos(r/2),y=Math.sin(r/2),d=2*p*y,v=y*y,m=1-f*p*p,g=m?1/m:0,x=m?Math.acos(u*p)*Math.sqrt(1/m):0,b=.5*(2*x*u*y+2*r/Math.PI)-e,k=.5*(x*l+n)-t,S=.5*g*(f*v+x*u*p*h)+1/Math.PI,A=g*(d*c/4-x*l*y),I=.125*g*(c*y-x*l*f*d),M=.5*g*(h*p+x*v*u)+.5,T=A*I-M*S;s=(b*I-k*S)/T,r=_(r-(o=(k*A-b*M)/T),-Math.PI,Math.PI),n=_(n-s,-If,If)}while((Math.abs(o)>a||Math.abs(s)>a)&&--i>0);return new Ws(w(r),w(n))}}]),r}(hf),Tf=function(e){l(r,e);var t=c(r);function r(e){var n;return p(this,r),(n=t.call(this,e)).center=e.center||[0,0],n.parallels=e.parallels||[0,0],n.cosPhi=Math.max(.01,Math.cos(k(n.parallels[0]))),n.scale=1/(2*Math.max(Math.PI*n.cosPhi,1/n.cosPhi)),n.wrap=!0,n.supportsWorldCopies=!0,n}return y(r,[{key:"project",value:function(e,t){var r=this.scale,n=this.cosPhi;return{x:k(e)*n*r+.5,y:-Math.sin(k(t))/n*r+.5,z:0}}},{key:"unproject",value:function(e,t){var r=this.scale,n=this.cosPhi,i=-(t-.5)/r,a=_(w((e-.5)/r)/n,-180,180),o=Math.asin(_(i*n,-1,1)),s=_(w(o),-85.051129,nu);return new Ws(a,s)}}]),r}(hf),zf=function(e){l(r,e);var t=c(r);function r(e){var n;return p(this,r),(n=t.call(this,e)).requiresDraping=!0,n.supportsWorldCopies=!1,n.supportsFog=!0,n.zAxisUnit="pixels",n.unsupportedLayers=["debug"],n.range=[3,5],n}return y(r,[{key:"projectTilePoint",value:function(e,t,r){var n=Ns(e,t,r);return ws(n,n,Gs(Fs(r))),{x:n[0],y:n[1],z:n[2]}}},{key:"locationPoint",value:function(e,t){var r=qs(t.lat,t.lng),n=bs([],r),i=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;xs(r,r,n,eu(1,0)*rs*i);var a=os(new Float64Array(16));return us(a,e.pixelMatrix,e.globeMatrix),ws(r,r,a),new v(r[0],r[1])}},{key:"pixelsPerMeter",value:function(e,t){return eu(1,0)*t}},{key:"pixelSpaceConversion",value:function(e,t,r){var n=eu(1,e)*t,i=bt(eu(1,45)*t,n,r);return this.pixelsPerMeter(e,t)/i}},{key:"createTileMatrix",value:function(e,t,r){var n=function(e){var t=function(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}(Xs,e.min),r=1/Zs(e);return cs(t,t,[r,r,r])}(Fs(r.canonical));return us(new Float64Array(16),e.globeMatrix,n)}},{key:"createInversionMatrix",value:function(e,t){var r=e.center,n=Gs(Fs(t));return function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[0],o=t[1],s=t[2],u=t[3],l=t[8],c=t[9],h=t[10],f=t[11];t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-l*n,e[1]=o*i-c*n,e[2]=s*i-h*n,e[3]=u*i-f*n,e[8]=a*n+l*i,e[9]=o*n+c*i,e[10]=s*n+h*i,e[11]=u*n+f*i}(n,n,k(r.lng)),function(e,t,r){var n=Math.sin(r),i=Math.cos(r),a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],c=t[9],h=t[10],f=t[11];t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+l*n,e[5]=o*i+c*n,e[6]=s*i+h*n,e[7]=u*i+f*n,e[8]=l*i-a*n,e[9]=c*i-o*n,e[10]=h*i-s*n,e[11]=f*i-u*n}(n,n,k(r.lat)),cs(n,n,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(n)}},{key:"pointCoordinate",value:function(e,t,r,n){return Ls(e,t,r,!0)||new iu(0,0)}},{key:"pointCoordinate3D",value:function(e,t,r){var n=this.pointCoordinate(e,t,r,0);return[n.x,n.y,n.z]}},{key:"isPointAboveHorizon",value:function(e,t){return!Ls(e,t.x,t.y,!1)}},{key:"farthestPixelDistance",value:function(e){var t=function(e,t){var r,n=e.cameraToCenterDistance,i=e._centerAltitude*t,a=e._camera,o=e._camera.forward(),s=ds([],gs([],o,-n),[0,0,i]),u=e.worldSize/(2*Math.PI),l=[0,0,-u],c=e.width/e.height,h=Math.tan(e.fovAboveCenter),f=gs([],a.up(),h),p=gs([],a.right(),h*c),y=bs([],ds([],ds([],o,f),p)),d=[];if(new zs(s,y).closestPointOnSphere(l,u,d)){var v=ds([],d,l),m=Ss([],v,s);r=Math.cos(e.fovAboveCenter)*ps(m)}else{var g=Ss([],s,l),x=Ss([],l,s);bs(x,x);var b=ps(g)-u;r=Math.sqrt(b*(b+2*u));var k=Math.acos(r/(u+b))-Math.acos(ks(o,x));r*=Math.cos(k)}return 1.01*r}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=Ys(e.zoom);if(r>0){var n=uf(e,eu(1,e.center.lat)*e.worldSize),i=e.worldSize/(2*Math.PI),a=Math.max(e.width,e.height)/e.worldSize*Math.PI;return bt(t,n+i*(1-Math.cos(a)),Math.pow(r,10))}return t}},{key:"upVector",value:function(e,t,r){return Ns(t,r,e,1)}},{key:"upVectorScale",value:function(e){return{metersToTile:Vs(Zs(Fs(e)))}}}]),r}(_f);function Bf(e){var t=e.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new _f(e);case"equirectangular":return new xf(e);case"naturalEarth":return new Af(e);case"equalEarth":return new gf(e);case"winkelTripel":return new Mf(e);case"albers":return r?new Tf(e):new ff(e);case"lambertConformalConic":return r?new Tf(e):new wf(e);case"globe":return new zf(e)}throw new Error("Invalid projection name: ".concat(e.name))}var Cf=Wl.types,Pf=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Ef(e,t,r,n,i,a,o,s,u,l,c,h,f){var p=s?Math.min(tf,Math.round(s[0])):0,y=s?Math.min(tf,Math.round(s[1])):0;e.emplaceBack(t,r,Math.round(32*n),Math.round(32*i),a,o,(p<<1)+(u?1:0),y,16*l,16*c,256*h,256*f)}function Df(e,t,r,n,i,a,o){e.emplaceBack(t,r,n,i,a,o)}function Vf(e,t,r,n,i){e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i)}function Lf(e){var t,r=u(e.sections);try{for(r.s();!(t=r.n()).done;){if(la(t.value.text))return!0}}catch(n){r.e(n)}finally{r.f()}return!1}var Ff=function(){function e(t){p(this,e),this.layoutVertexArray=new Ya,this.indexArray=new to,this.programConfigurations=t,this.segments=new ts,this.dynamicLayoutVertexArray=new Na,this.opacityVertexArray=new Ja,this.placedSymbolArray=new po,this.globeExtVertexArray=new Ka}return y(e,[{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}},{key:"upload",value:function(e,t,r,n){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Cc.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Ec.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Pf,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Pc.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(e))}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}]),e}();In(Ff,"SymbolBuffers");var Rf=function(){function e(t,r,n){p(this,e),this.layoutVertexArray=new t,this.layoutAttributes=r,this.indexArray=new n,this.segments=new ts,this.collisionVertexArray=new Qa,this.collisionVertexArrayExt=new eo}return y(e,[{key:"upload",value:function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Dc.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Vc.members,!0)}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}]),e}();In(Rf,"CollisionBuffers");var jf=function(){function e(t){p(this,e),this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=os([]),this.placementViewportMatrix=os([]);var r=this.layers[0]._unevaluatedLayout._values;this.textSizeData=jc(this.zoom,r["text-size"]),this.iconSizeData=jc(this.zoom,r["icon-size"]);var n=this.layers[0].layout,i=n.get("symbol-sort-key"),a=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==a&&void 0!==i.constantOr(1),this.sortFeaturesByY=("viewport-y"===a||"auto"===a&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map((function(e){return mh[e]})),this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id})),this.sourceID=t.sourceID,this.projection=t.projection}return y(e,[{key:"createArrays",value:function(){this.text=new Ff(new Xo(this.layers,this.zoom,(function(e){return/^text/.test(e)}))),this.icon=new Ff(new Xo(this.layers,this.zoom,(function(e){return/^icon/.test(e)}))),this.glyphOffsetArray=new mo,this.lineVertexArray=new go,this.symbolInstances=new vo}},{key:"calculateGlyphDependencies",value:function(e,t,r,n,i){for(var a=0;a<e.length;a++)if(t[e.charCodeAt(a)]=!0,n&&i){var o=Nc[e.charAt(a)];o&&(t[o.charCodeAt(0)]=!0)}}},{key:"populate",value:function(e,t,r,n){var i=this.layers[0],a=i.layout,o="globe"===this.projection.name,s=a.get("text-font"),l=a.get("text-field"),c=a.get("icon-image"),h=("constant"!==l.value.kind||l.value.value instanceof _e&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),f="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,p=a.get("symbol-sort-key");if(this.features=[],h||f){var y,d=t.iconDependencies,v=t.glyphDependencies,m=t.availableImages,g=new ba(this.zoom),x=u(e);try{for(x.s();!(y=x.n()).done;){var b=y.value,k=b.feature,w=b.id,_=b.index,S=b.sourceLayerIndex,A=i._featureFilter.needGeometry,I=pu(k,A);if(i._featureFilter.filter(g,I,r)){A||(I.geometry=fu(k,r,n)),o&&1!==k.type&&r.z<=5&&function(){for(var e=I.geometry,t=function(e,t){return ks(Ns(e.x,e.y,r,1),Ns(t.x,t.y,r,1))<.98078528056},n=0;n<e.length;n++)e[n]=uu(e[n],t)}();var M=void 0,T=void 0;if(h){var z=i.getValueAndResolveTokens("text-field",I,r,m),B=_e.factory(z);Lf(B)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ma()||this.hasRTLText&&xa.isParsed())&&(M=qc(B,i,I))}if(f){var C=i.getValueAndResolveTokens("icon-image",I,r,m);T=C instanceof Se?C:Se.fromString(C)}if(M||T){var P=this.sortFeaturesByKey?p.evaluate(I,{},r):void 0;if(this.features.push({id:w,text:M,icon:T,index:_,sourceLayerIndex:S,geometry:I.geometry,properties:k.properties,type:Cf[k.type],sortKey:P}),T&&(d[T.name]=!0),M){var E=s.evaluate(I,{},r).join(","),D="map"===a.get("text-rotation-alignment")&&"point"!==a.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(mh.vertical)>=0;var V,L=u(M.sections);try{for(L.s();!(V=L.n()).done;){var F=V.value;if(F.image)d[F.image.name]=!0;else{var R=na(M.toString()),j=F.fontStack||E,O=v[j]=v[j]||{};this.calculateGlyphDependencies(F.text,O,D,this.allowVerticalPlacement,R)}}}catch(U){L.e(U)}finally{L.f()}}}}}}catch(U){x.e(U)}finally{x.f()}"line"===a.get("symbol-placement")&&(this.features=function(e){var t={},r={},n=[],i=0;function a(t){n.push(e[t]),i++}function o(e,t,i){var a=r[e];return delete r[e],r[t]=a,n[a].geometry[0].pop(),n[a].geometry[0]=n[a].geometry[0].concat(i[0]),a}function s(e,r,i){var a=t[r];return delete t[r],t[e]=a,n[a].geometry[0].shift(),n[a].geometry[0]=i[0].concat(n[a].geometry[0]),a}function u(e,t,r){var n=r?t[0][t[0].length-1]:t[0][0];return"".concat(e,":").concat(n.x,":").concat(n.y)}for(var l=0;l<e.length;l++){var c=e[l],h=c.geometry,f=c.text?c.text.toString():null;if(f){var p=u(f,h),y=u(f,h,!0);if(p in r&&y in t&&r[p]!==t[y]){var d=s(p,y,h),v=o(p,y,n[d].geometry);delete t[p],delete r[y],r[u(f,n[v].geometry,!0)]=v,n[d].geometry=null}else p in r?o(p,y,h):y in t?s(p,y,h):(a(l),t[p]=i-1,r[y]=i-1)}else a(l)}return n.filter((function(e){return e.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(e,t){return e.sortKey-t.sortKey}))}}},{key:"update",value:function(e,t,r,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r,n))}},{key:"isEmpty",value:function(){return 0===this.symbolInstances.length&&!this.hasRTLText}},{key:"uploadPending",value:function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}},{key:"upload",value:function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}},{key:"destroyDebugData",value:function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}},{key:"getProjection",value:function(){return this.projectionInstance||(this.projectionInstance=Bf(this.projection)),this.projectionInstance}},{key:"destroy",value:function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}},{key:"addToLineVertexArray",value:function(e,t){var r=this.lineVertexArray.length;if(void 0!==e.segment){var n,i=u(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=a.x,s=a.y;this.lineVertexArray.emplaceBack(o,s)}}catch(l){i.e(l)}finally{i.f()}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}},{key:"addSymbols",value:function(e,t,r,n,i,a,o,s,u,l,c,h,p,y){for(var d=e.indexArray,v=e.layoutVertexArray,m=e.globeExtVertexArray,g=e.segments.prepareSegment(4*t.length,v,d,this.canOverlap?a.sortKey:void 0),x=this.glyphOffsetArray.length,b=g.vertexLength,k=this.allowVerticalPlacement&&o===mh.vertical?Math.PI/2:0,w=a.text&&a.text.sections,_=0;_<t.length;_++){var S=t[_],A=S.tl,I=S.tr,M=S.bl,T=S.br,z=S.tex,B=S.pixelOffsetTL,C=S.pixelOffsetBR,P=S.minFontScaleX,E=S.minFontScaleY,D=S.glyphOffset,V=S.isSDF,L=S.sectionIndex,F=g.vertexLength,R=D[1];if(Ef(v,u.x,u.y,A.x,R+A.y,z.x,z.y,r,V,B.x,B.y,P,E),Ef(v,u.x,u.y,I.x,R+I.y,z.x+z.w,z.y,r,V,C.x,B.y,P,E),Ef(v,u.x,u.y,M.x,R+M.y,z.x,z.y+z.h,r,V,B.x,C.y,P,E),Ef(v,u.x,u.y,T.x,R+T.y,z.x+z.w,z.y+z.h,r,V,C.x,C.y,P,E),s){var j=s.anchor,O=j.x,U=j.y,q=j.z,N=f(s.up,3),Z=N[0],X=N[1],G=N[2];Df(m,O,U,q,Z,X,G),Df(m,O,U,q,Z,X,G),Df(m,O,U,q,Z,X,G),Df(m,O,U,q,Z,X,G),Vf(e.dynamicLayoutVertexArray,O,U,q,k)}else Vf(e.dynamicLayoutVertexArray,u.x,u.y,u.z,k);d.emplaceBack(F,F+1,F+2),d.emplaceBack(F+1,F+2,F+3),g.vertexLength+=4,g.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(D[0]),_!==t.length-1&&L===t[_+1].sectionIndex||e.programConfigurations.populatePaintArrays(v.length,a,a.index,{},p,y,w&&w[L])}var Y=s?s.anchor:u;e.placedSymbolArray.emplaceBack(Y.x,Y.y,Y.z,u.x,u.y,x,this.glyphOffsetArray.length-x,b,l,c,u.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],o,0,!1,0,h,0)}},{key:"_commitLayoutVertex",value:function(e,t,r,n,i,a,o){e.emplaceBack(t,r,n,i,a,Math.round(o.x),Math.round(o.y))}},{key:"_addCollisionDebugVertices",value:function(e,t,r,n,i,a,o){for(var s=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),u=s.vertexLength,l=o.tileAnchorX,c=o.tileAnchorY,h=0;h<4;h++)r.collisionVertexArray.emplaceBack(0,0,0,0);r.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),r.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),r.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(r.layoutVertexArray,n,i,a,l,c,new v(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,i,a,l,c,new v(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,i,a,l,c,new v(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,n,i,a,l,c,new v(e.x1,e.y2)),s.vertexLength+=4;var f=r.indexArray;f.emplaceBack(u,u+1),f.emplaceBack(u+1,u+2),f.emplaceBack(u+2,u+3),f.emplaceBack(u+3,u),s.primitiveLength+=4}},{key:"_addTextDebugCollisionBoxes",value:function(e,t,r,n,i,a){for(var o=n;o<i;o++){var s=r.get(o),u=this.getSymbolInstanceTextSize(e,a,t,o);this._addCollisionDebugVertices(s,u,this.textCollisionBox,s.projectedAnchorX,s.projectedAnchorY,s.projectedAnchorZ,a)}}},{key:"_addIconDebugCollisionBoxes",value:function(e,t,r,n,i,a){for(var o=n;o<i;o++){var s=r.get(o),u=this.getSymbolInstanceIconSize(e,t,a.placedIconSymbolIndex);this._addCollisionDebugVertices(s,u,this.iconCollisionBox,s.projectedAnchorX,s.projectedAnchorY,s.projectedAnchorZ,a)}}},{key:"generateCollisionDebugBuffers",value:function(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Rf(Ha,Lc.members,so),this.iconCollisionBox=new Rf(Ha,Lc.members,so);for(var r=Uc(this.iconSizeData,e),n=Uc(this.textSizeData,e),i=0;i<this.symbolInstances.length;i++){var a=this.symbolInstances.get(i);this._addTextDebugCollisionBoxes(n,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(n,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(r,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(r,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}},{key:"getSymbolInstanceTextSize",value:function(e,t,r,n){var i=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:n),a=Oc(this.textSizeData,e,i)/Fc;return this.tilePixelRatio*a}},{key:"getSymbolInstanceIconSize",value:function(e,t,r){var n=this.icon.placedSymbolArray.get(r),i=Oc(this.iconSizeData,e,n);return this.tilePixelRatio*i}},{key:"_commitDebugCollisionVertexUpdate",value:function(e,t,r){e.emplaceBack(t,-r,-r),e.emplaceBack(t,r,-r),e.emplaceBack(t,r,r),e.emplaceBack(t,-r,r)}},{key:"_updateTextDebugCollisionBoxes",value:function(e,t,r,n,i,a){for(var o=n;o<i;o++){var s=r.get(o),u=this.getSymbolInstanceTextSize(e,a,t,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,u,s.padding)}}},{key:"_updateIconDebugCollisionBoxes",value:function(e,t,r,n,i,a){for(var o=n;o<i;o++){var s=r.get(o),u=this.getSymbolInstanceIconSize(e,t,a);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,u,s.padding)}}},{key:"updateCollisionDebugBuffers",value:function(e,t){if(this.hasDebugData()){this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();for(var r=Uc(this.iconSizeData,e),n=Uc(this.textSizeData,e),i=0;i<this.symbolInstances.length;i++){var a=this.symbolInstances.get(i);this._updateTextDebugCollisionBoxes(n,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._updateTextDebugCollisionBoxes(n,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._updateIconDebugCollisionBoxes(r,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(r,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}}},{key:"_deserializeCollisionBoxesForSymbol",value:function(e,t,r,n,i,a,o,s,u){var l={};if(t<r){var c=e.get(t),h=c.x1,f=c.y1,p=c.x2,y=c.y2,d=c.padding,v=c.projectedAnchorX,m=c.projectedAnchorY,g=c.projectedAnchorZ,x=c.tileAnchorX,b=c.tileAnchorY,k=c.featureIndex;l.textBox={x1:h,y1:f,x2:p,y2:y,padding:d,projectedAnchorX:v,projectedAnchorY:m,projectedAnchorZ:g,tileAnchorX:x,tileAnchorY:b},l.textFeatureIndex=k}if(n<i){var w=e.get(n),_=w.x1,S=w.y1,A=w.x2,I=w.y2,M=w.padding,T=w.projectedAnchorX,z=w.projectedAnchorY,B=w.projectedAnchorZ,C=w.tileAnchorX,P=w.tileAnchorY,E=w.featureIndex;l.verticalTextBox={x1:_,y1:S,x2:A,y2:I,padding:M,projectedAnchorX:T,projectedAnchorY:z,projectedAnchorZ:B,tileAnchorX:C,tileAnchorY:P},l.verticalTextFeatureIndex=E}if(a<o){var D=e.get(a),V=D.x1,L=D.y1,F=D.x2,R=D.y2,j=D.padding,O=D.projectedAnchorX,U=D.projectedAnchorY,q=D.projectedAnchorZ,N=D.tileAnchorX,Z=D.tileAnchorY,X=D.featureIndex;l.iconBox={x1:V,y1:L,x2:F,y2:R,padding:j,projectedAnchorX:O,projectedAnchorY:U,projectedAnchorZ:q,tileAnchorX:N,tileAnchorY:Z},l.iconFeatureIndex=X}if(s<u){var G=e.get(s),Y=G.x1,K=G.y1,J=G.x2,W=G.y2,H=G.padding,$=G.projectedAnchorX,Q=G.projectedAnchorY,ee=G.projectedAnchorZ,te=G.tileAnchorX,re=G.tileAnchorY,ne=G.featureIndex;l.verticalIconBox={x1:Y,y1:K,x2:J,y2:W,padding:H,projectedAnchorX:$,projectedAnchorY:Q,projectedAnchorZ:ee,tileAnchorX:te,tileAnchorY:re},l.verticalIconFeatureIndex=ne}return l}},{key:"deserializeCollisionBoxes",value:function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}},{key:"hasTextData",value:function(){return this.text.segments.get().length>0}},{key:"hasIconData",value:function(){return this.icon.segments.get().length>0}},{key:"hasDebugData",value:function(){return this.textCollisionBox&&this.iconCollisionBox}},{key:"hasTextCollisionBoxData",value:function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}},{key:"hasIconCollisionBoxData",value:function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}},{key:"addIndicesForPlacedSymbol",value:function(e,t){for(var r=e.placedSymbolArray.get(t),n=r.vertexStartIndex+4*r.numGlyphs,i=r.vertexStartIndex;i<n;i+=4)e.indexArray.emplaceBack(i,i+1,i+2),e.indexArray.emplaceBack(i+1,i+2,i+3)}},{key:"getSortedSymbolIndexes",value:function(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),n=[],i=[],a=[],o=0;o<this.symbolInstances.length;++o){a.push(o);var s=this.symbolInstances.get(o);n.push(0|Math.round(t*s.tileAnchorX+r*s.tileAnchorY)),i.push(s.featureIndex)}return a.sort((function(e,t){return n[e]-n[t]||i[t]-i[e]})),a}},{key:"addToSortKeyRanges",value:function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}},{key:"sortFeatures",value:function(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];var t,r=u(this.symbolInstanceIndexes);try{for(r.s();!(t=r.n()).done;){var n=t.value,i=this.symbolInstances.get(n);this.featureSortOrder.push(i.featureIndex);var a=i.rightJustifiedTextSymbolIndex,o=i.centerJustifiedTextSymbolIndex,s=i.leftJustifiedTextSymbolIndex,l=i.verticalPlacedTextSymbolIndex,c=i.placedIconSymbolIndex,h=i.verticalPlacedIconSymbolIndex;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),o>=0&&o!==a&&this.addIndicesForPlacedSymbol(this.text,o),s>=0&&s!==o&&s!==a&&this.addIndicesForPlacedSymbol(this.text,s),l>=0&&this.addIndicesForPlacedSymbol(this.text,l),c>=0&&this.addIndicesForPlacedSymbol(this.icon,c),h>=0&&this.addIndicesForPlacedSymbol(this.icon,h)}}catch(f){r.e(f)}finally{r.f()}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}]),e}();In(jf,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),jf.MAX_GLYPHS=65535,jf.addDynamicAttributes=Vf;var Of=new Pa({"symbol-placement":new za(Fn.layout_symbol["symbol-placement"]),"symbol-spacing":new za(Fn.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new za(Fn.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ba(Fn.layout_symbol["symbol-sort-key"]),"symbol-z-order":new za(Fn.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new za(Fn.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new za(Fn.layout_symbol["icon-ignore-placement"]),"icon-optional":new za(Fn.layout_symbol["icon-optional"]),"icon-rotation-alignment":new za(Fn.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ba(Fn.layout_symbol["icon-size"]),"icon-text-fit":new za(Fn.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new za(Fn.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ba(Fn.layout_symbol["icon-image"]),"icon-rotate":new Ba(Fn.layout_symbol["icon-rotate"]),"icon-padding":new za(Fn.layout_symbol["icon-padding"]),"icon-keep-upright":new za(Fn.layout_symbol["icon-keep-upright"]),"icon-offset":new Ba(Fn.layout_symbol["icon-offset"]),"icon-anchor":new Ba(Fn.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new za(Fn.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new za(Fn.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new za(Fn.layout_symbol["text-rotation-alignment"]),"text-field":new Ba(Fn.layout_symbol["text-field"]),"text-font":new Ba(Fn.layout_symbol["text-font"]),"text-size":new Ba(Fn.layout_symbol["text-size"]),"text-max-width":new Ba(Fn.layout_symbol["text-max-width"]),"text-line-height":new Ba(Fn.layout_symbol["text-line-height"]),"text-letter-spacing":new Ba(Fn.layout_symbol["text-letter-spacing"]),"text-justify":new Ba(Fn.layout_symbol["text-justify"]),"text-radial-offset":new Ba(Fn.layout_symbol["text-radial-offset"]),"text-variable-anchor":new za(Fn.layout_symbol["text-variable-anchor"]),"text-anchor":new Ba(Fn.layout_symbol["text-anchor"]),"text-max-angle":new za(Fn.layout_symbol["text-max-angle"]),"text-writing-mode":new za(Fn.layout_symbol["text-writing-mode"]),"text-rotate":new Ba(Fn.layout_symbol["text-rotate"]),"text-padding":new za(Fn.layout_symbol["text-padding"]),"text-keep-upright":new za(Fn.layout_symbol["text-keep-upright"]),"text-transform":new Ba(Fn.layout_symbol["text-transform"]),"text-offset":new Ba(Fn.layout_symbol["text-offset"]),"text-allow-overlap":new za(Fn.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new za(Fn.layout_symbol["text-ignore-placement"]),"text-optional":new za(Fn.layout_symbol["text-optional"])}),Uf={paint:new Pa({"icon-opacity":new Ba(Fn.paint_symbol["icon-opacity"]),"icon-color":new Ba(Fn.paint_symbol["icon-color"]),"icon-halo-color":new Ba(Fn.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ba(Fn.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ba(Fn.paint_symbol["icon-halo-blur"]),"icon-translate":new za(Fn.paint_symbol["icon-translate"]),"icon-translate-anchor":new za(Fn.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ba(Fn.paint_symbol["text-opacity"]),"text-color":new Ba(Fn.paint_symbol["text-color"],{runtimeType:le,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Ba(Fn.paint_symbol["text-halo-color"]),"text-halo-width":new Ba(Fn.paint_symbol["text-halo-width"]),"text-halo-blur":new Ba(Fn.paint_symbol["text-halo-blur"]),"text-translate":new za(Fn.paint_symbol["text-translate"]),"text-translate-anchor":new za(Fn.paint_symbol["text-translate-anchor"])}),layout:Of},qf=function(){function e(t){p(this,e),this.type=t.property.overrides?t.property.overrides.runtimeType:ae,this.defaultValue=t}return y(e,[{key:"evaluate",value:function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}},{key:"eachChild",value:function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return null}}]),e}();In(qf,"FormatSectionOverride",{omit:["defaultValue"]});var Nf=function(e){l(r,e);var t=c(r);function r(e){return p(this,r),t.call(this,e,Uf)}return y(r,[{key:"recalculate",value:function(e,t){n(i(r.prototype),"recalculate",this).call(this,e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));var a=this.layout.get("text-writing-mode");if(a){var o,s=[],l=u(a);try{for(l.s();!(o=l.n()).done;){var c=o.value;s.indexOf(c)<0&&s.push(c)}}catch(h){l.e(h)}finally{l.f()}this.layout._values["text-writing-mode"]=s}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}},{key:"getValueAndResolveTokens",value:function(e,t,r,n){var i=this.layout.get(e).evaluate(t,{},r,n),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||Lr(a.value)||!i?i:function(e,t){return t.replace(/{([^{}]+)}/g,(function(t,r){return r in e?String(e[r]):""}))}(t.properties,i)}},{key:"createBucket",value:function(e){return new jf(e)}},{key:"queryRadius",value:function(){return 0}},{key:"queryIntersectsFeature",value:function(){return!1}},{key:"_setPaintOverrides",value:function(){var e,t=u(Uf.paint.overridableProperties);try{for(t.s();!(e=t.n()).done;){var n=e.value;if(r.hasPaintOverride(this.layout,n)){var i,a=this.paint.get(n),o=new qf(a),s=new Vr(o,a.property.specification);i="constant"===a.value.kind||"source"===a.value.kind?new Rr("source",s):new jr("composite",s,a.value.zoomStops,a.value._interpolationType),this.paint._values[n]=new Ma(a.property,i,a.parameters)}}}catch(l){t.e(l)}finally{t.f()}}},{key:"_handleOverridablePaintPropertyUpdate",value:function(e,t,n){return!(!this.layout||t.isDataDriven()||n.isDataDriven())&&r.hasPaintOverride(this.layout,e)}},{key:"getProgramConfiguration",value:function(e){return new Zo(this,e)}}],[{key:"hasPaintOverride",value:function(e,t){var r=e.get("text-field"),n=Uf.paint.properties[t],i=!1,a=function(e){var t,r=u(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;if(n.overrides&&n.overrides.hasOverride(a))return void(i=!0)}}catch(o){r.e(o)}finally{r.f()}};if("constant"===r.value.kind&&r.value.value instanceof _e)a(r.value.value.sections);else if("source"===r.value.kind){var o=r.value;o._styleExpression&&function e(t){i||(t instanceof Be&&Me(t.value)===pe?a(t.value.sections):t instanceof Ve?a(t.sections):t.eachChild(e))}(o._styleExpression.expression)}return i}}]),r}($o),Zf={paint:new Pa({"background-color":new za(Fn.paint_background["background-color"]),"background-pattern":new za(Fn.paint_background["background-pattern"]),"background-opacity":new za(Fn.paint_background["background-opacity"])})},Xf={paint:new Pa({"raster-opacity":new za(Fn.paint_raster["raster-opacity"]),"raster-hue-rotate":new za(Fn.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new za(Fn.paint_raster["raster-brightness-min"]),"raster-brightness-max":new za(Fn.paint_raster["raster-brightness-max"]),"raster-saturation":new za(Fn.paint_raster["raster-saturation"]),"raster-contrast":new za(Fn.paint_raster["raster-contrast"]),"raster-resampling":new za(Fn.paint_raster["raster-resampling"]),"raster-fade-duration":new za(Fn.paint_raster["raster-fade-duration"])})},Gf=function(e){l(r,e);var t=c(r);function r(e){var n;return p(this,r),(n=t.call(this,e,{})).implementation=e,n}return y(r,[{key:"is3D",value:function(){return"3d"===this.implementation.renderingMode}},{key:"hasOffscreenPass",value:function(){return void 0!==this.implementation.prerender}},{key:"isLayerDraped",value:function(){return void 0!==this.implementation.renderToTile}},{key:"shouldRedrape",value:function(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}},{key:"recalculate",value:function(){}},{key:"updateTransitions",value:function(){}},{key:"hasTransition",value:function(){return!1}},{key:"serialize",value:function(){}},{key:"onAdd",value:function(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}},{key:"onRemove",value:function(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}]),r}($o),Yf={paint:new Pa({"sky-type":new za(Fn.paint_sky["sky-type"]),"sky-atmosphere-sun":new za(Fn.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new za(Fn.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new za(Fn.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new za(Fn.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ca(Fn.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new za(Fn.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new za(Fn.paint_sky["sky-atmosphere-color"]),"sky-opacity":new za(Fn.paint_sky["sky-opacity"])})};function Kf(e,t,r){var n=[0,0,1],i=function(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}([]);return function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),u=Math.cos(r);e[0]=n*u-a*s,e[1]=i*u+o*s,e[2]=a*u+n*s,e[3]=o*u-i*s}(i,i,r?-k(e)+Math.PI:k(e)),function(e,t,r){r*=.5;var n=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(r),u=Math.cos(r);e[0]=n*u+o*s,e[1]=i*u+a*s,e[2]=a*u-i*s,e[3]=o*u-n*s}(i,i,-k(t)),function(e,t,r){var n=r[0],i=r[1],a=r[2],o=t[0],s=t[1],u=t[2],l=i*u-a*s,c=a*o-n*u,h=n*s-i*o,f=i*h-a*c,p=a*l-n*h,y=n*c-i*l,d=2*r[3];c*=d,h*=d,p*=2,y*=2,e[0]=o+(l*=d)+(f*=2),e[1]=s+c+p,e[2]=u+h+y}(n,n,i),bs(n,n)}var Jf={circle:function(e){l(r,e);var t=c(r);function r(e){return p(this,r),t.call(this,e,Eu)}return y(r,[{key:"createBucket",value:function(e){return new vu(e)}},{key:"queryRadius",value:function(e){var t=e;return Tu("circle-radius",this,t)+Tu("circle-stroke-width",this,t)+zu(this.paint.get("circle-translate"))}},{key:"queryIntersectsFeature",value:function(e,t,r,n,i,a,o,s){var u=Cu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),l=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return Du(e,n,a,o,s,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),u,l)}},{key:"getProgramIds",value:function(){return["circle"]}},{key:"getProgramConfiguration",value:function(e){return new Zo(this,e)}}]),r}($o),heatmap:function(e){l(r,e);var t=c(r);function r(e){var n;return p(this,r),(n=t.call(this,e,Xu))._updateColorRamp(),n}return y(r,[{key:"createBucket",value:function(e){return new ju(e)}},{key:"_handleSpecialPaintPropertyUpdate",value:function(e){"heatmap-color"===e&&this._updateColorRamp()}},{key:"_updateColorRamp",value:function(){this.colorRamp=Gu({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}},{key:"resize",value:function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}},{key:"queryRadius",value:function(e){return Tu("heatmap-radius",this,e)}},{key:"queryIntersectsFeature",value:function(e,t,r,n,i,a,o,s){var u=this.paint.get("heatmap-radius").evaluate(t,r);return Du(e,n,a,o,s,!0,!0,new v(0,0),u)}},{key:"hasOffscreenPass",value:function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},{key:"getProgramIds",value:function(){return["heatmap","heatmapTexture"]}},{key:"getProgramConfiguration",value:function(e){return new Zo(this,e)}}]),r}($o),hillshade:function(e){l(r,e);var t=c(r);function r(e){return p(this,r),t.call(this,e,Yu)}return y(r,[{key:"hasOffscreenPass",value:function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},{key:"getProgramIds",value:function(){return["hillshade","hillshadePrepare"]}}]),r}($o),fill:function(e){l(r,e);var t=c(r);function r(e){return p(this,r),t.call(this,e,Pl)}return y(r,[{key:"getProgramIds",value:function(){var e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}},{key:"getProgramConfiguration",value:function(e){return new Zo(this,e)}},{key:"recalculate",value:function(e,t){n(i(r.prototype),"recalculate",this).call(this,e,t);var a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}},{key:"createBucket",value:function(e){return new Bl(e)}},{key:"queryRadius",value:function(){return zu(this.paint.get("fill-translate"))}},{key:"queryIntersectsFeature",value:function(e,t,r,n,i,a){return!e.queryGeometry.isAboveHorizon&&xu(Bu(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),n)}},{key:"isTileClipped",value:function(){return!0}}]),r}($o),"fill-extrusion":function(e){l(r,e);var t=c(r);function r(e){return p(this,r),t.call(this,e,fc)}return y(r,[{key:"createBucket",value:function(e){return new nc(e)}},{key:"queryRadius",value:function(){return zu(this.paint.get("fill-extrusion-translate"))}},{key:"is3D",value:function(){return!0}},{key:"getProgramIds",value:function(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}},{key:"getProgramConfiguration",value:function(e){return new Zo(this,e)}},{key:"queryIntersectsFeature",value:function(e,t,r,n,i,a,o,s,l){var c=Cu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(t,r),p=this.paint.get("fill-extrusion-base").evaluate(t,r),y=[0,0],d=s&&a.elevation,m=a.elevation?a.elevation.exaggeration():1,g=e.tile.getBucket(this);if(d&&g instanceof nc){var x=g.centroidVertexArray,b=l+1;b<x.length&&(y[0]=x.geta_centroid_pos0(b),y[1]=x.geta_centroid_pos1(b))}if(0===y[0]&&1===y[1])return!1;"globe"===a.projection.name&&(n=cc([n],[new v(0,0),new v(rs,rs)],e.tileID.canonical).map((function(e){return e.polygon})).flat());var k=function(e,t,r,n,i,a,o,s,l,c,h){return"globe"===e.projection.name?function(e,t,r,n,i,a,o,s,l,c,h){var f=[],p=[],y=e.projection.upVectorScale(h,e.center.lat,e.worldSize).metersToTile,d=[0,0,0,1],v=[0,0,0,1],m=function(e,t,r,n){e[0]=t,e[1]=r,e[2]=n,e[3]=1},g=function(){var e=Math.PI/32,t=Math.tan(e),r=Ks;return r*Math.sqrt(1+2*t*t)-r}();r>0&&(r+=g),n+=g;var x,b=u(t);try{for(b.s();!(x=b.n()).done;){var k,w=x.value,_=[],S=[],A=u(w);try{for(A.s();!(k=A.n()).done;){var I=k.value,M=I.x+i.x,T=I.y+i.y,z=e.projection.projectTilePoint(M,T,h),B=e.projection.upVector(h,I.x,I.y),C=r,P=n;if(o){var E=kc(M,T,r,n,o,s,l,c);C+=E.base,P+=E.top}0!==r?m(d,z.x+B[0]*y*C,z.y+B[1]*y*C,z.z+B[2]*y*C):m(d,z.x,z.y,z.z),m(v,z.x+B[0]*y*P,z.y+B[1]*y*P,z.z+B[2]*y*P),ws(d,d,a),ws(v,v,a),_.push(new gc(d[0],d[1],d[2])),S.push(new gc(v[0],v[1],v[2]))}}catch(D){A.e(D)}finally{A.f()}f.push(_),p.push(S)}}catch(D){b.e(D)}finally{b.f()}return[f,p]}(e,t,r,n,i,a,o,s,l,c,h):o?function(e,t,r,n,i,a,o,s,l){var c,h=[],f=[],p=[0,0,0,1],y=u(e);try{for(y.s();!(c=y.n()).done;){var d,v=c.value,m=[],g=[],x=u(v);try{for(x.s();!(d=x.n()).done;){var b=d.value,k=b.x+n.x,w=b.y+n.y,_=kc(k,w,t,r,a,o,s,l);p[0]=k,p[1]=w,p[2]=_.base,p[3]=1,As(p,p,i),p[3]=Math.max(p[3],1e-5);var S=new gc(p[0]/p[3],p[1]/p[3],p[2]/p[3]);p[0]=k,p[1]=w,p[2]=_.top,p[3]=1,As(p,p,i),p[3]=Math.max(p[3],1e-5);var A=new gc(p[0]/p[3],p[1]/p[3],p[2]/p[3]);m.push(S),g.push(A)}}catch(I){x.e(I)}finally{x.f()}h.push(m),f.push(g)}}catch(I){y.e(I)}finally{y.f()}return[h,f]}(t,r,n,i,a,o,s,l,c):function(e,t,r,n,i){var a,o=[],s=[],l=i[8]*t,c=i[9]*t,h=i[10]*t,f=i[11]*t,p=i[8]*r,y=i[9]*r,d=i[10]*r,v=i[11]*r,m=u(e);try{for(m.s();!(a=m.n()).done;){var g,x=a.value,b=[],k=[],w=u(x);try{for(w.s();!(g=w.n()).done;){var _=g.value,S=_.x+n.x,A=_.y+n.y,I=i[0]*S+i[4]*A+i[12],M=i[1]*S+i[5]*A+i[13],T=i[2]*S+i[6]*A+i[14],z=i[3]*S+i[7]*A+i[15],B=I+l,C=M+c,P=T+h,E=Math.max(z+f,1e-5),D=I+p,V=M+y,L=T+d,F=Math.max(z+v,1e-5);b.push(new gc(B/E,C/E,P/E)),k.push(new gc(D/F,V/F,L/F))}}catch(R){w.e(R)}finally{w.f()}o.push(b),s.push(k)}}catch(R){m.e(R)}finally{m.f()}return[o,s]}(t,r,n,i,a)}(a,n,p,h,c,o,d?s:null,y,m,a.center.lat,e.tileID.canonical),w=f(k,2),_=w[0],S=w[1],A=e.queryGeometry;return function(e,t,r){var n=1/0;xu(r,t)&&(n=bc(r,t[0]));for(var i=0;i<t.length;i++)for(var a=t[i],o=e[i],s=0;s<a.length-1;s++){var u=a[s],l=[u,a[s+1],o[s+1],o[s],u];mu(r,l)&&(n=Math.min(n,bc(r,l)))}return n!==1/0&&n}(_,S,A.isPointQuery()?A.screenBounds:A.screenGeometry)}}]),r}($o),line:function(e){l(r,e);var t=c(r);function r(e){var n;return p(this,r),(n=t.call(this,e,Tc)).gradientVersion=0,n}return y(r,[{key:"_handleSpecialPaintPropertyUpdate",value:function(e){if("line-gradient"===e){var t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof xt,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}},{key:"gradientExpression",value:function(){return this._transitionablePaint._values["line-gradient"].value.expression}},{key:"widthExpression",value:function(){return this._transitionablePaint._values["line-width"].value.expression}},{key:"recalculate",value:function(e,t){n(i(r.prototype),"recalculate",this).call(this,e,t),this.paint._values["line-floorwidth"]=zc.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}},{key:"createBucket",value:function(e){return new Ic(e)}},{key:"getProgramIds",value:function(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}},{key:"getProgramConfiguration",value:function(e){return new Zo(this,e)}},{key:"queryRadius",value:function(e){var t=e,r=Bc(Tu("line-width",this,t),Tu("line-gap-width",this,t)),n=Tu("line-offset",this,t);return r/2+Math.abs(n)+zu(this.paint.get("line-translate"))}},{key:"queryIntersectsFeature",value:function(e,t,r,n,i,a){if(e.queryGeometry.isAboveHorizon)return!1;var o=Bu(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),s=e.pixelToTileUnitsFactor/2*Bc(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),u=this.paint.get("line-offset").evaluate(t,r);return u&&(n=function(e,t){for(var r=[],n=new v(0,0),i=0;i<e.length;i++){for(var a=e[i],o=[],s=0;s<a.length;s++){var u=a[s-1],l=a[s],c=a[s+1],h=0===s?n:l.sub(u)._unit()._perp(),f=s===a.length-1?n:c.sub(l)._unit()._perp(),p=h._add(f)._unit();p._mult(1/(p.x*f.x+p.y*f.y)),o.push(p._mult(t)._add(l))}r.push(o)}return r}(n,u*e.pixelToTileUnitsFactor)),function(e,t,r){for(var n=0;n<t.length;n++){var i=t[n];if(e.length>=3)for(var a=0;a<i.length;a++)if(Iu(e,i[a]))return!0;if(bu(e,i,r))return!0}return!1}(o,n,s)}},{key:"isTileClipped",value:function(){return!0}}]),r}($o),symbol:Nf,background:function(e){l(r,e);var t=c(r);function r(e){return p(this,r),t.call(this,e,Zf)}return y(r,[{key:"getProgramIds",value:function(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}}]),r}($o),raster:function(e){l(r,e);var t=c(r);function r(e){return p(this,r),t.call(this,e,Xf)}return y(r,[{key:"getProgramIds",value:function(){return["raster"]}}]),r}($o),sky:function(e){l(r,e);var t=c(r);function r(e){var n;return p(this,r),(n=t.call(this,e,Yf))._updateColorRamp(),n}return y(r,[{key:"_handleSpecialPaintPropertyUpdate",value:function(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}},{key:"_updateColorRamp",value:function(){this.colorRamp=Gu({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}},{key:"needsSkyboxCapture",value:function(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){var t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}},{key:"getCenter",value:function(e,t){if("atmosphere"===this.paint.get("sky-type")){var r=this.paint.get("sky-atmosphere-sun"),n=!r,i=e.style.light,a=i.properties.get("position");return n&&"viewport"===i.properties.get("anchor")&&V("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?Kf(a.azimuthal,90-a.polar,t):Kf(r[0],90-r[1],t)}var o=this.paint.get("sky-gradient-center");return Kf(o[0],90-o[1],t)}},{key:"is3D",value:function(){return!1}},{key:"isSky",value:function(){return!0}},{key:"markSkyboxValid",value:function(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}},{key:"hasOffscreenPass",value:function(){return!0}},{key:"getProgramIds",value:function(){var e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}]),r}($o)},Wf=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Hf(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){var t,r="[",n=u(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;r+="".concat(Hf(i),",")}}catch(c){n.e(c)}finally{n.f()}return"".concat(r,"]")}var a,o="{",s=u(Object.keys(e).sort());try{for(s.s();!(a=s.n()).done;){var l=a.value;o+="".concat(l,":").concat(Hf(e[l]),",")}}catch(c){s.e(c)}finally{s.f()}return"".concat(o,"}")}function $f(e){var t,r="",n=u(Wf);try{for(n.s();!(t=n.n()).done;){var i=t.value;r+="/".concat(Hf(e[i]))}}catch(a){n.e(a)}finally{n.f()}return r}for(var Qf=function(){function e(t){p(this,e),this.keyCache={},t&&this.replace(t)}return y(e,[{key:"replace",value:function(e){this._layerConfigs={},this._layers={},this.update(e,[])}},{key:"update",value:function(e,t){var r,n,i=this,a=u(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;this._layerConfigs[o.id]=o,(this._layers[o.id]=(n=o,"custom"===n.type?new Gf(n):new Jf[n.type](n))).compileFilter(),this.keyCache[o.id]&&delete this.keyCache[o.id]}}catch(b){a.e(b)}finally{a.f()}var s,l=u(t);try{for(l.s();!(s=l.n()).done;){var c=s.value;delete this.keyCache[c],delete this._layerConfigs[c],delete this._layers[c]}}catch(b){l.e(b)}finally{l.f()}this.familiesBySource={};var h,f=function(e,t){for(var r={},n=0;n<e.length;n++){var i=t&&t[e[n].id]||$f(e[n]);t&&(t[e[n].id]=i);var a=r[i];a||(a=r[i]=[]),a.push(e[n])}var o=[];for(var s in r)o.push(r[s]);return o}(A(this._layerConfigs),this.keyCache),p=u(f);try{for(p.s();!(h=p.n()).done;){var y=h.value.map((function(e){return i._layers[e.id]})),d=y[0];if("none"!==d.visibility){var v=d.source||"",m=this.familiesBySource[v];m||(m=this.familiesBySource[v]={});var g=d.sourceLayer||"_geojsonTileLayer",x=m[g];x||(x=m[g]=[]),x.push(y)}}}catch(b){p.e(b)}finally{p.f()}}}]),e}(),ep=function(){function e(t){p(this,e),this._stringToNumber={},this._numberToString=[];for(var r=0;r<t.length;r++){var n=t[r];this._stringToNumber[n]=r,this._numberToString[r]=n}}return y(e,[{key:"encode",value:function(e){return this._stringToNumber[e]}},{key:"decode",value:function(e){return this._numberToString[e]}}]),e}(),tp=["tile","layer","source","sourceLayer","state"],rp=function(){function e(t,r,n,i,a){p(this,e),this.type="Feature",this._vectorTileFeature=t,this._z=r,this._x=n,this._y=i,this.properties=t.properties,this.id=a}return y(e,[{key:"geometry",get:function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry},set:function(e){this._geometry=e}},{key:"toJSON",value:function(){var e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);var t,r=u(tp);try{for(r.s();!(t=r.n()).done;){var n=t.value;void 0!==this[n]&&(e[n]=this[n])}}catch(i){r.e(i)}finally{r.f()}return e}}]),e}(),np=function(){function e(t,r,n,i){p(this,e),this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(r,i)}return y(e,[{key:"update",value:function(e,t,r){var n=e.width,i=e.height,a=this.context,o=a.gl,s=g.HTMLImageElement,u=g.HTMLCanvasElement,l=g.HTMLVideoElement,c=g.ImageData,h=g.ImageBitmap;if(o.bindTexture(o.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA&&(!t||!1!==t.premultiply)),r||this.size&&this.size[0]===n&&this.size[1]===i){var f=r||{x:0,y:0},p=f.x,y=f.y;e instanceof s||e instanceof u||e instanceof l||e instanceof c||h&&e instanceof h?o.texSubImage2D(o.TEXTURE_2D,0,p,y,o.RGBA,o.UNSIGNED_BYTE,e):o.texSubImage2D(o.TEXTURE_2D,0,p,y,n,i,o.RGBA,o.UNSIGNED_BYTE,e.data)}else this.size=[n,i],e instanceof s||e instanceof u||e instanceof l||e instanceof c||h&&e instanceof h?o.texImage2D(o.TEXTURE_2D,0,this.format,this.format,o.UNSIGNED_BYTE,e):o.texImage2D(o.TEXTURE_2D,0,this.format,n,i,0,this.format,o.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(t&&t.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&o.generateMipmap(o.TEXTURE_2D)}},{key:"bind",value:function(e,t){var r=this.context.gl;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap?e===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_NEAREST:e),this.filter=e),t!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrap=t)}},{key:"isSizePowerOfTwo",value:function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}},{key:"destroy",value:function(){this.context.gl.deleteTexture(this.texture),this.texture=null}}]),e}(),ip=32,ap=33,op=new Uint16Array(8184),sp=0;sp<2046;sp++){var up=sp+2,lp=0,cp=0,hp=0,fp=0,pp=0,yp=0;for(1&up?hp=fp=pp=ip:lp=cp=yp=ip;(up>>=1)>1;){var dp=lp+hp>>1,vp=cp+fp>>1;1&up?(hp=lp,fp=cp,lp=pp,cp=yp):(lp=hp,cp=fp,hp=pp,fp=yp),pp=dp,yp=vp}var mp=4*sp;op[mp+0]=lp,op[mp+1]=cp,op[mp+2]=hp,op[mp+3]=fp}var gp=new Uint16Array(2178),xp=new Uint8Array(1089),bp=new Uint16Array(1089);function kp(e){return 0===e?-.03125:32===e?.03125:0}var wp=Fa([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),_p={type:2,extent:rs,loadGeometry:function(){return[[new v(0,0),new v(8193,0),new v(8193,8193),new v(0,8193),new v(0,0)]]}},Sp=function(){function e(t,r,n,i,a){p(this,e),this.tileID=t,this.uid=M++,this.uses=0,this.tileSize=r,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=a,this.expiredRequestCount=0,this.state="loading",i&&i.transform&&(this.projection=i.transform.projection)}return y(e,[{key:"registerFadeDuration",value:function(e){var t=e+this.timeAdded;t<ca.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}},{key:"wasRequested",value:function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}},{key:"tileTransform",get:function(){return this._tileTransform||(this._tileTransform=lf(this.tileID.canonical,this.projection)),this._tileTransform}},{key:"loadVectorData",value:function(e,t,r){if(this.unloadVectorData(),this.state="loaded",e){for(var n in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){var r={};if(!t)return r;var n,i=u(e);try{var a=function(){var e=n.value,i=e.layerIds.map((function(e){return t.getLayer(e)})).filter(Boolean);if(0!==i.length){e.layers=i,e.stateDependentLayerIds&&(e.stateDependentLayers=e.stateDependentLayerIds.map((function(e){return i.filter((function(t){return t.id===e}))[0]})));var a,o=u(i);try{for(o.s();!(a=o.n()).done;){var s=a.value;r[s.id]=e}}catch(l){o.e(l)}finally{o.f()}}};for(i.s();!(n=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return r}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[n];if(i instanceof jf){if(this.hasSymbolBuckets=!0,!r)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var a in this.buckets){var o=this.buckets[a];if(o instanceof jf&&o.hasRTLText){this.hasRTLText=!0,xa.isLoading()||xa.isLoaded()||"deferred"!==ma()||ga();break}}for(var s in this.queryPadding=0,this.buckets){var l=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(s).queryRadius(l))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new ho}},{key:"unloadVectorData",value:function(){if(this.hasData()){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}},{key:"getBucket",value:function(e){return this.buckets[e.id]}},{key:"upload",value:function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new np(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new np(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new np(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}},{key:"prepare",value:function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}},{key:"queryRenderedFeatures",value:function(e,t,r,n,i,a,o,s){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:n,pixelPosMatrix:o,transform:a,params:i,tileTransform:this.tileTransform},e,t,r):{}}},{key:"querySourceFeatures",value:function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var n=r.loadVTLayers(),i=t?t.sourceLayer:"",a=n._geojsonTileLayer||n[i];if(a)for(var o=ei(t&&t.filter),s=this.tileID.canonical,u=s.z,l=s.x,c=s.y,h={z:u,x:l,y:c},f=0;f<a.length;f++){var p=a.feature(f);if(o.needGeometry){var y=pu(p,!0);if(!o.filter(new ba(this.tileID.overscaledZ),y,this.tileID.canonical))continue}else if(!o.filter(new ba(this.tileID.overscaledZ),p))continue;var d=r.getId(p,i),v=new rp(p,u,l,c,d);v.tile=h,e.push(v)}}}},{key:"hasData",value:function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}},{key:"patternsLoaded",value:function(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}},{key:"setExpiryData",value:function(e){var t=this.expirationTime;if(e.cacheControl){var r=j(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var n=Date.now(),i=!1;if(this.expirationTime>n)i=!1;else if(t)if(this.expirationTime<t)i=!0;else{var a=this.expirationTime-t;a?this.expirationTime=n+Math.max(a,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}},{key:"getExpiryTimeout",value:function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}},{key:"setFeatureState",value:function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length&&t){var r=this.latestFeatureIndex.loadVTLayers(),n=t.style.listImages();for(var i in this.buckets)if(t.style.hasLayer(i)){var a=this.buckets[i],o=a.layers[0].sourceLayer||"_geojsonTileLayer",s=r[o],u=e[o];if(s&&u&&0!==Object.keys(u).length){if(a.update(u,s,n,this.imageAtlas&&this.imageAtlas.patternPositions||{}),a instanceof Ic||a instanceof Bl){var l=t.style._getSourceCache(a.layers[0].source);t._terrain&&t._terrain.enabled&&l&&a.programConfigurations.needsUpload&&t._terrain._clearRenderCacheForTile(l.id,this.tileID)}var c=t&&t.style&&t.style.getLayer(i);c&&(this.queryPadding=Math.max(this.queryPadding,c.queryRadius(a)))}}}}},{key:"holdingForFade",value:function(){return void 0!==this.symbolFadeHoldUntil}},{key:"symbolFadeFinished",value:function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ca.now()}},{key:"clearFadeHold",value:function(){this.symbolFadeHoldUntil=void 0}},{key:"setHoldDuration",value:function(e){this.symbolFadeHoldUntil=ca.now()+e}},{key:"setTexture",value:function(e,t){var r=t.context,n=r.gl;this.texture=this.texture||t.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new np(r,e,n.RGBA,{useMipmap:!0}),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),r.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax))}},{key:"setDependencies",value:function(e,t){var r,n={},i=u(t);try{for(i.s();!(r=i.n()).done;){n[r.value]=!0}}catch(a){i.e(a)}finally{i.f()}this.dependencies[e]=n}},{key:"hasDependency",value:function(e,t){var r,n=u(e);try{for(n.s();!(r=n.n()).done;){var i=r.value,a=this.dependencies[i];if(a){var o,s=u(t);try{for(s.s();!(o=s.n()).done;){if(a[o.value])return!0}}catch(l){s.e(l)}finally{s.f()}}}}catch(l){n.e(l)}finally{n.f()}return!1}},{key:"clearQueryDebugViz",value:function(){}},{key:"_makeDebugTileBoundsBuffers",value:function(e,t){if(t&&"mercator"!==t.name&&!this._tileDebugBuffer){for(var r=fu(_p,this.tileID.canonical,this.tileTransform)[0],n=new ja,i=new uo,a=0;a<r.length;a++){var o=r[a],s=o.x,u=o.y;n.emplaceBack(s,u),i.emplaceBack(a)}i.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(i),this._tileDebugBuffer=e.createVertexBuffer(n,Ts.members),this._tileDebugSegments=ts.simpleSegment(0,0,n.length,i.length)}}},{key:"_makeTileBoundsBuffers",value:function(e,t){if(!this._tileBoundsBuffer&&t&&"mercator"!==t.name){var r,n,i=fu(_p,this.tileID.canonical,this.tileTransform)[0];if(this.isRaster){var a=function(e,t){for(var r=lf(e,t),n=Math.pow(2,e.z),i=0;i<ap;i++)for(var a=0;a<ap;a++){var o=tu((e.x+(a+kp(a))/ip)/n),s=ru((e.y+(i+kp(i))/ip)/n),u=t.project(o,s),l=i*ap+a;gp[2*l+0]=Math.round((u.x*r.scale-r.x)*rs),gp[2*l+1]=Math.round((u.y*r.scale-r.y)*rs)}xp.fill(0),bp.fill(0);for(var c=2045;c>=0;c--){var h=4*c,f=op[h+0],p=op[h+1],y=op[h+2],d=op[h+3],v=f+y>>1,m=p+d>>1,g=v+m-p,x=m+f-v,b=p*ap+f,k=d*ap+y,w=m*ap+v,_=Math.hypot((gp[2*b+0]+gp[2*k+0])/2-gp[2*w+0],(gp[2*b+1]+gp[2*k+1])/2-gp[2*w+1])>=16;if(xp[w]=xp[w]||(_?1:0),c<1022){var S=(p+x>>1)*ap+(f+g>>1),A=(d+x>>1)*ap+(y+g>>1);xp[w]=xp[w]||xp[S]||xp[A]}}var I=new Ua,M=new to,T=0;function z(e,t){var r=t*ap+e;return 0===bp[r]&&(I.emplaceBack(gp[2*r+0],gp[2*r+1],e*rs/ip,t*rs/ip),bp[r]=++T),bp[r]-1}function B(e,t,r,n,i,a){var o=e+r>>1,s=t+n>>1;if(Math.abs(e-i)+Math.abs(t-a)>1&&xp[s*ap+o])B(i,a,e,t,o,s),B(r,n,i,a,o,s);else{var u=z(e,t),l=z(r,n),c=z(i,a);M.emplaceBack(u,l,c)}}return B(0,0,ip,ip,ip,0),B(ip,ip,0,0,0,ip),{vertices:I,indices:M}}(this.tileID.canonical,t);r=a.vertices,n=a.indices}else{r=new Ua,n=new to;var o,s=u(i);try{for(s.s();!(o=s.n()).done;){var l=o.value,c=l.x,h=l.y;r.emplaceBack(c,h,0,0)}}catch(y){s.e(y)}finally{s.f()}for(var f=Ju(r.int16,void 0,4),p=0;p<f.length;p+=3)n.emplaceBack(f[p],f[p+1],f[p+2])}this._tileBoundsBuffer=e.createVertexBuffer(r,wp.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(n),this._tileBoundsSegments=ts.simpleSegment(0,0,r.length,n.length)}}},{key:"_makeGlobeTileDebugBuffers",value:function(e,t){var r=t.projection;if(r&&"globe"===r.name&&!t.freezeTileCoverage){var n,i=this.tileID.canonical,a=function(e,t){var r=Ys(t.zoom);if(0===r)return Fs(e);var n=js(e),i=Os(n),a=$s(n.getWest())*t.worldSize,o=$s(n.getEast())*t.worldSize,s=Qs(n.getNorth())*t.worldSize,u=Qs(n.getSouth())*t.worldSize,l=[a,s,0],c=[o,s,0],h=[a,u,0],f=[o,u,0],p=ss([],t.globeMatrix);return ws(l,l,p),ws(c,c,p),ws(h,h,p),ws(f,f,p),i[0]=Rs(i[0],h,r),i[1]=Rs(i[1],f,r),i[2]=Rs(i[2],c,r),i[3]=Rs(i[3],l,r),Bs.fromPoints(i)}(i,t),o=Gs(a),s=Ys(t.zoom);s>0&&(n=ss(new Float64Array(16),t.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,i,t,o,n,s),this._makeGlobeTileDebugTextBuffer(e,i,t,o,n,s)}}},{key:"_globePoint",value:function(e,t,r,n,i,a,o){var s=Ns(e,t,r);if(a){var u=1<<r.z,l=$s(n.center.lng),c=Qs(n.center.lat),h=(r.x+.5)/u-l,f=0;h>.5?f=-1:h<-.5&&(f=1);var p=(e/rs+r.x)/u+f,y=(t/rs+r.y)/u;p=(p-l)*n._pixelsPerMercatorPixel+l,y=(y-c)*n._pixelsPerMercatorPixel+c;var d=[p*n.worldSize,y*n.worldSize,0];ws(d,d,a),s=Rs(s,d,o)}return ws(s,s,i)}},{key:"_makeGlobeTileDebugBorderBuffer",value:function(e,t,r,n,i,a){var o=this,s=new ja,u=new uo,l=new Oa,c=function(e,c,h,f,p){for(var y=(h-e)/(p-1),d=(f-c)/(p-1),v=s.length,m=0;m<p;m++){var g=e+m*y,x=c+m*d;s.emplaceBack(g,x);var b=o._globePoint(g,x,t,r,n,i,a);l.emplaceBack(b[0],b[1],b[2]),u.emplaceBack(v+m)}},h=rs;c(0,0,h,0,16),c(h,0,h,h,16),c(h,h,0,h,16),c(0,h,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(u),this._tileDebugBuffer=e.createVertexBuffer(s,Ts.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(l,Ms.members),this._tileDebugSegments=ts.simpleSegment(0,0,s.length,u.length)}},{key:"_makeGlobeTileDebugTextBuffer",value:function(e,t,r,n,i,a){var o=new ja,s=new to,u=new Oa,l=25;s.reserve(32),o.reserve(l),u.reserve(l);for(var c=function(e,t){return l*e+t},h=0;h<l;h++)for(var f=2048*h,p=0;p<l;p++){var y=2048*p;o.emplaceBack(y,f);var d=this._globePoint(y,f,t,r,n,i,a);u.emplaceBack(d[0],d[1],d[2])}for(var v=0;v<4;v++)for(var m=0;m<4;m++){var g=c(v,m),x=c(v,m+1),b=c(v+1,m),k=c(v+1,m+1);s.emplaceBack(g,x,b),s.emplaceBack(b,x,k)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(s),this._tileDebugTextBuffer=e.createVertexBuffer(o,Ts.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(u,Ms.members),this._tileDebugTextSegments=ts.simpleSegment(0,0,l,32)}}]),e}(),Ap=function(){function e(){p(this,e),this.state={},this.stateChanges={},this.deletedStates={}}return y(e,[{key:"updateState",value:function(e,t,r){var n=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},I(this.stateChanges[e][n],r),null===this.deletedStates[e])for(var i in this.deletedStates[e]={},this.state[e])i!==n&&(this.deletedStates[e][i]=null);else if(this.deletedStates[e]&&null===this.deletedStates[e][n])for(var a in this.deletedStates[e][n]={},this.state[e][n])r[a]||(this.deletedStates[e][n][a]=null);else for(var o in r)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][o]&&delete this.deletedStates[e][n][o]}},{key:"removeFeatureState",value:function(e,t,r){if(null!==this.deletedStates[e]){var n=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==t)null!==this.deletedStates[e][n]&&(this.deletedStates[e][n]=this.deletedStates[e][n]||{},this.deletedStates[e][n][r]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][n])for(r in this.deletedStates[e][n]={},this.stateChanges[e][n])this.deletedStates[e][n][r]=null;else this.deletedStates[e][n]=null;else this.deletedStates[e]=null}}},{key:"getState",value:function(e,t){var r=String(t),n=I({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){var i=this.deletedStates[e][t];if(null===i)return{};for(var a in i)delete n[a]}return n}},{key:"initializeTileState",value:function(e,t){e.setFeatureState(this.state,t)}},{key:"coalesceChanges",value:function(e,t){var r={};for(var n in this.stateChanges){this.state[n]=this.state[n]||{};var i={};for(var a in this.stateChanges[n])this.state[n][a]||(this.state[n][a]={}),I(this.state[n][a],this.stateChanges[n][a]),i[a]=this.state[n][a];r[n]=i}for(var o in this.deletedStates){this.state[o]=this.state[o]||{};var s={};if(null===this.deletedStates[o])for(var u in this.state[o])s[u]={},this.state[o][u]={};else for(var l in this.deletedStates[o]){if(null===this.deletedStates[o][l])this.state[o][l]={};else if(this.state[o][l])for(var c=0,h=Object.keys(this.deletedStates[o][l]);c<h.length;c++){var f=h[c];delete this.state[o][l][f]}s[l]=this.state[o][l]}r[o]=r[o]||{},I(r[o],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(var p in e)e[p].setFeatureState(r,t)}}]),e}(),Ip=function(){function e(t){p(this,e),this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}return y(e,[{key:"getElevation",value:function(e,t){var r=this.toIdx(e,t);return{min:this.minimums[r],max:this.maximums[r]}}},{key:"isLeaf",value:function(e,t){return this.leaves[this.toIdx(e,t)]}},{key:"toIdx",value:function(e,t){return t*this.size+e}}]),e}();function Mp(e,t,r,n){for(var i=0,a=Number.MAX_VALUE,o=0;o<3;o++)if(Math.abs(n[o])<1e-15){if(r[o]<e[o]||r[o]>t[o])return null}else{var s=1/n[o],u=(e[o]-r[o])*s,l=(t[o]-r[o])*s;if(u>l){var c=u;u=l,l=c}if(u>i&&(i=u),l<a&&(a=l),i>a)return null}return i}function Tp(e,t,r,n,i,a,o,s,u,l,c){var h=n-e,f=i-t,p=a-r,y=o-e,d=s-t,v=u-r,m=c[1]*v-c[2]*d,g=c[2]*y-c[0]*v,x=c[0]*d-c[1]*y,b=h*m+f*g+p*x;if(Math.abs(b)<1e-15)return null;var k=1/b,w=l[0]-e,_=l[1]-t,S=l[2]-r,A=(w*m+_*g+S*x)*k;if(A<0||A>1)return null;var I=_*p-S*f,M=S*h-w*p,T=w*f-_*h,z=(c[0]*I+c[1]*M+c[2]*T)*k;return z<0||A+z>1?null:(y*I+d*M+v*T)*k}function zp(e,t,r){return(e-t)/(r-t)}function Bp(e,t,r,n,i,a,o,s,u){var l=1<<r,c=a-n,h=o-i,f=(e+1)/l*c+n,p=(t+0)/l*h+i,y=(t+1)/l*h+i;s[0]=(e+0)/l*c+n,s[1]=p,u[0]=f,u[1]=y}var Cp=function(){function e(t){if(p(this,e),this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],this.dem){var r=function(e){for(var t=Math.ceil(Math.log2(e.dim/8)),r=[],n=Math.ceil(Math.pow(2,t)),i=1/n,a=function(e,t,r,n,i){var a=n?1:0,o=(e+1)*r-a,s=t*r,u=(t+1)*r-a;i[0]=e*r,i[1]=s,i[2]=o,i[3]=u},o=new Ip(n),s=[],u=0;u<n*n;u++){a(u%n,Math.floor(u/n),i,!1,s);var l=Ep(s[0],s[1],e),c=Ep(s[2],s[1],e),h=Ep(s[2],s[3],e),f=Ep(s[0],s[3],e);o.minimums.push(Math.min(l,c,h,f)),o.maximums.push(Math.max(l,c,h,f)),o.leaves.push(1)}for(r.push(o),n/=2;n>=1;n/=2){var p=r[r.length-1];o=new Ip(n);for(var y=0;y<n*n;y++){a(y%n,Math.floor(y/n),2,!0,s);var d=p.getElevation(s[0],s[1]),v=p.getElevation(s[2],s[1]),m=p.getElevation(s[2],s[3]),g=p.getElevation(s[0],s[3]),x=p.isLeaf(s[0],s[1]),b=p.isLeaf(s[2],s[1]),k=p.isLeaf(s[2],s[3]),w=p.isLeaf(s[0],s[3]),_=Math.min(d.min,v.min,m.min,g.min),S=Math.max(d.max,v.max,m.max,g.max),A=x&&b&&k&&w;o.maximums.push(S),o.minimums.push(_),o.leaves.push(S-_<=5&&A?1:0)}r.push(o)}return r}(this.dem),n=r.length-1,i=r[n];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(r,0,0,n,0)}}return y(e,[{key:"raycastRoot",value:function(e,t,r,n,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Mp([e,t,-100],[r,n,this.maximums[0]*o],i,a)}},{key:"raycast",value:function(e,t,r,n,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;var s=this.raycastRoot(e,t,r,n,i,a,o);if(null==s)return null;for(var u=[],l=[],c=[],h=[],f=[{idx:0,t:s,nodex:0,nodey:0,depth:0}];f.length>0;){var p=f.pop(),y=p.idx,d=p.t,v=p.nodex,m=p.nodey,g=p.depth;if(this.leaves[y]){Bp(v,m,g,e,t,r,n,c,h);var x=1<<g,b=(v+0)/x,k=(v+1)/x,w=(m+0)/x,_=(m+1)/x,S=Ep(b,w,this.dem)*o,A=Ep(k,w,this.dem)*o,I=Ep(k,_,this.dem)*o,M=Ep(b,_,this.dem)*o,T=Tp(c[0],c[1],S,h[0],c[1],A,h[0],h[1],I,i,a),z=Tp(h[0],h[1],I,c[0],h[1],M,c[0],c[1],S,i,a),B=Math.min(null!==T?T:Number.MAX_VALUE,null!==z?z:Number.MAX_VALUE);if(B!==Number.MAX_VALUE)return B;var C=xs([],i,a,d);if(Pp(S,A,M,I,zp(C[0],c[0],h[0]),zp(C[1],c[1],h[1]))>=C[2])return d}else{for(var P=0,E=0;E<this._siblingOffset.length;E++){Bp((v<<1)+this._siblingOffset[E][0],(m<<1)+this._siblingOffset[E][1],g+1,e,t,r,n,c,h),c[2]=-100,h[2]=this.maximums[this.childOffsets[y]+E]*o;var D=Mp(c,h,i,a);if(null!=D){var V=D;u[E]=V;for(var L=!1,F=0;F<P&&!L;F++)V>=u[l[F]]&&(l.splice(F,0,E),L=!0);L||(l[P]=E),P++}}for(var R=0;R<P;R++){var j=l[R];f.push({idx:this.childOffsets[y]+j,t:u[j],nodex:(v<<1)+this._siblingOffset[j][0],nodey:(m<<1)+this._siblingOffset[j][1],depth:g+1})}}}return null}},{key:"_addNode",value:function(e,t,r){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}},{key:"_construct",value:function(e,t,r,n,i){if(1!==e[n].isLeaf(t,r)){this.childOffsets[i]||(this.childOffsets[i]=this.nodeCount);for(var a=n-1,o=e[a],s=0,u=0,l=0;l<this._siblingOffset.length;l++){var c=2*t+this._siblingOffset[l][0],h=2*r+this._siblingOffset[l][1],f=o.getElevation(c,h),p=o.isLeaf(c,h),y=this._addNode(f.min,f.max,p);p&&(s|=1<<l),u||(u=y)}for(var d=0;d<this._siblingOffset.length;d++)s&1<<d||this._construct(e,2*t+this._siblingOffset[d][0],2*r+this._siblingOffset[d][1],a,u+d)}}}]),e}();function Pp(e,t,r,n,i,a){return bt(bt(e,r,a),bt(t,n,a),i)}function Ep(e,t,r){var n=r.dim,i=_(e*n-.5,0,n-1),a=_(t*n-.5,0,n-1),o=Math.floor(i),s=Math.floor(a),u=Math.min(o+1,n-1),l=Math.min(s+1,n-1);return Pp(r.get(o,s),r.get(u,s),r.get(o,l),r.get(u,l),i-o,a-s)}var Dp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]},Vp=function(){function e(t,r,n){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(p(this,e),this.uid=t,r.height!==r.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return V('"'.concat(n,'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".'));this.stride=r.height;var o=this.dim=r.height-2,s=new Uint32Array(r.data.buffer);if(this.pixels=new Uint8Array(r.data.buffer),this.encoding=n||"mapbox",this.borderReady=i,!i){for(var u=0;u<o;u++)s[this._idx(-1,u)]=s[this._idx(0,u)],s[this._idx(o,u)]=s[this._idx(o-1,u)],s[this._idx(u,-1)]=s[this._idx(u,0)],s[this._idx(u,o)]=s[this._idx(u,o-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(o,-1)]=s[this._idx(o-1,0)],s[this._idx(-1,o)]=s[this._idx(0,o-1)],s[this._idx(o,o)]=s[this._idx(o-1,o-1)],a&&this._buildQuadTree()}}return y(e,[{key:"tree",get:function(){return this._tree||this._buildQuadTree(),this._tree}},{key:"_buildQuadTree",value:function(){this._tree=new Cp(this)}},{key:"get",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];r&&(e=_(e,-1,this.dim),t=_(t,-1,this.dim));var n=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[n],this.pixels[n+1],this.pixels[n+2])}},{key:"unpackVector",get:function(){return Dp[this.encoding]}},{key:"_idx",value:function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}},{key:"_unpackMapbox",value:function(e,t,r){return(256*e*256+256*t+r)/10-1e4}},{key:"_unpackTerrarium",value:function(e,t,r){return 256*e+t+r/256-32768}},{key:"getPixels",value:function(){return new Zu({width:this.stride,height:this.stride},this.pixels)}},{key:"backfillBorder",value:function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var n=t*this.dim,i=t*this.dim+this.dim,a=r*this.dim,o=r*this.dim+this.dim;switch(t){case-1:n=i-1;break;case 1:i=n+1}switch(r){case-1:a=o-1;break;case 1:o=a+1}for(var s=-t*this.dim,u=-r*this.dim,l=a;l<o;l++)for(var c=n;c<i;c++){var h=4*this._idx(c,l),f=4*this._idx(c+s,l+u);this.pixels[h+0]=e.pixels[f+0],this.pixels[h+1]=e.pixels[f+1],this.pixels[h+2]=e.pixels[f+2],this.pixels[h+3]=e.pixels[f+3]}}},{key:"onDeserialize",value:function(){this._tree&&(this._tree.dem=this)}}],[{key:"getUnpackVector",value:function(e){return Dp[e]}},{key:"pack",value:function(t,r){var n=[0,0,0,0],i=e.getUnpackVector(r),a=Math.floor((t+i[3])/i[2]);return n[2]=a%256,a=Math.floor(a/256),n[1]=a%256,a=Math.floor(a/256),n[0]=a,n}}]),e}();In(Vp,"DEMData"),In(Cp,"DemMinMaxQuadTree",{omit:["dem"]});var Lp=function(){function e(t,r){p(this,e),this.max=t,this.onRemove=r,this.reset()}return y(e,[{key:"reset",value:function(){for(var e in this.data){var t,r=u(this.data[e]);try{for(r.s();!(t=r.n()).done;){var n=t.value;n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value)}}catch(i){r.e(i)}finally{r.f()}}return this.data={},this.order=[],this}},{key:"add",value:function(e,t,r){var n=this,i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);var a={value:t,timeout:void 0};if(void 0!==r&&(a.timeout=setTimeout((function(){n.remove(e,a)}),r)),this.data[i].push(a),this.order.push(i),this.order.length>this.max){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}},{key:"has",value:function(e){return e.wrapped().key in this.data}},{key:"getAndRemove",value:function(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}},{key:"_getAndRemoveByKey",value:function(e){var t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}},{key:"getByKey",value:function(e){var t=this.data[e];return t?t[0].value:null}},{key:"get",value:function(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}},{key:"remove",value:function(e,t){if(!this.has(e))return this;var r=e.wrapped().key,n=void 0===t?0:this.data[r].indexOf(t),i=this.data[r][n];return this.data[r].splice(n,1),i.timeout&&clearTimeout(i.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(i.value),this.order.splice(this.order.indexOf(r),1),this}},{key:"setMaxSize",value:function(e){for(this.max=e;this.order.length>this.max;){var t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}},{key:"filter",value:function(e){var t=[];for(var r in this.data){var n,i=u(this.data[r]);try{for(i.s();!(n=i.n()).done;){var a=n.value;e(a.value)||t.push(a)}}catch(c){i.e(c)}finally{i.f()}}for(var o=0,s=t;o<s.length;o++){var l=s[o];this.remove(l.value.tileID,l)}}}]),e}(),Fp=y((function e(t,r,n){p(this,e),this.blendFunction=t,this.blendColor=r,this.mask=n}));Fp.Replace=[1,0],Fp.disabled=new Fp(Fp.Replace,Q.transparent,[!1,!1,!1,!1]),Fp.unblended=new Fp(Fp.Replace,Q.transparent,[!0,!0,!0,!0]),Fp.alphaBlended=new Fp([1,771],Q.transparent,[!0,!0,!0,!0]);var Rp=function(t){l(n,t);var r=c(n);function n(t,i,a){var o;return p(this,n),(o=r.call(this)).id=t,o._onlySymbols=a,i.on("data",(function(e){"source"===e.dataType&&"metadata"===e.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))})),i.on("error",(function(){o._sourceErrored=!0})),o._source=i,o._tiles={},o._cache=new Lp(0,o._unloadTile.bind(e(o))),o._timers={},o._cacheTimers={},o._minTileCacheSize=i.minTileCacheSize,o._maxTileCacheSize=i.maxTileCacheSize,o._loadedParentTiles={},o._coveredTiles={},o._state=new Ap,o._isRaster="raster"===o._source.type||"raster-dem"===o._source.type||"custom"===o._source.type&&"raster"===o._source._dataType,o}return y(n,[{key:"onAdd",value:function(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}},{key:"loaded",value:function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var e in this._tiles){var t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}},{key:"getSource",value:function(){return this._source}},{key:"pause",value:function(){this._paused=!0}},{key:"resume",value:function(){if(this._paused){var e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}}},{key:"_loadTile",value:function(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}},{key:"_unloadTile",value:function(e){if(this._source.unloadTile)return this._source.unloadTile(e,(function(){}))}},{key:"_abortTile",value:function(e){if(this._source.abortTile)return this._source.abortTile(e,(function(){}))}},{key:"serialize",value:function(){return this._source.serialize()}},{key:"prepare",value:function(e){for(var t in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var r=this._tiles[t];r.upload(e),r.prepare(this.map.style.imageManager)}}},{key:"getIds",value:function(){return A(this._tiles).map((function(e){return e.tileID})).sort(jp).map((function(e){return e.key}))}},{key:"getRenderableIds",value:function(e){var t=this,r=[];for(var n in this._tiles)this._isIdRenderable(+n,e)&&r.push(this._tiles[n]);return e?r.sort((function(e,r){var n=e.tileID,i=r.tileID,a=new v(n.canonical.x,n.canonical.y)._rotate(t.transform.angle),o=new v(i.canonical.x,i.canonical.y)._rotate(t.transform.angle);return n.overscaledZ-i.overscaledZ||o.y-a.y||o.x-a.x})).map((function(e){return e.tileID.key})):r.map((function(e){return e.tileID})).sort(jp).map((function(e){return e.key}))}},{key:"hasRenderableParent",value:function(e){var t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}},{key:"_isIdRenderable",value:function(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}},{key:"reload",value:function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var e in this._cache.reset(),this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}},{key:"_reloadTile",value:function(e,t){var r=this._tiles[e];r&&("loading"!==r.state&&(r.state=t),this._loadTile(r,this._tileLoaded.bind(this,r,e,t)))}},{key:"_tileLoaded",value:function(e,t,r,n){if(n)if(e.state="errored",404!==n.status)this._source.fire(new Un(n,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){var i=this.map.painter.terrain;this.update(this.transform,i.getScaledDemTileSize(),!0),i.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=ca.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new On("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}},{key:"_backfillDEM",value:function(e){for(var t=this.getRenderableIds(),r=0;r<t.length;r++){var n=t[r];if(e.neighboringTiles&&e.neighboringTiles[n]){var i=this.getTileByID(n);a(e,i),a(i,e)}}function a(e,t){if(e.dem&&!e.dem.borderReady){e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;var r=t.tileID.canonical.x-e.tileID.canonical.x,n=t.tileID.canonical.y-e.tileID.canonical.y,i=Math.pow(2,e.tileID.canonical.z),a=t.tileID.key;0===r&&0===n||Math.abs(n)>1||(Math.abs(r)>1&&(1===Math.abs(r+i)?r+=i:1===Math.abs(r-i)&&(r-=i)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,r,n),e.neighboringTiles&&e.neighboringTiles[a]&&(e.neighboringTiles[a].backfilled=!0)))}}}},{key:"getTile",value:function(e){return this.getTileByID(e.key)}},{key:"getTileByID",value:function(e){return this._tiles[e]}},{key:"_retainLoadedChildren",value:function(e,t,r,n){for(var i in this._tiles){var a=this._tiles[i];if(!(n[i]||!a.hasData()||a.tileID.overscaledZ<=t||a.tileID.overscaledZ>r)){for(var o=a.tileID;a&&a.tileID.overscaledZ>t+1;){var s=a.tileID.scaledTo(a.tileID.overscaledZ-1);(a=this._tiles[s.key])&&a.hasData()&&(o=s)}for(var u=o;u.overscaledZ>t;)if(e[(u=u.scaledTo(u.overscaledZ-1)).key]){n[o.key]=o;break}}}}},{key:"findLoadedParent",value:function(e,t){if(e.key in this._loadedParentTiles){var r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=t?r:null}for(var n=e.overscaledZ-1;n>=t;n--){var i=e.scaledTo(n),a=this._getLoadedTile(i);if(a)return a}}},{key:"_getLoadedTile",value:function(e){var t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}},{key:"updateCacheSize",value:function(e,t){t=t||this._source.tileSize;var r=Math.ceil(e.width/t)+1,n=Math.ceil(e.height/t)+1,i=Math.floor(r*n*5),a="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,i):i,o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,a):a;this._cache.setMaxSize(o)}},{key:"handleWrapJump",value:function(e){var t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){var r={};for(var n in this._tiles){var i=this._tiles[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),r[i.tileID.key]=i}for(var a in this._tiles=r,this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(var o in this._tiles)this._setTileReloadTimer(+o,this._tiles[o])}}},{key:"update",value:function(e,t,r){var i=this;if(this.transform=e,this._sourceLoaded&&!this._paused&&!this.transform.freezeTileCoverage&&(!this.usedForTerrain||r)){var a;this.updateCacheSize(e,t),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new vc(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(a=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(a=a.filter((function(e){return i._source.hasTile(e)})))):a=[];var o=this._updateRetainedTiles(a);if(Op(this._source.type)&&0!==a.length){for(var s={},l={},c=0,h=Object.keys(o);c<h.length;c++){var f=h[c],p=o[f],y=this._tiles[f];if(y&&!(y.fadeEndTime&&y.fadeEndTime<=ca.now())){var d=this.findLoadedParent(p,Math.max(p.overscaledZ-n.maxOverzooming,this._source.minzoom));d&&(this._addTile(d.tileID),s[d.tileID.key]=d.tileID),l[f]=p}}var v=a[a.length-1].overscaledZ;for(var m in this._tiles){var g=this._tiles[m];if(!o[m]&&g.hasData())for(var x=g.tileID;x.overscaledZ>v;){x=x.scaledTo(x.overscaledZ-1);var b=this._tiles[x.key];if(b&&b.hasData()&&l[x.key]){o[m]=g.tileID;break}}}for(var k in s)o[k]||(this._coveredTiles[k]=!0,o[k]=s[k])}for(var w in o)this._tiles[w].clearFadeHold();var _,S=function(e,t){var r=[];for(var n in e)n in t||r.push(n);return r}(this._tiles,o),A=u(S);try{for(A.s();!(_=A.n()).done;){var I=_.value,M=this._tiles[I];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(+I)}}catch(T){A.e(T)}finally{A.f()}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}}},{key:"releaseSymbolFadeTiles",value:function(){for(var e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}},{key:"_updateRetainedTiles",value:function(e){var t={};if(0===e.length)return t;var r,i={},a=e.reduce((function(e,t){return Math.min(e,t.overscaledZ)}),1/0),o=e[0].overscaledZ,s=Math.max(o-n.maxOverzooming,this._source.minzoom),l=Math.max(o+n.maxUnderzooming,this._source.minzoom),c={},h=u(e);try{for(h.s();!(r=h.n()).done;){var f=r.value,p=this._addTile(f);t[f.key]=f,p.hasData()||a<this._source.maxzoom&&(c[f.key]=f)}}catch(S){h.e(S)}finally{h.f()}this._retainLoadedChildren(c,a,l,t);var y,d=u(e);try{for(d.s();!(y=d.n()).done;){var v=y.value,m=this._tiles[v.key];if(!m.hasData()){if(v.canonical.z>=this._source.maxzoom){var g=v.children(this._source.maxzoom)[0],x=this.getTile(g);if(x&&x.hasData()){t[g.key]=g;continue}}else{var b=v.children(this._source.maxzoom);if(t[b[0].key]&&t[b[1].key]&&t[b[2].key]&&t[b[3].key])continue}for(var k=m.wasRequested(),w=v.overscaledZ-1;w>=s;--w){var _=v.scaledTo(w);if(i[_.key])break;if(i[_.key]=!0,!(m=this.getTile(_))&&k&&(m=this._addTile(_)),m&&(t[_.key]=_,k=m.wasRequested(),m.hasData()))break}}}}catch(S){d.e(S)}finally{d.f()}return t}},{key:"_updateLoadedParentTileCache",value:function(){for(var e in this._loadedParentTiles={},this._tiles){for(var t=[],r=void 0,n=this._tiles[e].tileID;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){r=this._loadedParentTiles[n.key];break}t.push(n.key);var i=n.scaledTo(n.overscaledZ-1);if(r=this._getLoadedTile(i))break;n=i}for(var a=0,o=t;a<o.length;a++){var s=o[a];this._loadedParentTiles[s]=r}}}},{key:"_addTile",value:function(e){var t=this._tiles[e.key];if(t)return t;(t=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));var r=Boolean(t);if(!r){var n=this.map?this.map.painter:null;t=new Sp(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,n,this._isRaster),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))}return t?(t.uses++,this._tiles[e.key]=t,r||this._source.fire(new On("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}},{key:"_setTileReloadTimer",value:function(e,t){var r=this;e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);var n=t.getExpiryTimeout();n&&(this._timers[e]=setTimeout((function(){r._reloadTile(e,"expired"),delete r._timers[e]}),n))}},{key:"_removeTile",value:function(e){var t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}},{key:"clearTiles",value:function(){for(var e in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}},{key:"tilesIn",value:function(e,t,r){var n=[],i=this.transform;if(!i)return n;var a="globe"===i.projection.name,o=$s(i.center.lng);for(var l in this._tiles){var c=this._tiles[l];if(r&&c.clearQueryDebugViz(),!c.holdingForFade()){var h=void 0;if(a){var f=c.tileID.canonical;if(0===f.z){var p=[Math.abs(_.apply(void 0,[o].concat(s(Up(f,-1))))-o),Math.abs(_.apply(void 0,[o].concat(s(Up(f,1))))-o)];h=[0,2*p.indexOf(Math.min.apply(Math,p))-1]}else{var y=[Math.abs(_.apply(void 0,[o].concat(s(Up(f,-1))))-o),Math.abs(_.apply(void 0,[o].concat(s(Up(f,0))))-o),Math.abs(_.apply(void 0,[o].concat(s(Up(f,1))))-o)];h=[y.indexOf(Math.min.apply(Math,y))-1]}}else h=[0];var d,v=u(h);try{for(v.s();!(d=v.n()).done;){var m=d.value,g=e.containsTile(c,i,t,m);g&&n.push(g)}}catch(x){v.e(x)}finally{v.f()}}}return n}},{key:"getVisibleCoordinates",value:function(e){var t,r=this,n=this.getRenderableIds(e).map((function(e){return r._tiles[e].tileID})),i=u(n);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.projMatrix=this.transform.calculateProjMatrix(a.toUnwrapped())}}catch(o){i.e(o)}finally{i.f()}return n}},{key:"hasTransition",value:function(){if(this._source.hasTransition())return!0;if(Op(this._source.type))for(var e in this._tiles){var t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=ca.now())return!0}return!1}},{key:"setFeatureState",value:function(e,t,r){this._state.updateState(e=e||"_geojsonTileLayer",t,r)}},{key:"removeFeatureState",value:function(e,t,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,r)}},{key:"getFeatureState",value:function(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}},{key:"setDependencies",value:function(e,t,r){var n=this._tiles[e];n&&n.setDependencies(t,r)}},{key:"reloadTilesForDependencies",value:function(e,t){for(var r in this._tiles)this._tiles[r].hasDependency(e,t)&&this._reloadTile(+r,"reloading");this._cache.filter((function(r){return!r.hasDependency(e,t)}))}},{key:"_preloadTiles",value:function(e,t){var r,n=this,i=new Map,a=Array.isArray(e)?e:[e],o=this.map.painter.terrain,s=this.usedForTerrain&&o?o.getScaledDemTileSize():this._source.tileSize,l=u(a);try{for(l.s();!(r=l.n()).done;){var c,h=r.value,f=h.coveringTiles({tileSize:s,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),p=u(f);try{for(p.s();!(c=p.n()).done;){var y=c.value;i.set(y.key,y)}}catch(d){p.e(d)}finally{p.f()}this.usedForTerrain&&h.updateElevation(!1)}}catch(d){l.e(d)}finally{l.f()}!function(e,t,r){if(!e.length)return r(null,[]);var i=e.length,a=new Array(e.length),o=null;e.forEach((function(e,t){!function(e,t){var r=new Sp(e,n._source.tileSize*e.overscaleFactor(),n.transform.tileZoom,n.map.painter,n._isRaster);n._loadTile(r,(function(e){"raster-dem"===n._source.type&&r.dem&&n._backfillDEM(r),t(e,r)}))}(e,(function(e,n){e&&(o=e),a[t]=n,0==--i&&r(o,a)}))}))}(Array.from(i.values()),0,t)}}]),n}(qn);function jp(e,t){var r=Math.abs(2*e.wrap)-+(e.wrap<0),n=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||n-r||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Op(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Up(e,t){var r=1<<e.z;return[e.x/r+t,(e.x+1)/r+t]}Rp.maxOverzooming=10,Rp.maxUnderzooming=3;var qp=function(){function e(t,r,n){p(this,e),this._demTile=t,this._dem=this._demTile.dem,this._scale=r,this._offset=n}return y(e,[{key:"tileCoordToPixel",value:function(e,t){var r=t*this._scale+this._offset[1],n=Math.floor(e*this._scale+this._offset[0]),i=Math.floor(r);return new v(n,i)}},{key:"getElevationAt",value:function(e,t,r,n){var i=e*this._scale+this._offset[0],a=t*this._scale+this._offset[1],o=Math.floor(i),s=Math.floor(a),u=this._dem;return n=!!n,r?bt(bt(u.get(o,s,n),u.get(o,s+1,n),a-s),bt(u.get(o+1,s,n),u.get(o+1,s+1,n),a-s),i-o):u.get(o,s,n)}},{key:"getElevationAtPixel",value:function(e,t,r){return this._dem.get(e,t,!!r)}},{key:"getMeterToDEM",value:function(e){return(1<<this._demTile.tileID.canonical.z)*eu(1,e)*this._dem.stride}}],[{key:"create",value:function(t,r,n){var i=n||t.findDEMTileFor(r);if(i&&i.dem){var a=i.dem,o=i.tileID,s=1<<r.canonical.z-o.canonical.z;return new e(i,i.tileSize/rs/s,[(r.canonical.x/s-o.canonical.x)*a.dim,(r.canonical.y/s-o.canonical.y)*a.dim])}}}]),e}(),Np=function(){function e(t,r){p(this,e),this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Z(rs,16,0),this.featureIndexArray=new bo,this.promoteId=r}return y(e,[{key:"insert",value:function(e,t,r,n,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i,a);for(var s=this.grid,u=0;u<t.length;u++){for(var l=t[u],c=[1/0,1/0,-1/0,-1/0],h=0;h<l.length;h++){var f=l[h];c[0]=Math.min(c[0],f.x),c[1]=Math.min(c[1],f.y),c[2]=Math.max(c[2],f.x),c[3]=Math.max(c[3],f.y)}c[0]<rs&&c[1]<rs&&c[2]>=0&&c[3]>=0&&s.insert(o,c[0],c[1],c[2],c[3])}}},{key:"loadVTLayers",value:function(){if(!this.vtLayers)for(var e in this.vtLayers=new Jl(new Gc(this.rawTileData)).layers,this.sourceLayerCoder=new ep(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={},this.vtLayers)this.vtFeatures[e]=[];return this.vtLayers}},{key:"query",value:function(e,t,r,n){var i=this;this.loadVTLayers();var a=e.params||{},o=ei(a.filter),s=e.tileResult,l=e.transform,c=s.bufferedTilespaceBounds,h=this.grid.query(c.min.x,c.min.y,c.max.x,c.max.y,(function(e,t,r,n){return function(e,t,r,n,i){var a,o=u(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(t<=s.x&&r<=s.y&&n>=s.x&&i>=s.y)return!0}}catch(p){o.e(p)}finally{o.f()}var l=[new v(t,r),new v(t,i),new v(n,i),new v(n,r)];if(e.length>2){var c,h=u(l);try{for(h.s();!(c=h.n()).done;){if(Iu(e,c.value))return!0}}catch(p){h.e(p)}finally{h.f()}}for(var f=0;f<e.length-1;f++)if(Mu(e[f],e[f+1],l))return!0;return!1}(s.bufferedTilespaceGeometry,e,t,r,n)}));h.sort(Xp);var f=null;l.elevation&&h.length>0&&(f=qp.create(l.elevation,this.tileID));for(var p,y={},d=function(u){var l=h[u];if(l===p)return"continue";p=l;var c=i.featureIndexArray.get(l),d=null;i.loadMatchingFeature(y,c,o,a.layers,a.availableImages,t,r,n,(function(t,r,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return d||(d=fu(t,i.tileID.canonical,e.tileTransform)),r.queryIntersectsFeature(s,t,n,d,i.z,e.transform,e.pixelPosMatrix,f,a)}))},m=0;m<h.length;m++)d(m);return y}},{key:"loadMatchingFeature",value:function(e,t,r,n,i,a,o,s,u){var l=t.featureIndex,c=t.bucketIndex,h=t.sourceLayerIndex,f=t.layoutVertexArrayOffset,p=this.bucketLayerIDs[c];if(!n||function(e,t){for(var r=0;r<e.length;r++)if(t.indexOf(e[r])>=0)return!0;return!1}(n,p)){var y=this.sourceLayerCoder.decode(h),d=this.vtLayers[y].feature(l);if(r.needGeometry){var v=pu(d,!0);if(!r.filter(new ba(this.tileID.overscaledZ),v,this.tileID.canonical))return}else if(!r.filter(new ba(this.tileID.overscaledZ),d))return;for(var m=this.getId(d,y),g=0;g<p.length;g++){var x=p[g];if(!(n&&n.indexOf(x)<0)){var b=a[x];if(b){var k={};void 0!==m&&s&&(k=s.getState(b.sourceLayer||"_geojsonTileLayer",m));var w=I({},o[x]);w.paint=Zp(w.paint,b.paint,d,k,i),w.layout=Zp(w.layout,b.layout,d,k,i);var _=!u||u(d,b,k,f);if(_){var S=new rp(d,this.z,this.x,this.y,m);S.layer=w;var A=e[x];void 0===A&&(A=e[x]=[]),A.push({featureIndex:l,feature:S,intersectionZ:_})}}}}}}},{key:"lookupSymbolFeatures",value:function(e,t,r,n,i,a,o,s){var l={};this.loadVTLayers();var c,h=ei(i),f=u(e);try{for(f.s();!(c=f.n()).done;){var p=c.value;this.loadMatchingFeature(l,{bucketIndex:r,sourceLayerIndex:n,featureIndex:p,layoutVertexArrayOffset:0},h,a,o,s,t)}}catch(y){f.e(y)}finally{f.f()}return l}},{key:"loadFeature",value:function(e){var t=e.featureIndex,r=e.sourceLayerIndex;this.loadVTLayers();var n=this.sourceLayerCoder.decode(r),i=this.vtFeatures[n];if(i[t])return i[t];var a=this.vtLayers[n].feature(t);return i[t]=a,a}},{key:"hasLayer",value:function(e){var t,r=u(this.bucketLayerIDs);try{for(r.s();!(t=r.n()).done;){var n,i=t.value,a=u(i);try{for(a.s();!(n=a.n()).done;){if(e===n.value)return!0}}catch(o){a.e(o)}finally{a.f()}}}catch(o){r.e(o)}finally{r.f()}return!1}},{key:"getId",value:function(e,t){var r=e.id;if(this.promoteId){var n="string"==typeof this.promoteId?this.promoteId:this.promoteId[t];null!=n&&(r=e.properties[n]),"boolean"==typeof r&&(r=Number(r))}return r}}]),e}();function Zp(e,t,r,n,i){return P(e,(function(e,a){var o=t instanceof Ta?t.get(a):null;return o&&o.evaluate?o.evaluate(r,n,i):o}))}function Xp(e,t){return t-e}In(Np,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});var Gp=function(){function e(t,r){p(this,e),this.width=t,this.height=r,this.nextRow=0,this.image=new Nu({width:t,height:r}),this.positions={},this.uploaded=!1}return y(e,[{key:"getDash",value:function(e,t){var r=this.getKey(e,t);return this.positions[r]}},{key:"trim",value:function(){var e,t=this.width,r=this.height=(e=this.nextRow)<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2));this.image.resize({width:t,height:r})}},{key:"getKey",value:function(e,t){return e.join(",")+t}},{key:"getDashRanges",value:function(e,t,r){var n=[],i=e.length%2==1?-e[e.length-1]*r:0,a=e[0]*r,o=!0;n.push({left:i,right:a,isDash:o,zeroLength:0===e[0]});for(var s=e[0],u=1;u<e.length;u++){o=!o;var l=e[u];i=s*r,a=(s+=l)*r,n.push({left:i,right:a,isDash:o,zeroLength:0===l})}return n}},{key:"addRoundDash",value:function(e,t,r){for(var n=t/2,i=-r;i<=r;i++)for(var a=this.width*(this.nextRow+r+i),o=0,s=e[o],u=0;u<this.width;u++){u/s.right>1&&(s=e[++o]);var l=Math.abs(u-s.left),c=Math.abs(u-s.right),h=Math.min(l,c),f=void 0,p=i/r*(n+1);if(s.isDash){var y=n-Math.abs(p);f=Math.sqrt(h*h+y*y)}else f=n-Math.sqrt(h*h+p*p);this.image.data[a+u]=Math.max(0,Math.min(255,f+128))}}},{key:"addRegularDash",value:function(e,t){for(var r=e.length-1;r>=0;--r){var n=e[r],i=e[r+1];n.zeroLength?e.splice(r,1):i&&i.isDash===n.isDash&&(i.left=n.left,e.splice(r,1))}var a=e[0],o=e[e.length-1];a.isDash===o.isDash&&(a.left=o.left-this.width,o.right=a.right+this.width);for(var s=this.width*this.nextRow,u=0,l=e[u],c=0;c<this.width;c++){c/l.right>1&&(l=e[++u]);var h=Math.abs(c-l.left),f=Math.abs(c-l.right),p=Math.min(h,f);this.image.data[s+c]=Math.max(0,Math.min(255,(l.isDash?p:-p)+t+128))}}},{key:"addDash",value:function(e,t){var r=this.getKey(e,t);if(this.positions[r])return this.positions[r];var n="round"===t,i=n?7:0,a=2*i+1;if(this.nextRow+a>this.height)return V("LineAtlas out of space"),null;0===e.length&&e.push(1);for(var o=0,s=0;s<e.length;s++)e[s]<0&&(V("Negative value is found in line dasharray, replacing values with 0"),e[s]=0),o+=e[s];if(0!==o){var u=this.width/o,l=this.getDashRanges(e,this.width,u);n?this.addRoundDash(l,u,i):this.addRegularDash(l,"square"===t?.5*u:0)}var c=this.nextRow+i;this.nextRow+=a;var h={tl:[c,i],br:[o,0]};return this.positions[r]=h,h}}]),e}();In(Gp,"LineAtlas");var Yp=y((function e(t){p(this,e);var r={},n=[];for(var i in t){var a=t[i],o=r[i]={};for(var s in a.glyphs){var u=a.glyphs[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var l=u.metrics.localGlyph?2:1,c={x:0,y:0,w:u.bitmap.width+2*l,h:u.bitmap.height+2*l};n.push(c),o[s]=c}}}var h=yh(n),f=h.w,y=h.h,d=new Nu({width:f||1,height:y||1});for(var v in t){var m=t[v];for(var g in m.glyphs){var x=m.glyphs[+g];if(x&&0!==x.bitmap.width&&0!==x.bitmap.height){var b=r[v][g],k=x.metrics.localGlyph?2:1;Nu.copy(x.bitmap,d,{x:0,y:0},{x:b.x+k,y:b.y+k},x.bitmap)}}}this.image=d,this.positions=r}));In(Yp,"GlyphAtlas");var Kp=function(){function e(t){p(this,e),this.tileID=new vc(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=lf(t.tileID.canonical,t.projection),this.projection=t.projection}return y(e,[{key:"parse",value:function(e,t,r,n,i){var a=this;this.status="parsing",this.data=e,this.collisionBoxArray=new ho;var o=new ep(Object.keys(e.layers).sort()),s=new Np(this.tileID,this.promoteId);s.bucketLayerIDs=[];var l,c,h,f,p={},y=new Gp(256,256),d={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:y,availableImages:r},v=t.familiesBySource[this.source];for(var m in v){var g=e.layers[m];if(g){var x,b=!1,k=!1,w=u(v[m]);try{for(w.s();!(x=w.n()).done;){"symbol"===x.value[0].type?b=!0:k=!0}}catch(O){w.e(O)}finally{w.f()}if((!0!==this.isSymbolTile||b)&&(!1!==this.isSymbolTile||k)){1===g.version&&V('Vector tile source "'.concat(this.source,'" layer "').concat(m,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));for(var _=o.encode(m),S=[],I=0;I<g.length;I++){var M=g.feature(I),T=s.getId(M,m);S.push({feature:M,id:T,index:I,sourceLayerIndex:_})}var z,B=u(v[m]);try{for(B.s();!(z=B.n()).done;){var C=z.value,E=C[0];void 0!==this.isSymbolTile&&"symbol"===E.type!==this.isSymbolTile||E.minzoom&&this.zoom<Math.floor(E.minzoom)||E.maxzoom&&this.zoom>=E.maxzoom||"none"!==E.visibility&&(Jp(C,this.zoom,r),(p[E.id]=E.createBucket({index:s.bucketLayerIDs.length,layers:C,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:r})).populate(S,d,this.tileID.canonical,this.tileTransform),s.bucketLayerIDs.push(C.map((function(e){return e.id}))))}}catch(O){B.e(O)}finally{B.f()}}}}y.trim();var D={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},L=P(d.glyphDependencies,(function(e){return Object.keys(e).map(Number)}));Object.keys(L).length?n.send("getGlyphs",{uid:this.uid,stacks:L},(function(e,t){l||(l=e,c=t,j.call(a))}),void 0,!1,D):c={};var F=Object.keys(d.iconDependencies);F.length?n.send("getImages",{icons:F,source:this.source,tileID:this.tileID,type:"icons"},(function(e,t){l||(l=e,h=t,j.call(a))}),void 0,!1,D):h={};var R=Object.keys(d.patternDependencies);function j(){if(l)return i(l);if(c&&h&&f){var e=new Yp(c),t=new vh(h,f);for(var n in p){var a=p[n];a instanceof jf?(Jp(a.layers,this.zoom,r),$h(a,c,e.positions,h,t.iconPositions,this.showCollisionBoxes,r,this.tileID.canonical,this.tileZoom,this.projection)):a.hasPattern&&(a instanceof Ic||a instanceof Bl||a instanceof nc)&&(Jp(a.layers,this.zoom,r),a.addFeatures(d,this.tileID.canonical,t.patternPositions,r,this.tileTransform))}this.status="done",i(null,{buckets:A(p).filter((function(e){return!e.isEmpty()})),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,lineAtlas:y,imageAtlas:t,glyphMap:this.returnDependencies?c:null,iconMap:this.returnDependencies?h:null,glyphPositions:this.returnDependencies?e.positions:null})}}R.length?n.send("getImages",{icons:R,source:this.source,tileID:this.tileID,type:"patterns"},(function(e,t){l||(l=e,f=t,j.call(a))}),void 0,!1,D):f={},j.call(this)}}]),e}();function Jp(e,t,r){var n,i=new ba(t),a=u(e);try{for(a.s();!(n=a.n()).done;){n.value.recalculate(i,r)}}catch(o){a.e(o)}finally{a.f()}}var Wp=function(){function e(t){p(this,e),this.entries={},this.scheduler=t}return y(e,[{key:"request",value:function(e,t,r,n){var i=this,a=this.entries[e]=this.entries[e]||{callbacks:[]};if(a.result){var o=f(a.result,2),s=o[0],l=o[1];return this.scheduler?this.scheduler.add((function(){n(s,l)}),t):n(s,l),function(){}}return a.callbacks.push(n),a.cancel||(a.cancel=r((function(r,n){a.result=[r,n];var o,s=u(a.callbacks);try{var l=function(){var e=o.value;i.scheduler?i.scheduler.add((function(){e(r,n)}),t):e(r,n)};for(s.s();!(o=s.n()).done;)l()}catch(c){s.e(c)}finally{s.f()}setTimeout((function(){return delete i.entries[e]}),3e3)}))),function(){a.result||(a.callbacks=a.callbacks.filter((function(e){return e!==n})),a.callbacks.length||(a.cancel(),delete i.entries[e]))}}}]),e}();function Hp(e,t,r){var n=JSON.stringify(e.request);return e.data&&(this.deduped.entries[n]={result:[null,e.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(function(t){var n=wn(e.request,(function(e,n,i,a){e?t(e):n&&t(null,{vectorTile:r?void 0:new Jl(new Gc(n)),rawData:n,cacheControl:i,expires:a})}));return function(){n.cancel(),t()}}),t)}var $p=function(e){l(r,e);var t=c(r);function r(e,n,i,a,o){var s;return p(this,r),(s=t.call(this)).actor=e,s.layerIndex=n,s.availableImages=i,s.loadVectorData=o||Hp,s.loading={},s.loaded={},s.deduped=new Wp(e.scheduler),s.isSpriteLoaded=a,s.scheduler=e.scheduler,s}return y(r,[{key:"loadTile",value:function(e,t){var r=this,n=e.uid,i=e&&e.request,a=i&&i.collectResourceTiming,o=this.loading[n]=new Kp(e);o.abort=this.loadVectorData(e,(function(s,u){var l=!r.loading[n];if(delete r.loading[n],l||s||!u)return o.status="done",l||(r.loaded[n]=o),t(s);var c=u.rawData,h={};u.expires&&(h.expires=u.expires),u.cacheControl&&(h.cacheControl=u.cacheControl),o.vectorTile=u.vectorTile||new Jl(new Gc(c));var f=function(){o.parse(o.vectorTile,r.layerIndex,r.availableImages,r.actor,(function(e,r){if(e||!r)return t(e);var n={};if(a){var o=Dn(i);o.length>0&&(n.resourceTiming=JSON.parse(JSON.stringify(o)))}t(null,I({rawTileData:c.slice(0)},r,h,n))}))};r.isSpriteLoaded?f():r.once("isSpriteLoaded",(function(){r.scheduler?r.scheduler.add(f,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom}):f()})),r.loaded=r.loaded||{},r.loaded[n]=o}))}},{key:"reloadTile",value:function(e,t){var r=this,n=this.loaded,i=e.uid,a=this;if(n&&n[i]){var o=n[i];o.showCollisionBoxes=e.showCollisionBoxes,o.enableTerrain=!!e.enableTerrain,o.projection=e.projection,o.tileTransform=lf(e.tileID.canonical,e.projection);var s=function(e,n){var i=o.reloadCallback;i&&(delete o.reloadCallback,o.parse(o.vectorTile,a.layerIndex,r.availableImages,a.actor,i)),t(e,n)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}},{key:"abortTile",value:function(e,t){var r=e.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),t()}},{key:"removeTile",value:function(e,t){var r=this.loaded,n=e.uid;r&&r[n]&&delete r[n],t()}}]),r}(qn),Qp=function(){function e(){p(this,e)}return y(e,[{key:"loadTile",value:function(e,t){var r=e.uid,n=e.encoding,i=e.rawImageData,a=e.padding,o=e.buildQuadTree,s=g.ImageBitmap&&i instanceof g.ImageBitmap?this.getImageData(i,a):i;t(null,new Vp(r,s,n,a<1,o))}},{key:"getImageData",value:function(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);var r=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),r}}]),e}(),ey=function e(t,r){var n,i=t&&t.type;if("FeatureCollection"===i)for(n=0;n<t.features.length;n++)e(t.features[n],r);else if("GeometryCollection"===i)for(n=0;n<t.geometries.length;n++)e(t.geometries[n],r);else if("Feature"===i)e(t.geometry,r);else if("Polygon"===i)ty(t.coordinates,r);else if("MultiPolygon"===i)for(n=0;n<t.coordinates.length;n++)ty(t.coordinates[n],r);return t};function ty(e,t){if(0!==e.length){ry(e[0],t);for(var r=1;r<e.length;r++)ry(e[r],!t)}}function ry(e,t){for(var r=0,n=0,i=0,a=e.length,o=a-1;i<a;o=i++){var s=(e[i][0]-e[o][0])*(e[o][1]+e[i][1]),u=r+s;n+=Math.abs(r)>=Math.abs(s)?r-u+s:s-u+r,r=u}r+n>=0!=!!t&&e.reverse()}var ny=Wl.prototype.toGeoJSON,iy=function(){function e(t){p(this,e),this._feature=t,this.extent=rs,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}return y(e,[{key:"loadGeometry",value:function(){if(1===this._feature.type){var e,t=[],r=u(this._feature.geometry);try{for(r.s();!(e=r.n()).done;){var n=e.value;t.push([new v(n[0],n[1])])}}catch(p){r.e(p)}finally{r.f()}return t}var i,a=[],o=u(this._feature.geometry);try{for(o.s();!(i=o.n()).done;){var s,l=i.value,c=[],h=u(l);try{for(h.s();!(s=h.n()).done;){var f=s.value;c.push(new v(f[0],f[1]))}}catch(p){h.e(p)}finally{h.f()}a.push(c)}}catch(p){o.e(p)}finally{o.f()}return a}},{key:"toGeoJSON",value:function(e,t,r){return ny.call(this,e,t,r)}}]),e}(),ay=function(){function e(t){p(this,e),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=rs,this.length=t.length,this._features=t}return y(e,[{key:"feature",value:function(e){return new iy(this._features[e])}}]),e}(),oy={},sy={get exports(){return oy},set exports(e){oy=e}},uy=v,ly=Fl.VectorTileFeature,cy=hy;function hy(e,t){this.options=t||{},this.features=e,this.length=e.length}function fy(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}hy.prototype.feature=function(e){return new fy(this.features[e],this.options.extent)},fy.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var t=0;t<e.length;t++){for(var r=e[t],n=[],i=0;i<r.length;i++)n.push(new uy(r[i][0],r[i][1]));this.geometry.push(n)}return this.geometry},fy.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,r=-1/0,n=1/0,i=-1/0,a=0;a<e.length;a++)for(var o=e[a],s=0;s<o.length;s++){var u=o[s];t=Math.min(t,u.x),r=Math.max(r,u.x),n=Math.min(n,u.y),i=Math.max(i,u.y)}return[t,n,r,i]},fy.prototype.toGeoJSON=ly.prototype.toGeoJSON;var py=Gc,yy=cy;function dy(e){var t=new py;return function(e,t){for(var r in e.layers)t.writeMessage(3,vy,e.layers[r])}(e,t),t.finish()}function vy(e,t){var r;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var n={keys:[],values:[],keycache:{},valuecache:{}};for(r=0;r<e.length;r++)n.feature=e.feature(r),t.writeMessage(2,my,n);var i=n.keys;for(r=0;r<i.length;r++)t.writeStringField(3,i[r]);var a=n.values;for(r=0;r<a.length;r++)t.writeMessage(4,wy,a[r])}function my(e,t){var r=e.feature;void 0!==r.id&&t.writeVarintField(1,r.id),t.writeMessage(2,gy,e),t.writeVarintField(3,r.type),t.writeMessage(4,ky,r)}function gy(e,t){var r=e.feature,n=e.keys,i=e.values,a=e.keycache,o=e.valuecache;for(var s in r.properties){var u=r.properties[s],l=a[s];if(null!==u){void 0===l&&(n.push(s),a[s]=l=n.length-1),t.writeVarint(l);var c=typeof u;"string"!==c&&"boolean"!==c&&"number"!==c&&(u=JSON.stringify(u));var h=c+":"+u,f=o[h];void 0===f&&(i.push(u),o[h]=f=i.length-1),t.writeVarint(f)}}}function xy(e,t){return(t<<3)+(7&e)}function by(e){return e<<1^e>>31}function ky(e,t){for(var r=e.loadGeometry(),n=e.type,i=0,a=0,o=r.length,s=0;s<o;s++){var u=r[s],l=1;1===n&&(l=u.length),t.writeVarint(xy(1,l));for(var c=3===n?u.length-1:u.length,h=0;h<c;h++){1===h&&1!==n&&t.writeVarint(xy(2,c-1));var f=u[h].x-i,p=u[h].y-a;t.writeVarint(by(f)),t.writeVarint(by(p)),i+=f,a+=p}3===n&&t.writeVarint(xy(7,1))}}function wy(e,t){var r=typeof e;"string"===r?t.writeStringField(1,e):"boolean"===r?t.writeBooleanField(7,e):"number"===r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}function _y(e,t,r,n,i,a){if(!(i-n<=r)){var o=n+i>>1;Sy(e,t,o,n,i,a%2),_y(e,t,r,n,o-1,a+1),_y(e,t,r,o+1,i,a+1)}}function Sy(e,t,r,n,i,a){for(;i>n;){if(i-n>600){var o=i-n+1,s=r-n+1,u=Math.log(o),l=.5*Math.exp(2*u/3),c=.5*Math.sqrt(u*l*(o-l)/o)*(s-o/2<0?-1:1);Sy(e,t,r,Math.max(n,Math.floor(r-s*l/o+c)),Math.min(i,Math.floor(r+(o-s)*l/o+c)),a)}var h=t[2*r+a],f=n,p=i;for(Ay(e,t,n,r),t[2*i+a]>h&&Ay(e,t,n,i);f<p;){for(Ay(e,t,f,p),f++,p--;t[2*f+a]<h;)f++;for(;t[2*p+a]>h;)p--}t[2*n+a]===h?Ay(e,t,n,p):Ay(e,t,++p,i),p<=r&&(n=p+1),r<=p&&(i=p-1)}}function Ay(e,t,r,n){Iy(e,r,n),Iy(t,2*r,2*n),Iy(t,2*r+1,2*n+1)}function Iy(e,t,r){var n=e[t];e[t]=e[r],e[r]=n}function My(e,t,r,n){var i=e-r,a=t-n;return i*i+a*a}sy.exports=dy,oy.fromVectorTileJs=dy,oy.fromGeojsonVt=function(e,t){t=t||{};var r={};for(var n in e)r[n]=new yy(e[n].features,t),r[n].name=n,r[n].version=t.version,r[n].extent=t.extent;return dy({layers:r})},oy.GeoJSONWrapper=yy;var Ty,zy=function(e){return e[0]},By=function(e){return e[1]},Cy=function(){function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:zy,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:By,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Float64Array;p(this,e),this.nodeSize=i,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,s=this.ids=new o(t.length),u=this.coords=new a(2*t.length),l=0;l<t.length;l++)s[l]=l,u[2*l]=r(t[l]),u[2*l+1]=n(t[l]);_y(s,u,i,0,s.length-1,0)}return y(e,[{key:"range",value:function(e,t,r,n){return function(e,t,r,n,i,a,o){for(var s,u,l=[0,e.length-1,0],c=[];l.length;){var h=l.pop(),f=l.pop(),p=l.pop();if(f-p<=o)for(var y=p;y<=f;y++)s=t[2*y],u=t[2*y+1],s>=r&&s<=i&&u>=n&&u<=a&&c.push(e[y]);else{var d=Math.floor((p+f)/2);s=t[2*d],u=t[2*d+1],s>=r&&s<=i&&u>=n&&u<=a&&c.push(e[d]);var v=(h+1)%2;(0===h?r<=s:n<=u)&&(l.push(p),l.push(d-1),l.push(v)),(0===h?i>=s:a>=u)&&(l.push(d+1),l.push(f),l.push(v))}}return c}(this.ids,this.coords,e,t,r,n,this.nodeSize)}},{key:"within",value:function(e,t,r){return function(e,t,r,n,i,a){for(var o=[0,e.length-1,0],s=[],u=i*i;o.length;){var l=o.pop(),c=o.pop(),h=o.pop();if(c-h<=a)for(var f=h;f<=c;f++)My(t[2*f],t[2*f+1],r,n)<=u&&s.push(e[f]);else{var p=Math.floor((h+c)/2),y=t[2*p],d=t[2*p+1];My(y,d,r,n)<=u&&s.push(e[p]);var v=(l+1)%2;(0===l?r-i<=y:n-i<=d)&&(o.push(h),o.push(p-1),o.push(v)),(0===l?r+i>=y:n+i>=d)&&(o.push(p+1),o.push(c),o.push(v))}}return s}(this.ids,this.coords,e,t,r,this.nodeSize)}}]),e}(),Py={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},Ey=Math.fround||(Ty=new Float32Array(1),function(e){return Ty[0]=+e,Ty[0]}),Dy=function(){function e(t){p(this,e),this.options=qy(Object.create(Py),t),this.trees=new Array(this.options.maxZoom+1)}return y(e,[{key:"load",value:function(e){var t=this.options,r=t.log,n=t.minZoom,i=t.maxZoom,a=t.nodeSize;r&&console.time("total time");var o="prepare ".concat(e.length," points");r&&console.time(o),this.points=e;for(var s=[],u=0;u<e.length;u++)e[u].geometry&&s.push(Ly(e[u],u));this.trees[i+1]=new Cy(s,Ny,Zy,a,Float32Array),r&&console.timeEnd(o);for(var l=i;l>=n;l--){var c=+Date.now();s=this._cluster(s,l),this.trees[l]=new Cy(s,Ny,Zy,a,Float32Array),r&&console.log("z%d: %d clusters in %dms",l,s.length,+Date.now()-c)}return r&&console.timeEnd("total time"),this}},{key:"getClusters",value:function(e,t){var r=((e[0]+180)%360+360)%360-180,n=Math.max(-90,Math.min(90,e[1])),i=180===e[2]?180:((e[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)r=-180,i=180;else if(r>i){var o=this.getClusters([r,n,180,a],t),s=this.getClusters([-180,n,i,a],t);return o.concat(s)}var l,c=this.trees[this._limitZoom(t)],h=c.range(jy(r),Oy(a),jy(i),Oy(n)),f=[],p=u(h);try{for(p.s();!(l=p.n()).done;){var y=l.value,d=c.points[y];f.push(d.numPoints?Fy(d):this.points[d.index])}}catch(v){p.e(v)}finally{p.f()}return f}},{key:"getChildren",value:function(e){var t=this._getOriginId(e),r=this._getOriginZoom(e),n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);var a=i.points[t];if(!a)throw new Error(n);var o,s=this.options.radius/(this.options.extent*Math.pow(2,r-1)),l=i.within(a.x,a.y,s),c=[],h=u(l);try{for(h.s();!(o=h.n()).done;){var f=o.value,p=i.points[f];p.parentId===e&&c.push(p.numPoints?Fy(p):this.points[p.index])}}catch(y){h.e(y)}finally{h.f()}if(0===c.length)throw new Error(n);return c}},{key:"getLeaves",value:function(e,t,r){var n=[];return this._appendLeaves(n,e,t=t||10,r=r||0,0),n}},{key:"getTile",value:function(e,t,r){var n=this.trees[this._limitZoom(e)],i=Math.pow(2,e),a=this.options,o=a.extent,s=a.radius/o,u=(r-s)/i,l=(r+1+s)/i,c={features:[]};return this._addTileFeatures(n.range((t-s)/i,u,(t+1+s)/i,l),n.points,t,r,i,c),0===t&&this._addTileFeatures(n.range(1-s/i,u,1,l),n.points,i,r,i,c),t===i-1&&this._addTileFeatures(n.range(0,u,s/i,l),n.points,-1,r,i,c),c.features.length?c:null}},{key:"getClusterExpansionZoom",value:function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}},{key:"_appendLeaves",value:function(e,t,r,n,i){var a,o=this.getChildren(t),s=u(o);try{for(s.s();!(a=s.n()).done;){var l=a.value,c=l.properties;if(c&&c.cluster?i+c.point_count<=n?i+=c.point_count:i=this._appendLeaves(e,c.cluster_id,r,n,i):i<n?i++:e.push(l),e.length===r)break}}catch(h){s.e(h)}finally{s.f()}return i}},{key:"_addTileFeatures",value:function(e,t,r,n,i,a){var o,s=u(e);try{for(s.s();!(o=s.n()).done;){var l=t[o.value],c=l.numPoints,h=void 0,f=void 0,p=void 0;if(c)h=Ry(l),f=l.x,p=l.y;else{var y=this.points[l.index];h=y.properties,f=jy(y.geometry.coordinates[0]),p=Oy(y.geometry.coordinates[1])}var d={type:1,geometry:[[Math.round(this.options.extent*(f*i-r)),Math.round(this.options.extent*(p*i-n))]],tags:h},v=void 0;c?v=l.id:this.options.generateId?v=l.index:this.points[l.index].id&&(v=this.points[l.index].id),void 0!==v&&(d.id=v),a.features.push(d)}}catch(m){s.e(m)}finally{s.f()}}},{key:"_limitZoom",value:function(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}},{key:"_cluster",value:function(e,t){for(var r=[],n=this.options,i=n.radius,a=n.extent,o=n.reduce,s=n.minPoints,l=i/(a*Math.pow(2,t)),c=0;c<e.length;c++){var h=e[c];if(!(h.zoom<=t)){h.zoom=t;var f,p=this.trees[t+1],y=p.within(h.x,h.y,l),d=h.numPoints||1,v=d,m=u(y);try{for(m.s();!(f=m.n()).done;){var g=f.value,x=p.points[g];x.zoom>t&&(v+=x.numPoints||1)}}catch(E){m.e(E)}finally{m.f()}if(v>d&&v>=s){var b,k=h.x*d,w=h.y*d,_=o&&d>1?this._map(h,!0):null,S=(c<<5)+(t+1)+this.points.length,A=u(y);try{for(A.s();!(b=A.n()).done;){var I=b.value,M=p.points[I];if(!(M.zoom<=t)){M.zoom=t;var T=M.numPoints||1;k+=M.x*T,w+=M.y*T,M.parentId=S,o&&(_||(_=this._map(h,!0)),o(_,this._map(M)))}}}catch(E){A.e(E)}finally{A.f()}h.parentId=S,r.push(Vy(k/v,w/v,S,v,_))}else if(r.push(h),v>1){var z,B=u(y);try{for(B.s();!(z=B.n()).done;){var C=z.value,P=p.points[C];P.zoom<=t||(P.zoom=t,r.push(P))}}catch(E){B.e(E)}finally{B.f()}}}}return r}},{key:"_getOriginId",value:function(e){return e-this.points.length>>5}},{key:"_getOriginZoom",value:function(e){return(e-this.points.length)%32}},{key:"_map",value:function(e,t){if(e.numPoints)return t?qy({},e.properties):e.properties;var r=this.points[e.index].properties,n=this.options.map(r);return t&&n===r?qy({},n):n}}]),e}();function Vy(e,t,r,n,i){return{x:Ey(e),y:Ey(t),zoom:1/0,id:r,parentId:-1,numPoints:n,properties:i}}function Ly(e,t){var r=f(e.geometry.coordinates,2),n=r[0],i=r[1];return{x:Ey(jy(n)),y:Ey(Oy(i)),zoom:1/0,index:t,parentId:-1}}function Fy(e){return{type:"Feature",id:e.id,properties:Ry(e),geometry:{type:"Point",coordinates:[(t=e.x,360*(t-.5)),Uy(e.y)]}};var t}function Ry(e){var t=e.numPoints,r=t>=1e4?"".concat(Math.round(t/1e3),"k"):t>=1e3?Math.round(t/100)/10+"k":t;return qy(qy({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:r})}function jy(e){return e/360+.5}function Oy(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function Uy(e){var t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function qy(e,t){for(var r in t)e[r]=t[r];return e}function Ny(e){return e.x}function Zy(e){return e.y}function Xy(e,t,r,n){for(var i,a=n,o=r-t>>1,s=r-t,u=e[t],l=e[t+1],c=e[r],h=e[r+1],f=t+3;f<r;f+=3){var p=Gy(e[f],e[f+1],u,l,c,h);if(p>a)i=f,a=p;else if(p===a){var y=Math.abs(f-o);y<s&&(i=f,s=y)}}a>n&&(i-t>3&&Xy(e,t,i,n),e[i+2]=a,r-i>3&&Xy(e,i,r,n))}function Gy(e,t,r,n,i,a){var o=i-r,s=a-n;if(0!==o||0!==s){var u=((e-r)*o+(t-n)*s)/(o*o+s*s);u>1?(r=i,n=a):u>0&&(r+=o*u,n+=s*u)}return(o=e-r)*o+(s=t-n)*s}function Yy(e,t,r,n){var i={id:void 0===e?null:e,type:t,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,r=e.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)Ky(e,t);else if("Polygon"===r||"MultiLineString"===r)for(var n=0;n<t.length;n++)Ky(e,t[n]);else if("MultiPolygon"===r)for(n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)Ky(e,t[n][i])}(i),i}function Ky(e,t){for(var r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function Jy(e,t,r,n){if(t.geometry){var i=t.geometry.coordinates,a=t.geometry.type,o=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2),s=[],u=t.id;if(r.promoteId?u=t.properties[r.promoteId]:r.generateId&&(u=n||0),"Point"===a)Wy(i,s);else if("MultiPoint"===a)for(var l=0;l<i.length;l++)Wy(i[l],s);else if("LineString"===a)Hy(i,s,o,!1);else if("MultiLineString"===a){if(r.lineMetrics){for(l=0;l<i.length;l++)Hy(i[l],s=[],o,!1),e.push(Yy(u,"LineString",s,t.properties));return}$y(i,s,o,!1)}else if("Polygon"===a)$y(i,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(l=0;l<t.geometry.geometries.length;l++)Jy(e,{id:u,geometry:t.geometry.geometries[l],properties:t.properties},r,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];$y(i[l],c,o,!0),s.push(c)}}e.push(Yy(u,a,s,t.properties))}}function Wy(e,t){t.push(Qy(e[0])),t.push(ed(e[1])),t.push(0)}function Hy(e,t,r,n){for(var i,a,o=0,s=0;s<e.length;s++){var u=Qy(e[s][0]),l=ed(e[s][1]);t.push(u),t.push(l),t.push(0),s>0&&(o+=n?(i*l-u*a)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-a,2))),i=u,a=l}var c=t.length-3;t[2]=1,Xy(t,0,c,r),t[c+2]=1,t.size=Math.abs(o),t.start=0,t.end=t.size}function $y(e,t,r,n){for(var i=0;i<e.length;i++){var a=[];Hy(e[i],a,r,n),t.push(a)}}function Qy(e){return e/360+.5}function ed(e){var t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function td(e,t,r,n,i,a,o,s){if(n/=t,a>=(r/=t)&&o<n)return e;if(o<r||a>=n)return null;for(var u=[],l=0;l<e.length;l++){var c=e[l],h=c.geometry,f=c.type,p=0===i?c.minX:c.minY,y=0===i?c.maxX:c.maxY;if(p>=r&&y<n)u.push(c);else if(!(y<r||p>=n)){var d=[];if("Point"===f||"MultiPoint"===f)rd(h,d,r,n,i);else if("LineString"===f)nd(h,d,r,n,i,!1,s.lineMetrics);else if("MultiLineString"===f)ad(h,d,r,n,i,!1);else if("Polygon"===f)ad(h,d,r,n,i,!0);else if("MultiPolygon"===f)for(var v=0;v<h.length;v++){var m=[];ad(h[v],m,r,n,i,!0),m.length&&d.push(m)}if(d.length){if(s.lineMetrics&&"LineString"===f){for(v=0;v<d.length;v++)u.push(Yy(c.id,f,d[v],c.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===d.length?(f="LineString",d=d[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===d.length?"Point":"MultiPoint"),u.push(Yy(c.id,f,d,c.tags))}}}return u.length?u:null}function rd(e,t,r,n,i){for(var a=0;a<e.length;a+=3){var o=e[a+i];o>=r&&o<=n&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function nd(e,t,r,n,i,a,o){for(var s,u,l=id(e),c=0===i?sd:ud,h=e.start,f=0;f<e.length-3;f+=3){var p=e[f],y=e[f+1],d=e[f+2],v=e[f+3],m=e[f+4],g=0===i?p:y,x=0===i?v:m,b=!1;o&&(s=Math.sqrt(Math.pow(p-v,2)+Math.pow(y-m,2))),g<r?x>r&&(u=c(l,p,y,v,m,r),o&&(l.start=h+s*u)):g>n?x<n&&(u=c(l,p,y,v,m,n),o&&(l.start=h+s*u)):od(l,p,y,d),x<r&&g>=r&&(u=c(l,p,y,v,m,r),b=!0),x>n&&g<=n&&(u=c(l,p,y,v,m,n),b=!0),!a&&b&&(o&&(l.end=h+s*u),t.push(l),l=id(e)),o&&(h+=s)}var k=e.length-3;p=e[k],y=e[k+1],d=e[k+2],(g=0===i?p:y)>=r&&g<=n&&od(l,p,y,d),k=l.length-3,a&&k>=3&&(l[k]!==l[0]||l[k+1]!==l[1])&&od(l,l[0],l[1],l[2]),l.length&&t.push(l)}function id(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function ad(e,t,r,n,i,a){for(var o=0;o<e.length;o++)nd(e[o],t,r,n,i,a,!1)}function od(e,t,r,n){e.push(t),e.push(r),e.push(n)}function sd(e,t,r,n,i,a){var o=(a-t)/(n-t);return e.push(a),e.push(r+(i-r)*o),e.push(1),o}function ud(e,t,r,n,i,a){var o=(a-r)/(i-r);return e.push(t+(n-t)*o),e.push(a),e.push(1),o}function ld(e,t){for(var r=[],n=0;n<e.length;n++){var i,a=e[n],o=a.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)i=cd(a.geometry,t);else if("MultiLineString"===o||"Polygon"===o){i=[];for(var s=0;s<a.geometry.length;s++)i.push(cd(a.geometry[s],t))}else if("MultiPolygon"===o)for(i=[],s=0;s<a.geometry.length;s++){for(var u=[],l=0;l<a.geometry[s].length;l++)u.push(cd(a.geometry[s][l],t));i.push(u)}r.push(Yy(a.id,o,i,a.tags))}return r}function cd(e,t){var r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(var n=0;n<e.length;n+=3)r.push(e[n]+t,e[n+1],e[n+2]);return r}function hd(e,t){if(e.transformed)return e;var r,n,i,a=1<<e.z,o=e.x,s=e.y;for(r=0;r<e.features.length;r++){var u=e.features[r],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(n=0;n<l.length;n+=2)u.geometry.push(fd(l[n],l[n+1],t,a,o,s));else for(n=0;n<l.length;n++){var h=[];for(i=0;i<l[n].length;i+=2)h.push(fd(l[n][i],l[n][i+1],t,a,o,s));u.geometry.push(h)}}return e.transformed=!0,e}function fd(e,t,r,n,i,a){return[Math.round(r*(e*n-i)),Math.round(r*(t*n-a))]}function pd(e,t,r,n,i){for(var a=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){o.numFeatures++,yd(o,e[s],a,i);var u=e[s].minX,l=e[s].minY,c=e[s].maxX,h=e[s].maxY;u<o.minX&&(o.minX=u),l<o.minY&&(o.minY=l),c>o.maxX&&(o.maxX=c),h>o.maxY&&(o.maxY=h)}return o}function yd(e,t,r,n){var i=t.geometry,a=t.type,o=[];if("Point"===a||"MultiPoint"===a)for(var s=0;s<i.length;s+=3)o.push(i[s]),o.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===a)dd(o,i,e,r,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(s=0;s<i.length;s++)dd(o,i[s],e,r,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)dd(o,l[s],e,r,!0,0===s)}if(o.length){var c=t.tags||null;if("LineString"===a&&n.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var f={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:c};null!==t.id&&(f.id=t.id),e.features.push(f)}}function dd(e,t,r,n,i,a){var o=n*n;if(n>0&&t.size<(i?o:n))r.numPoints+=t.length/3;else{for(var s=[],u=0;u<t.length;u+=3)(0===n||t[u+2]>o)&&(r.numSimplified++,s.push(t[u]),s.push(t[u+1])),r.numPoints++;i&&function(e,t){for(var r=0,n=0,i=e.length,a=i-2;n<i;a=n,n+=2)r+=(e[n]-e[a])*(e[n+1]+e[a+1]);if(r>0===t)for(n=0,i=e.length;n<i/2;n+=2){var o=e[n],s=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=o,e[i-1-n]=s}}(s,a),e.push(s)}}function vd(e,t){var r=(t=this.options=function(e,t){for(var r in t)e[r]=t[r];return e}(Object.create(this.options),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=function(e,t){var r=[];if("FeatureCollection"===e.type)for(var n=0;n<e.features.length;n++)Jy(r,e.features[n],t,n);else Jy(r,"Feature"===e.type?e:{geometry:e},t);return r}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(e,t){var r=t.buffer/t.extent,n=e,i=td(e,1,-1-r,r,0,-1,2,t),a=td(e,1,1-r,2+r,0,-1,2,t);return(i||a)&&(n=td(e,1,-r,1+r,0,-1,2,t)||[],i&&(n=ld(i,1).concat(n)),a&&(n=n.concat(ld(a,-1)))),n}(n,t),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function md(e,t,r){return 32*((1<<e)*r+t)+e}function gd(e,t){var r=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);var n=this._geoJSONIndex.getTile(r.z,r.x,r.y);if(!n)return t(null,null);var i=new ay(n.features),a=oy(i);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),t(null,{vectorTile:i,rawData:a.buffer})}vd.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},vd.prototype.splitTile=function(e,t,r,n,i,a,o){for(var s=[e,t,r,n],u=this.options,l=u.debug;s.length;){n=s.pop(),r=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,h=md(t,r,n),f=this.tiles[h];if(!f&&(l>1&&console.time("creation"),f=this.tiles[h]=pd(e,t,r,n,u),this.tileCoords.push({z:t,x:r,y:n}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,n,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=e,i){if(t===u.maxZoom||t===i)continue;var y=1<<i-t;if(r!==Math.floor(a/y)||n!==Math.floor(o/y))continue}else if(t===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue;if(f.source=null,0!==e.length){l>1&&console.time("clipping");var d,v,m,g,x,b,k=.5*u.buffer/u.extent,w=.5-k,_=.5+k,S=1+k;d=v=m=g=null,x=td(e,c,r-k,r+_,0,f.minX,f.maxX,u),b=td(e,c,r+w,r+S,0,f.minX,f.maxX,u),e=null,x&&(d=td(x,c,n-k,n+_,1,f.minY,f.maxY,u),v=td(x,c,n+w,n+S,1,f.minY,f.maxY,u),x=null),b&&(m=td(b,c,n-k,n+_,1,f.minY,f.maxY,u),g=td(b,c,n+w,n+S,1,f.minY,f.maxY,u),b=null),l>1&&console.timeEnd("clipping"),s.push(d||[],t+1,2*r,2*n),s.push(v||[],t+1,2*r,2*n+1),s.push(m||[],t+1,2*r+1,2*n),s.push(g||[],t+1,2*r+1,2*n+1)}}},vd.prototype.getTile=function(e,t,r){var n=this.options,i=n.extent,a=n.debug;if(e<0||e>24)return null;var o=1<<e,s=md(e,t=(t%o+o)%o,r);if(this.tiles[s])return hd(this.tiles[s],i);a>1&&console.log("drilling down to z%d-%d-%d",e,t,r);for(var u,l=e,c=t,h=r;!u&&l>0;)l--,c=Math.floor(c/2),h=Math.floor(h/2),u=this.tiles[md(l,c,h)];return u&&u.source?(a>1&&console.log("found parent tile z%d-%d-%d",l,c,h),a>1&&console.time("drilling down"),this.splitTile(u.source,l,c,h,e,t,r),a>1&&console.timeEnd("drilling down"),this.tiles[s]?hd(this.tiles[s],i):null):null};var xd=function(e){l(r,e);var t=c(r);function r(e,n,i,a,o){var s;return p(this,r),s=t.call(this,e,n,i,a,gd),o&&(s.loadGeoJSON=o),s}return y(r,[{key:"loadData",value:function(e,t){var r=this,n=e&&e.request,i=n&&n.collectResourceTiming;this.loadGeoJSON(e,(function(a,o){if(a||!o)return t(a);if("object"!=typeof o)return t(new Error("Input data given to '".concat(e.source,"' is not a valid GeoJSON object.")));ey(o,!0);try{if(e.filter){var s=Fr(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===s.result)throw new Error(s.value.map((function(e){return"".concat(e.key,": ").concat(e.message)})).join(", "));var l=o.features.filter((function(e){return s.value.evaluate({zoom:0},e)}));o={type:"FeatureCollection",features:l}}r._geoJSONIndex=e.cluster?new Dy(function(e){var t=e.superclusterOptions,r=e.clusterProperties;if(!r||!t)return t;for(var n={},i={},a={accumulated:null,zoom:0},o={properties:null},s=Object.keys(r),l=0,c=s;l<c.length;l++){var h=c[l],p=f(r[h],2),y=p[0],d=Fr(p[1]),v=Fr("string"==typeof y?[y,["accumulated"],["get",h]]:y);n[h]=d.value,i[h]=v.value}return t.map=function(e){o.properties=e;var t,r={},i=u(s);try{for(i.s();!(t=i.n()).done;){var l=t.value;r[l]=n[l].evaluate(a,o)}}catch(c){i.e(c)}finally{i.f()}return r},t.reduce=function(e,t){o.properties=t;var r,n=u(s);try{for(n.s();!(r=n.n()).done;){var l=r.value;a.accumulated=e[l],e[l]=i[l].evaluate(a,o)}}catch(c){n.e(c)}finally{n.f()}},t}(e)).load(o.features):function(e,t){return new vd(e,t)}(o,e.geojsonVtOptions)}catch(a){return t(a)}r.loaded={};var c={};if(i){var h=Dn(n);h&&(c.resourceTiming={},c.resourceTiming[e.source]=JSON.parse(JSON.stringify(h)))}t(null,c)}))}},{key:"reloadTile",value:function(e,t){var a=this.loaded;return a&&a[e.uid]?n(i(r.prototype),"reloadTile",this).call(this,e,t):this.loadTile(e,t)}},{key:"loadGeoJSON",value:function(e,t){if(e.request)!function(e,t){kn(I(e,{type:"json"}),t)}(e.request,t);else{if("string"!=typeof e.data)return t(new Error("Input data given to '".concat(e.source,"' is not a valid GeoJSON object.")));try{return t(null,JSON.parse(e.data))}catch(v){return t(new Error("Input data given to '".concat(e.source,"' is not a valid GeoJSON object.")))}}}},{key:"getClusterExpansionZoom",value:function(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}},{key:"getClusterChildren",value:function(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}},{key:"getClusterLeaves",value:function(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}]),r}($p),bd=function(){function e(t){var r=this;p(this,e),this.self=t,this.actor=new Ln(t,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=Bf({name:"mercator"}),this.workerSourceTypes={vector:$p,geojson:xd},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(e,t){if(r.workerSourceTypes[e])throw new Error('Worker source with name "'.concat(e,'" already registered.'));r.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=function(e){if(xa.isParsed())throw new Error("RTL text plugin already registered.");xa.applyArabicShaping=e.applyArabicShaping,xa.processBidirectionalText=e.processBidirectionalText,xa.processStyledBidirectionalText=e.processStyledBidirectionalText}}return y(e,[{key:"clearCaches",value:function(e,t,r){delete this.layerIndexes[e],delete this.availableImages[e],delete this.workerSources[e],delete this.demWorkerSources[e],r()}},{key:"checkIfReady",value:function(e,t,r){r()}},{key:"setReferrer",value:function(e,t){this.referrer=t}},{key:"spriteLoaded",value:function(e,t){for(var r in this.isSpriteLoaded[e]=t,this.workerSources[e]){var n=this.workerSources[e][r];for(var i in n)n[i]instanceof $p&&(n[i].isSpriteLoaded=t,n[i].fire(new On("isSpriteLoaded")))}}},{key:"setImages",value:function(e,t,r){for(var n in this.availableImages[e]=t,this.workerSources[e]){var i=this.workerSources[e][n];for(var a in i)i[a].availableImages=t}r()}},{key:"enableTerrain",value:function(e,t,r){this.terrain=t,r()}},{key:"setProjection",value:function(e,t){this.projections[e]=Bf(t)}},{key:"setLayers",value:function(e,t,r){this.getLayerIndex(e).replace(t),r()}},{key:"updateLayers",value:function(e,t,r){this.getLayerIndex(e).update(t.layers,t.removedIds),r()}},{key:"loadTile",value:function(e,t,r){var n=this.enableTerrain?I({enableTerrain:this.terrain},t):t;n.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source).loadTile(n,r)}},{key:"loadDEMTile",value:function(e,t,r){var n=this.enableTerrain?I({buildQuadTree:this.terrain},t):t;this.getDEMWorkerSource(e,t.source).loadTile(n,r)}},{key:"reloadTile",value:function(e,t,r){var n=this.enableTerrain?I({enableTerrain:this.terrain},t):t;n.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source).reloadTile(n,r)}},{key:"abortTile",value:function(e,t,r){this.getWorkerSource(e,t.type,t.source).abortTile(t,r)}},{key:"removeTile",value:function(e,t,r){this.getWorkerSource(e,t.type,t.source).removeTile(t,r)}},{key:"removeSource",value:function(e,t,r){if(this.workerSources[e]&&this.workerSources[e][t.type]&&this.workerSources[e][t.type][t.source]){var n=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==n.removeSource?n.removeSource(t,r):r()}}},{key:"loadWorkerSource",value:function(e,t,r){try{this.self.importScripts(t.url),r()}catch(e){r(e.toString())}}},{key:"syncRTLPluginState",value:function(e,t,r){try{xa.setState(t);var n=xa.getPluginURL();if(xa.isLoaded()&&!xa.isParsed()&&null!=n){this.self.importScripts(n);var i=xa.isParsed();r(i?void 0:new Error("RTL Text Plugin failed to import scripts from ".concat(n)),i)}}catch(e){r(e.toString())}}},{key:"getAvailableImages",value:function(e){var t=this.availableImages[e];return t||(t=[]),t}},{key:"getLayerIndex",value:function(e){var t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new Qf),t}},{key:"getWorkerSource",value:function(e,t,r){var n=this;if(this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),!this.workerSources[e][t][r]){var i={send:function(t,r,i,a,o,s){n.actor.send(t,r,i,e,o,s)},scheduler:this.actor.scheduler};this.workerSources[e][t][r]=new this.workerSourceTypes[t](i,this.getLayerIndex(e),this.getAvailableImages(e),this.isSpriteLoaded[e])}return this.workerSources[e][t][r]}},{key:"getDEMWorkerSource",value:function(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new Qp),this.demWorkerSources[e][t]}},{key:"enforceCacheSizeLimit",value:function(e,t){!function(e){mn(),yn&&yn.then((function(t){t.keys().then((function(r){for(var n=0;n<r.length-e;n++)t.delete(r[n])}))}))}(t)}},{key:"getWorkerPerformanceMetrics",value:function(e,t,r){r(void 0,void 0)}}]),e}();"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new bd(self))}()}()}();
//# sourceMappingURL=mapbox-gl-csp-worker.cb9c0912.worker.js.map